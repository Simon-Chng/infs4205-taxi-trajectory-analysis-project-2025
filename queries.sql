-- Taxi Trajectory Data from Kaggle [https://www.kaggle.com/datasets/crailtap/taxi-trajectory] will be used in this project.

/* Environment Requirement*/
-- Make sure you have installed Python3.13 environment and the following packages:
-- pip install pytz numpy scipy fastdtw

/* Data Preparation */
-- Please run data_preprocessing.py first to pre-process the data:
-- python data_preprocessing.py

/* DATA BASE CREATION  */
-- Connect to PostgreSQL in the terminal
-- psql -U postgres

-- Step 1: Create a new database
CREATE DATABASE porto_taxi_trajectory;

-- Step 2: Connect to the database
\c porto_taxi_trajectory;

-- Step 3: Enable the necessary extensions
CREATE EXTENSION postgis;
CREATE EXTENSION plpython3u;

-- Step 4: Create the table to store the taxi trajectory data
DROP TABLE IF EXISTS taxi_trajectory;
CREATE TABLE taxi_trajectory (
    trip_id BIGINT,
    call_type CHAR(1),
    origin_call INTEGER,
    origin_stand INTEGER,
    taxi_id INTEGER,
    day_type CHAR(1),
    missing_data BOOLEAN,
    polyline GEOMETRY(LINESTRING, 4326),
    timestamps TIMESTAMP WITH TIME ZONE[],
    total_travel_time INTEGER,
    start_local_time TIMESTAMP WITHOUT TIME ZONE,
    end_local_time TIMESTAMP WITHOUT TIME ZONE,
    hour_of_day INTEGER,
    point_count INTEGER
);

-- Step 5: Insert the processed data into the table
COPY taxi_trajectory
FROM '/Users/simonchng/Downloads/infs_4205_7205_prac_2/train_preprocessed.csv'
WITH (
    FORMAT csv,
    HEADER,
    DELIMITER ',',
    NULL ''
);

/*
The following location are captured by https://geojson.io/ and used for query tasks and test cases:

1. Francisco Sá Carneiro Airport
ST_GeomFromText('POLYGON((-8.676514220811896 41.22748617051806,-8.662971112404733 41.23761712125881,-8.680597042810376 41.26953327959913,-8.695944813498926 41.266930675298255,-8.697524142221397 41.232466971412066,-8.676514220811896 41.22748617051806))', 4326)

2. Campanhã Train Station
ST_GeomFromText('POLYGON((-8.588691530277202 41.14725942933609,-8.584291957451597 41.14603884995606,-8.582079306790718 41.15061106220182,-8.581976392807064 41.15181218372203,-8.585784210222613 41.15276144161274,-8.588691530277202 41.14725942933609))', 4326)

3. Avenida dos Aliados (CBD)
ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)

4. Estádio do Dragão (Football Stadium)
ST_GeomFromText('POLYGON((-8.581945663894942 41.15845020195181,-8.580602174156041 41.16282480723726,-8.582785344981687 41.16407644692981,-8.586026513975384 41.163254665988546,-8.586715052466644 41.161674289059675,-8.584481500776263 41.15909503206146,-8.581945663894942 41.15845020195181))', 4326)

5. Hospital
ST_GeomFromText('POLYGON((-8.6204120171505 41.14585489815653,-8.617463270972934 41.14625862693123,-8.61798408847909 41.14821379254357,-8.620312449097725 41.14797733018469,-8.620695403146357 41.147239100749715,-8.6204120171505 41.14585489815653))', 4326)

6. Clérigos Tower (Tourist Area)
ST_GeomFromText('POLYGON((-8.615571934016486 41.145022490170476,-8.61335460385007 41.14561477721966,-8.613371338416869 41.14608104198402,-8.614199699498528 41.14618185555062,-8.615768565182918 41.14557382137204,-8.615571934016486 41.145022490170476))', 4326)

*/

/* QUERY PLAN will be generate by EXPLAIN (ANALYZE ON, BUFFERS ON) [same sql queries...] */

/* 
Query Task 1: Spatio-Temporal Query
Find all trips during a given date and time range whose full trajectory is either inside or not entirely within a defined region.
*/

/* Test Case 1.1: In Sept 2013, the morning rush hour, the entire trip was in CBD */
/* Test Case 1.1 with Only indexing temporal data (B-tree on start_local_time and hour_of_day) */
CREATE INDEX idx_start_local_time_btree ON taxi_trajectory (start_local_time);
CREATE INDEX idx_hour_of_day_btree ON taxi_trajectory (hour_of_day);

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-10-01 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_CoveredBy(
    polyline,
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)
  );

DROP INDEX idx_start_local_time_btree;
DROP INDEX idx_hour_of_day_btree;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1379142093620000440	"2013-09-14 08:01:33"	"2013-09-14 08:03:18"	"0102000020E610000008000000950C0055DC3821C0B3D30FEA2293444048A30227DB3821C0062E8F35239344407C48F8DEDF3821C0B3D30FEA229344402FFCE07CEA3821C08CB96B09F9924440E2E995B20C3921C0BADC60A8C3924440AE6186C6133921C0DA91EA3BBF924440E2AFC91AF53821C0CD920035B59244401538D906EE3821C05A83F755B9924440"
1380269988620000008	"2013-09-27 09:19:48"	"2013-09-27 09:22:33"	"0102000020E61000000C000000E31934F44F3821C012329067979344407DCF4884463821C0250516C094934440E31934F44F3821C0EB6E9EEA9093444049641F64593821C04C7155D977934440C972124A5F3821C0F816D68D7793444096EA025E663821C0EC34D25279934440168A743FA73821C065FB90B75C93444015E126A3CA3821C0BF0CC68844934440FC1C1F2DCE3821C0C6FD47A64393444049861C5BCF3821C0390D51853F93444062BEBC00FB3821C0A6D425E318934440FB73D190F13821C0CC7A319413934440"
1379406890620000038	"2013-09-17 09:34:50"	"2013-09-17 09:37:35"	"0102000020E61000000C000000172EABB0193821C0F3203D450E93444064062AE3DF3721C0207EFE7BF092444097FDBAD39D3721C059F78F85E8924440FE648C0FB33721C033349E08E2924440E4A08499B63721C0E0D91EBDE192444030B8E68EFE3721C073BB97FBE4924440B0AE0AD4623821C0EDD808C4EB92444015E126A3CA3821C04033880FEC924440C9772975C93821C006F4C29D0B934440FCE25295B63821C0D36BB3B1129344402FF7C951803821C0126745D444934440B0912408573821C00C93A98251934440"
1379667568620000080	"2013-09-20 09:59:28"	"2013-09-20 09:59:43"	"0102000020E61000000200000095D233BDC43821C00611A969179344407C0E2C47C83821C0ACC5A70018934440"
1379750693620000038	"2013-09-21 09:04:53"	"2013-09-21 09:06:38"	"0102000020E610000008000000B000A60C1C3821C0000341800C9344401711C5E40D3821C0EDF5EE8FF792444098E0D407923721C0069D103AE89244404B94BDA59C3721C019709692E59244407DAD4B8DD03721C0D9E89C9FE29244404A99D4D0063821C0868E1D54E29244401711C5E40D3821C0809D9B36E392444030D5CC5A0A3821C0D9E89C9FE2924440"
1379925012620000403	"2013-09-23 09:30:12"	"2013-09-23 09:30:27"	"0102000020E6100000020000002FDFFAB0DE3821C00C022B871693444048C0E8F2E63821C0CC5D4BC807934440"
1380182921620000038	"2013-09-26 09:08:41"	"2013-09-26 09:09:56"	"0102000020E610000006000000302C7FBE2D3821C085B01A4B58934440965984622B3821C05F27F5656993444030DAE385743821C005DCF3FC699344402F88484DBB3821C09966BAD749934440959D7E50173921C0467BBC900E934440AE0FEB8D5A3921C006F4C29D0B934440"
1380355071620000038	"2013-09-28 08:57:51"	"2013-09-28 09:02:36"	"0102000020E6100000140000004AB6BA9C123821C099D53BDC0E934440B0A9F3A8F83721C0395FECBDF89244406475ABE7A43721C060E811A3E79244406475ABE7A43721C0B933130CE7924440B1DEA815A63721C0C0249529E69244403161342BDB3721C026529ACDE3924440FCFF3861C23821C04641F0F8F6924440FC8BA031933821C01FF296AB1F9344406397A8DE1A3821C0E509849D62934440630B410E4A3821C02C9FE57970934440E31934F44F3821C07808E3A77193444030833122513821C025AE635C71934440632827DA553821C0D253E41071934440E3AAB2EF8A3821C03F558506629344404969368FC33821C03FFED2A23E934440AE7E6C921F3921C0E04DB7EC10934440E1B4E0455F3921C0EC2FBB270F934440145AD6FD633921C0EC2FBB270F934440C7F0D8CF623921C0EC2FBB270F934440944BE3175E3921C099D53BDC0E934440"
1380530722620000453	"2013-09-30 09:45:22"	"2013-09-30 09:50:37"	"0102000020E610000016000000E4F736FDD93721C0B91B446B45934440FDBB3E73D63721C0BF0CC688449344403161342BDB3721C0AC39403047934440CA332F87DD3721C0E6CFB7054B9344403161342BDB3721C0D9EDB3CA4C9344407DCA3159DC3721C00C76C3B64593444064062AE3DF3721C052EE3EC747934440179D2CB5DE3721C0392A37514B9344407DCA3159DC3721C0392A37514B9344403161342BDB3721C08693347F4C934440CA332F87DD3721C0392A37514B9344403161342BDB3721C065DEAAEB50934440E4F736FDD93721C07FA2B2614D934440E4F736FDD93721C0126745D4449344403161342BDB3721C0126745D444934440E4F736FDD93721C0F9A23D5E48934440978E39CFD83721C04CFDBCA9489344403161342BDB3721C0460C3B8C499344407DCA3159DC3721C0ECC039234A934440E4F736FDD93721C0460C3B8C49934440E4F736FDD93721C09F573CF548934440E4F736FDD93721C09F573CF548934440"
1379666757620000038	"2013-09-20 09:45:57"	"2013-09-20 09:50:27"	"0102000020E610000013000000E388B5F8143821C08602B683119344404A42226DE33721C04641F0F8F6924440CBA2B08BA23721C000AC8E1CE99244406440F67AF73721C000AC8E1CE99244401616DC0F783821C073D87DC7F0924440AF963B33C13821C0335184D4ED92444096986725AD3821C0A0C6BDF90D934440C90391459A3821C08602B6831193444016F9F5436C3821C0E6B2D1393F934440B0E3BF40103821C04C378941609344407DB262B83A3821C098BD6C3B6D93444016855D143D3821C04563EDEF6C934440B05758703F3821C098BD6C3B6D93444030A017EE5C3821C085EAE6E26F934440AF3F89CF9D3821C052280B5F5F93444015C440D7BE3821C0D92780626493444015C440D7BE3821C06CEC12D55B934440151BF33AE23821C06C9560713893444062BEBC00FB3821C0EC4CA1F31A934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Gather  (cost=7049.35..168989.58 rows=265 width=842) (actual time=62.694..66.271 rows=10 loops=1)"
"  Workers Planned: 2"
"  Workers Launched: 2"
"  Buffers: shared hit=6899"
"  ->  Parallel Bitmap Heap Scan on taxi_trajectory  (cost=6049.35..167963.08 rows=110 width=842) (actual time=22.676..25.514 rows=3 loops=3)"
"        Recheck Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-10-01 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9))"
"        Rows Removed by Index Recheck: 3237"
"        Filter: st_coveredby(polyline, '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"        Rows Removed by Filter: 6409"
"        Heap Blocks: exact=2773"
"        Buffers: shared hit=6899"
"        ->  BitmapAnd  (cost=6049.35..6049.35 rows=19494 width=0) (actual time=57.087..57.088 rows=0 loops=1)"
"              Buffers: shared hit=594"
"              ->  Bitmap Index Scan on idx_start_local_time_btree  (cost=0.00..2990.66 rows=143023 width=0) (actual time=16.844..16.844 rows=144824 loops=1)"
"                    Index Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-10-01 00:00:00'::timestamp without time zone))"
"                    Buffers: shared hit=396"
"              ->  Bitmap Index Scan on idx_hour_of_day_btree  (cost=0.00..3058.31 rows=228188 width=0) (actual time=38.888..38.889 rows=230895 loops=1)"
"                    Index Cond: ((hour_of_day >= 7) AND (hour_of_day <= 9))"
"                    Buffers: shared hit=198"
"Planning Time: 0.342 ms"
"Execution Time: 66.308 ms"
 */

/* Test Case 1.1: In Sept 2013, the morning rush hour, the entire trip was in CBD */
/* Test Case 1.1 with Only indexing spatial data (GiST on polyline, SP-GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline)) */
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_start_point_spgist ON taxi_trajectory USING spgist (ST_StartPoint(polyline));
CREATE INDEX idx_end_point_spgist ON taxi_trajectory USING spgist (ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-10-01 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_CoveredBy(
    polyline,
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)
  );

DROP INDEX idx_polyline_gist;
DROP INDEX idx_start_point_spgist;
DROP INDEX idx_end_point_spgist;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1379925012620000403	"2013-09-23 09:30:12"	"2013-09-23 09:30:27"	"0102000020E6100000020000002FDFFAB0DE3821C00C022B871693444048C0E8F2E63821C0CC5D4BC807934440"
1380182921620000038	"2013-09-26 09:08:41"	"2013-09-26 09:09:56"	"0102000020E610000006000000302C7FBE2D3821C085B01A4B58934440965984622B3821C05F27F5656993444030DAE385743821C005DCF3FC699344402F88484DBB3821C09966BAD749934440959D7E50173921C0467BBC900E934440AE0FEB8D5A3921C006F4C29D0B934440"
1379142093620000440	"2013-09-14 08:01:33"	"2013-09-14 08:03:18"	"0102000020E610000008000000950C0055DC3821C0B3D30FEA2293444048A30227DB3821C0062E8F35239344407C48F8DEDF3821C0B3D30FEA229344402FFCE07CEA3821C08CB96B09F9924440E2E995B20C3921C0BADC60A8C3924440AE6186C6133921C0DA91EA3BBF924440E2AFC91AF53821C0CD920035B59244401538D906EE3821C05A83F755B9924440"
1379406890620000038	"2013-09-17 09:34:50"	"2013-09-17 09:37:35"	"0102000020E61000000C000000172EABB0193821C0F3203D450E93444064062AE3DF3721C0207EFE7BF092444097FDBAD39D3721C059F78F85E8924440FE648C0FB33721C033349E08E2924440E4A08499B63721C0E0D91EBDE192444030B8E68EFE3721C073BB97FBE4924440B0AE0AD4623821C0EDD808C4EB92444015E126A3CA3821C04033880FEC924440C9772975C93821C006F4C29D0B934440FCE25295B63821C0D36BB3B1129344402FF7C951803821C0126745D444934440B0912408573821C00C93A98251934440"
1379667568620000080	"2013-09-20 09:59:28"	"2013-09-20 09:59:43"	"0102000020E61000000200000095D233BDC43821C00611A969179344407C0E2C47C83821C0ACC5A70018934440"
1379750693620000038	"2013-09-21 09:04:53"	"2013-09-21 09:06:38"	"0102000020E610000008000000B000A60C1C3821C0000341800C9344401711C5E40D3821C0EDF5EE8FF792444098E0D407923721C0069D103AE89244404B94BDA59C3721C019709692E59244407DAD4B8DD03721C0D9E89C9FE29244404A99D4D0063821C0868E1D54E29244401711C5E40D3821C0809D9B36E392444030D5CC5A0A3821C0D9E89C9FE2924440"
1380269988620000008	"2013-09-27 09:19:48"	"2013-09-27 09:22:33"	"0102000020E61000000C000000E31934F44F3821C012329067979344407DCF4884463821C0250516C094934440E31934F44F3821C0EB6E9EEA9093444049641F64593821C04C7155D977934440C972124A5F3821C0F816D68D7793444096EA025E663821C0EC34D25279934440168A743FA73821C065FB90B75C93444015E126A3CA3821C0BF0CC68844934440FC1C1F2DCE3821C0C6FD47A64393444049861C5BCF3821C0390D51853F93444062BEBC00FB3821C0A6D425E318934440FB73D190F13821C0CC7A319413934440"
1380355071620000038	"2013-09-28 08:57:51"	"2013-09-28 09:02:36"	"0102000020E6100000140000004AB6BA9C123821C099D53BDC0E934440B0A9F3A8F83721C0395FECBDF89244406475ABE7A43721C060E811A3E79244406475ABE7A43721C0B933130CE7924440B1DEA815A63721C0C0249529E69244403161342BDB3721C026529ACDE3924440FCFF3861C23821C04641F0F8F6924440FC8BA031933821C01FF296AB1F9344406397A8DE1A3821C0E509849D62934440630B410E4A3821C02C9FE57970934440E31934F44F3821C07808E3A77193444030833122513821C025AE635C71934440632827DA553821C0D253E41071934440E3AAB2EF8A3821C03F558506629344404969368FC33821C03FFED2A23E934440AE7E6C921F3921C0E04DB7EC10934440E1B4E0455F3921C0EC2FBB270F934440145AD6FD633921C0EC2FBB270F934440C7F0D8CF623921C0EC2FBB270F934440944BE3175E3921C099D53BDC0E934440"
1379666757620000038	"2013-09-20 09:45:57"	"2013-09-20 09:50:27"	"0102000020E610000013000000E388B5F8143821C08602B683119344404A42226DE33721C04641F0F8F6924440CBA2B08BA23721C000AC8E1CE99244406440F67AF73721C000AC8E1CE99244401616DC0F783821C073D87DC7F0924440AF963B33C13821C0335184D4ED92444096986725AD3821C0A0C6BDF90D934440C90391459A3821C08602B6831193444016F9F5436C3821C0E6B2D1393F934440B0E3BF40103821C04C378941609344407DB262B83A3821C098BD6C3B6D93444016855D143D3821C04563EDEF6C934440B05758703F3821C098BD6C3B6D93444030A017EE5C3821C085EAE6E26F934440AF3F89CF9D3821C052280B5F5F93444015C440D7BE3821C0D92780626493444015C440D7BE3821C06CEC12D55B934440151BF33AE23821C06C9560713893444062BEBC00FB3821C0EC4CA1F31A934440"
1380530722620000453	"2013-09-30 09:45:22"	"2013-09-30 09:50:37"	"0102000020E610000016000000E4F736FDD93721C0B91B446B45934440FDBB3E73D63721C0BF0CC688449344403161342BDB3721C0AC39403047934440CA332F87DD3721C0E6CFB7054B9344403161342BDB3721C0D9EDB3CA4C9344407DCA3159DC3721C00C76C3B64593444064062AE3DF3721C052EE3EC747934440179D2CB5DE3721C0392A37514B9344407DCA3159DC3721C0392A37514B9344403161342BDB3721C08693347F4C934440CA332F87DD3721C0392A37514B9344403161342BDB3721C065DEAAEB50934440E4F736FDD93721C07FA2B2614D934440E4F736FDD93721C0126745D4449344403161342BDB3721C0126745D444934440E4F736FDD93721C0F9A23D5E48934440978E39CFD83721C04CFDBCA9489344403161342BDB3721C0460C3B8C499344407DCA3159DC3721C0ECC039234A934440E4F736FDD93721C0460C3B8C49934440E4F736FDD93721C09F573CF548934440E4F736FDD93721C09F573CF548934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Gather  (cost=1499.02..188767.86 rows=265 width=842) (actual time=184.518..193.896 rows=10 loops=1)"
"  Workers Planned: 2"
"  Workers Launched: 2"
"  Buffers: shared read=8561 written=69"
"  ->  Parallel Bitmap Heap Scan on taxi_trajectory  (cost=499.02..187741.36 rows=110 width=842) (actual time=156.682..165.022 rows=3 loops=3)"
"        Filter: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-10-01 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9) AND st_coveredby(polyline, '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry))"
"        Rows Removed by Filter: 1003"
"        Heap Blocks: exact=1559"
"        Buffers: shared read=8561 written=69"
"        ->  Bitmap Index Scan on idx_polyline_gist  (cost=0.00..498.95 rows=22755 width=0) (actual time=181.956..181.956 rows=3018 loops=1)"
"              Index Cond: (polyline @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared read=5620 written=69"
"Planning Time: 0.360 ms"
"Execution Time: 193.939 ms"
 */

/* Test Case 1.1: In Sept 2013, the morning rush hour, the entire trip was in CBD */
/* Test Case 1.1 with Both temporal data and spatial data using indices (B-tree, GiST, SP-GiST) */
CREATE INDEX idx_start_local_time_btree ON taxi_trajectory (start_local_time);
CREATE INDEX idx_hour_of_day_btree ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_start_point_spgist ON taxi_trajectory USING spgist (ST_StartPoint(polyline));
CREATE INDEX idx_end_point_spgist ON taxi_trajectory USING spgist (ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-10-01 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_CoveredBy(
    polyline,
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)
  );

DROP INDEX idx_start_local_time_btree;
DROP INDEX idx_hour_of_day_btree;
DROP INDEX idx_polyline_gist;
DROP INDEX idx_start_point_spgist;
DROP INDEX idx_end_point_spgist;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1379142093620000440	"2013-09-14 08:01:33"	"2013-09-14 08:03:18"	"0102000020E610000008000000950C0055DC3821C0B3D30FEA2293444048A30227DB3821C0062E8F35239344407C48F8DEDF3821C0B3D30FEA229344402FFCE07CEA3821C08CB96B09F9924440E2E995B20C3921C0BADC60A8C3924440AE6186C6133921C0DA91EA3BBF924440E2AFC91AF53821C0CD920035B59244401538D906EE3821C05A83F755B9924440"
1379406890620000038	"2013-09-17 09:34:50"	"2013-09-17 09:37:35"	"0102000020E61000000C000000172EABB0193821C0F3203D450E93444064062AE3DF3721C0207EFE7BF092444097FDBAD39D3721C059F78F85E8924440FE648C0FB33721C033349E08E2924440E4A08499B63721C0E0D91EBDE192444030B8E68EFE3721C073BB97FBE4924440B0AE0AD4623821C0EDD808C4EB92444015E126A3CA3821C04033880FEC924440C9772975C93821C006F4C29D0B934440FCE25295B63821C0D36BB3B1129344402FF7C951803821C0126745D444934440B0912408573821C00C93A98251934440"
1379667568620000080	"2013-09-20 09:59:28"	"2013-09-20 09:59:43"	"0102000020E61000000200000095D233BDC43821C00611A969179344407C0E2C47C83821C0ACC5A70018934440"
1379666757620000038	"2013-09-20 09:45:57"	"2013-09-20 09:50:27"	"0102000020E610000013000000E388B5F8143821C08602B683119344404A42226DE33721C04641F0F8F6924440CBA2B08BA23721C000AC8E1CE99244406440F67AF73721C000AC8E1CE99244401616DC0F783821C073D87DC7F0924440AF963B33C13821C0335184D4ED92444096986725AD3821C0A0C6BDF90D934440C90391459A3821C08602B6831193444016F9F5436C3821C0E6B2D1393F934440B0E3BF40103821C04C378941609344407DB262B83A3821C098BD6C3B6D93444016855D143D3821C04563EDEF6C934440B05758703F3821C098BD6C3B6D93444030A017EE5C3821C085EAE6E26F934440AF3F89CF9D3821C052280B5F5F93444015C440D7BE3821C0D92780626493444015C440D7BE3821C06CEC12D55B934440151BF33AE23821C06C9560713893444062BEBC00FB3821C0EC4CA1F31A934440"
1379750693620000038	"2013-09-21 09:04:53"	"2013-09-21 09:06:38"	"0102000020E610000008000000B000A60C1C3821C0000341800C9344401711C5E40D3821C0EDF5EE8FF792444098E0D407923721C0069D103AE89244404B94BDA59C3721C019709692E59244407DAD4B8DD03721C0D9E89C9FE29244404A99D4D0063821C0868E1D54E29244401711C5E40D3821C0809D9B36E392444030D5CC5A0A3821C0D9E89C9FE2924440"
1379925012620000403	"2013-09-23 09:30:12"	"2013-09-23 09:30:27"	"0102000020E6100000020000002FDFFAB0DE3821C00C022B871693444048C0E8F2E63821C0CC5D4BC807934440"
1380182921620000038	"2013-09-26 09:08:41"	"2013-09-26 09:09:56"	"0102000020E610000006000000302C7FBE2D3821C085B01A4B58934440965984622B3821C05F27F5656993444030DAE385743821C005DCF3FC699344402F88484DBB3821C09966BAD749934440959D7E50173921C0467BBC900E934440AE0FEB8D5A3921C006F4C29D0B934440"
1380269988620000008	"2013-09-27 09:19:48"	"2013-09-27 09:22:33"	"0102000020E61000000C000000E31934F44F3821C012329067979344407DCF4884463821C0250516C094934440E31934F44F3821C0EB6E9EEA9093444049641F64593821C04C7155D977934440C972124A5F3821C0F816D68D7793444096EA025E663821C0EC34D25279934440168A743FA73821C065FB90B75C93444015E126A3CA3821C0BF0CC68844934440FC1C1F2DCE3821C0C6FD47A64393444049861C5BCF3821C0390D51853F93444062BEBC00FB3821C0A6D425E318934440FB73D190F13821C0CC7A319413934440"
1380355071620000038	"2013-09-28 08:57:51"	"2013-09-28 09:02:36"	"0102000020E6100000140000004AB6BA9C123821C099D53BDC0E934440B0A9F3A8F83721C0395FECBDF89244406475ABE7A43721C060E811A3E79244406475ABE7A43721C0B933130CE7924440B1DEA815A63721C0C0249529E69244403161342BDB3721C026529ACDE3924440FCFF3861C23821C04641F0F8F6924440FC8BA031933821C01FF296AB1F9344406397A8DE1A3821C0E509849D62934440630B410E4A3821C02C9FE57970934440E31934F44F3821C07808E3A77193444030833122513821C025AE635C71934440632827DA553821C0D253E41071934440E3AAB2EF8A3821C03F558506629344404969368FC33821C03FFED2A23E934440AE7E6C921F3921C0E04DB7EC10934440E1B4E0455F3921C0EC2FBB270F934440145AD6FD633921C0EC2FBB270F934440C7F0D8CF623921C0EC2FBB270F934440944BE3175E3921C099D53BDC0E934440"
1380530722620000453	"2013-09-30 09:45:22"	"2013-09-30 09:50:37"	"0102000020E610000016000000E4F736FDD93721C0B91B446B45934440FDBB3E73D63721C0BF0CC688449344403161342BDB3721C0AC39403047934440CA332F87DD3721C0E6CFB7054B9344403161342BDB3721C0D9EDB3CA4C9344407DCA3159DC3721C00C76C3B64593444064062AE3DF3721C052EE3EC747934440179D2CB5DE3721C0392A37514B9344407DCA3159DC3721C0392A37514B9344403161342BDB3721C08693347F4C934440CA332F87DD3721C0392A37514B9344403161342BDB3721C065DEAAEB50934440E4F736FDD93721C07FA2B2614D934440E4F736FDD93721C0126745D4449344403161342BDB3721C0126745D444934440E4F736FDD93721C0F9A23D5E48934440978E39CFD83721C04CFDBCA9489344403161342BDB3721C0460C3B8C499344407DCA3159DC3721C0ECC039234A934440E4F736FDD93721C0460C3B8C49934440E4F736FDD93721C09F573CF548934440E4F736FDD93721C09F573CF548934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Bitmap Heap Scan on taxi_trajectory  (cost=6548.61..10901.32 rows=265 width=842) (actual time=65.365..65.474 rows=10 loops=1)"
"  Recheck Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-10-01 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9))"
"  Rows Removed by Index Recheck: 24"
"  Filter: st_coveredby(polyline, '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"  Rows Removed by Filter: 13"
"  Heap Blocks: exact=47"
"  Buffers: shared hit=6261"
"  ->  BitmapAnd  (cost=6548.61..6548.61 rows=265 width=0) (actual time=65.246..65.247 rows=0 loops=1)"
"        Buffers: shared hit=6214"
"        ->  Bitmap Index Scan on idx_polyline_gist  (cost=0.00..498.95 rows=22755 width=0) (actual time=48.527..48.527 rows=3018 loops=1)"
"              Index Cond: (polyline @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared hit=5620"
"        ->  Bitmap Index Scan on idx_start_local_time_btree  (cost=0.00..2990.66 rows=143023 width=0) (actual time=6.434..6.434 rows=144824 loops=1)"
"              Index Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-10-01 00:00:00'::timestamp without time zone))"
"              Buffers: shared hit=396"
"        ->  Bitmap Index Scan on idx_hour_of_day_btree  (cost=0.00..3058.31 rows=228188 width=0) (actual time=10.138..10.138 rows=230895 loops=1)"
"              Index Cond: ((hour_of_day >= 7) AND (hour_of_day <= 9))"
"              Buffers: shared hit=198"
"Planning Time: 0.291 ms"
"Execution Time: 65.668 ms"
 */


/* Test Case 1.2: In the 1st day of Sept 2013, the morning rush hour, the starting point of the trip was not in CBD but the end point was in CBD */
/* Test Case 1.2 with Only indexing temporal data (B-tree on start_local_time and hour_of_day) */
CREATE INDEX idx_start_local_time_btree ON taxi_trajectory (start_local_time);
CREATE INDEX idx_hour_of_day_btree ON taxi_trajectory (hour_of_day);

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-09-02 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_EndPoint(polyline)
  )
  AND NOT ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_StartPoint(polyline)
  );

DROP INDEX idx_start_local_time_btree;
DROP INDEX idx_hour_of_day_btree;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1378016848620000073	"2013-09-01 07:27:28"	"2013-09-01 07:34:43"	"0102000020E61000001E00000013D38558FD3921C0889D29745E95444013D38558FD3921C0889D29745E954440ADA580B4FF3921C0889D29745E954440FA0E7EE2003A21C03543AA285E954440603C8386FE3921C0DCDAC2F3529544407B87DBA1613921C055BE6724429544402E7079AC193921C0020D36751E9544407B82C476F73821C0A9A44E4013954440AFB321FFCC3821C00FD253E4109544407D04FEF0F33721C0C959D8D30E954440FE47A643A73721C07CB60E0EF6944440FDD8243FE23721C0E38C614ED0944440179D2CB5DE3721C03CD862B7CF944440E44EE960FD3721C0B0CA85CABF944440E3A59BC4203821C0FDF9B660A9944440E3FC4D28443821C0174A26A776944440630B410E4A3821C0A48CB80034944440FDDD3B6A4C3821C07156444DF493444030833122513821C0128942CBBA934440FDDD3B6A4C3821C0D8614CFA7B93444016A75A0BB33821C0ECC039234A9344407B82C476F73821C026E318C91E9344401538D906EE3821C000C974E8F4924440E292E34EE93821C066F6798CF29244402FFCE07CEA3821C0B34291EEE7924440E2067C7E183921C0ED647094BC9244402F36AD14023921C0E75608ABB19244402F6B6281AF3821C0E75608ABB1924440FCC56CC9AA3821C093FC885FB192444096986725AD3821C03AB187F6B1924440"
1378017120620000380	"2013-09-01 07:32:00"	"2013-09-01 07:34:15"	"0102000020E61000000A000000ADFC3218233A21C08046E9D2BF924440132A38BC203A21C047938B31B09244402E1EDE73603921C0871A8524B3924440FC34EECD6F3821C0F355F2B1BB92444097715303CD3721C060AE450BD092444017299485AF3721C09A44BDE0D392444017299485AF3721C0C6F8307BD9924440E5F21FD26F3721C0F9D7F2CAF59244404CE141B3EB3621C03FE1ECD63293444019541B9C883621C0F2EB87D860934440"
1378018901620000054	"2013-09-01 08:01:41"	"2013-09-01 08:06:56"	"0102000020E610000016000000C651B9895A3A21C0A8565F5D159244402C7FBE2D583A21C054FCDF111592444012D89C83673A21C0F4BF5C8B1692444078962023A03A21C074EB353D289244405F5E807D743A21C014E97E4E41924440793A5794123A21C07A50508A569244401494A2957B3921C0077B1343729244402FFCE07CEA3821C03A5AD5928E9244401538D906EE3821C087C3D2C08F924440151BF33AE23821C0CD3B4ED1919244402F3196E9973821C0DA740470B3924440E4F736FDD93721C033FAD170CA924440CA501553E93721C033349E08E2924440AF5C6F9BA93821C0394206F2EC924440168A743FA73821C046240A2DEB924440C9772975C93821C0B35F77BAF392444062105839B43821C020D5B0DF13934440499EEBFB703821C05F96766A2E93444016BF29AC543821C059DFC0E446934440494739984D3821C0F2B1BB4049934440E388B5F8143821C0D927806264934440971FB8CA133821C01FA0FB7266934440"
1378017569620000349	"2013-09-01 07:39:29"	"2013-09-01 07:55:14"	"0102000020E610000040000000E3DD91B1DA5421C0037CB779E394444030478FDFDB5421C0A930B610E494444030478FDFDB5421C04FE5B4A7E494444064CF9ECBD45421C09C4EB2D5E59444407D93A641D15421C0EFA83121E6944440302AA913D05421C0EFA83121E6944440963FDF162C5521C050C8CEDBD89444407D1F0E12A25421C0E960FD9FC39444404B75012F335421C08907944DB9944440FF756EDA8C5321C0DCB8C5FCDC944440E6948098845321C0A33F34F3E4944440B3EF8AE07F5321C0965D30B8E694444001C3F2E7DB5221C08F6CAE9AE7944440B62DCA6C905121C0F67CCD72D99444409F20B1DD3D5021C009336DFFCA944440ED7F80B56A4F21C0F0517FBDC29444403C66A032FE4D21C009F9A067B3944440D94125AE634C21C0D636C5E3A2944440F69A1E14944A21C063EDEF6C8F9444402A36E675C44921C0F7B182DF86944440C4CE143AAF4921C050FD83488694444093020B60CA4821C0EAB298D87C9444402E008DD2A54721C0973B33C170944440FC5069C4CC4621C0D7A546E8679444404BE5ED08A74521C0842EE1D05B9444401840F850A24521C0DD79E2395B944440B325AB22DC4421C06A4DF38E53944440E8A38CB8004421C0FDF49F353F9444409CDEC5FB714321C0CBF8F71917944440B6D782DE1B4321C037177FDB1394444004029D499B4221C0849D62D5209444401E87C1FC154221C064CBF275199444409FE74F1BD54121C0048F6FEF1A944440397B67B4554121C03160C9552C944440D5EC8156604021C0CA15DEE522944440EFE53E390A4021C0EACA67791E944440A27C410B094021C0EACA67791E944440098D60E3FA3F21C0F78F85E81094444088F2052D244021C0ABCFD556EC93444023D8B8FE5D3F21C0041BD7BFEB934440A438471D1D3F21C031CF4A5AF19344408A3A730F093F21C02BDEC83CF2934440BF2CEDD45C3E21C058923CD7F79344408DB7955E9B3D21C0840CE4D9E5934440DBDC989EB03C21C0D158FB3BDB934440766B990CC73B21C01EA5129ED093444012DDB3AED13A21C071E2AB1DC5934440ADDF4C4C173A21C0B83D4162BB934440C6C03A8E1F3A21C0B24CBF44BC93444093E1783E033A21C0F2B6D26BB3934440473EAF78EA3921C07E8AE3C0AB934440486E4DBA2D3921C045F46BEBA7934440E3C281902C3821C0A530EF71A69344407FDDE9CE133721C065A9F57EA3934440E6CB0BB08F3621C06B9A779CA2934440804754A86E3621C08B4F01309E93444000CADFBDA33621C06C43C5387F934440E5B33C0FEE3621C07FDC7EF9649344407F86376BF03621C085B01A4B589344404CC45BE7DF3621C0F2CEA10C5593444019028063CF3621C05FED28CE51934440CC5EB69DB63621C0DFDE35E84B9344406631B1F9B83621C0E6CFB7054B934440B2D47ABFD13621C01975ADBD4F934440"
1378020371620000463	"2013-09-01 08:26:11"	"2013-09-01 08:30:26"	"0102000020E61000001200000016DC0F78603821C0F5D72B2CB891444017BA1281EA3721C0DB300A82C7914440FD12F1D6F93721C05B79C9FFE49144407D957CEC2E3821C0A148F7730A924440FCE25295B63821C09B745B2217924440F96A47718E3A21C00E8464011392444045F12A6B9B3A21C0416326512F924440C634D3BD4E3A21C0FA415DA45092444061FD9FC37C3921C0A14D0E9F7492444062BEBC00FB3821C00DC347C494924440E25817B7D13821C04D4A41B797924440C93D5DDDB13821C09AED0A7DB0924440FC51D4997B3821C00038F6ECB9924440CBBF9657AE3721C08D62B9A5D592444064AF777FBC3721C0F3ACA415DF9244409737876BB53721C0206118B0E4924440AF3F89CF9D3821C006D7DCD1FF924440B0AE0AD4623821C0062E8F3523934440"
1378020555620000199	"2013-09-01 08:29:15"	"2013-09-01 08:35:30"	"0102000020E61000001A000000F98381E7DE2B21C0F3035779029344402C29779FE32B21C080F44D9A0693444046443179032C21C08602B68311934440AB5E7EA7C92C21C0537AA6971893444043705CC64D2D21C0E621533E04934440761A69A9BC2D21C0F38FBE49D3924440F41ABB44F52E21C04DBED9E6C6924440BE326FD5753021C01AFCFD62B6924440D505BCCCB03121C09AED0A7DB0924440D2191879593321C01ADF1797AA924440D12346CF2D3421C080290307B4924440D12346CF2D3421C08D28ED0DBE9244401D588E90813421C02618CE35CC924440695721E5273521C0C6BE64E3C19244404E9D47C5FF3521C0FA635A9BC6924440B4041901153621C08D45D3D9C9924440321D3A3DEF3621C046EA3D95D3924440172EABB0193821C0D9E89C9FE2924440622D3E05C03821C08CB96B09F992444030BDFDB9683821C0A60EF27A30934440300F99F2213821C072DD94F25A934440300F99F2213821C0E5266A696E934440300F99F2213821C08CDB68006F9344407D789620233821C0329067976F9344407D789620233821C085EAE6E26F9344407D789620233821C0D844662E70934440"
1378022114620000011	"2013-09-01 08:55:14"	"2013-09-01 09:01:14"	"0102000020E610000019000000CEC3094CA73521C03673486AA19444403448C153C83521C03065E08096944440008BFCFA213621C0CAE0287975944440016E162F163621C030D461855B94444082035ABA823521C08A027D224F944440812040868E3521C0B134F0A31A94444035D42824993521C031957EC2D99344401B2D077AA83521C0B212F3ACA493444081CEA44DD53521C00B5EF415A493444033A48AE2553621C09E3F6D54A79344407F17B6662B3721C0F88A6EBDA693444018EAB0C22D3721C0984EEB36A89344407E569929AD3721C0DEC66647AA934440B0912408573821C02522FC8BA093444063450DA6613821C012DBDD037493444095B54DF1B83821C09F7422C154934440E292E34EE93821C0DF8783842893444048DDCEBEF23821C0A06F0B96EA92444062156F641E3921C027DE019EB4924440AF0AD462F03821C0BABF7ADCB79244409546CCECF33821C00D1AFA27B89244409546CCECF33821C0B3CEF8BEB89244409546CCECF33821C0ADDD76A1B992444048DDCEBEF23821C053927538BA924440FB73D190F13821C0A7ECF483BA924440"
1378023673620000534	"2013-09-01 09:21:13"	"2013-09-01 09:28:13"	"0102000020E61000001D0000001D91EF52EA4221C0D8497D59DA9344403755F7C8E64221C078D32D3BC49344406ADD06B5DF4221C0D89B1892939344406ADD06B5DF4221C018062CB98A93444083A10E2BDC4221C0CB9C2E8B89934440857AFA08FC4121C0A5D93C0E8393444087DF4DB7EC4021C0F816D68D77934440BB6246787B4021C02657B1F84D9344403B8908FF224021C099B855100393444057957D57043F21C0EDD808C4EB92444059C0046EDD3D21C0AD342905DD9244408D7DC9C6833D21C00038F6ECB9924440F4A5B73F173D21C080290307B49244400F60915F3F3C21C05A83F755B9924440C382FB010F3C21C09A9658198D924440C4094CA7753B21C05A2C45F29592444011A8FE41243B21C0603AADDBA0924440F9484A7A183A21C0B3B112F3AC9244401477BCC96F3921C03AB187F6B19244409529E620E83821C08D28ED0DBE92444016DC0F78603821C0DFC14F1C4093444063450DA6613821C08C84B69C4B93444049810530653821C0E6CFB7054B934440C9552C7E533821C01975ADBD4F93444030664B56453821C0D253E41071934440B0912408573821C07F6DFDF49F934440B1DEA815A63721C0AB21718FA5934440B2F677B6473721C0B212F3ACA4934440B2D47ABFD13621C05FB87361A4934440"
1378024616620000386	"2013-09-01 09:36:56"	"2013-09-01 09:42:41"	"0102000020E610000018000000D00A0C59DD4221C0EBC5504EB49344406AC020E9D34221C0DF8C9AAF929344406AC020E9D34221C018062CB98A934440371B2B31CF4221C0CB9C2E8B899344408597E0D4074221C0ACCABE2B8293444007D15AD1E64021C0CC7F48BF7D934440EE4108C8974021C0FF243E7782934440EECD6F98684021C00685419946934440D5E76A2BF63F21C06C04E275FD9244408A1D8D43FD3E21C046240A2DEB9244408C48145AD63D21C060CB2BD7DB924440DAE6C6F4843D21C09A0AF148BC924440289D4830D53C21C027DE019EB49244402907B309303C21C06D567DAEB69244405C381092053C21C000C45DBD8A924440909E2287883B21C027874F3A91924440115663096B3B21C0B477465B95924440DEB06D51663B21C000E1438996924440DE9387855A3B21C0F4FE3F4E98924440AC58FCA6B03A21C0800C1D3BA8924440473EAF78EA3921C0674815C5AB92444095F430B43A3921C09AED0A7DB092444062F3716DA83821C0E75608ABB1924440B0AE0AD4623821C0ADDD76A1B9924440"
1378025754620000621	"2013-09-01 09:55:54"	"2013-09-01 10:05:09"	"0102000020E61000002600000067EDB60BCD3521C024ED461FF39344404E29AF95D03521C024ED461FF3934440CE37A27BD63521C024ED461FF39344401BA19FA9D73521C07847C66AF3934440B4739A05DA3521C07847C66AF3934440E71890BDDE3521C07156444DF4934440E71890BDDE3521C0C4B0C398F4934440E71890BDDE3521C0180B43E4F4934440B4739A05DA3521C07156444DF4934440670A9DD7D83521C0CBA145B6F393444081423D7D043621C038A3E6ABE4934440344DD87E323621C03E5A9C31CC934440E71DA7E8483621C052103CBEBD93444033C170AE613621C0CBF3E0EEAC934440802A6EDC623621C07E8AE3C0AB93444033C170AE613621C0D8D5E429AB934440802A6EDC623621C0D8D5E429AB9344401A1A4F04713621C0CBD6FA22A1934440E6AE25E4833621C012F8C3CF7F93444080D8D2A3A93621C0723447567E934440666B7D91D03621C0E5EC9DD15693444099D6A6B1BD3621C09983A0A3559344407F129F3BC13621C046EF54C03D934440B20E4757E93621C04CC3F0113193444032056B9C4D3721C0C05E61C1FD92444018B5FB55803721C086AB0320EE924440E42CEC69873721C04033880FEC9244406458C51B993721C0137F1475E6924440E353008C673821C060E811A3E7924440E2E995B20C3921C0CDE9B298D8924440C84274081C3921C00729780AB9924440C84274081C3921C0C0B0FCF9B6924440622D3E05C03821C02DCF83BBB3924440492F6AF7AB3821C0E065868DB292444096986725AD3821C08D0B0742B2924440C93D5DDDB13821C0E065868DB29244402F6B6281AF3821C0871A8524B3924440492F6AF7AB3821C02DCF83BBB3924440"
1378024896620000100	"2013-09-01 09:41:36"	"2013-09-01 10:07:36"	"0102000020E61000006900000030478FDFDB5421C0219221C7D695444030478FDFDB5421C01BA19FA9D795444097749483D95421C0219221C7D69544401766A19DD35421C0219221C7D6954440B0389CF9D55421C02783A3E4D5954440B0389CF9D55421C07BDD2230D6954440B0389CF9D55421C02783A3E4D595444064CF9ECBD45421C02783A3E4D5954440FDA19927D75421C07BDD2230D69544407DB08C0DDD5421C02783A3E4D5954440CA198A3BDE5421C07BDD2230D6954440FDA19927D75421C02783A3E4D5954440645B069CA55421C0CE548847E2954440CC7EDDE9CE5321C04772F90FE9954440FF06EDD5C75321C0F4FA93F8DC954440E50D30F31D5421C0B4739A05DA954440651C23D9235421C087A2409FC895444032772D211F5421C04147AB5AD295444032772D211F5421C0E7FBA9F1D2954440E50D30F31D5421C094A12AA6D2954440E50D30F31D5421C04147AB5AD29544407EE02A4F205421C0EEEC2B0FD295444018B325AB225421C0EEEC2B0FD2954440651C23D9235421C047382D78D1954440FEEE1D35265421C09B92ACC3D1954440FEEE1D35265421C09B92ACC3D1954440651C23D9235421C0F4DDAD2CD195444018B325AB225421C0A1832EE1D0954440CB49287D215421C0F4DDAD2CD195444018B325AB225421C0F4DDAD2CD1954440CB49287D215421C047382D78D1954440CB49287D215421C047382D78D195444018B325AB225421C047382D78D195444018B325AB225421C0F4DDAD2CD195444018B325AB225421C0F4DDAD2CD1954440CB49287D215421C047382D78D1954440E5F04927125421C05437177FDB954440998235CEA65321C0A1A014ADDC954440E6C93505325321C0C7293A92CB9544409B215514AF5221C0AEF199EC9F9544404E44BFB67E5221C008C90226709544409B73F04C685221C00281CEA44D954440812381069B5221C0C9B08A373295444000C80913465321C0E200FA7DFF94444080F3E2C4575321C009A7052FFA944440338AE596565321C0B64C86E3F9944440E620E868555321C0B64C86E3F9944440999A046F485321C076A8A624EB9444406803B001115221C0D6C743DFDD9444409E08E23C9C5021C0F06E6589CE9444408787307E1A4F21C0B6BB07E8BE944440BD5296218E4D21C029AE2AFBAE9444403ECBF3E0EE4C21C003EB387EA894444025EA059FE64C21C0B090B932A8944440A723809BC54B21C0B66455849B9444404339D1AE424A21C02A5778978B9444405FEE93A3004921C0371C96067E944440F986C267EB4821C03D0D18247D94444093C3279D484821C0C3EFA65B769444407A6EA12B114821C0101FD8F15F944440931ADA006C4821C09E616A4B1D9444402CB81FF0C04821C0E52B8194D89344407978CF81E54821C0B24CBF44BC9344402C0FD253E44821C0AB5B3D27BD934440AC6F6072A34821C0F8A75489B2934440C8073D9B554721C09240834D9D9344403126FDBD144621C072512D228A9344401ADF1797AA4421C0F2423A3C849344404E7ADFF8DA4321C0C5ABAC6D8A934440821FD5B0DF4321C072512D228A9344409C35785F954321C07842AF3F89934440EB724A404C4221C0EC51B81E8593444054573ECBF34021C0527FBDC28293444088F71C588E4021C0DF52CE177B934440543541D47D4021C0460C3B8C49934440BBEEAD484C4021C07920B24813934440BBEEAD484C4021C093E4B9BE0F934440D595CFF23C4021C0A0C6BDF90D9344403C4A253CA13F21C0395FECBDF8924440BE66B96C743E21C0D3F71A82E3924440404E98309A3D21C0BAF94674CF92444073B9C150873D21C0A7ECF483BA9244408E041A6CEA3C21C01AFCFD62B692444042E8A04B383C21C07A3881E9B492444043572250FD3B21C0B45A608F89924440C4094CA7753B21C000E1438996924440DE59BBED423B21C080EF366F9C92444011E2CAD93B3B21C07AFEB4519D924440DF4F8D976E3A21C09AED0A7DB0924440AEA06989953921C0FA298E03AF924440E292E34EE93821C0F355F2B1BB92444062A1D634EF3821C03ACE6DC2BD9244402FFCE07CEA3821C0E773EE76BD9244409529E620E83821C040BFEFDFBC9244407C65DEAAEB3821C093196F2BBD9244401538D906EE3821C0E773EE76BD9244401538D906EE3821C0DA91EA3BBF92444048C0E8F2E63821C08063CF9ECB92444048C0E8F2E63821C02D095053CB924440E275FD82DD3821C04016A243E092444016A75A0BB33821C026A94C3107934440499EEBFB703821C0E695EB6D33934440FC170802643821C0392A37514B934440172EABB0193821C005DCF3FC69934440B0743E3C4B3821C01F1494A295934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Bitmap Heap Scan on taxi_trajectory  (cost=3141.63..18496.54 rows=1 width=842) (actual time=32.932..33.228 rows=11 loops=1)"
"  Recheck Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-02 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9))"
"  Rows Removed by Index Recheck: 276"
"  Filter: (st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_endpoint(polyline)) AND (NOT st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline))))"
"  Rows Removed by Filter: 380"
"  Heap Blocks: exact=187"
"  Buffers: shared hit=399"
"  ->  BitmapAnd  (cost=3141.63..3141.63 rows=527 width=0) (actual time=32.823..32.824 rows=0 loops=1)"
"        Buffers: shared hit=212"
"        ->  Bitmap Index Scan on idx_start_local_time_btree  (cost=0.00..83.07 rows=3864 width=0) (actual time=0.503..0.503 rows=3929 loops=1)"
"              Index Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-02 00:00:00'::timestamp without time zone))"
"              Buffers: shared hit=14"
"        ->  Bitmap Index Scan on idx_hour_of_day_btree  (cost=0.00..3058.31 rows=228188 width=0) (actual time=32.090..32.090 rows=230895 loops=1)"
"              Index Cond: ((hour_of_day >= 7) AND (hour_of_day <= 9))"
"              Buffers: shared hit=198"
"Planning Time: 0.260 ms"
"Execution Time: 33.375 ms"
 */

/* Test Case 1.2: In the 1st day of Sept 2013, the morning rush hour, the starting point of the trip was not in CBD but the end point was in CBD */
/* Test Case 1.2 with Only indexing spatial data (GiST on polyline, SP-GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline)) */
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_start_point_spgist ON taxi_trajectory USING spgist (ST_StartPoint(polyline));
CREATE INDEX idx_end_point_spgist ON taxi_trajectory USING spgist (ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-09-02 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_EndPoint(polyline)
  )
  AND NOT ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_StartPoint(polyline)
  );

DROP INDEX idx_polyline_gist;
DROP INDEX idx_start_point_spgist;
DROP INDEX idx_end_point_spgist;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1378020371620000463	"2013-09-01 08:26:11"	"2013-09-01 08:30:26"	"0102000020E61000001200000016DC0F78603821C0F5D72B2CB891444017BA1281EA3721C0DB300A82C7914440FD12F1D6F93721C05B79C9FFE49144407D957CEC2E3821C0A148F7730A924440FCE25295B63821C09B745B2217924440F96A47718E3A21C00E8464011392444045F12A6B9B3A21C0416326512F924440C634D3BD4E3A21C0FA415DA45092444061FD9FC37C3921C0A14D0E9F7492444062BEBC00FB3821C00DC347C494924440E25817B7D13821C04D4A41B797924440C93D5DDDB13821C09AED0A7DB0924440FC51D4997B3821C00038F6ECB9924440CBBF9657AE3721C08D62B9A5D592444064AF777FBC3721C0F3ACA415DF9244409737876BB53721C0206118B0E4924440AF3F89CF9D3821C006D7DCD1FF924440B0AE0AD4623821C0062E8F3523934440"
1378025754620000621	"2013-09-01 09:55:54"	"2013-09-01 10:05:09"	"0102000020E61000002600000067EDB60BCD3521C024ED461FF39344404E29AF95D03521C024ED461FF3934440CE37A27BD63521C024ED461FF39344401BA19FA9D73521C07847C66AF3934440B4739A05DA3521C07847C66AF3934440E71890BDDE3521C07156444DF4934440E71890BDDE3521C0C4B0C398F4934440E71890BDDE3521C0180B43E4F4934440B4739A05DA3521C07156444DF4934440670A9DD7D83521C0CBA145B6F393444081423D7D043621C038A3E6ABE4934440344DD87E323621C03E5A9C31CC934440E71DA7E8483621C052103CBEBD93444033C170AE613621C0CBF3E0EEAC934440802A6EDC623621C07E8AE3C0AB93444033C170AE613621C0D8D5E429AB934440802A6EDC623621C0D8D5E429AB9344401A1A4F04713621C0CBD6FA22A1934440E6AE25E4833621C012F8C3CF7F93444080D8D2A3A93621C0723447567E934440666B7D91D03621C0E5EC9DD15693444099D6A6B1BD3621C09983A0A3559344407F129F3BC13621C046EF54C03D934440B20E4757E93621C04CC3F0113193444032056B9C4D3721C0C05E61C1FD92444018B5FB55803721C086AB0320EE924440E42CEC69873721C04033880FEC9244406458C51B993721C0137F1475E6924440E353008C673821C060E811A3E7924440E2E995B20C3921C0CDE9B298D8924440C84274081C3921C00729780AB9924440C84274081C3921C0C0B0FCF9B6924440622D3E05C03821C02DCF83BBB3924440492F6AF7AB3821C0E065868DB292444096986725AD3821C08D0B0742B2924440C93D5DDDB13821C0E065868DB29244402F6B6281AF3821C0871A8524B3924440492F6AF7AB3821C02DCF83BBB3924440"
1378016848620000073	"2013-09-01 07:27:28"	"2013-09-01 07:34:43"	"0102000020E61000001E00000013D38558FD3921C0889D29745E95444013D38558FD3921C0889D29745E954440ADA580B4FF3921C0889D29745E954440FA0E7EE2003A21C03543AA285E954440603C8386FE3921C0DCDAC2F3529544407B87DBA1613921C055BE6724429544402E7079AC193921C0020D36751E9544407B82C476F73821C0A9A44E4013954440AFB321FFCC3821C00FD253E4109544407D04FEF0F33721C0C959D8D30E954440FE47A643A73721C07CB60E0EF6944440FDD8243FE23721C0E38C614ED0944440179D2CB5DE3721C03CD862B7CF944440E44EE960FD3721C0B0CA85CABF944440E3A59BC4203821C0FDF9B660A9944440E3FC4D28443821C0174A26A776944440630B410E4A3821C0A48CB80034944440FDDD3B6A4C3821C07156444DF493444030833122513821C0128942CBBA934440FDDD3B6A4C3821C0D8614CFA7B93444016A75A0BB33821C0ECC039234A9344407B82C476F73821C026E318C91E9344401538D906EE3821C000C974E8F4924440E292E34EE93821C066F6798CF29244402FFCE07CEA3821C0B34291EEE7924440E2067C7E183921C0ED647094BC9244402F36AD14023921C0E75608ABB19244402F6B6281AF3821C0E75608ABB1924440FCC56CC9AA3821C093FC885FB192444096986725AD3821C03AB187F6B1924440"
1378023673620000534	"2013-09-01 09:21:13"	"2013-09-01 09:28:13"	"0102000020E61000001D0000001D91EF52EA4221C0D8497D59DA9344403755F7C8E64221C078D32D3BC49344406ADD06B5DF4221C0D89B1892939344406ADD06B5DF4221C018062CB98A93444083A10E2BDC4221C0CB9C2E8B89934440857AFA08FC4121C0A5D93C0E8393444087DF4DB7EC4021C0F816D68D77934440BB6246787B4021C02657B1F84D9344403B8908FF224021C099B855100393444057957D57043F21C0EDD808C4EB92444059C0046EDD3D21C0AD342905DD9244408D7DC9C6833D21C00038F6ECB9924440F4A5B73F173D21C080290307B49244400F60915F3F3C21C05A83F755B9924440C382FB010F3C21C09A9658198D924440C4094CA7753B21C05A2C45F29592444011A8FE41243B21C0603AADDBA0924440F9484A7A183A21C0B3B112F3AC9244401477BCC96F3921C03AB187F6B19244409529E620E83821C08D28ED0DBE92444016DC0F78603821C0DFC14F1C4093444063450DA6613821C08C84B69C4B93444049810530653821C0E6CFB7054B934440C9552C7E533821C01975ADBD4F93444030664B56453821C0D253E41071934440B0912408573821C07F6DFDF49F934440B1DEA815A63721C0AB21718FA5934440B2F677B6473721C0B212F3ACA4934440B2D47ABFD13621C05FB87361A4934440"
1378022114620000011	"2013-09-01 08:55:14"	"2013-09-01 09:01:14"	"0102000020E610000019000000CEC3094CA73521C03673486AA19444403448C153C83521C03065E08096944440008BFCFA213621C0CAE0287975944440016E162F163621C030D461855B94444082035ABA823521C08A027D224F944440812040868E3521C0B134F0A31A94444035D42824993521C031957EC2D99344401B2D077AA83521C0B212F3ACA493444081CEA44DD53521C00B5EF415A493444033A48AE2553621C09E3F6D54A79344407F17B6662B3721C0F88A6EBDA693444018EAB0C22D3721C0984EEB36A89344407E569929AD3721C0DEC66647AA934440B0912408573821C02522FC8BA093444063450DA6613821C012DBDD037493444095B54DF1B83821C09F7422C154934440E292E34EE93821C0DF8783842893444048DDCEBEF23821C0A06F0B96EA92444062156F641E3921C027DE019EB4924440AF0AD462F03821C0BABF7ADCB79244409546CCECF33821C00D1AFA27B89244409546CCECF33821C0B3CEF8BEB89244409546CCECF33821C0ADDD76A1B992444048DDCEBEF23821C053927538BA924440FB73D190F13821C0A7ECF483BA924440"
1378017120620000380	"2013-09-01 07:32:00"	"2013-09-01 07:34:15"	"0102000020E61000000A000000ADFC3218233A21C08046E9D2BF924440132A38BC203A21C047938B31B09244402E1EDE73603921C0871A8524B3924440FC34EECD6F3821C0F355F2B1BB92444097715303CD3721C060AE450BD092444017299485AF3721C09A44BDE0D392444017299485AF3721C0C6F8307BD9924440E5F21FD26F3721C0F9D7F2CAF59244404CE141B3EB3621C03FE1ECD63293444019541B9C883621C0F2EB87D860934440"
1378017569620000349	"2013-09-01 07:39:29"	"2013-09-01 07:55:14"	"0102000020E610000040000000E3DD91B1DA5421C0037CB779E394444030478FDFDB5421C0A930B610E494444030478FDFDB5421C04FE5B4A7E494444064CF9ECBD45421C09C4EB2D5E59444407D93A641D15421C0EFA83121E6944440302AA913D05421C0EFA83121E6944440963FDF162C5521C050C8CEDBD89444407D1F0E12A25421C0E960FD9FC39444404B75012F335421C08907944DB9944440FF756EDA8C5321C0DCB8C5FCDC944440E6948098845321C0A33F34F3E4944440B3EF8AE07F5321C0965D30B8E694444001C3F2E7DB5221C08F6CAE9AE7944440B62DCA6C905121C0F67CCD72D99444409F20B1DD3D5021C009336DFFCA944440ED7F80B56A4F21C0F0517FBDC29444403C66A032FE4D21C009F9A067B3944440D94125AE634C21C0D636C5E3A2944440F69A1E14944A21C063EDEF6C8F9444402A36E675C44921C0F7B182DF86944440C4CE143AAF4921C050FD83488694444093020B60CA4821C0EAB298D87C9444402E008DD2A54721C0973B33C170944440FC5069C4CC4621C0D7A546E8679444404BE5ED08A74521C0842EE1D05B9444401840F850A24521C0DD79E2395B944440B325AB22DC4421C06A4DF38E53944440E8A38CB8004421C0FDF49F353F9444409CDEC5FB714321C0CBF8F71917944440B6D782DE1B4321C037177FDB1394444004029D499B4221C0849D62D5209444401E87C1FC154221C064CBF275199444409FE74F1BD54121C0048F6FEF1A944440397B67B4554121C03160C9552C944440D5EC8156604021C0CA15DEE522944440EFE53E390A4021C0EACA67791E944440A27C410B094021C0EACA67791E944440098D60E3FA3F21C0F78F85E81094444088F2052D244021C0ABCFD556EC93444023D8B8FE5D3F21C0041BD7BFEB934440A438471D1D3F21C031CF4A5AF19344408A3A730F093F21C02BDEC83CF2934440BF2CEDD45C3E21C058923CD7F79344408DB7955E9B3D21C0840CE4D9E5934440DBDC989EB03C21C0D158FB3BDB934440766B990CC73B21C01EA5129ED093444012DDB3AED13A21C071E2AB1DC5934440ADDF4C4C173A21C0B83D4162BB934440C6C03A8E1F3A21C0B24CBF44BC93444093E1783E033A21C0F2B6D26BB3934440473EAF78EA3921C07E8AE3C0AB934440486E4DBA2D3921C045F46BEBA7934440E3C281902C3821C0A530EF71A69344407FDDE9CE133721C065A9F57EA3934440E6CB0BB08F3621C06B9A779CA2934440804754A86E3621C08B4F01309E93444000CADFBDA33621C06C43C5387F934440E5B33C0FEE3621C07FDC7EF9649344407F86376BF03621C085B01A4B589344404CC45BE7DF3621C0F2CEA10C5593444019028063CF3621C05FED28CE51934440CC5EB69DB63621C0DFDE35E84B9344406631B1F9B83621C0E6CFB7054B934440B2D47ABFD13621C01975ADBD4F934440"
1378024616620000386	"2013-09-01 09:36:56"	"2013-09-01 09:42:41"	"0102000020E610000018000000D00A0C59DD4221C0EBC5504EB49344406AC020E9D34221C0DF8C9AAF929344406AC020E9D34221C018062CB98A934440371B2B31CF4221C0CB9C2E8B899344408597E0D4074221C0ACCABE2B8293444007D15AD1E64021C0CC7F48BF7D934440EE4108C8974021C0FF243E7782934440EECD6F98684021C00685419946934440D5E76A2BF63F21C06C04E275FD9244408A1D8D43FD3E21C046240A2DEB9244408C48145AD63D21C060CB2BD7DB924440DAE6C6F4843D21C09A0AF148BC924440289D4830D53C21C027DE019EB49244402907B309303C21C06D567DAEB69244405C381092053C21C000C45DBD8A924440909E2287883B21C027874F3A91924440115663096B3B21C0B477465B95924440DEB06D51663B21C000E1438996924440DE9387855A3B21C0F4FE3F4E98924440AC58FCA6B03A21C0800C1D3BA8924440473EAF78EA3921C0674815C5AB92444095F430B43A3921C09AED0A7DB092444062F3716DA83821C0E75608ABB1924440B0AE0AD4623821C0ADDD76A1B9924440"
1378018901620000054	"2013-09-01 08:01:41"	"2013-09-01 08:06:56"	"0102000020E610000016000000C651B9895A3A21C0A8565F5D159244402C7FBE2D583A21C054FCDF111592444012D89C83673A21C0F4BF5C8B1692444078962023A03A21C074EB353D289244405F5E807D743A21C014E97E4E41924440793A5794123A21C07A50508A569244401494A2957B3921C0077B1343729244402FFCE07CEA3821C03A5AD5928E9244401538D906EE3821C087C3D2C08F924440151BF33AE23821C0CD3B4ED1919244402F3196E9973821C0DA740470B3924440E4F736FDD93721C033FAD170CA924440CA501553E93721C033349E08E2924440AF5C6F9BA93821C0394206F2EC924440168A743FA73821C046240A2DEB924440C9772975C93821C0B35F77BAF392444062105839B43821C020D5B0DF13934440499EEBFB703821C05F96766A2E93444016BF29AC543821C059DFC0E446934440494739984D3821C0F2B1BB4049934440E388B5F8143821C0D927806264934440971FB8CA133821C01FA0FB7266934440"
1378024896620000100	"2013-09-01 09:41:36"	"2013-09-01 10:07:36"	"0102000020E61000006900000030478FDFDB5421C0219221C7D695444030478FDFDB5421C01BA19FA9D795444097749483D95421C0219221C7D69544401766A19DD35421C0219221C7D6954440B0389CF9D55421C02783A3E4D5954440B0389CF9D55421C07BDD2230D6954440B0389CF9D55421C02783A3E4D595444064CF9ECBD45421C02783A3E4D5954440FDA19927D75421C07BDD2230D69544407DB08C0DDD5421C02783A3E4D5954440CA198A3BDE5421C07BDD2230D6954440FDA19927D75421C02783A3E4D5954440645B069CA55421C0CE548847E2954440CC7EDDE9CE5321C04772F90FE9954440FF06EDD5C75321C0F4FA93F8DC954440E50D30F31D5421C0B4739A05DA954440651C23D9235421C087A2409FC895444032772D211F5421C04147AB5AD295444032772D211F5421C0E7FBA9F1D2954440E50D30F31D5421C094A12AA6D2954440E50D30F31D5421C04147AB5AD29544407EE02A4F205421C0EEEC2B0FD295444018B325AB225421C0EEEC2B0FD2954440651C23D9235421C047382D78D1954440FEEE1D35265421C09B92ACC3D1954440FEEE1D35265421C09B92ACC3D1954440651C23D9235421C0F4DDAD2CD195444018B325AB225421C0A1832EE1D0954440CB49287D215421C0F4DDAD2CD195444018B325AB225421C0F4DDAD2CD1954440CB49287D215421C047382D78D1954440CB49287D215421C047382D78D195444018B325AB225421C047382D78D195444018B325AB225421C0F4DDAD2CD195444018B325AB225421C0F4DDAD2CD1954440CB49287D215421C047382D78D1954440E5F04927125421C05437177FDB954440998235CEA65321C0A1A014ADDC954440E6C93505325321C0C7293A92CB9544409B215514AF5221C0AEF199EC9F9544404E44BFB67E5221C008C90226709544409B73F04C685221C00281CEA44D954440812381069B5221C0C9B08A373295444000C80913465321C0E200FA7DFF94444080F3E2C4575321C009A7052FFA944440338AE596565321C0B64C86E3F9944440E620E868555321C0B64C86E3F9944440999A046F485321C076A8A624EB9444406803B001115221C0D6C743DFDD9444409E08E23C9C5021C0F06E6589CE9444408787307E1A4F21C0B6BB07E8BE944440BD5296218E4D21C029AE2AFBAE9444403ECBF3E0EE4C21C003EB387EA894444025EA059FE64C21C0B090B932A8944440A723809BC54B21C0B66455849B9444404339D1AE424A21C02A5778978B9444405FEE93A3004921C0371C96067E944440F986C267EB4821C03D0D18247D94444093C3279D484821C0C3EFA65B769444407A6EA12B114821C0101FD8F15F944440931ADA006C4821C09E616A4B1D9444402CB81FF0C04821C0E52B8194D89344407978CF81E54821C0B24CBF44BC9344402C0FD253E44821C0AB5B3D27BD934440AC6F6072A34821C0F8A75489B2934440C8073D9B554721C09240834D9D9344403126FDBD144621C072512D228A9344401ADF1797AA4421C0F2423A3C849344404E7ADFF8DA4321C0C5ABAC6D8A934440821FD5B0DF4321C072512D228A9344409C35785F954321C07842AF3F89934440EB724A404C4221C0EC51B81E8593444054573ECBF34021C0527FBDC28293444088F71C588E4021C0DF52CE177B934440543541D47D4021C0460C3B8C49934440BBEEAD484C4021C07920B24813934440BBEEAD484C4021C093E4B9BE0F934440D595CFF23C4021C0A0C6BDF90D9344403C4A253CA13F21C0395FECBDF8924440BE66B96C743E21C0D3F71A82E3924440404E98309A3D21C0BAF94674CF92444073B9C150873D21C0A7ECF483BA9244408E041A6CEA3C21C01AFCFD62B692444042E8A04B383C21C07A3881E9B492444043572250FD3B21C0B45A608F89924440C4094CA7753B21C000E1438996924440DE59BBED423B21C080EF366F9C92444011E2CAD93B3B21C07AFEB4519D924440DF4F8D976E3A21C09AED0A7DB0924440AEA06989953921C0FA298E03AF924440E292E34EE93821C0F355F2B1BB92444062A1D634EF3821C03ACE6DC2BD9244402FFCE07CEA3821C0E773EE76BD9244409529E620E83821C040BFEFDFBC9244407C65DEAAEB3821C093196F2BBD9244401538D906EE3821C0E773EE76BD9244401538D906EE3821C0DA91EA3BBF92444048C0E8F2E63821C08063CF9ECB92444048C0E8F2E63821C02D095053CB924440E275FD82DD3821C04016A243E092444016A75A0BB33821C026A94C3107934440499EEBFB703821C0E695EB6D33934440FC170802643821C0392A37514B934440172EABB0193821C005DCF3FC69934440B0743E3C4B3821C01F1494A295934440"
1378020555620000199	"2013-09-01 08:29:15"	"2013-09-01 08:35:30"	"0102000020E61000001A000000F98381E7DE2B21C0F3035779029344402C29779FE32B21C080F44D9A0693444046443179032C21C08602B68311934440AB5E7EA7C92C21C0537AA6971893444043705CC64D2D21C0E621533E04934440761A69A9BC2D21C0F38FBE49D3924440F41ABB44F52E21C04DBED9E6C6924440BE326FD5753021C01AFCFD62B6924440D505BCCCB03121C09AED0A7DB0924440D2191879593321C01ADF1797AA924440D12346CF2D3421C080290307B4924440D12346CF2D3421C08D28ED0DBE9244401D588E90813421C02618CE35CC924440695721E5273521C0C6BE64E3C19244404E9D47C5FF3521C0FA635A9BC6924440B4041901153621C08D45D3D9C9924440321D3A3DEF3621C046EA3D95D3924440172EABB0193821C0D9E89C9FE2924440622D3E05C03821C08CB96B09F992444030BDFDB9683821C0A60EF27A30934440300F99F2213821C072DD94F25A934440300F99F2213821C0E5266A696E934440300F99F2213821C08CDB68006F9344407D789620233821C0329067976F9344407D789620233821C085EAE6E26F9344407D789620233821C0D844662E70934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Index Scan using idx_end_point_spgist on taxi_trajectory  (cost=0.29..4893.63 rows=1 width=842) (actual time=125.585..538.286 rows=11 loops=1)"
"  Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"  Filter: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-02 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_endpoint(polyline)) AND (NOT st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline))))"
"  Rows Removed by Filter: 97586"
"  Buffers: shared hit=7511 read=93095"
"Planning Time: 0.207 ms"
"Execution Time: 538.338 ms"
 */

/* Test Case 1.2: In the 1st day of Sept 2013, the morning rush hour, the starting point of the trip was not in CBD but the end point was in CBD */
/* Test Case 1.2 with Both temporal data and spatial data using indices (B-tree, GiST, SP-GiST) */
CREATE INDEX idx_start_local_time_btree ON taxi_trajectory (start_local_time);
CREATE INDEX idx_hour_of_day_btree ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_start_point_spgist ON taxi_trajectory USING spgist (ST_StartPoint(polyline));
CREATE INDEX idx_end_point_spgist ON taxi_trajectory USING spgist (ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-09-02 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_EndPoint(polyline)
  )
  AND NOT ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_StartPoint(polyline)
  );

DROP INDEX idx_start_local_time_btree;
DROP INDEX idx_hour_of_day_btree;
DROP INDEX idx_polyline_gist;
DROP INDEX idx_start_point_spgist;
DROP INDEX idx_end_point_spgist;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1378016848620000073	"2013-09-01 07:27:28"	"2013-09-01 07:34:43"	"0102000020E61000001E00000013D38558FD3921C0889D29745E95444013D38558FD3921C0889D29745E954440ADA580B4FF3921C0889D29745E954440FA0E7EE2003A21C03543AA285E954440603C8386FE3921C0DCDAC2F3529544407B87DBA1613921C055BE6724429544402E7079AC193921C0020D36751E9544407B82C476F73821C0A9A44E4013954440AFB321FFCC3821C00FD253E4109544407D04FEF0F33721C0C959D8D30E954440FE47A643A73721C07CB60E0EF6944440FDD8243FE23721C0E38C614ED0944440179D2CB5DE3721C03CD862B7CF944440E44EE960FD3721C0B0CA85CABF944440E3A59BC4203821C0FDF9B660A9944440E3FC4D28443821C0174A26A776944440630B410E4A3821C0A48CB80034944440FDDD3B6A4C3821C07156444DF493444030833122513821C0128942CBBA934440FDDD3B6A4C3821C0D8614CFA7B93444016A75A0BB33821C0ECC039234A9344407B82C476F73821C026E318C91E9344401538D906EE3821C000C974E8F4924440E292E34EE93821C066F6798CF29244402FFCE07CEA3821C0B34291EEE7924440E2067C7E183921C0ED647094BC9244402F36AD14023921C0E75608ABB19244402F6B6281AF3821C0E75608ABB1924440FCC56CC9AA3821C093FC885FB192444096986725AD3821C03AB187F6B1924440"
1378017120620000380	"2013-09-01 07:32:00"	"2013-09-01 07:34:15"	"0102000020E61000000A000000ADFC3218233A21C08046E9D2BF924440132A38BC203A21C047938B31B09244402E1EDE73603921C0871A8524B3924440FC34EECD6F3821C0F355F2B1BB92444097715303CD3721C060AE450BD092444017299485AF3721C09A44BDE0D392444017299485AF3721C0C6F8307BD9924440E5F21FD26F3721C0F9D7F2CAF59244404CE141B3EB3621C03FE1ECD63293444019541B9C883621C0F2EB87D860934440"
1378018901620000054	"2013-09-01 08:01:41"	"2013-09-01 08:06:56"	"0102000020E610000016000000C651B9895A3A21C0A8565F5D159244402C7FBE2D583A21C054FCDF111592444012D89C83673A21C0F4BF5C8B1692444078962023A03A21C074EB353D289244405F5E807D743A21C014E97E4E41924440793A5794123A21C07A50508A569244401494A2957B3921C0077B1343729244402FFCE07CEA3821C03A5AD5928E9244401538D906EE3821C087C3D2C08F924440151BF33AE23821C0CD3B4ED1919244402F3196E9973821C0DA740470B3924440E4F736FDD93721C033FAD170CA924440CA501553E93721C033349E08E2924440AF5C6F9BA93821C0394206F2EC924440168A743FA73821C046240A2DEB924440C9772975C93821C0B35F77BAF392444062105839B43821C020D5B0DF13934440499EEBFB703821C05F96766A2E93444016BF29AC543821C059DFC0E446934440494739984D3821C0F2B1BB4049934440E388B5F8143821C0D927806264934440971FB8CA133821C01FA0FB7266934440"
1378017569620000349	"2013-09-01 07:39:29"	"2013-09-01 07:55:14"	"0102000020E610000040000000E3DD91B1DA5421C0037CB779E394444030478FDFDB5421C0A930B610E494444030478FDFDB5421C04FE5B4A7E494444064CF9ECBD45421C09C4EB2D5E59444407D93A641D15421C0EFA83121E6944440302AA913D05421C0EFA83121E6944440963FDF162C5521C050C8CEDBD89444407D1F0E12A25421C0E960FD9FC39444404B75012F335421C08907944DB9944440FF756EDA8C5321C0DCB8C5FCDC944440E6948098845321C0A33F34F3E4944440B3EF8AE07F5321C0965D30B8E694444001C3F2E7DB5221C08F6CAE9AE7944440B62DCA6C905121C0F67CCD72D99444409F20B1DD3D5021C009336DFFCA944440ED7F80B56A4F21C0F0517FBDC29444403C66A032FE4D21C009F9A067B3944440D94125AE634C21C0D636C5E3A2944440F69A1E14944A21C063EDEF6C8F9444402A36E675C44921C0F7B182DF86944440C4CE143AAF4921C050FD83488694444093020B60CA4821C0EAB298D87C9444402E008DD2A54721C0973B33C170944440FC5069C4CC4621C0D7A546E8679444404BE5ED08A74521C0842EE1D05B9444401840F850A24521C0DD79E2395B944440B325AB22DC4421C06A4DF38E53944440E8A38CB8004421C0FDF49F353F9444409CDEC5FB714321C0CBF8F71917944440B6D782DE1B4321C037177FDB1394444004029D499B4221C0849D62D5209444401E87C1FC154221C064CBF275199444409FE74F1BD54121C0048F6FEF1A944440397B67B4554121C03160C9552C944440D5EC8156604021C0CA15DEE522944440EFE53E390A4021C0EACA67791E944440A27C410B094021C0EACA67791E944440098D60E3FA3F21C0F78F85E81094444088F2052D244021C0ABCFD556EC93444023D8B8FE5D3F21C0041BD7BFEB934440A438471D1D3F21C031CF4A5AF19344408A3A730F093F21C02BDEC83CF2934440BF2CEDD45C3E21C058923CD7F79344408DB7955E9B3D21C0840CE4D9E5934440DBDC989EB03C21C0D158FB3BDB934440766B990CC73B21C01EA5129ED093444012DDB3AED13A21C071E2AB1DC5934440ADDF4C4C173A21C0B83D4162BB934440C6C03A8E1F3A21C0B24CBF44BC93444093E1783E033A21C0F2B6D26BB3934440473EAF78EA3921C07E8AE3C0AB934440486E4DBA2D3921C045F46BEBA7934440E3C281902C3821C0A530EF71A69344407FDDE9CE133721C065A9F57EA3934440E6CB0BB08F3621C06B9A779CA2934440804754A86E3621C08B4F01309E93444000CADFBDA33621C06C43C5387F934440E5B33C0FEE3621C07FDC7EF9649344407F86376BF03621C085B01A4B589344404CC45BE7DF3621C0F2CEA10C5593444019028063CF3621C05FED28CE51934440CC5EB69DB63621C0DFDE35E84B9344406631B1F9B83621C0E6CFB7054B934440B2D47ABFD13621C01975ADBD4F934440"
1378020371620000463	"2013-09-01 08:26:11"	"2013-09-01 08:30:26"	"0102000020E61000001200000016DC0F78603821C0F5D72B2CB891444017BA1281EA3721C0DB300A82C7914440FD12F1D6F93721C05B79C9FFE49144407D957CEC2E3821C0A148F7730A924440FCE25295B63821C09B745B2217924440F96A47718E3A21C00E8464011392444045F12A6B9B3A21C0416326512F924440C634D3BD4E3A21C0FA415DA45092444061FD9FC37C3921C0A14D0E9F7492444062BEBC00FB3821C00DC347C494924440E25817B7D13821C04D4A41B797924440C93D5DDDB13821C09AED0A7DB0924440FC51D4997B3821C00038F6ECB9924440CBBF9657AE3721C08D62B9A5D592444064AF777FBC3721C0F3ACA415DF9244409737876BB53721C0206118B0E4924440AF3F89CF9D3821C006D7DCD1FF924440B0AE0AD4623821C0062E8F3523934440"
1378020555620000199	"2013-09-01 08:29:15"	"2013-09-01 08:35:30"	"0102000020E61000001A000000F98381E7DE2B21C0F3035779029344402C29779FE32B21C080F44D9A0693444046443179032C21C08602B68311934440AB5E7EA7C92C21C0537AA6971893444043705CC64D2D21C0E621533E04934440761A69A9BC2D21C0F38FBE49D3924440F41ABB44F52E21C04DBED9E6C6924440BE326FD5753021C01AFCFD62B6924440D505BCCCB03121C09AED0A7DB0924440D2191879593321C01ADF1797AA924440D12346CF2D3421C080290307B4924440D12346CF2D3421C08D28ED0DBE9244401D588E90813421C02618CE35CC924440695721E5273521C0C6BE64E3C19244404E9D47C5FF3521C0FA635A9BC6924440B4041901153621C08D45D3D9C9924440321D3A3DEF3621C046EA3D95D3924440172EABB0193821C0D9E89C9FE2924440622D3E05C03821C08CB96B09F992444030BDFDB9683821C0A60EF27A30934440300F99F2213821C072DD94F25A934440300F99F2213821C0E5266A696E934440300F99F2213821C08CDB68006F9344407D789620233821C0329067976F9344407D789620233821C085EAE6E26F9344407D789620233821C0D844662E70934440"
1378022114620000011	"2013-09-01 08:55:14"	"2013-09-01 09:01:14"	"0102000020E610000019000000CEC3094CA73521C03673486AA19444403448C153C83521C03065E08096944440008BFCFA213621C0CAE0287975944440016E162F163621C030D461855B94444082035ABA823521C08A027D224F944440812040868E3521C0B134F0A31A94444035D42824993521C031957EC2D99344401B2D077AA83521C0B212F3ACA493444081CEA44DD53521C00B5EF415A493444033A48AE2553621C09E3F6D54A79344407F17B6662B3721C0F88A6EBDA693444018EAB0C22D3721C0984EEB36A89344407E569929AD3721C0DEC66647AA934440B0912408573821C02522FC8BA093444063450DA6613821C012DBDD037493444095B54DF1B83821C09F7422C154934440E292E34EE93821C0DF8783842893444048DDCEBEF23821C0A06F0B96EA92444062156F641E3921C027DE019EB4924440AF0AD462F03821C0BABF7ADCB79244409546CCECF33821C00D1AFA27B89244409546CCECF33821C0B3CEF8BEB89244409546CCECF33821C0ADDD76A1B992444048DDCEBEF23821C053927538BA924440FB73D190F13821C0A7ECF483BA924440"
1378023673620000534	"2013-09-01 09:21:13"	"2013-09-01 09:28:13"	"0102000020E61000001D0000001D91EF52EA4221C0D8497D59DA9344403755F7C8E64221C078D32D3BC49344406ADD06B5DF4221C0D89B1892939344406ADD06B5DF4221C018062CB98A93444083A10E2BDC4221C0CB9C2E8B89934440857AFA08FC4121C0A5D93C0E8393444087DF4DB7EC4021C0F816D68D77934440BB6246787B4021C02657B1F84D9344403B8908FF224021C099B855100393444057957D57043F21C0EDD808C4EB92444059C0046EDD3D21C0AD342905DD9244408D7DC9C6833D21C00038F6ECB9924440F4A5B73F173D21C080290307B49244400F60915F3F3C21C05A83F755B9924440C382FB010F3C21C09A9658198D924440C4094CA7753B21C05A2C45F29592444011A8FE41243B21C0603AADDBA0924440F9484A7A183A21C0B3B112F3AC9244401477BCC96F3921C03AB187F6B19244409529E620E83821C08D28ED0DBE92444016DC0F78603821C0DFC14F1C4093444063450DA6613821C08C84B69C4B93444049810530653821C0E6CFB7054B934440C9552C7E533821C01975ADBD4F93444030664B56453821C0D253E41071934440B0912408573821C07F6DFDF49F934440B1DEA815A63721C0AB21718FA5934440B2F677B6473721C0B212F3ACA4934440B2D47ABFD13621C05FB87361A4934440"
1378024616620000386	"2013-09-01 09:36:56"	"2013-09-01 09:42:41"	"0102000020E610000018000000D00A0C59DD4221C0EBC5504EB49344406AC020E9D34221C0DF8C9AAF929344406AC020E9D34221C018062CB98A934440371B2B31CF4221C0CB9C2E8B899344408597E0D4074221C0ACCABE2B8293444007D15AD1E64021C0CC7F48BF7D934440EE4108C8974021C0FF243E7782934440EECD6F98684021C00685419946934440D5E76A2BF63F21C06C04E275FD9244408A1D8D43FD3E21C046240A2DEB9244408C48145AD63D21C060CB2BD7DB924440DAE6C6F4843D21C09A0AF148BC924440289D4830D53C21C027DE019EB49244402907B309303C21C06D567DAEB69244405C381092053C21C000C45DBD8A924440909E2287883B21C027874F3A91924440115663096B3B21C0B477465B95924440DEB06D51663B21C000E1438996924440DE9387855A3B21C0F4FE3F4E98924440AC58FCA6B03A21C0800C1D3BA8924440473EAF78EA3921C0674815C5AB92444095F430B43A3921C09AED0A7DB092444062F3716DA83821C0E75608ABB1924440B0AE0AD4623821C0ADDD76A1B9924440"
1378025754620000621	"2013-09-01 09:55:54"	"2013-09-01 10:05:09"	"0102000020E61000002600000067EDB60BCD3521C024ED461FF39344404E29AF95D03521C024ED461FF3934440CE37A27BD63521C024ED461FF39344401BA19FA9D73521C07847C66AF3934440B4739A05DA3521C07847C66AF3934440E71890BDDE3521C07156444DF4934440E71890BDDE3521C0C4B0C398F4934440E71890BDDE3521C0180B43E4F4934440B4739A05DA3521C07156444DF4934440670A9DD7D83521C0CBA145B6F393444081423D7D043621C038A3E6ABE4934440344DD87E323621C03E5A9C31CC934440E71DA7E8483621C052103CBEBD93444033C170AE613621C0CBF3E0EEAC934440802A6EDC623621C07E8AE3C0AB93444033C170AE613621C0D8D5E429AB934440802A6EDC623621C0D8D5E429AB9344401A1A4F04713621C0CBD6FA22A1934440E6AE25E4833621C012F8C3CF7F93444080D8D2A3A93621C0723447567E934440666B7D91D03621C0E5EC9DD15693444099D6A6B1BD3621C09983A0A3559344407F129F3BC13621C046EF54C03D934440B20E4757E93621C04CC3F0113193444032056B9C4D3721C0C05E61C1FD92444018B5FB55803721C086AB0320EE924440E42CEC69873721C04033880FEC9244406458C51B993721C0137F1475E6924440E353008C673821C060E811A3E7924440E2E995B20C3921C0CDE9B298D8924440C84274081C3921C00729780AB9924440C84274081C3921C0C0B0FCF9B6924440622D3E05C03821C02DCF83BBB3924440492F6AF7AB3821C0E065868DB292444096986725AD3821C08D0B0742B2924440C93D5DDDB13821C0E065868DB29244402F6B6281AF3821C0871A8524B3924440492F6AF7AB3821C02DCF83BBB3924440"
1378024896620000100	"2013-09-01 09:41:36"	"2013-09-01 10:07:36"	"0102000020E61000006900000030478FDFDB5421C0219221C7D695444030478FDFDB5421C01BA19FA9D795444097749483D95421C0219221C7D69544401766A19DD35421C0219221C7D6954440B0389CF9D55421C02783A3E4D5954440B0389CF9D55421C07BDD2230D6954440B0389CF9D55421C02783A3E4D595444064CF9ECBD45421C02783A3E4D5954440FDA19927D75421C07BDD2230D69544407DB08C0DDD5421C02783A3E4D5954440CA198A3BDE5421C07BDD2230D6954440FDA19927D75421C02783A3E4D5954440645B069CA55421C0CE548847E2954440CC7EDDE9CE5321C04772F90FE9954440FF06EDD5C75321C0F4FA93F8DC954440E50D30F31D5421C0B4739A05DA954440651C23D9235421C087A2409FC895444032772D211F5421C04147AB5AD295444032772D211F5421C0E7FBA9F1D2954440E50D30F31D5421C094A12AA6D2954440E50D30F31D5421C04147AB5AD29544407EE02A4F205421C0EEEC2B0FD295444018B325AB225421C0EEEC2B0FD2954440651C23D9235421C047382D78D1954440FEEE1D35265421C09B92ACC3D1954440FEEE1D35265421C09B92ACC3D1954440651C23D9235421C0F4DDAD2CD195444018B325AB225421C0A1832EE1D0954440CB49287D215421C0F4DDAD2CD195444018B325AB225421C0F4DDAD2CD1954440CB49287D215421C047382D78D1954440CB49287D215421C047382D78D195444018B325AB225421C047382D78D195444018B325AB225421C0F4DDAD2CD195444018B325AB225421C0F4DDAD2CD1954440CB49287D215421C047382D78D1954440E5F04927125421C05437177FDB954440998235CEA65321C0A1A014ADDC954440E6C93505325321C0C7293A92CB9544409B215514AF5221C0AEF199EC9F9544404E44BFB67E5221C008C90226709544409B73F04C685221C00281CEA44D954440812381069B5221C0C9B08A373295444000C80913465321C0E200FA7DFF94444080F3E2C4575321C009A7052FFA944440338AE596565321C0B64C86E3F9944440E620E868555321C0B64C86E3F9944440999A046F485321C076A8A624EB9444406803B001115221C0D6C743DFDD9444409E08E23C9C5021C0F06E6589CE9444408787307E1A4F21C0B6BB07E8BE944440BD5296218E4D21C029AE2AFBAE9444403ECBF3E0EE4C21C003EB387EA894444025EA059FE64C21C0B090B932A8944440A723809BC54B21C0B66455849B9444404339D1AE424A21C02A5778978B9444405FEE93A3004921C0371C96067E944440F986C267EB4821C03D0D18247D94444093C3279D484821C0C3EFA65B769444407A6EA12B114821C0101FD8F15F944440931ADA006C4821C09E616A4B1D9444402CB81FF0C04821C0E52B8194D89344407978CF81E54821C0B24CBF44BC9344402C0FD253E44821C0AB5B3D27BD934440AC6F6072A34821C0F8A75489B2934440C8073D9B554721C09240834D9D9344403126FDBD144621C072512D228A9344401ADF1797AA4421C0F2423A3C849344404E7ADFF8DA4321C0C5ABAC6D8A934440821FD5B0DF4321C072512D228A9344409C35785F954321C07842AF3F89934440EB724A404C4221C0EC51B81E8593444054573ECBF34021C0527FBDC28293444088F71C588E4021C0DF52CE177B934440543541D47D4021C0460C3B8C49934440BBEEAD484C4021C07920B24813934440BBEEAD484C4021C093E4B9BE0F934440D595CFF23C4021C0A0C6BDF90D9344403C4A253CA13F21C0395FECBDF8924440BE66B96C743E21C0D3F71A82E3924440404E98309A3D21C0BAF94674CF92444073B9C150873D21C0A7ECF483BA9244408E041A6CEA3C21C01AFCFD62B692444042E8A04B383C21C07A3881E9B492444043572250FD3B21C0B45A608F89924440C4094CA7753B21C000E1438996924440DE59BBED423B21C080EF366F9C92444011E2CAD93B3B21C07AFEB4519D924440DF4F8D976E3A21C09AED0A7DB0924440AEA06989953921C0FA298E03AF924440E292E34EE93821C0F355F2B1BB92444062A1D634EF3821C03ACE6DC2BD9244402FFCE07CEA3821C0E773EE76BD9244409529E620E83821C040BFEFDFBC9244407C65DEAAEB3821C093196F2BBD9244401538D906EE3821C0E773EE76BD9244401538D906EE3821C0DA91EA3BBF92444048C0E8F2E63821C08063CF9ECB92444048C0E8F2E63821C02D095053CB924440E275FD82DD3821C04016A243E092444016A75A0BB33821C026A94C3107934440499EEBFB703821C0E695EB6D33934440FC170802643821C0392A37514B934440172EABB0193821C005DCF3FC69934440B0743E3C4B3821C01F1494A295934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Bitmap Heap Scan on taxi_trajectory  (cost=88.86..118.13 rows=1 width=842) (actual time=28.579..28.764 rows=11 loops=1)"
"  Recheck Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-02 00:00:00'::timestamp without time zone))"
"  Rows Removed by Index Recheck: 189"
"  Filter: ((hour_of_day >= 7) AND (hour_of_day <= 9) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_endpoint(polyline)) AND (NOT st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline))))"
"  Rows Removed by Filter: 546"
"  Heap Blocks: exact=91 lossy=90"
"  Buffers: shared hit=2837"
"  ->  BitmapAnd  (cost=88.86..88.86 rows=1 width=0) (actual time=28.366..28.367 rows=0 loops=1)"
"        Buffers: shared hit=2656"
"        ->  Bitmap Index Scan on idx_end_point_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=25.229..25.229 rows=97597 loops=1)"
"              Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared hit=2642"
"        ->  Bitmap Index Scan on idx_start_local_time_btree  (cost=0.00..83.07 rows=3864 width=0) (actual time=0.181..0.181 rows=3929 loops=1)"
"              Index Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-02 00:00:00'::timestamp without time zone))"
"              Buffers: shared hit=14"
"Planning Time: 0.276 ms"
"Execution Time: 29.160 ms"
 */


/* Test Case 1.3: In the 1st week of Sept 2013, the morning rush hour, the starting point and the end point were both in CBD, but part of the trip was not in CBD */
/* Test Case 1.3 with Only indexing temporal data (B-tree on start_local_time and hour_of_day) */
CREATE INDEX idx_start_local_time_btree ON taxi_trajectory (start_local_time);
CREATE INDEX idx_hour_of_day_btree ON taxi_trajectory (hour_of_day);

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time < TIMESTAMP '2013-09-08 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_StartPoint(polyline)
  )
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_EndPoint(polyline)
  )
  AND NOT ST_CoveredBy(
    polyline,
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)
  );

DROP INDEX idx_start_local_time_btree;
DROP INDEX idx_hour_of_day_btree;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1378104382620000515	"2013-09-02 07:46:22"	"2013-09-02 08:09:37"	"0102000020E61000005E000000CBBF9657AE3721C0728BF9B9A1934440B11875ADBD3721C0A530EF71A693444098DBBDDC273721C0B80375CAA3934440CDEA1D6E873621C06B9A779CA29344404DDC2A88813621C0BFF4F6E7A2934440994528B6823621C0124F7633A393444066666666663621C038F581E49D934440992842EA763621C0723447567E934440992D5915E13621C0D844662E70934440315C1D00713721C04CFDBCA948934440CA1B60E63B3821C02657B1F84D9344404AD3A0681E3821C00CCD751A69934440E2016553AE3821C059198D7C5E934440E2CCAFE6003921C026E318C91E934440C8CEDBD8EC3821C0F92EA52E199344407C0E2C47C83821C079E6E5B0FB924440151BF33AE23821C02618CE35CC9244407BBC900E0F3921C080290307B4924440FC1C1F2DCE3821C0CD751A69A99244407C2B1213D43821C0E71C3C139A9244407CD45FAFB03821C0AD2F12DA72924440E3FC4D28443821C034D8D479549244404BE658DE553721C08E06F01648924440815F2349103621C054707841449244401B1021AE9C3521C09A3FA6B569924440EA3E00A94D3421C01AF7E6374C924440EACA67791E3421C0C80BE9F0109244406B0E10CCD13321C0E8F527F1B9914440EB39E97DE33321C0BC07E8BE9C9144405167EE21E13321C00F62670A9D914440B8CEBF5DF63321C0EF8FF7AA959144401D925A28993421C0C9E9EBF99A9144400247020D363521C0E2CAD93BA39144404E0CC9C9C43521C00F62670A9D914440336FD575A83621C00F289B7285914440325706D5063721C0A9DDAF027C9144404BAC8C463E3721C02FC03E3A7591444098A608707A3721C0C97553CA6B9144407F17B6662B3721C0A37895B54D9144406519E258173721C0E97C789620914440FF5A5EB9DE3621C0A3AD4A22FB9044407F129F3BC13621C03D29931ADA904440CD936B0A643621C0C47AA356989044409AB4A9BA473621C03E5E488787904440CDC82077113621C09161156F64904440B4CA4C69FD3521C0522CB7B41A904440B43EE5982C3621C032E6AE25E48F44401AA6B6D4413621C04562821ABE8F4440CD3CB9A6403621C085CC9541B58F4440CD1FD3DA343621C08CBD175FB48F44404D11E0F42E3621C0ECF99AE5B28F444000A8E2C62D3621C0A6811FD5B08F444000C5C892393621C03FFD67CD8F8F44404D4BAC8C463621C0D36A48DC638F4440003961C2683621C0336DFFCA4A8F444033DE567A6D3621C0E012807F4A8F444000FF942A513621C086AA984A3F8F444068B3EA73B53521C08DB800344A8F4440B6696CAF053521C0B9895A9A5B8F44406BB75D68AE3321C04089CF9D608F44403A77BB5E9A3221C03929CC7B9C8F4440EE5F5969523221C0F27B9BFEEC8F44403AC95697533221C0C53BC09316904440A182C30B223221C00B7F86376B9044402252D32EA63121C0912C6002B790444008ABB184B53121C04A0B9755D8904440EE5F5969523221C01DAED51EF6904440D314014EEF3221C05070B1A206914440382F4E7CB53321C05D8C81751C914440045ABA826D3421C01C7920B248914440048F6FEF1A3421C0CFA0A17F829144406B82A8FB003421C0E2900DA48B91444085D21742CE3321C0D53F8864C8914440D1E97937163421C01492CCEA1D924440045ABA826D3421C0944E24986A924440E9B7AF03E73421C00DE02D90A09244409BC761307F3521C074F04C68929244403465A71FD43521C04DF38E53749244404DDC2A88813621C087A6ECF48392444019ABCDFFAB3621C007B5DFDA89924440193C4CFBE63621C007EFAB72A192444032C687D9CB3621C0ED478AC8B092444099D6A6B1BD3621C0A0FB7266BB9244407F2F8507CD3621C0ED815660C8924440CBF44BC45B3721C05ABDC3EDD0924440FD4CBD6E113821C0EDBB22F8DF924440C93D5DDDB13821C0EDD808C4EB924440E2E47E87A23821C099B8551003934440AF05BD37863821C02CB7B41A12934440B0CBF09F6E3821C0CC7A319413934440B0CBF09F6E3821C07920B2481393444016F9F5436C3821C07920B2481393444063D17476323821C0EC12D55B039344403161342BDB3721C0266F8099EF924440"
1378105904620000288	"2013-09-02 08:11:44"	"2013-09-02 08:44:44"	"0102000020E6100000850000009737876BB53721C052D66F26A6934440FE7C5BB0543721C052D66F26A693444098BED7101C3721C0DFA9807B9E934440CD936B0A643621C03FE603029D9344407FDDE9CE133721C0535DC0CB0C934440333509DE903621C02C9ACE4E0693444082C98D226B3521C05A83F755B9924440359A5C8C813521C087E0B88C9B924440E86A2BF6973521C054E410717392444084D72E6D383421C0F4F928232E924440EB73B515FB3321C01B0FB6D8ED914440B8770DFAD23321C0887FD8D2A39144409DB81CAF403421C02F17F19D98914440E9D495CFF23421C06F9EEA909B914440CFDBD8EC483521C0CFF753E3A5914440CE4F711C783521C0568330B77B9144404E417E36723521C0A35BAFE94191444002BB9A3C653521C0E38BF6782191444002D88008713521C0F0164850FC9044400186E5CFB73521C010AFEB17EC904440CDAB3AAB053621C050FC1873D790444067B8019F1F3621C05DC136E2C990444067F2CD36373621C057B3CEF8BE904440802A6EDC623621C0DE3EABCC94904440CDC82077113621C0B8CD548847904440E7C6F484253621C06B0DA5F622904440344DD87E323621C04B0169FF03904440E7E3DA50313621C0126BF1290090444080D3BB783F3621C0F84F3750E08F4440E71DA7E8483621C0790778D2C28F44401AC39CA04D3621C03F7100FDBE8F44409AD18F86533621C01F9F909DB78F44401AE0826C593621C04C1938A0A58F4440CDB051D66F3621C0FF58880E818F4440B3B794F3C53621C0064A0A2C808F44406536C824233721C0F2B0506B9A8F44407E9065C1C43721C06CCEC133A18F444017D7F84CF63721C0AC55BB26A48F44403161342BDB3721C0CC272B86AB8F44404ACE893DB43721C032384A5E9D8F4440971AA19FA93721C0E6B16664908F4440FE9E58A7CA3721C0933A014D848F444031444E5FCF3721C06C770FD07D8F4440CAA7C7B60C3821C0804A95287B8F444063EE5A423E3821C0990E9D9E778F4440B0E8D66B7A3821C0933A014D848F444095D233BDC43821C03F373465A78F4440E275FD82DD3821C0F9BEB854A58F44406284F068E33821C0520ABABDA48F44402FFCE07CEA3821C09F73B7EBA58F4440AF0AD462F03821C07FDB1324B68F4440FDF50A0BEE3721C03F8EE6C8CA8F4440E527D53E1D3721C0FF40B96DDF8F444033A9A10DC03621C098309A95ED8F4440003961C2683621C0BFF38B12F48F4440CD02ED0E293621C0925CFE43FA8F4440B4E73235093621C0EB1B98DC28904440CDAB3AAB053621C0AB08371955904440E674594C6C3621C0EA5A7B9FAA9044404C50C3B7B03621C06ADD06B5DF90444099F38C7DC93621C04354E1CFF0904440B24813EF003721C0F06DFAB31F914440CB80B3942C3721C06FD39FFD48914440E5B8533A583721C0020CCB9F6F914440CCEF3499F13621C0A2EC2DE57C9144409A5DF756243621C00954FF2092914440E8137992743521C0C806D2C5A69144409C31CC09DA3421C02F17F19D9891444037C5E3A25A3421C0E99E758D969144409DF2E846583421C08F537424979144406A4DF38E533421C0E2ADF36F9791444085EFFD0DDA3321C07C80EECB9991444085EFFD0DDA3321C028B7ED7BD491444051DB8651103421C0EECEDA6D17924440516C054D4B3421C0FA5E43705C924440035FD1ADD73421C0BA85AE44A0924440B5C5353E933521C0E1F1ED5D83924440B439CE6DC23521C0018A9125739244401ADB6B41EF3521C0E7C589AF76924440344DD87E323621C0DAE38574789244403352EFA99C3621C0A16AF46A8092444032C687D9CB3621C03A5AD5928E9244406688635DDC3621C07AE1CE8591924440B20E4757E93621C0BA68C87894924440323A2009FB3621C0D449B6BA9C924440666B7D91D03621C0A7CF0EB8AE92444099B9C0E5B13621C00055DCB8C5924440B2BCAB1E303721C00D71AC8BDB9244407E8B4E965A3721C066BCADF4DA92444097546D37C13721C026529ACDE3924440965E9B8D953821C0F9BA0CFFE99244404912842BA03821C026A94C3107934440499EEBFB703821C01958C7F143934440FDFA2136583821C0AC5626FC52934440FDDD3B6A4C3821C0D219187959934440492A53CC413821C039471D1D57934440C93846B2473821C085B01A4B58934440CAFE791A303821C02C6519E25893444016687748313821C039471D1D57934440492A53CC413821C03F389F3A5693444030664B56453821C0ECDD1FEF55934440630B410E4A3821C04529215855934440C93846B2473821C04C1AA37554934440E3FC4D28443821C09F7422C154934440B03A72A4333821C032569BFF57934440B01D8CD8273821C0257497C45993444063B48EAA263821C079CE16105A934440B01D8CD8273821C0257497C459934440965984622B3821C07FBF982D59934440E3C281902C3821C02C6519E258934440CAFE791A303821C0257497C459934440E3C281902C3821C079CE16105A934440CAFE791A303821C01F8315A75A9344404A0D6D00363821C0199293895B934440E3C281902C3821C06CEC12D55B934440E3C281902C3821C012A1116C5C934440302C7FBE2D3821C012A1116C5C934440B01D8CD8273821C0199293895B934440302C7FBE2D3821C0199293895B934440302C7FBE2D3821C0199293895B934440965984622B3821C0C537143E5B934440E3C281902C3821C072DD94F25A934440965984622B3821C072DD94F25A934440E3C281902C3821C072DD94F25A934440B03A72A4333821C06CEC12D55B93444063D17476323821C0199293895B934440E3C281902C3821C072DD94F25A934440164B917C253821C079CE16105A934440B000A60C1C3821C0D219187959934440B000A60C1C3821C01F8315A75A934440172EABB0193821C01F8315A75A934440172EABB0193821C079CE16105A934440302C7FBE2D3821C00CB08F4E5D934440"
1378109912620000038	"2013-09-02 09:18:32"	"2013-09-02 09:34:32"	"0102000020E610000041000000172EABB0193821C0A0C6BDF90D9344409702D2FE073821C0395FECBDF89244409702D2FE073821C066F6798CF2924440CBA2B08BA23721C0B34291EEE792444098DBBDDC273721C080F44D9A06934440CCB56801DA3621C0DF87838428934440CCD24ECDE53621C053B4722F309344404CE141B3EB3621C09F1D705D31934440E63FA4DFBE3621C05FD04202469344401AE0826C593621C025AE635C71934440B4CA4C69FD3521C00B24287E8C9344401A1538D9063621C0DFA9807B9E934440CDE506431D3621C052D66F26A6934440CC988235CE3621C0F88A6EBDA69344404A7CEE04FB3721C0A530EF71A6934440614F3BFC353921C0E5B7E864A9934440145AD6FD633921C085B53176C293444060AB048BC33921C02BA4FCA4DA934440473EAF78EA3921C02BA4FCA4DA934440FAD4B14AE93921C07EFE7BF0DA93444013D38558FD3921C011C30E63D2934440FA0E7EE2003A21C0929735B1C0934440ADA580B4FF3921C0929735B1C0934440FA0E7EE2003A21C00B98C0ADBB934440AEA06989953921C0381268B0A99344407B6AF5D5553921C0D89B189293934440C8D3F203573921C04C8E3BA58393444061A6ED5F593921C01FDAC70A7E934440C8D3F203573921C0DF35E84B6F934440143DF031583921C03F55850662934440AE2CD159663921C0ECDD1FEF55934440FB95CE87673921C0ECDD1FEF55934440AE2CD159663921C03F389F3A56934440FB95CE87673921C092921E8656934440FB95CE87673921C092921E86569344409468C9E3693921C0ECDD1FEF55934440FB95CE87673921C03F389F3A56934440AE2CD159663921C092921E8656934440FB95CE87673921C092921E8656934440FB95CE87673921C092921E86569344409468C9E3693921C0ECDD1FEF55934440FB95CE87673921C039471D1D57934440FB95CE87673921C08CA19C685793444061C3D32B653921C0E5EC9DD156934440FB95CE87673921C03F389F3A56934440C7F0D8CF623921C0ECDD1FEF55934440C7F0D8CF623921C0ECDD1FEF55934440145AD6FD633921C0ECDD1FEF559344407B87DBA1613921C03F389F3A569344402E1EDE73603921C092921E86569344407B87DBA1613921C092921E86569344407B87DBA1613921C0E5EC9DD156934440C7F0D8CF623921C0E5EC9DD156934440145AD6FD633921C039471D1D57934440AE2CD159663921C0E5EC9DD156934440FB95CE87673921C03F389F3A56934440FB95CE87673921C03F389F3A56934440AE2CD159663921C092921E8656934440145AD6FD633921C0DFFB1BB45793444061C3D32B653921C08CA19C6857934440C7F0D8CF623921C03F389F3A5693444047FFCBB5683921C0C6FD47A643934440AE2CD159663921C039D384ED27934440C7F0D8CF623921C0E63E390A10934440E1B4E0455F3921C0F3203D450E934440"
1378112386620000038	"2013-09-02 09:59:46"	"2013-09-02 10:14:01"	"0102000020E61000003A000000145AD6FD633921C0CC5D4BC807934440C7D8092FC13921C05323F433F5924440AD4ECE50DC3921C0ACA8C1340C934440FA7DFFE6C53921C06C787AA52C9344402D40DB6AD63921C0A60EF27A30934440FA2B64AE0C3A21C03FE1ECD632934440C634D3BD4E3A21C0FF59F3E32F934440C66E9F55663A21C0923B6C2233934440F9307BD9763A21C039F06AB933934440ACE46377813A21C0E695EB6D33934440795C548B883A21C0923B6C2233934440DF89592F863A21C0E695EB6D33934440DFC325C79D3A21C0923B6C22339344409294F430B43A21C09F3A56293D934440C51C041DAD3A21C012842BA050934440AC014A438D3A21C0B972F6CE68934440799109F8353A21C07F164B917C93444013471E882C3A21C09F05A1BC8F934440ADDF4C4C173A21C0855E7F129F93444046B247A8193A21C0855E7F129F934440946DE00ED43921C0CBF3E0EEAC93444014200A664C3921C09E3F6D54A7934440AE0FEB8D5A3921C0E56036018693444061A6ED5F593921C0C571E0D572934440C8D3F203573921C0CC457C2766934440944BE3175E3921C05F0A0F9A5D9344407B87DBA1613921C065FB90B75C9344402E1EDE73603921C012A1116C5C934440944BE3175E3921C012A1116C5C934440AE0FEB8D5A3921C012A1116C5C934440AE0FEB8D5A3921C065FB90B75C934440944BE3175E3921C012A1116C5C934440FB78E8BB5B3921C0BF4692205C934440AE0FEB8D5A3921C0199293895B934440AE0FEB8D5A3921C0C537143E5B93444048E2E5E95C3921C01F8315A75A934440AE0FEB8D5A3921C0199293895B934440E1B4E0455F3921C06CEC12D55B934440E1B4E0455F3921C06CEC12D55B934440C7F0D8CF623921C0199293895B9344407B87DBA1613921C06CEC12D55B9344407B87DBA1613921C0BF4692205C9344402E1EDE73603921C06CEC12D55B934440C7F0D8CF623921C06CEC12D55B9344402E3BC43F6C3921C0BF4692205C93444047FFCBB5683921C0BF4692205C93444061C3D32B653921C0BF4692205C934440C7F0D8CF623921C012A1116C5C934440E1B4E0455F3921C0BF4692205C934440E1B4E0455F3921C0BF4692205C93444048E2E5E95C3921C0BF4692205C93444061A6ED5F593921C012A1116C5C9344407B87DBA1613921C0F2B1BB4049934440944BE3175E3921C0ACFF73982F93444047FFCBB5683921C06C3EAE0D15934440618907944D3921C0E63E390A109344402EE411DC483921C093E4B9BE0F9344402E01F8A7543921C0A0C6BDF90D934440"
1378197079620000038	"2013-09-03 09:31:19"	"2013-09-03 09:37:04"	"0102000020E610000018000000CAC4AD82183821C0F33D23111A934440FDF50A0BEE3721C0D314014EEF924440FE2AC0779B3721C02D431CEBE2924440E466B8019F3721C02D431CEBE292444031D0B52FA03721C02D431CEBE292444031ED9BFBAB3721C0EDBB22F8DF924440178046E9D23721C033349E08E2924440B08C0DDDEC3721C06DCA15DEE592444063B48EAA263821C066D993C0E692444016855D143D3821C0A6608DB3E9924440C93846B2473821C059F78F85E8924440630B410E4A3821C066D993C0E6924440166D8E739B3821C0938D075BEC924440168A743FA73821C07903CC7C07934440499EEBFB703821C05FB35C363A934440E3DF675C383821C0D90A9A965893444063D17476323821C0A59F70766B93444016687748313821C005DCF3FC699344409607E929723821C0651877836893444095D233BDC43821C0927538BA4A934440622D3E05C03821C0C6FD47A64393444015E126A3CA3821C09F3A56293D934440AEF204C24E3921C099D53BDC0E934440FB78E8BB5B3921C0F911BF620D934440"
1378194916620000288	"2013-09-03 08:55:16"	"2013-09-03 09:34:31"	"0102000020E61000009E000000164B917C253821C0B95510035D934440E388B5F8143821C0E509849D62934440309B00C3F23721C03221E692AA9344407A8CF2CCCB3921C0EB39E97DE3934440A629029CDE3D21C0D7BD158909944440A4FE7A85053F21C03126FDBD14944440A4552DE9283F21C0441669E21D94444022516859F73F21C0CA15DEE52294444087C267EBE04021C03E42CD902A944440BA15C26A2C4121C02A6F47382D944440533F6F2A524121C0B75F3E5931944440B9A64066674121C0A48CB80034944440EC8502B6834121C0AA9A20EA3E9444406C94F59B894121C0771211FE45944440D1E80E62674221C017F3734353944440D1798D5DA24221C0771211FE459444401D007157AF4221C0513239B533944440043C69E1B24221C05706D50627944440698B6B7C264321C071ADF6B0179444409BA9108FC44321C02A6F47382D9444409BCB0D863A4421C0B1A888D349944440651D8EAED24521C050A6D1E46294444061191BBAD94721C05DC2A1B778944440AC915D69194921C03D2AFEEF889444409146054EB64921C003B16CE6909444405C1FD61BB54A21C0B090B932A89444408FC4CBD3B94A21C02A91442FA39444408F1B7E37DD4A21C0C34659BF99944440F418E599974B21C0F6EB4E779E94444072C284D1AC4C21C0A99F3715A994444070EEAF1EF74D21C0F6251B0FB694444009DE9046054E21C0499D8026C294444070EEAF1EF74D21C0C3D7D7BAD4944440BD3AC780EC4D21C0F6B6990AF19444400A6AF816D64D21C0C976BE9F1A954440D9EA724A404C21C0C28A53AD8595444059DC7F643A4C21C022C7D633849544400C738236394C21C088F4DBD781954440F39194F4304C21C095D6DF12809544408C648F50334C21C0F51263997E95444040DEAB56264C21C0E23FDD40819544400D39B69E214C21C028B8585183954440A60BB1FA234C21C0DB4E5B238295444040DEAB56264C21C08EE55DF5809544400C569C6A2D4C21C0F51263997E954440D9B0A6B2284C21C088F4DBD781954440261AA4E0294C21C03B8BDEA980954440D9B0A6B2284C21C08EE55DF58095444059BF99982E4C21C0DB4E5B238295444059BF99982E4C21C0E23FDD4081954440C0EC9E3C2C4C21C0DB4E5B238295444040FB9122324C21C0359A5C8C81954440F39194F4304C21C0E8305F5E8095444040FB9122324C21C095D6DF1280954440D9CD8C7E344C21C04E5E64027E954440D9CD8C7E344C21C0FB03E5B67D954440F374AE28254C21C07B12D89C839544408D47A984274C21C0DB4E5B2382954440D9CD8C7E344C21C068226C787A95444040FB9122324C21C04E5E64027E954440C0EC9E3C2C4C21C0EE21E17B7F954440C0EC9E3C2C4C21C08EE55DF580954440C0EC9E3C2C4C21C03B8BDEA9809544407383A10E2B4C21C0E23FDD40819544400C569C6A2D4C21C08EE55DF5809544407383A10E2B4C21C0E8305F5E809544407383A10E2B4C21C0E8305F5E80954440261AA4E0294C21C0E23FDD40819544400C569C6A2D4C21C0427C60C77F95444040FB9122324C21C0FB03E5B67D954440C0EC9E3C2C4C21C08EE55DF5809544407383A10E2B4C21C0E23FDD4081954440C0EC9E3C2C4C21C0359A5C8C81954440A62897C62F4C21C08EE55DF58095444059BF99982E4C21C0E23FDD40819544400C569C6A2D4C21C03B8BDEA980954440F39194F4304C21C09BC761307F954440F39194F4304C21C0EE21E17B7F95444040FB9122324C21C09BC761307F95444059BF99982E4C21C0427C60C77F9544400C569C6A2D4C21C095D6DF12809544400C569C6A2D4C21C09BC761307F954440261AA4E0294C21C095D6DF12809544407383A10E2B4C21C0EE21E17B7F954440D9B0A6B2284C21C03B8BDEA9809544400C569C6A2D4C21C0486DE2E47E9544407383A10E2B4C21C0427C60C77F954440261AA4E0294C21C08EE55DF580954440F39194F4304C21C0F51263997E95444059BF99982E4C21C0359A5C8C819544400C738236394C21C0C28A53AD859544403F575BB1BF4C21C0C85EEFFE789544403EAE0D15E34C21C042B115342D954440A4897780274D21C0B62FA017EE944440A41AF67B624D21C0C98E8D40BC944440A41AF67B624D21C0DD611399B9944440240C03965C4D21C03D9E961FB8944440A4FD0FB0564D21C096E99788B79444400B60CAC0014D21C0B090B932A8944440A52DAEF1994C21C0D04543C6A39444408E3D7B2E534B21C03065E08096944440AAF23D23114A21C08A93FB1D8A944440AAF23D23114A21C0E3DEFC868994444011381268B04921C0AA4885B18594444060234910AE4821C09758198D7C944440C8D2872EA84721C0EA95B20C7194444048F949B54F4721C0CAC342AD69944440155454FD4A4721C01D1EC2F86994444049BA66F2CD4621C0707841446A944440FEB5BC72BD4521C01D01DC2C5E944440E71C3C139A4421C02AC6F99B5094444068CF656A124421C04A5E9D634094444002D71533C24321C0978DCEF9299444404F58E201654321C051DB8651109444406AA33A1DC84221C0917F66101F9444401DE38A8BA34221C02A52616C219444406BD8EF89754221C057E9EE3A1B944440D1AE42CA4F4221C06ABC7493189444401FD95C35CF4121C09E616A4B1D944440868DB27E334121C08AABCABE2B944440D5264EEE774021C0EAE74D452A944440221CB3EC494021C06AD95A5F24944440BC2363B5F93F21C0AA436E861B94444055302AA9134021C058923CD7F79344403C670B08AD3F21C0B8B1D991EA9344403EB48F15FC3E21C0D88349F1F1934440D99942E7353E21C0A4FB3905F99344400CCB9F6F0B3E21C08B1A4CC3F0934440DAFE9595263D21C0F81BEDB8E19344408F6E8445453C21C0F10D85CFD693444078F2E9B12D3B21C0F8E12021CA934440AC1919E42E3A21C0A56ABB09BE934440ADC266800B3A21C0EBC5504EB4934440C70DBF9B6E3921C02B306475AB93444096986725AD3821C0E5B7E864A9934440E38DCC237F3821C0EBA86A82A89344409624CFF57D3821C0F299EC9FA7934440B0AE0AD4623821C0056D72F8A493444096CD1C925A3821C07F164B917C93444016BF29AC543821C06C26DF6C7393444030833122513821C07217618A72934440E3AAB2EF8A3821C065FB90B75C934440FCE25295B63821C07F85CC95419344407C48F8DEDF3821C053978C6324934440C8940F41D53821C0D9791B9B1D93444095EF1989D03821C08C101E6D1C93444062D68BA19C3821C099F221A81A9344409607E929723821C0EC866D8B3293444016DC0F78603821C04CFDBCA94893444030A017EE5C3821C09966BAD74993444063450DA6613821C0E6CFB7054B934440C9552C7E533821C06CCF2C095093444063EE5A423E3821C0F2CEA10C55934440965984622B3821C0DFFB1BB457934440973C9E961F3821C0E5EC9DD156934440FD69A33A1D3821C092921E8656934440172EABB0193821C032569BFF57934440FD69A33A1D3821C039471D1D57934440"
1378367292620000038	"2013-09-05 08:48:12"	"2013-09-05 08:59:27"	"0102000020E61000002E000000FB78E8BB5B3921C0D95C35CF119344409485AFAF753921C0D9226937FA924440C712D6C6D83921C0198D7C5EF1924440469A7807783A21C073F56393FC9244402C2D23F59E3A21C059147651F4924440DF32A7CB623A21C0B34291EEE79244402DD15966113A21C0A05225CADE92444013471E882C3A21C0001B1021AE924440F99FFCDD3B3A21C013EE9579AB9244407AFB73D1903921C0BAA29410AC924440E2AFC91AF53821C07347FFCBB5924440FC1C1F2DCE3821C079AC1919E49244407C0E2C47C83821C026529ACDE3924440624A24D1CB3821C0206118B0E4924440E23B31EBC53821C086AB0320EE924440E3C798BB963821C03999B85510934440632827DA553821C05F5CAAD2169344404AD3A0681E3821C09FE3A3C519934440FD69A33A1D3821C04C89247A19934440FD69A33A1D3821C00611A96917934440FD69A33A1D3821C00611A96917934440FD69A33A1D3821C0596B28B517934440FD69A33A1D3821C04C89247A19934440FD69A33A1D3821C09FE3A3C519934440FD69A33A1D3821C09FE3A3C519934440E3A59BC4203821C0EC4CA1F31A934440CAE1934E243821C0EC4CA1F31A934440CAE1934E243821C0F92EA52E19934440CAE1934E243821C0F92EA52E19934440300F99F2213821C0FF1F274C18934440973C9E961F3821C00611A96917934440300F99F2213821C09FE3A3C5199344404AD3A0681E3821C0A6D425E318934440FD69A33A1D3821C0FF1F274C189344404AB6BA9C123821C019E42EC214934440637AC2120F3821C020D5B0DF13934440E388B5F8143821C0B3B6291E179344406397A8DE1A3821C04C89247A19934440B000A60C1C3821C03FA7203F1B934440CAC4AD82183821C09FE3A3C5199344407D5BB054173821C0A6D425E318934440172EABB0193821C0537AA69718934440B000A60C1C3821C0537AA69718934440E3A59BC4203821C04698A25C1A93444063B48EAA263821C0DF6A9DB81C9344407D789620233821C0E65B1FD61B934440"
1378369236620000038	"2013-09-05 09:20:36"	"2013-09-05 09:48:21"	"0102000020E6100000700000004A7CEE04FB3721C09FE3A3C51993444018416326513721C0000341800C93444032056B9C4D3721C0ACA8C1340C934440E59B6D6E4C3721C04C6C3EAE0D934440B20E4757E93621C08CD651D50493444081EB8A19E13521C0B950F9D7F29244409B70AFCC5B3521C0AD510FD1E8924440B5C01E13293521C060AE450BD0924440E96514CB2D3521C060915F3FC49244404E98309A953521C014D1AFAD9F924440CE6C57E8833521C007B5DFDA89924440815A0C1EA63521C0E1D4079277924440CEE0EF17B33521C061C614AC71924440B62FA017EE3421C041D7BE805E9244401DC70F95463421C06E6E4C4F58924440B66455849B3421C001A777F17E924440836DC493DD3421C02D95B7239C924440E9482EFF213521C0BA85AE44A092444035B22B2D233521C0BA85AE44A0924440821B295B243521C00DE02D90A0924440821B295B243521C00DE02D90A0924440CF842689253521C0BA85AE44A0924440E9482EFF213521C0BA85AE44A09244409CDF30D1203521C00DE02D90A09244409CDF30D1203521C00DE02D90A0924440E9482EFF213521C0672B2FF99F924440E9482EFF213521C014D1AFAD9F9244409CDF30D1203521C0BA85AE44A092444035B22B2D233521C014D1AFAD9F9244409CDF30D1203521C01AC231CB9E924440B5A338471D3521C0740D33349E924440693A3B191C3521C0CD58349D9D9244409CDF30D1203521C0740D33349E92444035B22B2D233521C0740D33349E9244404F7633A31F3521C0740D33349E924440B5A338471D3521C0CD58349D9D924440B5A338471D3521C020B3B3E89D924440E9482EFF213521C0740D33349E924440695721E5273521C0C767B27F9E924440B5C01E13293521C06D1CB1169F924440B5C01E13293521C01AC231CB9E9244401CEE23B7263521C020B3B3E89D924440E9482EFF213521C0CD58349D9D924440020D36751E3521C01AC231CB9E924440B5A338471D3521C06D1CB1169F924440020D36751E3521C0C07630629F9244409CDF30D1203521C0C07630629F924440821B295B243521C014D1AFAD9F9244404F7633A31F3521C0C07630629F9244404F7633A31F3521C0C07630629F92444082ACA7565F3521C0E02BBAF59A924440813D26529A3521C0AD4CF8A57E92444034BC5983F73521C0946B0A647692444019541B9C883621C0DA006C4084924440198EE733A03621C02079E75086924440191F662FDB3621C0D42CD0EE90924440E5D022DBF93621C0A7B228ECA2924440CC988235CE3621C0001B1021AE9244404C8A8F4FC83621C0ADC090D5AD9244404C6DA983BC3621C0001B1021AE924440FF03AC55BB3621C060747973B8924440E6E8F17B9B3621C0CDCCCCCCCC9244403352EFA99C3621C02618CE35CC924440CC24EA059F3621C07A724D81CC92444066F7E461A13621C0CDCCCCCCCC9244407FDDE9CE133721C08D62B9A5D5924440CBF44BC45B3721C0739EB12FD9924440FEB627486C3721C066BCADF4DA9244407EC51A2E723721C0198D7C5EF1924440E59B6D6E4C3721C0E030D1200593444098A1F144103721C0062E8F3523934440E65C8AABCA3621C02C2B4D4A41934440992842EA763621C0FFEA71DF6A934440CDE506431D3621C00533A6608D93444001344A97FE3521C09F2287889B9344404E8061F9F33521C05F9B8D9598934440008BFCFA213621C0B80375CAA3934440E73A8DB4543621C052D66F26A6934440FF08C380253721C0F88A6EBDA6934440499EEBFB703821C0EBA86A82A8934440E1B4E0455F3921C0C5025FD1AD934440C70DBF9B6E3921C08BE07F2BD9934440603C8386FE3921C07EE19524CF93444093E1783E033A21C0EBE2361AC0934440ADA580B4FF3921C0452E3883BF934440FA0E7EE2003A21C0B24CBF44BC93444061545227A03921C0E5B7E864A9934440944BE3175E3921C0E5B7E864A99344402EE411DC483921C09F05A1BC8F934440FB78E8BB5B3921C0389ECF807A9344402E1EDE73603921C0F2086EA46C93444061C3D32B653921C0BF4692205C9344402E1EDE73603921C0BF4692205C93444048E2E5E95C3921C06CEC12D55B934440944BE3175E3921C0BF4692205C93444048E2E5E95C3921C0BF4692205C93444048E2E5E95C3921C0C537143E5B93444048E2E5E95C3921C0C537143E5B934440FB78E8BB5B3921C0C537143E5B934440C7F0D8CF623921C06CEC12D55B934440AE2CD159663921C0BF4692205C934440FB95CE87673921C065FB90B75C934440AE2CD159663921C0BF4692205C934440C7F0D8CF623921C0199293895B934440C7F0D8CF623921C065FB90B75C934440145AD6FD633921C00CB08F4E5D934440145AD6FD633921C0B95510035D934440C7F0D8CF623921C065FB90B75C9344407BA4C16D6D3921C0BF29AC5450934440E1B4E0455F3921C059C2DA183B9344409468C9E3693921C0F33D23111A934440C7F0D8CF623921C033A8363811934440"
1378453913620000038	"2013-09-06 08:51:53"	"2013-09-06 08:55:23"	"0102000020E61000000F000000944BE3175E3921C020D5B0DF13934440AE2CD159663921C013B9E00CFE924440AC1E300F993A21C0C0417BF5F19244404609FA0B3D3A21C039252026E192444013471E882C3A21C06D3997E2AA9244402DB4739A053A21C020D099B4A9924440C8D3F203573921C0ADC090D5AD924440FB3E1C24443921C04D840D4FAF924440486E4DBA2D3921C093FC885FB1924440C8B1F50CE13821C033FAD170CA92444095D233BDC43821C06DE7FBA9F19244401650A8A78F3821C019E42EC214934440302C7FBE2D3821C0B9A7AB3B169344406397A8DE1A3821C00611A96917934440973C9E961F3821C0ACC5A70018934440"
1378455564620000038	"2013-09-06 09:19:24"	"2013-09-06 09:25:24"	"0102000020E610000019000000FD2FD7A2053821C06C3EAE0D159344407DE71725E83721C06DE7FBA9F1924440CB68E4F38A3721C059F78F85E89244404B5AF10D853721C0B933130CE792444098C3EE3B863721C019709692E5924440317E1AF7E63721C09961A3ACDF924440E3361AC05B3821C0069D103AE89244407C7DAD4B8D3821C0997E8978EB924440FC8BA031933821C0394206F2EC924440E21E4B1FBA3821C086AB0320EE9244407CD45FAFB03821C080F44D9A06934440C90391459A3821C0D95C35CF119344402F14B01D8C3821C09FE3A3C519934440B0AE0AD4623821C0FF93BF7B47934440637AC2120F3821C0D236FE4465934440B0743E3C4B3821C08CDB68006F934440FDDD3B6A4C3821C0329067976F9344402F14B01D8C3821C0F2EB87D8609344407CB779E3A43821C079CE16105A93444015C440D7BE3821C08C67D0D03F9344402FFCE07CEA3821C0793D98141F934440E15D2EE23B3921C0F3203D450E934440143DF031583921C0C66CC9AA08934440944BE3175E3921C03999B855109344407B87DBA1613921C026C632FD12934440"
1378540649620000038	"2013-09-07 08:57:29"	"2013-09-07 08:59:59"	"0102000020E61000000B000000AE2CD159663921C080F44D9A069344402CB98AC56F3A21C0F3E670ADF6924440795C548B883A21C0C6151747E592444013471E882C3A21C0DA571EA4A792444014083BC5AA3921C06D3997E2AA92444048E2E5E95C3921C0605793A7AC924440E275FD82DD3821C04DA1F31ABB92444062105839B43821C059147651F49244406362F3716D3821C013F3ACA4159344407D3ECA880B3821C020D5B0DF1393444017F4DE18023821C04C6C3EAE0D934440"
1378542775620000038	"2013-09-07 09:32:55"	"2013-09-07 09:38:10"	"0102000020E610000016000000645DDC46033821C07903CC7C079344407EFFE6C5893721C0206118B0E492444098E0D407923721C0D9E89C9FE29244404A0856D5CB3721C04DF8A57EDE924440971FB8CA133821C0EDBB22F8DF924440622D3E05C03821C0938D075BEC924440E2AFC91AF53821C0066344A2D09244402E5393E00D3921C09A0AF148BC924440FBCA83F4143921C060747973B892444016A75A0BB33821C093FC885FB1924440499EEBFB703821C0E773EE76BD92444030664B56453821C0B3EBDE8AC4924440FD69A33A1D3821C0A0185932C7924440E388B5F8143821C0CDCCCCCCCC924440CAC4AD82183821C0D3BD4EEACB924440637AC2120F3821C07A724D81CC924440CAA7C7B60C3821C01A36CAFACD924440B000A60C1C3821C0C6DB4AAFCD924440E3C281902C3821C020274C18CD924440302C7FBE2D3821C020274C18CD9244407D789620233821C0C6DB4AAFCD924440300F99F2213821C0C6DB4AAFCD924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Gather  (cost=4641.62..78153.21 rows=1 width=842) (actual time=31.855..41.740 rows=12 loops=1)"
"  Workers Planned: 2"
"  Workers Launched: 2"
"  Buffers: shared hit=1675"
"  ->  Parallel Bitmap Heap Scan on taxi_trajectory  (cost=3641.62..77153.11 rows=1 width=842) (actual time=10.556..12.253 rows=4 loops=3)"
"        Recheck Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-08 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9))"
"        Rows Removed by Index Recheck: 721"
"        Filter: ((NOT st_coveredby(polyline, '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_endpoint(polyline)))"
"        Rows Removed by Filter: 1321"
"        Heap Blocks: exact=1330"
"        Buffers: shared hit=1675"
"        ->  BitmapAnd  (cost=3641.62..3641.62 rows=3798 width=0) (actual time=30.711..30.712 rows=0 loops=1)"
"              Buffers: shared hit=283"
"              ->  Bitmap Index Scan on idx_start_local_time_btree  (cost=0.00..583.06 rows=27863 width=0) (actual time=3.593..3.593 rows=30141 loops=1)"
"                    Index Cond: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-08 00:00:00'::timestamp without time zone))"
"                    Buffers: shared hit=85"
"              ->  Bitmap Index Scan on idx_hour_of_day_btree  (cost=0.00..3058.31 rows=228188 width=0) (actual time=26.463..26.463 rows=230895 loops=1)"
"                    Index Cond: ((hour_of_day >= 7) AND (hour_of_day <= 9))"
"                    Buffers: shared hit=198"
"Planning Time: 0.215 ms"
"Execution Time: 41.773 ms"
 */

/* Test Case 1.3: In the 1st week of Sept 2013, the morning rush hour, the starting point and the end point were both in CBD, but part of the trip was not in CBD */
/* Test Case 1.3 with Only indexing spatial data (GiST on polyline, SP-GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline)) */
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_start_point_spgist ON taxi_trajectory USING spgist (ST_StartPoint(polyline));
CREATE INDEX idx_end_point_spgist ON taxi_trajectory USING spgist (ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time <  TIMESTAMP '2013-09-08 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_StartPoint(polyline)
  )
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_EndPoint(polyline)
  )
  AND NOT ST_CoveredBy(
    polyline,
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)
  );

DROP INDEX idx_polyline_gist;
DROP INDEX idx_start_point_spgist;
DROP INDEX idx_end_point_spgist;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1378104382620000515	"2013-09-02 07:46:22"	"2013-09-02 08:09:37"	"0102000020E61000005E000000CBBF9657AE3721C0728BF9B9A1934440B11875ADBD3721C0A530EF71A693444098DBBDDC273721C0B80375CAA3934440CDEA1D6E873621C06B9A779CA29344404DDC2A88813621C0BFF4F6E7A2934440994528B6823621C0124F7633A393444066666666663621C038F581E49D934440992842EA763621C0723447567E934440992D5915E13621C0D844662E70934440315C1D00713721C04CFDBCA948934440CA1B60E63B3821C02657B1F84D9344404AD3A0681E3821C00CCD751A69934440E2016553AE3821C059198D7C5E934440E2CCAFE6003921C026E318C91E934440C8CEDBD8EC3821C0F92EA52E199344407C0E2C47C83821C079E6E5B0FB924440151BF33AE23821C02618CE35CC9244407BBC900E0F3921C080290307B4924440FC1C1F2DCE3821C0CD751A69A99244407C2B1213D43821C0E71C3C139A9244407CD45FAFB03821C0AD2F12DA72924440E3FC4D28443821C034D8D479549244404BE658DE553721C08E06F01648924440815F2349103621C054707841449244401B1021AE9C3521C09A3FA6B569924440EA3E00A94D3421C01AF7E6374C924440EACA67791E3421C0C80BE9F0109244406B0E10CCD13321C0E8F527F1B9914440EB39E97DE33321C0BC07E8BE9C9144405167EE21E13321C00F62670A9D914440B8CEBF5DF63321C0EF8FF7AA959144401D925A28993421C0C9E9EBF99A9144400247020D363521C0E2CAD93BA39144404E0CC9C9C43521C00F62670A9D914440336FD575A83621C00F289B7285914440325706D5063721C0A9DDAF027C9144404BAC8C463E3721C02FC03E3A7591444098A608707A3721C0C97553CA6B9144407F17B6662B3721C0A37895B54D9144406519E258173721C0E97C789620914440FF5A5EB9DE3621C0A3AD4A22FB9044407F129F3BC13621C03D29931ADA904440CD936B0A643621C0C47AA356989044409AB4A9BA473621C03E5E488787904440CDC82077113621C09161156F64904440B4CA4C69FD3521C0522CB7B41A904440B43EE5982C3621C032E6AE25E48F44401AA6B6D4413621C04562821ABE8F4440CD3CB9A6403621C085CC9541B58F4440CD1FD3DA343621C08CBD175FB48F44404D11E0F42E3621C0ECF99AE5B28F444000A8E2C62D3621C0A6811FD5B08F444000C5C892393621C03FFD67CD8F8F44404D4BAC8C463621C0D36A48DC638F4440003961C2683621C0336DFFCA4A8F444033DE567A6D3621C0E012807F4A8F444000FF942A513621C086AA984A3F8F444068B3EA73B53521C08DB800344A8F4440B6696CAF053521C0B9895A9A5B8F44406BB75D68AE3321C04089CF9D608F44403A77BB5E9A3221C03929CC7B9C8F4440EE5F5969523221C0F27B9BFEEC8F44403AC95697533221C0C53BC09316904440A182C30B223221C00B7F86376B9044402252D32EA63121C0912C6002B790444008ABB184B53121C04A0B9755D8904440EE5F5969523221C01DAED51EF6904440D314014EEF3221C05070B1A206914440382F4E7CB53321C05D8C81751C914440045ABA826D3421C01C7920B248914440048F6FEF1A3421C0CFA0A17F829144406B82A8FB003421C0E2900DA48B91444085D21742CE3321C0D53F8864C8914440D1E97937163421C01492CCEA1D924440045ABA826D3421C0944E24986A924440E9B7AF03E73421C00DE02D90A09244409BC761307F3521C074F04C68929244403465A71FD43521C04DF38E53749244404DDC2A88813621C087A6ECF48392444019ABCDFFAB3621C007B5DFDA89924440193C4CFBE63621C007EFAB72A192444032C687D9CB3621C0ED478AC8B092444099D6A6B1BD3621C0A0FB7266BB9244407F2F8507CD3621C0ED815660C8924440CBF44BC45B3721C05ABDC3EDD0924440FD4CBD6E113821C0EDBB22F8DF924440C93D5DDDB13821C0EDD808C4EB924440E2E47E87A23821C099B8551003934440AF05BD37863821C02CB7B41A12934440B0CBF09F6E3821C0CC7A319413934440B0CBF09F6E3821C07920B2481393444016F9F5436C3821C07920B2481393444063D17476323821C0EC12D55B039344403161342BDB3721C0266F8099EF924440"
1378105904620000288	"2013-09-02 08:11:44"	"2013-09-02 08:44:44"	"0102000020E6100000850000009737876BB53721C052D66F26A6934440FE7C5BB0543721C052D66F26A693444098BED7101C3721C0DFA9807B9E934440CD936B0A643621C03FE603029D9344407FDDE9CE133721C0535DC0CB0C934440333509DE903621C02C9ACE4E0693444082C98D226B3521C05A83F755B9924440359A5C8C813521C087E0B88C9B924440E86A2BF6973521C054E410717392444084D72E6D383421C0F4F928232E924440EB73B515FB3321C01B0FB6D8ED914440B8770DFAD23321C0887FD8D2A39144409DB81CAF403421C02F17F19D98914440E9D495CFF23421C06F9EEA909B914440CFDBD8EC483521C0CFF753E3A5914440CE4F711C783521C0568330B77B9144404E417E36723521C0A35BAFE94191444002BB9A3C653521C0E38BF6782191444002D88008713521C0F0164850FC9044400186E5CFB73521C010AFEB17EC904440CDAB3AAB053621C050FC1873D790444067B8019F1F3621C05DC136E2C990444067F2CD36373621C057B3CEF8BE904440802A6EDC623621C0DE3EABCC94904440CDC82077113621C0B8CD548847904440E7C6F484253621C06B0DA5F622904440344DD87E323621C04B0169FF03904440E7E3DA50313621C0126BF1290090444080D3BB783F3621C0F84F3750E08F4440E71DA7E8483621C0790778D2C28F44401AC39CA04D3621C03F7100FDBE8F44409AD18F86533621C01F9F909DB78F44401AE0826C593621C04C1938A0A58F4440CDB051D66F3621C0FF58880E818F4440B3B794F3C53621C0064A0A2C808F44406536C824233721C0F2B0506B9A8F44407E9065C1C43721C06CCEC133A18F444017D7F84CF63721C0AC55BB26A48F44403161342BDB3721C0CC272B86AB8F44404ACE893DB43721C032384A5E9D8F4440971AA19FA93721C0E6B16664908F4440FE9E58A7CA3721C0933A014D848F444031444E5FCF3721C06C770FD07D8F4440CAA7C7B60C3821C0804A95287B8F444063EE5A423E3821C0990E9D9E778F4440B0E8D66B7A3821C0933A014D848F444095D233BDC43821C03F373465A78F4440E275FD82DD3821C0F9BEB854A58F44406284F068E33821C0520ABABDA48F44402FFCE07CEA3821C09F73B7EBA58F4440AF0AD462F03821C07FDB1324B68F4440FDF50A0BEE3721C03F8EE6C8CA8F4440E527D53E1D3721C0FF40B96DDF8F444033A9A10DC03621C098309A95ED8F4440003961C2683621C0BFF38B12F48F4440CD02ED0E293621C0925CFE43FA8F4440B4E73235093621C0EB1B98DC28904440CDAB3AAB053621C0AB08371955904440E674594C6C3621C0EA5A7B9FAA9044404C50C3B7B03621C06ADD06B5DF90444099F38C7DC93621C04354E1CFF0904440B24813EF003721C0F06DFAB31F914440CB80B3942C3721C06FD39FFD48914440E5B8533A583721C0020CCB9F6F914440CCEF3499F13621C0A2EC2DE57C9144409A5DF756243621C00954FF2092914440E8137992743521C0C806D2C5A69144409C31CC09DA3421C02F17F19D9891444037C5E3A25A3421C0E99E758D969144409DF2E846583421C08F537424979144406A4DF38E533421C0E2ADF36F9791444085EFFD0DDA3321C07C80EECB9991444085EFFD0DDA3321C028B7ED7BD491444051DB8651103421C0EECEDA6D17924440516C054D4B3421C0FA5E43705C924440035FD1ADD73421C0BA85AE44A0924440B5C5353E933521C0E1F1ED5D83924440B439CE6DC23521C0018A9125739244401ADB6B41EF3521C0E7C589AF76924440344DD87E323621C0DAE38574789244403352EFA99C3621C0A16AF46A8092444032C687D9CB3621C03A5AD5928E9244406688635DDC3621C07AE1CE8591924440B20E4757E93621C0BA68C87894924440323A2009FB3621C0D449B6BA9C924440666B7D91D03621C0A7CF0EB8AE92444099B9C0E5B13621C00055DCB8C5924440B2BCAB1E303721C00D71AC8BDB9244407E8B4E965A3721C066BCADF4DA92444097546D37C13721C026529ACDE3924440965E9B8D953821C0F9BA0CFFE99244404912842BA03821C026A94C3107934440499EEBFB703821C01958C7F143934440FDFA2136583821C0AC5626FC52934440FDDD3B6A4C3821C0D219187959934440492A53CC413821C039471D1D57934440C93846B2473821C085B01A4B58934440CAFE791A303821C02C6519E25893444016687748313821C039471D1D57934440492A53CC413821C03F389F3A5693444030664B56453821C0ECDD1FEF55934440630B410E4A3821C04529215855934440C93846B2473821C04C1AA37554934440E3FC4D28443821C09F7422C154934440B03A72A4333821C032569BFF57934440B01D8CD8273821C0257497C45993444063B48EAA263821C079CE16105A934440B01D8CD8273821C0257497C459934440965984622B3821C07FBF982D59934440E3C281902C3821C02C6519E258934440CAFE791A303821C0257497C459934440E3C281902C3821C079CE16105A934440CAFE791A303821C01F8315A75A9344404A0D6D00363821C0199293895B934440E3C281902C3821C06CEC12D55B934440E3C281902C3821C012A1116C5C934440302C7FBE2D3821C012A1116C5C934440B01D8CD8273821C0199293895B934440302C7FBE2D3821C0199293895B934440302C7FBE2D3821C0199293895B934440965984622B3821C0C537143E5B934440E3C281902C3821C072DD94F25A934440965984622B3821C072DD94F25A934440E3C281902C3821C072DD94F25A934440B03A72A4333821C06CEC12D55B93444063D17476323821C0199293895B934440E3C281902C3821C072DD94F25A934440164B917C253821C079CE16105A934440B000A60C1C3821C0D219187959934440B000A60C1C3821C01F8315A75A934440172EABB0193821C01F8315A75A934440172EABB0193821C079CE16105A934440302C7FBE2D3821C00CB08F4E5D934440"
1378109912620000038	"2013-09-02 09:18:32"	"2013-09-02 09:34:32"	"0102000020E610000041000000172EABB0193821C0A0C6BDF90D9344409702D2FE073821C0395FECBDF89244409702D2FE073821C066F6798CF2924440CBA2B08BA23721C0B34291EEE792444098DBBDDC273721C080F44D9A06934440CCB56801DA3621C0DF87838428934440CCD24ECDE53621C053B4722F309344404CE141B3EB3621C09F1D705D31934440E63FA4DFBE3621C05FD04202469344401AE0826C593621C025AE635C71934440B4CA4C69FD3521C00B24287E8C9344401A1538D9063621C0DFA9807B9E934440CDE506431D3621C052D66F26A6934440CC988235CE3621C0F88A6EBDA69344404A7CEE04FB3721C0A530EF71A6934440614F3BFC353921C0E5B7E864A9934440145AD6FD633921C085B53176C293444060AB048BC33921C02BA4FCA4DA934440473EAF78EA3921C02BA4FCA4DA934440FAD4B14AE93921C07EFE7BF0DA93444013D38558FD3921C011C30E63D2934440FA0E7EE2003A21C0929735B1C0934440ADA580B4FF3921C0929735B1C0934440FA0E7EE2003A21C00B98C0ADBB934440AEA06989953921C0381268B0A99344407B6AF5D5553921C0D89B189293934440C8D3F203573921C04C8E3BA58393444061A6ED5F593921C01FDAC70A7E934440C8D3F203573921C0DF35E84B6F934440143DF031583921C03F55850662934440AE2CD159663921C0ECDD1FEF55934440FB95CE87673921C0ECDD1FEF55934440AE2CD159663921C03F389F3A56934440FB95CE87673921C092921E8656934440FB95CE87673921C092921E86569344409468C9E3693921C0ECDD1FEF55934440FB95CE87673921C03F389F3A56934440AE2CD159663921C092921E8656934440FB95CE87673921C092921E8656934440FB95CE87673921C092921E86569344409468C9E3693921C0ECDD1FEF55934440FB95CE87673921C039471D1D57934440FB95CE87673921C08CA19C685793444061C3D32B653921C0E5EC9DD156934440FB95CE87673921C03F389F3A56934440C7F0D8CF623921C0ECDD1FEF55934440C7F0D8CF623921C0ECDD1FEF55934440145AD6FD633921C0ECDD1FEF559344407B87DBA1613921C03F389F3A569344402E1EDE73603921C092921E86569344407B87DBA1613921C092921E86569344407B87DBA1613921C0E5EC9DD156934440C7F0D8CF623921C0E5EC9DD156934440145AD6FD633921C039471D1D57934440AE2CD159663921C0E5EC9DD156934440FB95CE87673921C03F389F3A56934440FB95CE87673921C03F389F3A56934440AE2CD159663921C092921E8656934440145AD6FD633921C0DFFB1BB45793444061C3D32B653921C08CA19C6857934440C7F0D8CF623921C03F389F3A5693444047FFCBB5683921C0C6FD47A643934440AE2CD159663921C039D384ED27934440C7F0D8CF623921C0E63E390A10934440E1B4E0455F3921C0F3203D450E934440"
1378112386620000038	"2013-09-02 09:59:46"	"2013-09-02 10:14:01"	"0102000020E61000003A000000145AD6FD633921C0CC5D4BC807934440C7D8092FC13921C05323F433F5924440AD4ECE50DC3921C0ACA8C1340C934440FA7DFFE6C53921C06C787AA52C9344402D40DB6AD63921C0A60EF27A30934440FA2B64AE0C3A21C03FE1ECD632934440C634D3BD4E3A21C0FF59F3E32F934440C66E9F55663A21C0923B6C2233934440F9307BD9763A21C039F06AB933934440ACE46377813A21C0E695EB6D33934440795C548B883A21C0923B6C2233934440DF89592F863A21C0E695EB6D33934440DFC325C79D3A21C0923B6C22339344409294F430B43A21C09F3A56293D934440C51C041DAD3A21C012842BA050934440AC014A438D3A21C0B972F6CE68934440799109F8353A21C07F164B917C93444013471E882C3A21C09F05A1BC8F934440ADDF4C4C173A21C0855E7F129F93444046B247A8193A21C0855E7F129F934440946DE00ED43921C0CBF3E0EEAC93444014200A664C3921C09E3F6D54A7934440AE0FEB8D5A3921C0E56036018693444061A6ED5F593921C0C571E0D572934440C8D3F203573921C0CC457C2766934440944BE3175E3921C05F0A0F9A5D9344407B87DBA1613921C065FB90B75C9344402E1EDE73603921C012A1116C5C934440944BE3175E3921C012A1116C5C934440AE0FEB8D5A3921C012A1116C5C934440AE0FEB8D5A3921C065FB90B75C934440944BE3175E3921C012A1116C5C934440FB78E8BB5B3921C0BF4692205C934440AE0FEB8D5A3921C0199293895B934440AE0FEB8D5A3921C0C537143E5B93444048E2E5E95C3921C01F8315A75A934440AE0FEB8D5A3921C0199293895B934440E1B4E0455F3921C06CEC12D55B934440E1B4E0455F3921C06CEC12D55B934440C7F0D8CF623921C0199293895B9344407B87DBA1613921C06CEC12D55B9344407B87DBA1613921C0BF4692205C9344402E1EDE73603921C06CEC12D55B934440C7F0D8CF623921C06CEC12D55B9344402E3BC43F6C3921C0BF4692205C93444047FFCBB5683921C0BF4692205C93444061C3D32B653921C0BF4692205C934440C7F0D8CF623921C012A1116C5C934440E1B4E0455F3921C0BF4692205C934440E1B4E0455F3921C0BF4692205C93444048E2E5E95C3921C0BF4692205C93444061A6ED5F593921C012A1116C5C9344407B87DBA1613921C0F2B1BB4049934440944BE3175E3921C0ACFF73982F93444047FFCBB5683921C06C3EAE0D15934440618907944D3921C0E63E390A109344402EE411DC483921C093E4B9BE0F9344402E01F8A7543921C0A0C6BDF90D934440"
1378197079620000038	"2013-09-03 09:31:19"	"2013-09-03 09:37:04"	"0102000020E610000018000000CAC4AD82183821C0F33D23111A934440FDF50A0BEE3721C0D314014EEF924440FE2AC0779B3721C02D431CEBE2924440E466B8019F3721C02D431CEBE292444031D0B52FA03721C02D431CEBE292444031ED9BFBAB3721C0EDBB22F8DF924440178046E9D23721C033349E08E2924440B08C0DDDEC3721C06DCA15DEE592444063B48EAA263821C066D993C0E692444016855D143D3821C0A6608DB3E9924440C93846B2473821C059F78F85E8924440630B410E4A3821C066D993C0E6924440166D8E739B3821C0938D075BEC924440168A743FA73821C07903CC7C07934440499EEBFB703821C05FB35C363A934440E3DF675C383821C0D90A9A965893444063D17476323821C0A59F70766B93444016687748313821C005DCF3FC699344409607E929723821C0651877836893444095D233BDC43821C0927538BA4A934440622D3E05C03821C0C6FD47A64393444015E126A3CA3821C09F3A56293D934440AEF204C24E3921C099D53BDC0E934440FB78E8BB5B3921C0F911BF620D934440"
1378194916620000288	"2013-09-03 08:55:16"	"2013-09-03 09:34:31"	"0102000020E61000009E000000164B917C253821C0B95510035D934440E388B5F8143821C0E509849D62934440309B00C3F23721C03221E692AA9344407A8CF2CCCB3921C0EB39E97DE3934440A629029CDE3D21C0D7BD158909944440A4FE7A85053F21C03126FDBD14944440A4552DE9283F21C0441669E21D94444022516859F73F21C0CA15DEE52294444087C267EBE04021C03E42CD902A944440BA15C26A2C4121C02A6F47382D944440533F6F2A524121C0B75F3E5931944440B9A64066674121C0A48CB80034944440EC8502B6834121C0AA9A20EA3E9444406C94F59B894121C0771211FE45944440D1E80E62674221C017F3734353944440D1798D5DA24221C0771211FE459444401D007157AF4221C0513239B533944440043C69E1B24221C05706D50627944440698B6B7C264321C071ADF6B0179444409BA9108FC44321C02A6F47382D9444409BCB0D863A4421C0B1A888D349944440651D8EAED24521C050A6D1E46294444061191BBAD94721C05DC2A1B778944440AC915D69194921C03D2AFEEF889444409146054EB64921C003B16CE6909444405C1FD61BB54A21C0B090B932A89444408FC4CBD3B94A21C02A91442FA39444408F1B7E37DD4A21C0C34659BF99944440F418E599974B21C0F6EB4E779E94444072C284D1AC4C21C0A99F3715A994444070EEAF1EF74D21C0F6251B0FB694444009DE9046054E21C0499D8026C294444070EEAF1EF74D21C0C3D7D7BAD4944440BD3AC780EC4D21C0F6B6990AF19444400A6AF816D64D21C0C976BE9F1A954440D9EA724A404C21C0C28A53AD8595444059DC7F643A4C21C022C7D633849544400C738236394C21C088F4DBD781954440F39194F4304C21C095D6DF12809544408C648F50334C21C0F51263997E95444040DEAB56264C21C0E23FDD40819544400D39B69E214C21C028B8585183954440A60BB1FA234C21C0DB4E5B238295444040DEAB56264C21C08EE55DF5809544400C569C6A2D4C21C0F51263997E954440D9B0A6B2284C21C088F4DBD781954440261AA4E0294C21C03B8BDEA980954440D9B0A6B2284C21C08EE55DF58095444059BF99982E4C21C0DB4E5B238295444059BF99982E4C21C0E23FDD4081954440C0EC9E3C2C4C21C0DB4E5B238295444040FB9122324C21C0359A5C8C81954440F39194F4304C21C0E8305F5E8095444040FB9122324C21C095D6DF1280954440D9CD8C7E344C21C04E5E64027E954440D9CD8C7E344C21C0FB03E5B67D954440F374AE28254C21C07B12D89C839544408D47A984274C21C0DB4E5B2382954440D9CD8C7E344C21C068226C787A95444040FB9122324C21C04E5E64027E954440C0EC9E3C2C4C21C0EE21E17B7F954440C0EC9E3C2C4C21C08EE55DF580954440C0EC9E3C2C4C21C03B8BDEA9809544407383A10E2B4C21C0E23FDD40819544400C569C6A2D4C21C08EE55DF5809544407383A10E2B4C21C0E8305F5E809544407383A10E2B4C21C0E8305F5E80954440261AA4E0294C21C0E23FDD40819544400C569C6A2D4C21C0427C60C77F95444040FB9122324C21C0FB03E5B67D954440C0EC9E3C2C4C21C08EE55DF5809544407383A10E2B4C21C0E23FDD4081954440C0EC9E3C2C4C21C0359A5C8C81954440A62897C62F4C21C08EE55DF58095444059BF99982E4C21C0E23FDD40819544400C569C6A2D4C21C03B8BDEA980954440F39194F4304C21C09BC761307F954440F39194F4304C21C0EE21E17B7F95444040FB9122324C21C09BC761307F95444059BF99982E4C21C0427C60C77F9544400C569C6A2D4C21C095D6DF12809544400C569C6A2D4C21C09BC761307F954440261AA4E0294C21C095D6DF12809544407383A10E2B4C21C0EE21E17B7F954440D9B0A6B2284C21C03B8BDEA9809544400C569C6A2D4C21C0486DE2E47E9544407383A10E2B4C21C0427C60C77F954440261AA4E0294C21C08EE55DF580954440F39194F4304C21C0F51263997E95444059BF99982E4C21C0359A5C8C819544400C738236394C21C0C28A53AD859544403F575BB1BF4C21C0C85EEFFE789544403EAE0D15E34C21C042B115342D954440A4897780274D21C0B62FA017EE944440A41AF67B624D21C0C98E8D40BC944440A41AF67B624D21C0DD611399B9944440240C03965C4D21C03D9E961FB8944440A4FD0FB0564D21C096E99788B79444400B60CAC0014D21C0B090B932A8944440A52DAEF1994C21C0D04543C6A39444408E3D7B2E534B21C03065E08096944440AAF23D23114A21C08A93FB1D8A944440AAF23D23114A21C0E3DEFC868994444011381268B04921C0AA4885B18594444060234910AE4821C09758198D7C944440C8D2872EA84721C0EA95B20C7194444048F949B54F4721C0CAC342AD69944440155454FD4A4721C01D1EC2F86994444049BA66F2CD4621C0707841446A944440FEB5BC72BD4521C01D01DC2C5E944440E71C3C139A4421C02AC6F99B5094444068CF656A124421C04A5E9D634094444002D71533C24321C0978DCEF9299444404F58E201654321C051DB8651109444406AA33A1DC84221C0917F66101F9444401DE38A8BA34221C02A52616C219444406BD8EF89754221C057E9EE3A1B944440D1AE42CA4F4221C06ABC7493189444401FD95C35CF4121C09E616A4B1D944440868DB27E334121C08AABCABE2B944440D5264EEE774021C0EAE74D452A944440221CB3EC494021C06AD95A5F24944440BC2363B5F93F21C0AA436E861B94444055302AA9134021C058923CD7F79344403C670B08AD3F21C0B8B1D991EA9344403EB48F15FC3E21C0D88349F1F1934440D99942E7353E21C0A4FB3905F99344400CCB9F6F0B3E21C08B1A4CC3F0934440DAFE9595263D21C0F81BEDB8E19344408F6E8445453C21C0F10D85CFD693444078F2E9B12D3B21C0F8E12021CA934440AC1919E42E3A21C0A56ABB09BE934440ADC266800B3A21C0EBC5504EB4934440C70DBF9B6E3921C02B306475AB93444096986725AD3821C0E5B7E864A9934440E38DCC237F3821C0EBA86A82A89344409624CFF57D3821C0F299EC9FA7934440B0AE0AD4623821C0056D72F8A493444096CD1C925A3821C07F164B917C93444016BF29AC543821C06C26DF6C7393444030833122513821C07217618A72934440E3AAB2EF8A3821C065FB90B75C934440FCE25295B63821C07F85CC95419344407C48F8DEDF3821C053978C6324934440C8940F41D53821C0D9791B9B1D93444095EF1989D03821C08C101E6D1C93444062D68BA19C3821C099F221A81A9344409607E929723821C0EC866D8B3293444016DC0F78603821C04CFDBCA94893444030A017EE5C3821C09966BAD74993444063450DA6613821C0E6CFB7054B934440C9552C7E533821C06CCF2C095093444063EE5A423E3821C0F2CEA10C55934440965984622B3821C0DFFB1BB457934440973C9E961F3821C0E5EC9DD156934440FD69A33A1D3821C092921E8656934440172EABB0193821C032569BFF57934440FD69A33A1D3821C039471D1D57934440"
1378367292620000038	"2013-09-05 08:48:12"	"2013-09-05 08:59:27"	"0102000020E61000002E000000FB78E8BB5B3921C0D95C35CF119344409485AFAF753921C0D9226937FA924440C712D6C6D83921C0198D7C5EF1924440469A7807783A21C073F56393FC9244402C2D23F59E3A21C059147651F4924440DF32A7CB623A21C0B34291EEE79244402DD15966113A21C0A05225CADE92444013471E882C3A21C0001B1021AE924440F99FFCDD3B3A21C013EE9579AB9244407AFB73D1903921C0BAA29410AC924440E2AFC91AF53821C07347FFCBB5924440FC1C1F2DCE3821C079AC1919E49244407C0E2C47C83821C026529ACDE3924440624A24D1CB3821C0206118B0E4924440E23B31EBC53821C086AB0320EE924440E3C798BB963821C03999B85510934440632827DA553821C05F5CAAD2169344404AD3A0681E3821C09FE3A3C519934440FD69A33A1D3821C04C89247A19934440FD69A33A1D3821C00611A96917934440FD69A33A1D3821C00611A96917934440FD69A33A1D3821C0596B28B517934440FD69A33A1D3821C04C89247A19934440FD69A33A1D3821C09FE3A3C519934440FD69A33A1D3821C09FE3A3C519934440E3A59BC4203821C0EC4CA1F31A934440CAE1934E243821C0EC4CA1F31A934440CAE1934E243821C0F92EA52E19934440CAE1934E243821C0F92EA52E19934440300F99F2213821C0FF1F274C18934440973C9E961F3821C00611A96917934440300F99F2213821C09FE3A3C5199344404AD3A0681E3821C0A6D425E318934440FD69A33A1D3821C0FF1F274C189344404AB6BA9C123821C019E42EC214934440637AC2120F3821C020D5B0DF13934440E388B5F8143821C0B3B6291E179344406397A8DE1A3821C04C89247A19934440B000A60C1C3821C03FA7203F1B934440CAC4AD82183821C09FE3A3C5199344407D5BB054173821C0A6D425E318934440172EABB0193821C0537AA69718934440B000A60C1C3821C0537AA69718934440E3A59BC4203821C04698A25C1A93444063B48EAA263821C0DF6A9DB81C9344407D789620233821C0E65B1FD61B934440"
1378369236620000038	"2013-09-05 09:20:36"	"2013-09-05 09:48:21"	"0102000020E6100000700000004A7CEE04FB3721C09FE3A3C51993444018416326513721C0000341800C93444032056B9C4D3721C0ACA8C1340C934440E59B6D6E4C3721C04C6C3EAE0D934440B20E4757E93621C08CD651D50493444081EB8A19E13521C0B950F9D7F29244409B70AFCC5B3521C0AD510FD1E8924440B5C01E13293521C060AE450BD0924440E96514CB2D3521C060915F3FC49244404E98309A953521C014D1AFAD9F924440CE6C57E8833521C007B5DFDA89924440815A0C1EA63521C0E1D4079277924440CEE0EF17B33521C061C614AC71924440B62FA017EE3421C041D7BE805E9244401DC70F95463421C06E6E4C4F58924440B66455849B3421C001A777F17E924440836DC493DD3421C02D95B7239C924440E9482EFF213521C0BA85AE44A092444035B22B2D233521C0BA85AE44A0924440821B295B243521C00DE02D90A0924440821B295B243521C00DE02D90A0924440CF842689253521C0BA85AE44A0924440E9482EFF213521C0BA85AE44A09244409CDF30D1203521C00DE02D90A09244409CDF30D1203521C00DE02D90A0924440E9482EFF213521C0672B2FF99F924440E9482EFF213521C014D1AFAD9F9244409CDF30D1203521C0BA85AE44A092444035B22B2D233521C014D1AFAD9F9244409CDF30D1203521C01AC231CB9E924440B5A338471D3521C0740D33349E924440693A3B191C3521C0CD58349D9D9244409CDF30D1203521C0740D33349E92444035B22B2D233521C0740D33349E9244404F7633A31F3521C0740D33349E924440B5A338471D3521C0CD58349D9D924440B5A338471D3521C020B3B3E89D924440E9482EFF213521C0740D33349E924440695721E5273521C0C767B27F9E924440B5C01E13293521C06D1CB1169F924440B5C01E13293521C01AC231CB9E9244401CEE23B7263521C020B3B3E89D924440E9482EFF213521C0CD58349D9D924440020D36751E3521C01AC231CB9E924440B5A338471D3521C06D1CB1169F924440020D36751E3521C0C07630629F9244409CDF30D1203521C0C07630629F924440821B295B243521C014D1AFAD9F9244404F7633A31F3521C0C07630629F9244404F7633A31F3521C0C07630629F92444082ACA7565F3521C0E02BBAF59A924440813D26529A3521C0AD4CF8A57E92444034BC5983F73521C0946B0A647692444019541B9C883621C0DA006C4084924440198EE733A03621C02079E75086924440191F662FDB3621C0D42CD0EE90924440E5D022DBF93621C0A7B228ECA2924440CC988235CE3621C0001B1021AE9244404C8A8F4FC83621C0ADC090D5AD9244404C6DA983BC3621C0001B1021AE924440FF03AC55BB3621C060747973B8924440E6E8F17B9B3621C0CDCCCCCCCC9244403352EFA99C3621C02618CE35CC924440CC24EA059F3621C07A724D81CC92444066F7E461A13621C0CDCCCCCCCC9244407FDDE9CE133721C08D62B9A5D5924440CBF44BC45B3721C0739EB12FD9924440FEB627486C3721C066BCADF4DA9244407EC51A2E723721C0198D7C5EF1924440E59B6D6E4C3721C0E030D1200593444098A1F144103721C0062E8F3523934440E65C8AABCA3621C02C2B4D4A41934440992842EA763621C0FFEA71DF6A934440CDE506431D3621C00533A6608D93444001344A97FE3521C09F2287889B9344404E8061F9F33521C05F9B8D9598934440008BFCFA213621C0B80375CAA3934440E73A8DB4543621C052D66F26A6934440FF08C380253721C0F88A6EBDA6934440499EEBFB703821C0EBA86A82A8934440E1B4E0455F3921C0C5025FD1AD934440C70DBF9B6E3921C08BE07F2BD9934440603C8386FE3921C07EE19524CF93444093E1783E033A21C0EBE2361AC0934440ADA580B4FF3921C0452E3883BF934440FA0E7EE2003A21C0B24CBF44BC93444061545227A03921C0E5B7E864A9934440944BE3175E3921C0E5B7E864A99344402EE411DC483921C09F05A1BC8F934440FB78E8BB5B3921C0389ECF807A9344402E1EDE73603921C0F2086EA46C93444061C3D32B653921C0BF4692205C9344402E1EDE73603921C0BF4692205C93444048E2E5E95C3921C06CEC12D55B934440944BE3175E3921C0BF4692205C93444048E2E5E95C3921C0BF4692205C93444048E2E5E95C3921C0C537143E5B93444048E2E5E95C3921C0C537143E5B934440FB78E8BB5B3921C0C537143E5B934440C7F0D8CF623921C06CEC12D55B934440AE2CD159663921C0BF4692205C934440FB95CE87673921C065FB90B75C934440AE2CD159663921C0BF4692205C934440C7F0D8CF623921C0199293895B934440C7F0D8CF623921C065FB90B75C934440145AD6FD633921C00CB08F4E5D934440145AD6FD633921C0B95510035D934440C7F0D8CF623921C065FB90B75C9344407BA4C16D6D3921C0BF29AC5450934440E1B4E0455F3921C059C2DA183B9344409468C9E3693921C0F33D23111A934440C7F0D8CF623921C033A8363811934440"
1378453913620000038	"2013-09-06 08:51:53"	"2013-09-06 08:55:23"	"0102000020E61000000F000000944BE3175E3921C020D5B0DF13934440AE2CD159663921C013B9E00CFE924440AC1E300F993A21C0C0417BF5F19244404609FA0B3D3A21C039252026E192444013471E882C3A21C06D3997E2AA9244402DB4739A053A21C020D099B4A9924440C8D3F203573921C0ADC090D5AD924440FB3E1C24443921C04D840D4FAF924440486E4DBA2D3921C093FC885FB1924440C8B1F50CE13821C033FAD170CA92444095D233BDC43821C06DE7FBA9F19244401650A8A78F3821C019E42EC214934440302C7FBE2D3821C0B9A7AB3B169344406397A8DE1A3821C00611A96917934440973C9E961F3821C0ACC5A70018934440"
1378455564620000038	"2013-09-06 09:19:24"	"2013-09-06 09:25:24"	"0102000020E610000019000000FD2FD7A2053821C06C3EAE0D159344407DE71725E83721C06DE7FBA9F1924440CB68E4F38A3721C059F78F85E89244404B5AF10D853721C0B933130CE792444098C3EE3B863721C019709692E5924440317E1AF7E63721C09961A3ACDF924440E3361AC05B3821C0069D103AE89244407C7DAD4B8D3821C0997E8978EB924440FC8BA031933821C0394206F2EC924440E21E4B1FBA3821C086AB0320EE9244407CD45FAFB03821C080F44D9A06934440C90391459A3821C0D95C35CF119344402F14B01D8C3821C09FE3A3C519934440B0AE0AD4623821C0FF93BF7B47934440637AC2120F3821C0D236FE4465934440B0743E3C4B3821C08CDB68006F934440FDDD3B6A4C3821C0329067976F9344402F14B01D8C3821C0F2EB87D8609344407CB779E3A43821C079CE16105A93444015C440D7BE3821C08C67D0D03F9344402FFCE07CEA3821C0793D98141F934440E15D2EE23B3921C0F3203D450E934440143DF031583921C0C66CC9AA08934440944BE3175E3921C03999B855109344407B87DBA1613921C026C632FD12934440"
1378540649620000038	"2013-09-07 08:57:29"	"2013-09-07 08:59:59"	"0102000020E61000000B000000AE2CD159663921C080F44D9A069344402CB98AC56F3A21C0F3E670ADF6924440795C548B883A21C0C6151747E592444013471E882C3A21C0DA571EA4A792444014083BC5AA3921C06D3997E2AA92444048E2E5E95C3921C0605793A7AC924440E275FD82DD3821C04DA1F31ABB92444062105839B43821C059147651F49244406362F3716D3821C013F3ACA4159344407D3ECA880B3821C020D5B0DF1393444017F4DE18023821C04C6C3EAE0D934440"
1378542775620000038	"2013-09-07 09:32:55"	"2013-09-07 09:38:10"	"0102000020E610000016000000645DDC46033821C07903CC7C079344407EFFE6C5893721C0206118B0E492444098E0D407923721C0D9E89C9FE29244404A0856D5CB3721C04DF8A57EDE924440971FB8CA133821C0EDBB22F8DF924440622D3E05C03821C0938D075BEC924440E2AFC91AF53821C0066344A2D09244402E5393E00D3921C09A0AF148BC924440FBCA83F4143921C060747973B892444016A75A0BB33821C093FC885FB1924440499EEBFB703821C0E773EE76BD92444030664B56453821C0B3EBDE8AC4924440FD69A33A1D3821C0A0185932C7924440E388B5F8143821C0CDCCCCCCCC924440CAC4AD82183821C0D3BD4EEACB924440637AC2120F3821C07A724D81CC924440CAA7C7B60C3821C01A36CAFACD924440B000A60C1C3821C0C6DB4AAFCD924440E3C281902C3821C020274C18CD924440302C7FBE2D3821C020274C18CD9244407D789620233821C0C6DB4AAFCD924440300F99F2213821C0C6DB4AAFCD924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Bitmap Heap Scan on taxi_trajectory  (cost=11.33..53.10 rows=1 width=842) (actual time=277.263..376.714 rows=12 loops=1)"
"  Filter: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-08 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9) AND (NOT st_coveredby(polyline, '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_endpoint(polyline)))"
"  Rows Removed by Filter: 109828"
"  Heap Blocks: exact=13320 lossy=13872"
"  Buffers: shared hit=3600 read=30000"
"  ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=261.567..261.568 rows=0 loops=1)"
"        Buffers: shared hit=3596 read=2804"
"        ->  Bitmap Index Scan on idx_end_point_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=95.831..95.831 rows=97597 loops=1)"
"              Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared hit=1489 read=1158"
"        ->  Bitmap Index Scan on idx_start_point_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=162.729..162.729 rows=144208 loops=1)"
"              Index Cond: (st_startpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared hit=2107 read=1646"
"Planning Time: 0.352 ms"
"Execution Time: 376.955 ms"
 */

/* Test Case 1.3: In the 1st week of Sept 2013, the morning rush hour, the starting point and the end point were both in CBD, but part of the trip was not in CBD */
/* Test Case 1.3 with Both temporal data and spatial data using indices (B-tree, GiST, SP-GiST) */
CREATE INDEX idx_start_local_time_btree ON taxi_trajectory (start_local_time);
CREATE INDEX idx_hour_of_day_btree ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_start_point_spgist ON taxi_trajectory USING spgist (ST_StartPoint(polyline));
CREATE INDEX idx_end_point_spgist ON taxi_trajectory USING spgist (ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT trip_id, start_local_time, end_local_time, polyline
FROM taxi_trajectory
WHERE 
  start_local_time >= TIMESTAMP '2013-09-01 00:00:00'
  AND start_local_time <  TIMESTAMP '2013-09-08 00:00:00'
  AND hour_of_day BETWEEN 7 AND 9
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_StartPoint(polyline)
  )
  AND ST_Contains(
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
    ST_EndPoint(polyline)
  )
  AND NOT ST_CoveredBy(
    polyline,
    ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326)
  );

DROP INDEX idx_start_local_time_btree;
DROP INDEX idx_hour_of_day_btree;
DROP INDEX idx_polyline_gist;
DROP INDEX idx_start_point_spgist;
DROP INDEX idx_end_point_spgist;
/* Outputs:
"trip_id"	"start_local_time"	"end_local_time"	"polyline"
1378104382620000515	"2013-09-02 07:46:22"	"2013-09-02 08:09:37"	"0102000020E61000005E000000CBBF9657AE3721C0728BF9B9A1934440B11875ADBD3721C0A530EF71A693444098DBBDDC273721C0B80375CAA3934440CDEA1D6E873621C06B9A779CA29344404DDC2A88813621C0BFF4F6E7A2934440994528B6823621C0124F7633A393444066666666663621C038F581E49D934440992842EA763621C0723447567E934440992D5915E13621C0D844662E70934440315C1D00713721C04CFDBCA948934440CA1B60E63B3821C02657B1F84D9344404AD3A0681E3821C00CCD751A69934440E2016553AE3821C059198D7C5E934440E2CCAFE6003921C026E318C91E934440C8CEDBD8EC3821C0F92EA52E199344407C0E2C47C83821C079E6E5B0FB924440151BF33AE23821C02618CE35CC9244407BBC900E0F3921C080290307B4924440FC1C1F2DCE3821C0CD751A69A99244407C2B1213D43821C0E71C3C139A9244407CD45FAFB03821C0AD2F12DA72924440E3FC4D28443821C034D8D479549244404BE658DE553721C08E06F01648924440815F2349103621C054707841449244401B1021AE9C3521C09A3FA6B569924440EA3E00A94D3421C01AF7E6374C924440EACA67791E3421C0C80BE9F0109244406B0E10CCD13321C0E8F527F1B9914440EB39E97DE33321C0BC07E8BE9C9144405167EE21E13321C00F62670A9D914440B8CEBF5DF63321C0EF8FF7AA959144401D925A28993421C0C9E9EBF99A9144400247020D363521C0E2CAD93BA39144404E0CC9C9C43521C00F62670A9D914440336FD575A83621C00F289B7285914440325706D5063721C0A9DDAF027C9144404BAC8C463E3721C02FC03E3A7591444098A608707A3721C0C97553CA6B9144407F17B6662B3721C0A37895B54D9144406519E258173721C0E97C789620914440FF5A5EB9DE3621C0A3AD4A22FB9044407F129F3BC13621C03D29931ADA904440CD936B0A643621C0C47AA356989044409AB4A9BA473621C03E5E488787904440CDC82077113621C09161156F64904440B4CA4C69FD3521C0522CB7B41A904440B43EE5982C3621C032E6AE25E48F44401AA6B6D4413621C04562821ABE8F4440CD3CB9A6403621C085CC9541B58F4440CD1FD3DA343621C08CBD175FB48F44404D11E0F42E3621C0ECF99AE5B28F444000A8E2C62D3621C0A6811FD5B08F444000C5C892393621C03FFD67CD8F8F44404D4BAC8C463621C0D36A48DC638F4440003961C2683621C0336DFFCA4A8F444033DE567A6D3621C0E012807F4A8F444000FF942A513621C086AA984A3F8F444068B3EA73B53521C08DB800344A8F4440B6696CAF053521C0B9895A9A5B8F44406BB75D68AE3321C04089CF9D608F44403A77BB5E9A3221C03929CC7B9C8F4440EE5F5969523221C0F27B9BFEEC8F44403AC95697533221C0C53BC09316904440A182C30B223221C00B7F86376B9044402252D32EA63121C0912C6002B790444008ABB184B53121C04A0B9755D8904440EE5F5969523221C01DAED51EF6904440D314014EEF3221C05070B1A206914440382F4E7CB53321C05D8C81751C914440045ABA826D3421C01C7920B248914440048F6FEF1A3421C0CFA0A17F829144406B82A8FB003421C0E2900DA48B91444085D21742CE3321C0D53F8864C8914440D1E97937163421C01492CCEA1D924440045ABA826D3421C0944E24986A924440E9B7AF03E73421C00DE02D90A09244409BC761307F3521C074F04C68929244403465A71FD43521C04DF38E53749244404DDC2A88813621C087A6ECF48392444019ABCDFFAB3621C007B5DFDA89924440193C4CFBE63621C007EFAB72A192444032C687D9CB3621C0ED478AC8B092444099D6A6B1BD3621C0A0FB7266BB9244407F2F8507CD3621C0ED815660C8924440CBF44BC45B3721C05ABDC3EDD0924440FD4CBD6E113821C0EDBB22F8DF924440C93D5DDDB13821C0EDD808C4EB924440E2E47E87A23821C099B8551003934440AF05BD37863821C02CB7B41A12934440B0CBF09F6E3821C0CC7A319413934440B0CBF09F6E3821C07920B2481393444016F9F5436C3821C07920B2481393444063D17476323821C0EC12D55B039344403161342BDB3721C0266F8099EF924440"
1378105904620000288	"2013-09-02 08:11:44"	"2013-09-02 08:44:44"	"0102000020E6100000850000009737876BB53721C052D66F26A6934440FE7C5BB0543721C052D66F26A693444098BED7101C3721C0DFA9807B9E934440CD936B0A643621C03FE603029D9344407FDDE9CE133721C0535DC0CB0C934440333509DE903621C02C9ACE4E0693444082C98D226B3521C05A83F755B9924440359A5C8C813521C087E0B88C9B924440E86A2BF6973521C054E410717392444084D72E6D383421C0F4F928232E924440EB73B515FB3321C01B0FB6D8ED914440B8770DFAD23321C0887FD8D2A39144409DB81CAF403421C02F17F19D98914440E9D495CFF23421C06F9EEA909B914440CFDBD8EC483521C0CFF753E3A5914440CE4F711C783521C0568330B77B9144404E417E36723521C0A35BAFE94191444002BB9A3C653521C0E38BF6782191444002D88008713521C0F0164850FC9044400186E5CFB73521C010AFEB17EC904440CDAB3AAB053621C050FC1873D790444067B8019F1F3621C05DC136E2C990444067F2CD36373621C057B3CEF8BE904440802A6EDC623621C0DE3EABCC94904440CDC82077113621C0B8CD548847904440E7C6F484253621C06B0DA5F622904440344DD87E323621C04B0169FF03904440E7E3DA50313621C0126BF1290090444080D3BB783F3621C0F84F3750E08F4440E71DA7E8483621C0790778D2C28F44401AC39CA04D3621C03F7100FDBE8F44409AD18F86533621C01F9F909DB78F44401AE0826C593621C04C1938A0A58F4440CDB051D66F3621C0FF58880E818F4440B3B794F3C53621C0064A0A2C808F44406536C824233721C0F2B0506B9A8F44407E9065C1C43721C06CCEC133A18F444017D7F84CF63721C0AC55BB26A48F44403161342BDB3721C0CC272B86AB8F44404ACE893DB43721C032384A5E9D8F4440971AA19FA93721C0E6B16664908F4440FE9E58A7CA3721C0933A014D848F444031444E5FCF3721C06C770FD07D8F4440CAA7C7B60C3821C0804A95287B8F444063EE5A423E3821C0990E9D9E778F4440B0E8D66B7A3821C0933A014D848F444095D233BDC43821C03F373465A78F4440E275FD82DD3821C0F9BEB854A58F44406284F068E33821C0520ABABDA48F44402FFCE07CEA3821C09F73B7EBA58F4440AF0AD462F03821C07FDB1324B68F4440FDF50A0BEE3721C03F8EE6C8CA8F4440E527D53E1D3721C0FF40B96DDF8F444033A9A10DC03621C098309A95ED8F4440003961C2683621C0BFF38B12F48F4440CD02ED0E293621C0925CFE43FA8F4440B4E73235093621C0EB1B98DC28904440CDAB3AAB053621C0AB08371955904440E674594C6C3621C0EA5A7B9FAA9044404C50C3B7B03621C06ADD06B5DF90444099F38C7DC93621C04354E1CFF0904440B24813EF003721C0F06DFAB31F914440CB80B3942C3721C06FD39FFD48914440E5B8533A583721C0020CCB9F6F914440CCEF3499F13621C0A2EC2DE57C9144409A5DF756243621C00954FF2092914440E8137992743521C0C806D2C5A69144409C31CC09DA3421C02F17F19D9891444037C5E3A25A3421C0E99E758D969144409DF2E846583421C08F537424979144406A4DF38E533421C0E2ADF36F9791444085EFFD0DDA3321C07C80EECB9991444085EFFD0DDA3321C028B7ED7BD491444051DB8651103421C0EECEDA6D17924440516C054D4B3421C0FA5E43705C924440035FD1ADD73421C0BA85AE44A0924440B5C5353E933521C0E1F1ED5D83924440B439CE6DC23521C0018A9125739244401ADB6B41EF3521C0E7C589AF76924440344DD87E323621C0DAE38574789244403352EFA99C3621C0A16AF46A8092444032C687D9CB3621C03A5AD5928E9244406688635DDC3621C07AE1CE8591924440B20E4757E93621C0BA68C87894924440323A2009FB3621C0D449B6BA9C924440666B7D91D03621C0A7CF0EB8AE92444099B9C0E5B13621C00055DCB8C5924440B2BCAB1E303721C00D71AC8BDB9244407E8B4E965A3721C066BCADF4DA92444097546D37C13721C026529ACDE3924440965E9B8D953821C0F9BA0CFFE99244404912842BA03821C026A94C3107934440499EEBFB703821C01958C7F143934440FDFA2136583821C0AC5626FC52934440FDDD3B6A4C3821C0D219187959934440492A53CC413821C039471D1D57934440C93846B2473821C085B01A4B58934440CAFE791A303821C02C6519E25893444016687748313821C039471D1D57934440492A53CC413821C03F389F3A5693444030664B56453821C0ECDD1FEF55934440630B410E4A3821C04529215855934440C93846B2473821C04C1AA37554934440E3FC4D28443821C09F7422C154934440B03A72A4333821C032569BFF57934440B01D8CD8273821C0257497C45993444063B48EAA263821C079CE16105A934440B01D8CD8273821C0257497C459934440965984622B3821C07FBF982D59934440E3C281902C3821C02C6519E258934440CAFE791A303821C0257497C459934440E3C281902C3821C079CE16105A934440CAFE791A303821C01F8315A75A9344404A0D6D00363821C0199293895B934440E3C281902C3821C06CEC12D55B934440E3C281902C3821C012A1116C5C934440302C7FBE2D3821C012A1116C5C934440B01D8CD8273821C0199293895B934440302C7FBE2D3821C0199293895B934440302C7FBE2D3821C0199293895B934440965984622B3821C0C537143E5B934440E3C281902C3821C072DD94F25A934440965984622B3821C072DD94F25A934440E3C281902C3821C072DD94F25A934440B03A72A4333821C06CEC12D55B93444063D17476323821C0199293895B934440E3C281902C3821C072DD94F25A934440164B917C253821C079CE16105A934440B000A60C1C3821C0D219187959934440B000A60C1C3821C01F8315A75A934440172EABB0193821C01F8315A75A934440172EABB0193821C079CE16105A934440302C7FBE2D3821C00CB08F4E5D934440"
1378109912620000038	"2013-09-02 09:18:32"	"2013-09-02 09:34:32"	"0102000020E610000041000000172EABB0193821C0A0C6BDF90D9344409702D2FE073821C0395FECBDF89244409702D2FE073821C066F6798CF2924440CBA2B08BA23721C0B34291EEE792444098DBBDDC273721C080F44D9A06934440CCB56801DA3621C0DF87838428934440CCD24ECDE53621C053B4722F309344404CE141B3EB3621C09F1D705D31934440E63FA4DFBE3621C05FD04202469344401AE0826C593621C025AE635C71934440B4CA4C69FD3521C00B24287E8C9344401A1538D9063621C0DFA9807B9E934440CDE506431D3621C052D66F26A6934440CC988235CE3621C0F88A6EBDA69344404A7CEE04FB3721C0A530EF71A6934440614F3BFC353921C0E5B7E864A9934440145AD6FD633921C085B53176C293444060AB048BC33921C02BA4FCA4DA934440473EAF78EA3921C02BA4FCA4DA934440FAD4B14AE93921C07EFE7BF0DA93444013D38558FD3921C011C30E63D2934440FA0E7EE2003A21C0929735B1C0934440ADA580B4FF3921C0929735B1C0934440FA0E7EE2003A21C00B98C0ADBB934440AEA06989953921C0381268B0A99344407B6AF5D5553921C0D89B189293934440C8D3F203573921C04C8E3BA58393444061A6ED5F593921C01FDAC70A7E934440C8D3F203573921C0DF35E84B6F934440143DF031583921C03F55850662934440AE2CD159663921C0ECDD1FEF55934440FB95CE87673921C0ECDD1FEF55934440AE2CD159663921C03F389F3A56934440FB95CE87673921C092921E8656934440FB95CE87673921C092921E86569344409468C9E3693921C0ECDD1FEF55934440FB95CE87673921C03F389F3A56934440AE2CD159663921C092921E8656934440FB95CE87673921C092921E8656934440FB95CE87673921C092921E86569344409468C9E3693921C0ECDD1FEF55934440FB95CE87673921C039471D1D57934440FB95CE87673921C08CA19C685793444061C3D32B653921C0E5EC9DD156934440FB95CE87673921C03F389F3A56934440C7F0D8CF623921C0ECDD1FEF55934440C7F0D8CF623921C0ECDD1FEF55934440145AD6FD633921C0ECDD1FEF559344407B87DBA1613921C03F389F3A569344402E1EDE73603921C092921E86569344407B87DBA1613921C092921E86569344407B87DBA1613921C0E5EC9DD156934440C7F0D8CF623921C0E5EC9DD156934440145AD6FD633921C039471D1D57934440AE2CD159663921C0E5EC9DD156934440FB95CE87673921C03F389F3A56934440FB95CE87673921C03F389F3A56934440AE2CD159663921C092921E8656934440145AD6FD633921C0DFFB1BB45793444061C3D32B653921C08CA19C6857934440C7F0D8CF623921C03F389F3A5693444047FFCBB5683921C0C6FD47A643934440AE2CD159663921C039D384ED27934440C7F0D8CF623921C0E63E390A10934440E1B4E0455F3921C0F3203D450E934440"
1378112386620000038	"2013-09-02 09:59:46"	"2013-09-02 10:14:01"	"0102000020E61000003A000000145AD6FD633921C0CC5D4BC807934440C7D8092FC13921C05323F433F5924440AD4ECE50DC3921C0ACA8C1340C934440FA7DFFE6C53921C06C787AA52C9344402D40DB6AD63921C0A60EF27A30934440FA2B64AE0C3A21C03FE1ECD632934440C634D3BD4E3A21C0FF59F3E32F934440C66E9F55663A21C0923B6C2233934440F9307BD9763A21C039F06AB933934440ACE46377813A21C0E695EB6D33934440795C548B883A21C0923B6C2233934440DF89592F863A21C0E695EB6D33934440DFC325C79D3A21C0923B6C22339344409294F430B43A21C09F3A56293D934440C51C041DAD3A21C012842BA050934440AC014A438D3A21C0B972F6CE68934440799109F8353A21C07F164B917C93444013471E882C3A21C09F05A1BC8F934440ADDF4C4C173A21C0855E7F129F93444046B247A8193A21C0855E7F129F934440946DE00ED43921C0CBF3E0EEAC93444014200A664C3921C09E3F6D54A7934440AE0FEB8D5A3921C0E56036018693444061A6ED5F593921C0C571E0D572934440C8D3F203573921C0CC457C2766934440944BE3175E3921C05F0A0F9A5D9344407B87DBA1613921C065FB90B75C9344402E1EDE73603921C012A1116C5C934440944BE3175E3921C012A1116C5C934440AE0FEB8D5A3921C012A1116C5C934440AE0FEB8D5A3921C065FB90B75C934440944BE3175E3921C012A1116C5C934440FB78E8BB5B3921C0BF4692205C934440AE0FEB8D5A3921C0199293895B934440AE0FEB8D5A3921C0C537143E5B93444048E2E5E95C3921C01F8315A75A934440AE0FEB8D5A3921C0199293895B934440E1B4E0455F3921C06CEC12D55B934440E1B4E0455F3921C06CEC12D55B934440C7F0D8CF623921C0199293895B9344407B87DBA1613921C06CEC12D55B9344407B87DBA1613921C0BF4692205C9344402E1EDE73603921C06CEC12D55B934440C7F0D8CF623921C06CEC12D55B9344402E3BC43F6C3921C0BF4692205C93444047FFCBB5683921C0BF4692205C93444061C3D32B653921C0BF4692205C934440C7F0D8CF623921C012A1116C5C934440E1B4E0455F3921C0BF4692205C934440E1B4E0455F3921C0BF4692205C93444048E2E5E95C3921C0BF4692205C93444061A6ED5F593921C012A1116C5C9344407B87DBA1613921C0F2B1BB4049934440944BE3175E3921C0ACFF73982F93444047FFCBB5683921C06C3EAE0D15934440618907944D3921C0E63E390A109344402EE411DC483921C093E4B9BE0F9344402E01F8A7543921C0A0C6BDF90D934440"
1378197079620000038	"2013-09-03 09:31:19"	"2013-09-03 09:37:04"	"0102000020E610000018000000CAC4AD82183821C0F33D23111A934440FDF50A0BEE3721C0D314014EEF924440FE2AC0779B3721C02D431CEBE2924440E466B8019F3721C02D431CEBE292444031D0B52FA03721C02D431CEBE292444031ED9BFBAB3721C0EDBB22F8DF924440178046E9D23721C033349E08E2924440B08C0DDDEC3721C06DCA15DEE592444063B48EAA263821C066D993C0E692444016855D143D3821C0A6608DB3E9924440C93846B2473821C059F78F85E8924440630B410E4A3821C066D993C0E6924440166D8E739B3821C0938D075BEC924440168A743FA73821C07903CC7C07934440499EEBFB703821C05FB35C363A934440E3DF675C383821C0D90A9A965893444063D17476323821C0A59F70766B93444016687748313821C005DCF3FC699344409607E929723821C0651877836893444095D233BDC43821C0927538BA4A934440622D3E05C03821C0C6FD47A64393444015E126A3CA3821C09F3A56293D934440AEF204C24E3921C099D53BDC0E934440FB78E8BB5B3921C0F911BF620D934440"
1378194916620000288	"2013-09-03 08:55:16"	"2013-09-03 09:34:31"	"0102000020E61000009E000000164B917C253821C0B95510035D934440E388B5F8143821C0E509849D62934440309B00C3F23721C03221E692AA9344407A8CF2CCCB3921C0EB39E97DE3934440A629029CDE3D21C0D7BD158909944440A4FE7A85053F21C03126FDBD14944440A4552DE9283F21C0441669E21D94444022516859F73F21C0CA15DEE52294444087C267EBE04021C03E42CD902A944440BA15C26A2C4121C02A6F47382D944440533F6F2A524121C0B75F3E5931944440B9A64066674121C0A48CB80034944440EC8502B6834121C0AA9A20EA3E9444406C94F59B894121C0771211FE45944440D1E80E62674221C017F3734353944440D1798D5DA24221C0771211FE459444401D007157AF4221C0513239B533944440043C69E1B24221C05706D50627944440698B6B7C264321C071ADF6B0179444409BA9108FC44321C02A6F47382D9444409BCB0D863A4421C0B1A888D349944440651D8EAED24521C050A6D1E46294444061191BBAD94721C05DC2A1B778944440AC915D69194921C03D2AFEEF889444409146054EB64921C003B16CE6909444405C1FD61BB54A21C0B090B932A89444408FC4CBD3B94A21C02A91442FA39444408F1B7E37DD4A21C0C34659BF99944440F418E599974B21C0F6EB4E779E94444072C284D1AC4C21C0A99F3715A994444070EEAF1EF74D21C0F6251B0FB694444009DE9046054E21C0499D8026C294444070EEAF1EF74D21C0C3D7D7BAD4944440BD3AC780EC4D21C0F6B6990AF19444400A6AF816D64D21C0C976BE9F1A954440D9EA724A404C21C0C28A53AD8595444059DC7F643A4C21C022C7D633849544400C738236394C21C088F4DBD781954440F39194F4304C21C095D6DF12809544408C648F50334C21C0F51263997E95444040DEAB56264C21C0E23FDD40819544400D39B69E214C21C028B8585183954440A60BB1FA234C21C0DB4E5B238295444040DEAB56264C21C08EE55DF5809544400C569C6A2D4C21C0F51263997E954440D9B0A6B2284C21C088F4DBD781954440261AA4E0294C21C03B8BDEA980954440D9B0A6B2284C21C08EE55DF58095444059BF99982E4C21C0DB4E5B238295444059BF99982E4C21C0E23FDD4081954440C0EC9E3C2C4C21C0DB4E5B238295444040FB9122324C21C0359A5C8C81954440F39194F4304C21C0E8305F5E8095444040FB9122324C21C095D6DF1280954440D9CD8C7E344C21C04E5E64027E954440D9CD8C7E344C21C0FB03E5B67D954440F374AE28254C21C07B12D89C839544408D47A984274C21C0DB4E5B2382954440D9CD8C7E344C21C068226C787A95444040FB9122324C21C04E5E64027E954440C0EC9E3C2C4C21C0EE21E17B7F954440C0EC9E3C2C4C21C08EE55DF580954440C0EC9E3C2C4C21C03B8BDEA9809544407383A10E2B4C21C0E23FDD40819544400C569C6A2D4C21C08EE55DF5809544407383A10E2B4C21C0E8305F5E809544407383A10E2B4C21C0E8305F5E80954440261AA4E0294C21C0E23FDD40819544400C569C6A2D4C21C0427C60C77F95444040FB9122324C21C0FB03E5B67D954440C0EC9E3C2C4C21C08EE55DF5809544407383A10E2B4C21C0E23FDD4081954440C0EC9E3C2C4C21C0359A5C8C81954440A62897C62F4C21C08EE55DF58095444059BF99982E4C21C0E23FDD40819544400C569C6A2D4C21C03B8BDEA980954440F39194F4304C21C09BC761307F954440F39194F4304C21C0EE21E17B7F95444040FB9122324C21C09BC761307F95444059BF99982E4C21C0427C60C77F9544400C569C6A2D4C21C095D6DF12809544400C569C6A2D4C21C09BC761307F954440261AA4E0294C21C095D6DF12809544407383A10E2B4C21C0EE21E17B7F954440D9B0A6B2284C21C03B8BDEA9809544400C569C6A2D4C21C0486DE2E47E9544407383A10E2B4C21C0427C60C77F954440261AA4E0294C21C08EE55DF580954440F39194F4304C21C0F51263997E95444059BF99982E4C21C0359A5C8C819544400C738236394C21C0C28A53AD859544403F575BB1BF4C21C0C85EEFFE789544403EAE0D15E34C21C042B115342D954440A4897780274D21C0B62FA017EE944440A41AF67B624D21C0C98E8D40BC944440A41AF67B624D21C0DD611399B9944440240C03965C4D21C03D9E961FB8944440A4FD0FB0564D21C096E99788B79444400B60CAC0014D21C0B090B932A8944440A52DAEF1994C21C0D04543C6A39444408E3D7B2E534B21C03065E08096944440AAF23D23114A21C08A93FB1D8A944440AAF23D23114A21C0E3DEFC868994444011381268B04921C0AA4885B18594444060234910AE4821C09758198D7C944440C8D2872EA84721C0EA95B20C7194444048F949B54F4721C0CAC342AD69944440155454FD4A4721C01D1EC2F86994444049BA66F2CD4621C0707841446A944440FEB5BC72BD4521C01D01DC2C5E944440E71C3C139A4421C02AC6F99B5094444068CF656A124421C04A5E9D634094444002D71533C24321C0978DCEF9299444404F58E201654321C051DB8651109444406AA33A1DC84221C0917F66101F9444401DE38A8BA34221C02A52616C219444406BD8EF89754221C057E9EE3A1B944440D1AE42CA4F4221C06ABC7493189444401FD95C35CF4121C09E616A4B1D944440868DB27E334121C08AABCABE2B944440D5264EEE774021C0EAE74D452A944440221CB3EC494021C06AD95A5F24944440BC2363B5F93F21C0AA436E861B94444055302AA9134021C058923CD7F79344403C670B08AD3F21C0B8B1D991EA9344403EB48F15FC3E21C0D88349F1F1934440D99942E7353E21C0A4FB3905F99344400CCB9F6F0B3E21C08B1A4CC3F0934440DAFE9595263D21C0F81BEDB8E19344408F6E8445453C21C0F10D85CFD693444078F2E9B12D3B21C0F8E12021CA934440AC1919E42E3A21C0A56ABB09BE934440ADC266800B3A21C0EBC5504EB4934440C70DBF9B6E3921C02B306475AB93444096986725AD3821C0E5B7E864A9934440E38DCC237F3821C0EBA86A82A89344409624CFF57D3821C0F299EC9FA7934440B0AE0AD4623821C0056D72F8A493444096CD1C925A3821C07F164B917C93444016BF29AC543821C06C26DF6C7393444030833122513821C07217618A72934440E3AAB2EF8A3821C065FB90B75C934440FCE25295B63821C07F85CC95419344407C48F8DEDF3821C053978C6324934440C8940F41D53821C0D9791B9B1D93444095EF1989D03821C08C101E6D1C93444062D68BA19C3821C099F221A81A9344409607E929723821C0EC866D8B3293444016DC0F78603821C04CFDBCA94893444030A017EE5C3821C09966BAD74993444063450DA6613821C0E6CFB7054B934440C9552C7E533821C06CCF2C095093444063EE5A423E3821C0F2CEA10C55934440965984622B3821C0DFFB1BB457934440973C9E961F3821C0E5EC9DD156934440FD69A33A1D3821C092921E8656934440172EABB0193821C032569BFF57934440FD69A33A1D3821C039471D1D57934440"
1378367292620000038	"2013-09-05 08:48:12"	"2013-09-05 08:59:27"	"0102000020E61000002E000000FB78E8BB5B3921C0D95C35CF119344409485AFAF753921C0D9226937FA924440C712D6C6D83921C0198D7C5EF1924440469A7807783A21C073F56393FC9244402C2D23F59E3A21C059147651F4924440DF32A7CB623A21C0B34291EEE79244402DD15966113A21C0A05225CADE92444013471E882C3A21C0001B1021AE924440F99FFCDD3B3A21C013EE9579AB9244407AFB73D1903921C0BAA29410AC924440E2AFC91AF53821C07347FFCBB5924440FC1C1F2DCE3821C079AC1919E49244407C0E2C47C83821C026529ACDE3924440624A24D1CB3821C0206118B0E4924440E23B31EBC53821C086AB0320EE924440E3C798BB963821C03999B85510934440632827DA553821C05F5CAAD2169344404AD3A0681E3821C09FE3A3C519934440FD69A33A1D3821C04C89247A19934440FD69A33A1D3821C00611A96917934440FD69A33A1D3821C00611A96917934440FD69A33A1D3821C0596B28B517934440FD69A33A1D3821C04C89247A19934440FD69A33A1D3821C09FE3A3C519934440FD69A33A1D3821C09FE3A3C519934440E3A59BC4203821C0EC4CA1F31A934440CAE1934E243821C0EC4CA1F31A934440CAE1934E243821C0F92EA52E19934440CAE1934E243821C0F92EA52E19934440300F99F2213821C0FF1F274C18934440973C9E961F3821C00611A96917934440300F99F2213821C09FE3A3C5199344404AD3A0681E3821C0A6D425E318934440FD69A33A1D3821C0FF1F274C189344404AB6BA9C123821C019E42EC214934440637AC2120F3821C020D5B0DF13934440E388B5F8143821C0B3B6291E179344406397A8DE1A3821C04C89247A19934440B000A60C1C3821C03FA7203F1B934440CAC4AD82183821C09FE3A3C5199344407D5BB054173821C0A6D425E318934440172EABB0193821C0537AA69718934440B000A60C1C3821C0537AA69718934440E3A59BC4203821C04698A25C1A93444063B48EAA263821C0DF6A9DB81C9344407D789620233821C0E65B1FD61B934440"
1378369236620000038	"2013-09-05 09:20:36"	"2013-09-05 09:48:21"	"0102000020E6100000700000004A7CEE04FB3721C09FE3A3C51993444018416326513721C0000341800C93444032056B9C4D3721C0ACA8C1340C934440E59B6D6E4C3721C04C6C3EAE0D934440B20E4757E93621C08CD651D50493444081EB8A19E13521C0B950F9D7F29244409B70AFCC5B3521C0AD510FD1E8924440B5C01E13293521C060AE450BD0924440E96514CB2D3521C060915F3FC49244404E98309A953521C014D1AFAD9F924440CE6C57E8833521C007B5DFDA89924440815A0C1EA63521C0E1D4079277924440CEE0EF17B33521C061C614AC71924440B62FA017EE3421C041D7BE805E9244401DC70F95463421C06E6E4C4F58924440B66455849B3421C001A777F17E924440836DC493DD3421C02D95B7239C924440E9482EFF213521C0BA85AE44A092444035B22B2D233521C0BA85AE44A0924440821B295B243521C00DE02D90A0924440821B295B243521C00DE02D90A0924440CF842689253521C0BA85AE44A0924440E9482EFF213521C0BA85AE44A09244409CDF30D1203521C00DE02D90A09244409CDF30D1203521C00DE02D90A0924440E9482EFF213521C0672B2FF99F924440E9482EFF213521C014D1AFAD9F9244409CDF30D1203521C0BA85AE44A092444035B22B2D233521C014D1AFAD9F9244409CDF30D1203521C01AC231CB9E924440B5A338471D3521C0740D33349E924440693A3B191C3521C0CD58349D9D9244409CDF30D1203521C0740D33349E92444035B22B2D233521C0740D33349E9244404F7633A31F3521C0740D33349E924440B5A338471D3521C0CD58349D9D924440B5A338471D3521C020B3B3E89D924440E9482EFF213521C0740D33349E924440695721E5273521C0C767B27F9E924440B5C01E13293521C06D1CB1169F924440B5C01E13293521C01AC231CB9E9244401CEE23B7263521C020B3B3E89D924440E9482EFF213521C0CD58349D9D924440020D36751E3521C01AC231CB9E924440B5A338471D3521C06D1CB1169F924440020D36751E3521C0C07630629F9244409CDF30D1203521C0C07630629F924440821B295B243521C014D1AFAD9F9244404F7633A31F3521C0C07630629F9244404F7633A31F3521C0C07630629F92444082ACA7565F3521C0E02BBAF59A924440813D26529A3521C0AD4CF8A57E92444034BC5983F73521C0946B0A647692444019541B9C883621C0DA006C4084924440198EE733A03621C02079E75086924440191F662FDB3621C0D42CD0EE90924440E5D022DBF93621C0A7B228ECA2924440CC988235CE3621C0001B1021AE9244404C8A8F4FC83621C0ADC090D5AD9244404C6DA983BC3621C0001B1021AE924440FF03AC55BB3621C060747973B8924440E6E8F17B9B3621C0CDCCCCCCCC9244403352EFA99C3621C02618CE35CC924440CC24EA059F3621C07A724D81CC92444066F7E461A13621C0CDCCCCCCCC9244407FDDE9CE133721C08D62B9A5D5924440CBF44BC45B3721C0739EB12FD9924440FEB627486C3721C066BCADF4DA9244407EC51A2E723721C0198D7C5EF1924440E59B6D6E4C3721C0E030D1200593444098A1F144103721C0062E8F3523934440E65C8AABCA3621C02C2B4D4A41934440992842EA763621C0FFEA71DF6A934440CDE506431D3621C00533A6608D93444001344A97FE3521C09F2287889B9344404E8061F9F33521C05F9B8D9598934440008BFCFA213621C0B80375CAA3934440E73A8DB4543621C052D66F26A6934440FF08C380253721C0F88A6EBDA6934440499EEBFB703821C0EBA86A82A8934440E1B4E0455F3921C0C5025FD1AD934440C70DBF9B6E3921C08BE07F2BD9934440603C8386FE3921C07EE19524CF93444093E1783E033A21C0EBE2361AC0934440ADA580B4FF3921C0452E3883BF934440FA0E7EE2003A21C0B24CBF44BC93444061545227A03921C0E5B7E864A9934440944BE3175E3921C0E5B7E864A99344402EE411DC483921C09F05A1BC8F934440FB78E8BB5B3921C0389ECF807A9344402E1EDE73603921C0F2086EA46C93444061C3D32B653921C0BF4692205C9344402E1EDE73603921C0BF4692205C93444048E2E5E95C3921C06CEC12D55B934440944BE3175E3921C0BF4692205C93444048E2E5E95C3921C0BF4692205C93444048E2E5E95C3921C0C537143E5B93444048E2E5E95C3921C0C537143E5B934440FB78E8BB5B3921C0C537143E5B934440C7F0D8CF623921C06CEC12D55B934440AE2CD159663921C0BF4692205C934440FB95CE87673921C065FB90B75C934440AE2CD159663921C0BF4692205C934440C7F0D8CF623921C0199293895B934440C7F0D8CF623921C065FB90B75C934440145AD6FD633921C00CB08F4E5D934440145AD6FD633921C0B95510035D934440C7F0D8CF623921C065FB90B75C9344407BA4C16D6D3921C0BF29AC5450934440E1B4E0455F3921C059C2DA183B9344409468C9E3693921C0F33D23111A934440C7F0D8CF623921C033A8363811934440"
1378453913620000038	"2013-09-06 08:51:53"	"2013-09-06 08:55:23"	"0102000020E61000000F000000944BE3175E3921C020D5B0DF13934440AE2CD159663921C013B9E00CFE924440AC1E300F993A21C0C0417BF5F19244404609FA0B3D3A21C039252026E192444013471E882C3A21C06D3997E2AA9244402DB4739A053A21C020D099B4A9924440C8D3F203573921C0ADC090D5AD924440FB3E1C24443921C04D840D4FAF924440486E4DBA2D3921C093FC885FB1924440C8B1F50CE13821C033FAD170CA92444095D233BDC43821C06DE7FBA9F19244401650A8A78F3821C019E42EC214934440302C7FBE2D3821C0B9A7AB3B169344406397A8DE1A3821C00611A96917934440973C9E961F3821C0ACC5A70018934440"
1378455564620000038	"2013-09-06 09:19:24"	"2013-09-06 09:25:24"	"0102000020E610000019000000FD2FD7A2053821C06C3EAE0D159344407DE71725E83721C06DE7FBA9F1924440CB68E4F38A3721C059F78F85E89244404B5AF10D853721C0B933130CE792444098C3EE3B863721C019709692E5924440317E1AF7E63721C09961A3ACDF924440E3361AC05B3821C0069D103AE89244407C7DAD4B8D3821C0997E8978EB924440FC8BA031933821C0394206F2EC924440E21E4B1FBA3821C086AB0320EE9244407CD45FAFB03821C080F44D9A06934440C90391459A3821C0D95C35CF119344402F14B01D8C3821C09FE3A3C519934440B0AE0AD4623821C0FF93BF7B47934440637AC2120F3821C0D236FE4465934440B0743E3C4B3821C08CDB68006F934440FDDD3B6A4C3821C0329067976F9344402F14B01D8C3821C0F2EB87D8609344407CB779E3A43821C079CE16105A93444015C440D7BE3821C08C67D0D03F9344402FFCE07CEA3821C0793D98141F934440E15D2EE23B3921C0F3203D450E934440143DF031583921C0C66CC9AA08934440944BE3175E3921C03999B855109344407B87DBA1613921C026C632FD12934440"
1378540649620000038	"2013-09-07 08:57:29"	"2013-09-07 08:59:59"	"0102000020E61000000B000000AE2CD159663921C080F44D9A069344402CB98AC56F3A21C0F3E670ADF6924440795C548B883A21C0C6151747E592444013471E882C3A21C0DA571EA4A792444014083BC5AA3921C06D3997E2AA92444048E2E5E95C3921C0605793A7AC924440E275FD82DD3821C04DA1F31ABB92444062105839B43821C059147651F49244406362F3716D3821C013F3ACA4159344407D3ECA880B3821C020D5B0DF1393444017F4DE18023821C04C6C3EAE0D934440"
1378542775620000038	"2013-09-07 09:32:55"	"2013-09-07 09:38:10"	"0102000020E610000016000000645DDC46033821C07903CC7C079344407EFFE6C5893721C0206118B0E492444098E0D407923721C0D9E89C9FE29244404A0856D5CB3721C04DF8A57EDE924440971FB8CA133821C0EDBB22F8DF924440622D3E05C03821C0938D075BEC924440E2AFC91AF53821C0066344A2D09244402E5393E00D3921C09A0AF148BC924440FBCA83F4143921C060747973B892444016A75A0BB33821C093FC885FB1924440499EEBFB703821C0E773EE76BD92444030664B56453821C0B3EBDE8AC4924440FD69A33A1D3821C0A0185932C7924440E388B5F8143821C0CDCCCCCCCC924440CAC4AD82183821C0D3BD4EEACB924440637AC2120F3821C07A724D81CC924440CAA7C7B60C3821C01A36CAFACD924440B000A60C1C3821C0C6DB4AAFCD924440E3C281902C3821C020274C18CD924440302C7FBE2D3821C020274C18CD9244407D789620233821C0C6DB4AAFCD924440300F99F2213821C0C6DB4AAFCD924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Bitmap Heap Scan on taxi_trajectory  (cost=11.33..53.10 rows=1 width=842) (actual time=80.710..152.832 rows=12 loops=1)"
"  Filter: ((start_local_time >= '2013-09-01 00:00:00'::timestamp without time zone) AND (start_local_time < '2013-09-08 00:00:00'::timestamp without time zone) AND (hour_of_day >= 7) AND (hour_of_day <= 9) AND (NOT st_coveredby(polyline, '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_endpoint(polyline)))"
"  Rows Removed by Filter: 110111"
"  Heap Blocks: exact=13262 lossy=13974"
"  Buffers: shared hit=3675 read=30102"
"  ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=65.039..65.039 rows=0 loops=1)"
"        Buffers: shared hit=3671 read=2862"
"        ->  Bitmap Index Scan on idx_end_point_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=37.295..37.295 rows=97597 loops=1)"
"              Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared hit=1363 read=1279"
"        ->  Bitmap Index Scan on idx_start_point_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=24.401..24.401 rows=144208 loops=1)"
"              Index Cond: (st_startpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"              Buffers: shared hit=2308 read=1583"
"Planning Time: 0.406 ms"
"Execution Time: 153.169 ms"
 */



/* 
Query Task 2: Skyline Query
Find the skyline trajectory from one place to another place that was not dominated by other trajectories with the shortest time and the closest distance.
*/

/* Test Case 2.1: Francisco Sá Carneiro Airport -> Campanhã Train Station */
/* Test Case 2.1 with Sequential Search */
-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.676514220811896 41.22748617051806,-8.662971112404733 41.23761712125881,-8.680597042810376 41.26953327959913,-8.695944813498926 41.266930675298255,-8.697524142221397 41.232466971412066,-8.676514220811896 41.22748617051806))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.588691530277202 41.14725942933609,-8.584291957451597 41.14603884995606,-8.582079306790718 41.15061106220182,-8.581976392807064 41.15181218372203,-8.585784210222613 41.15276144161274,-8.588691530277202 41.14725942933609))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1385118326620000351	540	0.1688899647651907	"0102000020E610000025000000E1F1ED5D835621C08522DDCF299E4440ADFA5C6DC55621C085ED27637C9E4440E1B20A9B015621C0056B9C4D479E4440494A7A185A5521C0992A1895D49D444014E97E4E415621C0ED0BE8853B9D4440AED85F764F5621C09B559FABAD9C44404D4EED0C535321C0AFEE586C939C44408483BD89215121C01CCEFC6A0E9C4440A1D79FC4E74E21C07D91D096739B4440577C43E1B34D21C00BCF4BC5C69A44403ED00A0C594D21C05985CD00179A4440BEA4315A474D21C07A8CF2CCCB99444026C3F17C064C21C02D978DCEF999444091EF52EA924921C08D2AC3B81B9A44407D5A457F684621C05325CADE529A4440373811FDDA4221C09911DE1E849A4440F0DB10E3353F21C0D3F9F02C419A444044352559873B21C05AF44E05DC99444098E0D407923721C01AF9BCE2A999444085B53176C23321C0AE49B725729944407138F3AB393021C0A8AAD0402C9944408ECBB8A9812E21C09B374E0AF39844408C497F2F852F21C09641B5C1899844403E7B2E53933021C02AE44A3D0B984440F25EB532E12F21C0F8E28BF678974440BF620D17B92F21C00569C6A2E99644402409C215503021C03A78263449964440A304FD851E3121C0EE26F8A6E99544403CDC0E0D8B3121C00708E6E8F195444072C45A7C0A3021C09ACC785BE995444029EB3713D32D21C07B2FBE688F954440FB96395D162B21C0FC8F4C874E95444064EAAEEC822921C0DC9BDF30D1944440C93EC8B2602A21C0F7031E1840944440957CEC2E502A21C0CB10C7BAB8934440965F0663442A21C0E5603601869344402FDB4E5B232A21C0AC90F2936A934440"
1402390890620000496	570	0.16540362363809086	"0102000020E61000002700000013286211C35621C038842A357B9E4440153B1A87FA5521C058C51B99479E4440FCE07CEA585521C0F9669B1BD39D4440FBEAAA402D5621C080272D5C569D444094A5D6FB8D5621C0419B1C3EE99C4440621399B9C05521C03BFC3559A39C4440CCD07822885321C09B1BD313969C4440B6BE4868CB5121C0A22424D2369C4440A01B9AB2D34F21C0B0C7444AB39B444056BB26A4354E21C0DEE522BE139B4440BDA94885B14D21C09FABADD85F9A44408BDD3EABCC4C21C0E0F3C308E1994440A46C91B41B4D21C0D32EA699EE9944400E9E094D124B21C020D26F5F079A4440E0D57267264821C09355116E329A44401A53B0C6D94421C032AA0CE36E9A4440BA32A836384121C05F5E807D749A444040C23060C93D21C0ADDF4C4C179A44402D7AA702EE3921C0E09C11A5BD9944403465A71FD43521C0E719FB928D994440212235ED623221C06E88F19A579944400C01C0B1672F21C0C85F5AD427994440F4E0EEACDD2E21C00F0D8B51D79844408B6B7C26FB2F21C0E94482A966984440F1BA7EC16E3021C077D9AF3BDD9744408CBD175FB42F21C08B506C054D974440586FD40AD32F21C0D34F38BBB5964440573F36C98F3021C07AA86DC328964440EF1B5F7B663121C01BBE8575E39544403DB5FAEAAA3021C0C79DD2C1FA9544405A65A6B4FE2E21C074B2D47ABF954440C422861DC62C21C02F6F0ED76A9544402F3201BF462A21C042B115342D95444063416150A62921C04963B48EAA944440AF7AC03C642A21C06422A5D93C944440AF5DDA70582A21C06BD44334BA934440FC8C0B07422A21C02BD9B111889344402FDB4E5B232A21C0593673486A93444062687572862A21C0B247A81952934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=17891733.70..17891733.76 rows=1 width=52) (actual time=339.742..340.771 rows=2 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 1332"
"  Buffers: shared hit=4512 read=265808"
"  CTE filtered_trips"
"    ->  Gather  (cost=1000.00..17891733.70 rows=1 width=838) (actual time=64.870..340.430 rows=154 loops=1)"
"          Workers Planned: 2"
"          Workers Launched: 2"
"          Buffers: shared hit=4512 read=265808"
"          ->  Parallel Seq Scan on taxi_trajectory  (cost=0.00..17890733.60 rows=1 width=838) (actual time=27.201..303.457 rows=51 loops=3)"
"                Filter: (st_contains('0103000020E6100000010000000600000000556B12605A21C06C554F441E9D444030F11BF3705321C05C63E23C6A9E4440F03F3137775C21C0EC87061180A24440F098EBE0526421C0445ACCC82AA24440D00566E2216521C0B8CE4B7AC19D444000556B12605A21C06C554F441E9D4440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E6100000010000000600000010F2EBF9682D21C05883A065D99244401024C150282B21C0DC40AA66B192444060B0844C062A21C04C49293947934440004D4CCFF82921C0381CE6946E934440B0D672E8EB2B21C084E8D9AF8D93444010F2EBF9682D21C05883A065D9924440'::geometry, st_endpoint(polyline)))"
"                Rows Removed by Filter: 558002"
"                Buffers: shared hit=4512 read=265808"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=64.874..64.889 rows=154 loops=1)"
"        Buffers: shared hit=133 read=9264"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..1.785 rows=10 loops=154)"
"        Buffers: shared hit=4379 read=256544"
"Planning Time: 0.321 ms"
"Execution Time: 340.829 ms"
 */

/* Test Case 2.1: Francisco Sá Carneiro Airport -> Campanhã Train Station */
/* Test Case 2.1 with GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline) */
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist(ST_StartPoint(polyline));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist(ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.676514220811896 41.22748617051806,-8.662971112404733 41.23761712125881,-8.680597042810376 41.26953327959913,-8.695944813498926 41.266930675298255,-8.697524142221397 41.232466971412066,-8.676514220811896 41.22748617051806))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.588691530277202 41.14725942933609,-8.584291957451597 41.14603884995606,-8.582079306790718 41.15061106220182,-8.581976392807064 41.15181218372203,-8.585784210222613 41.15276144161274,-8.588691530277202 41.14725942933609))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);

DROP INDEX idx_startpoint_gist;
DROP INDEX idx_endpoint_gist;
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1385118326620000351	540	0.1688899647651907	"0102000020E610000025000000E1F1ED5D835621C08522DDCF299E4440ADFA5C6DC55621C085ED27637C9E4440E1B20A9B015621C0056B9C4D479E4440494A7A185A5521C0992A1895D49D444014E97E4E415621C0ED0BE8853B9D4440AED85F764F5621C09B559FABAD9C44404D4EED0C535321C0AFEE586C939C44408483BD89215121C01CCEFC6A0E9C4440A1D79FC4E74E21C07D91D096739B4440577C43E1B34D21C00BCF4BC5C69A44403ED00A0C594D21C05985CD00179A4440BEA4315A474D21C07A8CF2CCCB99444026C3F17C064C21C02D978DCEF999444091EF52EA924921C08D2AC3B81B9A44407D5A457F684621C05325CADE529A4440373811FDDA4221C09911DE1E849A4440F0DB10E3353F21C0D3F9F02C419A444044352559873B21C05AF44E05DC99444098E0D407923721C01AF9BCE2A999444085B53176C23321C0AE49B725729944407138F3AB393021C0A8AAD0402C9944408ECBB8A9812E21C09B374E0AF39844408C497F2F852F21C09641B5C1899844403E7B2E53933021C02AE44A3D0B984440F25EB532E12F21C0F8E28BF678974440BF620D17B92F21C00569C6A2E99644402409C215503021C03A78263449964440A304FD851E3121C0EE26F8A6E99544403CDC0E0D8B3121C00708E6E8F195444072C45A7C0A3021C09ACC785BE995444029EB3713D32D21C07B2FBE688F954440FB96395D162B21C0FC8F4C874E95444064EAAEEC822921C0DC9BDF30D1944440C93EC8B2602A21C0F7031E1840944440957CEC2E502A21C0CB10C7BAB8934440965F0663442A21C0E5603601869344402FDB4E5B232A21C0AC90F2936A934440"
1402390890620000496	570	0.16540362363809086	"0102000020E61000002700000013286211C35621C038842A357B9E4440153B1A87FA5521C058C51B99479E4440FCE07CEA585521C0F9669B1BD39D4440FBEAAA402D5621C080272D5C569D444094A5D6FB8D5621C0419B1C3EE99C4440621399B9C05521C03BFC3559A39C4440CCD07822885321C09B1BD313969C4440B6BE4868CB5121C0A22424D2369C4440A01B9AB2D34F21C0B0C7444AB39B444056BB26A4354E21C0DEE522BE139B4440BDA94885B14D21C09FABADD85F9A44408BDD3EABCC4C21C0E0F3C308E1994440A46C91B41B4D21C0D32EA699EE9944400E9E094D124B21C020D26F5F079A4440E0D57267264821C09355116E329A44401A53B0C6D94421C032AA0CE36E9A4440BA32A836384121C05F5E807D749A444040C23060C93D21C0ADDF4C4C179A44402D7AA702EE3921C0E09C11A5BD9944403465A71FD43521C0E719FB928D994440212235ED623221C06E88F19A579944400C01C0B1672F21C0C85F5AD427994440F4E0EEACDD2E21C00F0D8B51D79844408B6B7C26FB2F21C0E94482A966984440F1BA7EC16E3021C077D9AF3BDD9744408CBD175FB42F21C08B506C054D974440586FD40AD32F21C0D34F38BBB5964440573F36C98F3021C07AA86DC328964440EF1B5F7B663121C01BBE8575E39544403DB5FAEAAA3021C0C79DD2C1FA9544405A65A6B4FE2E21C074B2D47ABF954440C422861DC62C21C02F6F0ED76A9544402F3201BF462A21C042B115342D95444063416150A62921C04963B48EAA944440AF7AC03C642A21C06422A5D93C944440AF5DDA70582A21C06BD44334BA934440FC8C0B07422A21C02BD9B111889344402FDB4E5B232A21C0593673486A93444062687572862A21C0B247A81952934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=40.72..40.78 rows=1 width=52) (actual time=19.784..20.045 rows=2 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 1182"
"  Buffers: shared hit=469"
"  CTE filtered_trips"
"    ->  Bitmap Heap Scan on taxi_trajectory  (cost=11.33..40.72 rows=1 width=838) (actual time=18.525..19.339 rows=154 loops=1)"
"          Filter: (st_contains('0103000020E6100000010000000600000000556B12605A21C06C554F441E9D444030F11BF3705321C05C63E23C6A9E4440F03F3137775C21C0EC87061180A24440F098EBE0526421C0445ACCC82AA24440D00566E2216521C0B8CE4B7AC19D444000556B12605A21C06C554F441E9D4440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E6100000010000000600000010F2EBF9682D21C05883A065D99244401024C150282B21C0DC40AA66B192444060B0844C062A21C04C49293947934440004D4CCFF82921C0381CE6946E934440B0D672E8EB2B21C084E8D9AF8D93444010F2EBF9682D21C05883A065D9924440'::geometry, st_endpoint(polyline)))"
"          Rows Removed by Filter: 13"
"          Heap Blocks: exact=167"
"          Buffers: shared hit=469"
"          ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=18.167..18.168 rows=0 loops=1)"
"                Buffers: shared hit=290"
"                ->  Bitmap Index Scan on idx_endpoint_gist  (cost=0.00..5.54 rows=167 width=0) (actual time=14.529..14.529 rows=46587 loops=1)"
"                      Index Cond: (st_endpoint(polyline) @ '0103000020E6100000010000000600000010F2EBF9682D21C05883A065D99244401024C150282B21C0DC40AA66B192444060B0844C062A21C04C49293947934440004D4CCFF82921C0381CE6946E934440B0D672E8EB2B21C084E8D9AF8D93444010F2EBF9682D21C05883A065D9924440'::geometry)"
"                      Buffers: shared hit=260"
"                ->  Bitmap Index Scan on idx_startpoint_gist  (cost=0.00..5.54 rows=167 width=0) (actual time=1.273..1.273 rows=3808 loops=1)"
"                      Index Cond: (st_startpoint(polyline) @ '0103000020E6100000010000000600000000556B12605A21C06C554F441E9D444030F11BF3705321C05C63E23C6A9E4440F03F3137775C21C0EC87061180A24440F098EBE0526421C0445ACCC82AA24440D00566E2216521C0B8CE4B7AC19D444000556B12605A21C06C554F441E9D4440'::geometry)"
"                      Buffers: shared hit=30"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=18.531..18.568 rows=154 loops=1)"
"        Buffers: shared hit=291"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.008 rows=9 loops=154)"
"        Buffers: shared hit=178"
"Planning Time: 0.231 ms"
"Execution Time: 20.242 ms"
 */

/* Test Case 2.1: Francisco Sá Carneiro Airport -> Campanhã Train Station */
/* Test Case 2.1 with SP-GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline) */
CREATE INDEX idx_startpoint_spgist ON taxi_trajectory USING spgist(ST_StartPoint(polyline));
CREATE INDEX idx_endpoint_spgist ON taxi_trajectory USING spgist(ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.676514220811896 41.22748617051806,-8.662971112404733 41.23761712125881,-8.680597042810376 41.26953327959913,-8.695944813498926 41.266930675298255,-8.697524142221397 41.232466971412066,-8.676514220811896 41.22748617051806))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.588691530277202 41.14725942933609,-8.584291957451597 41.14603884995606,-8.582079306790718 41.15061106220182,-8.581976392807064 41.15181218372203,-8.585784210222613 41.15276144161274,-8.588691530277202 41.14725942933609))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);

DROP INDEX idx_startpoint_spgist;
DROP INDEX idx_endpoint_spgist;
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1385118326620000351	540	0.1688899647651907	"0102000020E610000025000000E1F1ED5D835621C08522DDCF299E4440ADFA5C6DC55621C085ED27637C9E4440E1B20A9B015621C0056B9C4D479E4440494A7A185A5521C0992A1895D49D444014E97E4E415621C0ED0BE8853B9D4440AED85F764F5621C09B559FABAD9C44404D4EED0C535321C0AFEE586C939C44408483BD89215121C01CCEFC6A0E9C4440A1D79FC4E74E21C07D91D096739B4440577C43E1B34D21C00BCF4BC5C69A44403ED00A0C594D21C05985CD00179A4440BEA4315A474D21C07A8CF2CCCB99444026C3F17C064C21C02D978DCEF999444091EF52EA924921C08D2AC3B81B9A44407D5A457F684621C05325CADE529A4440373811FDDA4221C09911DE1E849A4440F0DB10E3353F21C0D3F9F02C419A444044352559873B21C05AF44E05DC99444098E0D407923721C01AF9BCE2A999444085B53176C23321C0AE49B725729944407138F3AB393021C0A8AAD0402C9944408ECBB8A9812E21C09B374E0AF39844408C497F2F852F21C09641B5C1899844403E7B2E53933021C02AE44A3D0B984440F25EB532E12F21C0F8E28BF678974440BF620D17B92F21C00569C6A2E99644402409C215503021C03A78263449964440A304FD851E3121C0EE26F8A6E99544403CDC0E0D8B3121C00708E6E8F195444072C45A7C0A3021C09ACC785BE995444029EB3713D32D21C07B2FBE688F954440FB96395D162B21C0FC8F4C874E95444064EAAEEC822921C0DC9BDF30D1944440C93EC8B2602A21C0F7031E1840944440957CEC2E502A21C0CB10C7BAB8934440965F0663442A21C0E5603601869344402FDB4E5B232A21C0AC90F2936A934440"
1402390890620000496	570	0.16540362363809086	"0102000020E61000002700000013286211C35621C038842A357B9E4440153B1A87FA5521C058C51B99479E4440FCE07CEA585521C0F9669B1BD39D4440FBEAAA402D5621C080272D5C569D444094A5D6FB8D5621C0419B1C3EE99C4440621399B9C05521C03BFC3559A39C4440CCD07822885321C09B1BD313969C4440B6BE4868CB5121C0A22424D2369C4440A01B9AB2D34F21C0B0C7444AB39B444056BB26A4354E21C0DEE522BE139B4440BDA94885B14D21C09FABADD85F9A44408BDD3EABCC4C21C0E0F3C308E1994440A46C91B41B4D21C0D32EA699EE9944400E9E094D124B21C020D26F5F079A4440E0D57267264821C09355116E329A44401A53B0C6D94421C032AA0CE36E9A4440BA32A836384121C05F5E807D749A444040C23060C93D21C0ADDF4C4C179A44402D7AA702EE3921C0E09C11A5BD9944403465A71FD43521C0E719FB928D994440212235ED623221C06E88F19A579944400C01C0B1672F21C0C85F5AD427994440F4E0EEACDD2E21C00F0D8B51D79844408B6B7C26FB2F21C0E94482A966984440F1BA7EC16E3021C077D9AF3BDD9744408CBD175FB42F21C08B506C054D974440586FD40AD32F21C0D34F38BBB5964440573F36C98F3021C07AA86DC328964440EF1B5F7B663121C01BBE8575E39544403DB5FAEAAA3021C0C79DD2C1FA9544405A65A6B4FE2E21C074B2D47ABF954440C422861DC62C21C02F6F0ED76A9544402F3201BF462A21C042B115342D95444063416150A62921C04963B48EAA944440AF7AC03C642A21C06422A5D93C944440AF5DDA70582A21C06BD44334BA934440FC8C0B07422A21C02BD9B111889344402FDB4E5B232A21C0593673486A93444062687572862A21C0B247A81952934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=40.72..40.78 rows=1 width=52) (actual time=23.273..23.564 rows=2 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 1182"
"  Buffers: shared hit=1607"
"  CTE filtered_trips"
"    ->  Bitmap Heap Scan on taxi_trajectory  (cost=11.33..40.72 rows=1 width=838) (actual time=22.111..22.924 rows=154 loops=1)"
"          Filter: (st_contains('0103000020E6100000010000000600000000556B12605A21C06C554F441E9D444030F11BF3705321C05C63E23C6A9E4440F03F3137775C21C0EC87061180A24440F098EBE0526421C0445ACCC82AA24440D00566E2216521C0B8CE4B7AC19D444000556B12605A21C06C554F441E9D4440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E6100000010000000600000010F2EBF9682D21C05883A065D99244401024C150282B21C0DC40AA66B192444060B0844C062A21C04C49293947934440004D4CCFF82921C0381CE6946E934440B0D672E8EB2B21C084E8D9AF8D93444010F2EBF9682D21C05883A065D9924440'::geometry, st_endpoint(polyline)))"
"          Rows Removed by Filter: 13"
"          Heap Blocks: exact=167"
"          Buffers: shared hit=1607"
"          ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=21.776..21.778 rows=0 loops=1)"
"                Buffers: shared hit=1428"
"                ->  Bitmap Index Scan on idx_endpoint_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=17.351..17.352 rows=46587 loops=1)"
"                      Index Cond: (st_endpoint(polyline) @ '0103000020E6100000010000000600000010F2EBF9682D21C05883A065D99244401024C150282B21C0DC40AA66B192444060B0844C062A21C04C49293947934440004D4CCFF82921C0381CE6946E934440B0D672E8EB2B21C084E8D9AF8D93444010F2EBF9682D21C05883A065D9924440'::geometry)"
"                      Buffers: shared hit=1297"
"                ->  Bitmap Index Scan on idx_startpoint_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=1.409..1.409 rows=3808 loops=1)"
"                      Index Cond: (st_startpoint(polyline) @ '0103000020E6100000010000000600000000556B12605A21C06C554F441E9D444030F11BF3705321C05C63E23C6A9E4440F03F3137775C21C0EC87061180A24440F098EBE0526421C0445ACCC82AA24440D00566E2216521C0B8CE4B7AC19D444000556B12605A21C06C554F441E9D4440'::geometry)"
"                      Buffers: shared hit=131"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=22.119..22.155 rows=154 loops=1)"
"        Buffers: shared hit=1429"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.008 rows=9 loops=154)"
"        Buffers: shared hit=178"
"Planning Time: 0.288 ms"
"Execution Time: 23.984 ms"
 */


/* Test Case 2.2: Avenida dos Aliados (CBD) -> Hospital */
/* Test Case 2.2 with Sequential Search */
-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.6204120171505 41.14585489815653,-8.617463270972934 41.14625862693123,-8.61798408847909 41.14821379254357,-8.620312449097725 41.14797733018469,-8.620695403146357 41.147239100749715,-8.6204120171505 41.14585489815653))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1392718310620000083	105	0.006277861238200446	"0102000020E610000008000000AE2CD159663921C073124A5F089344407974232C2A3A21C0CC4065FCFB924440F96A47718E3A21C0F3C98AE1EA9244402B84D558C23A21C0A643A7E7DD9244405E11FC6F253B21C0739EB12FD9924440AAD6C22CB43B21C07A8F334DD8924440DC114E0B5E3C21C02635B401D8924440425C397B673C21C06DAD2F12DA924440"
1391645993620000140	15	0.008759039330884918	"0102000020E6100000020000009563B2B8FF3821C0AD6EF59CF4924440739CDB847B3D21C0D905836BEE924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=17891733.70..17891733.76 rows=1 width=52) (actual time=355.272..356.476 rows=2 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 27616"
"  Buffers: shared hit=4744 read=265616"
"  CTE filtered_trips"
"    ->  Gather  (cost=1000.00..17891733.70 rows=1 width=838) (actual time=0.400..352.620 rows=1245 loops=1)"
"          Workers Planned: 2"
"          Workers Launched: 2"
"          Buffers: shared hit=4744 read=265616"
"          ->  Parallel Seq Scan on taxi_trajectory  (cost=0.00..17890733.60 rows=1 width=838) (actual time=0.463..316.741 rows=415 loops=3)"
"                Filter: (st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000006000000E069D7A4A63D21C098C5905FAB924440B09E5625243C21C0B8B6499AB8924440A0EE1269683C21C038E567ABF8924440505AE497993D21C0A8D8D0EBF09244401095B2C9CB3D21C0CC3419BBD8924440E069D7A4A63D21C098C5905FAB924440'::geometry, st_endpoint(polyline)))"
"                Rows Removed by Filter: 557638"
"                Buffers: shared hit=4744 read=265616"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=0.404..0.497 rows=1245 loops=1)"
"        Buffers: shared read=7"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.284 rows=23 loops=1245)"
"        Buffers: shared hit=4744 read=265609"
"Planning Time: 0.277 ms"
"Execution Time: 356.530 ms"
 */

/* Test Case 2.2: Avenida dos Aliados (CBD) -> Hospital */
/* Test Case 2.2 with GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline) */
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist(ST_StartPoint(polyline));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist(ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.6204120171505 41.14585489815653,-8.617463270972934 41.14625862693123,-8.61798408847909 41.14821379254357,-8.620312449097725 41.14797733018469,-8.620695403146357 41.147239100749715,-8.6204120171505 41.14585489815653))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);

DROP INDEX idx_startpoint_gist;
DROP INDEX idx_endpoint_gist;
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1391645993620000140	15	0.008759039330884918	"0102000020E6100000020000009563B2B8FF3821C0AD6EF59CF4924440739CDB847B3D21C0D905836BEE924440"
1392718310620000083	105	0.006277861238200446	"0102000020E610000008000000AE2CD159663921C073124A5F089344407974232C2A3A21C0CC4065FCFB924440F96A47718E3A21C0F3C98AE1EA9244402B84D558C23A21C0A643A7E7DD9244405E11FC6F253B21C0739EB12FD9924440AAD6C22CB43B21C07A8F334DD8924440DC114E0B5E3C21C02635B401D8924440425C397B673C21C06DAD2F12DA924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=40.72..40.78 rows=1 width=52) (actual time=111.074..111.935 rows=2 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 25347"
"  Buffers: shared hit=38 read=7650"
"  CTE filtered_trips"
"    ->  Bitmap Heap Scan on taxi_trajectory  (cost=11.33..40.72 rows=1 width=838) (actual time=89.314..109.251 rows=1245 loops=1)"
"          Filter: (st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000006000000E069D7A4A63D21C098C5905FAB924440B09E5625243C21C0B8B6499AB8924440A0EE1269683C21C038E567ABF8924440505AE497993D21C0A8D8D0EBF09244401095B2C9CB3D21C0CC3419BBD8924440E069D7A4A63D21C098C5905FAB924440'::geometry, st_endpoint(polyline)))"
"          Rows Removed by Filter: 5893"
"          Heap Blocks: exact=6752"
"          Buffers: shared hit=38 read=7650"
"          ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=88.699..88.699 rows=0 loops=1)"
"                Buffers: shared hit=7 read=919"
"                ->  Bitmap Index Scan on idx_endpoint_gist  (cost=0.00..5.54 rows=167 width=0) (actual time=15.725..15.725 rows=26126 loops=1)"
"                      Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000006000000E069D7A4A63D21C098C5905FAB924440B09E5625243C21C0B8B6499AB8924440A0EE1269683C21C038E567ABF8924440505AE497993D21C0A8D8D0EBF09244401095B2C9CB3D21C0CC3419BBD8924440E069D7A4A63D21C098C5905FAB924440'::geometry)"
"                      Buffers: shared hit=4 read=143"
"                ->  Bitmap Index Scan on idx_startpoint_gist  (cost=0.00..5.54 rows=167 width=0) (actual time=71.675..71.675 rows=144208 loops=1)"
"                      Index Cond: (st_startpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"                      Buffers: shared hit=3 read=776"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=89.317..89.403 rows=1245 loops=1)"
"        Buffers: shared hit=7 read=920"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.017 rows=21 loops=1245)"
"        Buffers: shared hit=31 read=6730"
"Planning Time: 0.319 ms"
"Execution Time: 112.043 ms"
 */

/* Test Case 2.2: Avenida dos Aliados (CBD) -> Hospital */
/* Test Case 2.2 with SP-GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline) */
CREATE INDEX idx_startpoint_spgist ON taxi_trajectory USING spgist(ST_StartPoint(polyline));
CREATE INDEX idx_endpoint_spgist ON taxi_trajectory USING spgist(ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.6119889952312 41.15363088753722,-8.612204916542566 41.14598930146323,-8.610539237851697 41.14605898560316,-8.608996942766908 41.14684873401163,-8.60532628046559 41.15351476067491,-8.6119889952312 41.15363088753722))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.6204120171505 41.14585489815653,-8.617463270972934 41.14625862693123,-8.61798408847909 41.14821379254357,-8.620312449097725 41.14797733018469,-8.620695403146357 41.147239100749715,-8.6204120171505 41.14585489815653))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);

DROP INDEX idx_startpoint_spgist;
DROP INDEX idx_endpoint_spgist;
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1391645993620000140	15	0.008759039330884918	"0102000020E6100000020000009563B2B8FF3821C0AD6EF59CF4924440739CDB847B3D21C0D905836BEE924440"
1392718310620000083	105	0.006277861238200446	"0102000020E610000008000000AE2CD159663921C073124A5F089344407974232C2A3A21C0CC4065FCFB924440F96A47718E3A21C0F3C98AE1EA9244402B84D558C23A21C0A643A7E7DD9244405E11FC6F253B21C0739EB12FD9924440AAD6C22CB43B21C07A8F334DD8924440DC114E0B5E3C21C02635B401D8924440425C397B673C21C06DAD2F12DA924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=40.72..40.78 rows=1 width=52) (actual time=93.135..94.011 rows=2 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 25347"
"  Buffers: shared hit=3627 read=7545"
"  CTE filtered_trips"
"    ->  Bitmap Heap Scan on taxi_trajectory  (cost=11.33..40.72 rows=1 width=838) (actual time=52.755..90.896 rows=1245 loops=1)"
"          Filter: (st_contains('0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000006000000E069D7A4A63D21C098C5905FAB924440B09E5625243C21C0B8B6499AB8924440A0EE1269683C21C038E567ABF8924440505AE497993D21C0A8D8D0EBF09244401095B2C9CB3D21C0CC3419BBD8924440E069D7A4A63D21C098C5905FAB924440'::geometry, st_endpoint(polyline)))"
"          Rows Removed by Filter: 5767"
"          Heap Blocks: exact=6659"
"          Buffers: shared hit=3627 read=7545"
"          ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=52.077..52.077 rows=0 loops=1)"
"                Buffers: shared hit=3620 read=888"
"                ->  Bitmap Index Scan on idx_endpoint_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=7.349..7.349 rows=26126 loops=1)"
"                      Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000006000000E069D7A4A63D21C098C5905FAB924440B09E5625243C21C0B8B6499AB8924440A0EE1269683C21C038E567ABF8924440505AE497993D21C0A8D8D0EBF09244401095B2C9CB3D21C0CC3419BBD8924440E069D7A4A63D21C098C5905FAB924440'::geometry)"
"                      Buffers: shared hit=739"
"                ->  Bitmap Index Scan on idx_startpoint_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=43.502..43.502 rows=144208 loops=1)"
"                      Index Cond: (st_startpoint(polyline) @ '0103000020E61000000100000006000000500F209F563921C05CD04A2DAA93444060003EEC723921C0DCAC05C7AF924440E0FE5699983821C0EC39930FB292444080188172CE3721C0FC0477F0CB924440A0048453ED3521C0A846265FA6934440500F209F563921C05CD04A2DAA934440'::geometry)"
"                      Buffers: shared hit=2881 read=888"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=52.758..52.845 rows=1245 loops=1)"
"        Buffers: shared hit=3620 read=889"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.032 rows=21 loops=1245)"
"        Buffers: shared hit=7 read=6656"
"Planning Time: 0.299 ms"
"Execution Time: 94.214 ms"
 */


/* Test Case 2.3: Clérigos Tower (Tourist Area) -> Estádio do Dragão (Football Stadium) */
/* Test Case 2.3 with Sequential Search */
-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.615571934016486 41.145022490170476,-8.61335460385007 41.14561477721966,-8.613371338416869 41.14608104198402,-8.614199699498528 41.14618185555062,-8.615768565182918 41.14557382137204,-8.615571934016486 41.145022490170476))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.581945663894942 41.15845020195181,-8.580602174156041 41.16282480723726,-8.582785344981687 41.16407644692981,-8.586026513975384 41.163254665988546,-8.586715052466644 41.161674289059675,-8.584481500776263 41.15909503206146,-8.581945663894942 41.15845020195181))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1395621183620000239	510	0.042479299298944964	"0102000020E610000023000000C68B8521723A21C020ED7F80B592444012F5824F733A21C07A3881E9B4924440C634D3BD4E3A21C0C6DB4AAFCD92444079573D601E3A21C046072461DF924440E04A766C043A21C0FA4674CFBA924440AD1402B9C43921C0DA740470B392444062A1D634EF3821C0DA91EA3BBF9244407C48F8DEDF3821C0CD069964E4924440AFEDED96E43821C06DCA15DEE5924440AF22A303923821C0D95C35CF11934440170CAEB9A33721C093E4B9BE0F934440E59B6D6E4C3721C0B98AC56F0A934440195932C7F23621C02C9ACE4E069344403465A71FD43521C0CD237F30F0924440505436ACA93421C0739EB12FD992444050A6D1E4623421C0A0353FFED29244406B60AB048B3321C0A643A7E7DD924440A087DA368C3221C093AAED26F8924440BA4BE2AC883221C00611A9691793444054FCDF11153221C08693347F4C934440D63A71395E3121C0A51309A69A9344400989B48D3F3121C01E4E603AAD93444089230F44163121C072C5C551B9934440249A40118B3021C09128B4ACFB9344407250C24CDB2F21C0CA6C904946944440404F0306492F21C0F7B182DF86944440F415A4198B2E21C0D68D7747C69444405CAD1397E32D21C01C7A8B87F79444402AA73D25E72C21C0234E27D9EA94444060B1868BDC2B21C0639B5434D6944440793BC269C12B21C0E3A9471ADC944440931CB0ABC92B21C0DCB8C5FCDC944440E085ADD9CA2B21C0D6C743DFDD9444402CEFAA07CC2B21C02331410DDF9444407958A835CD2B21C02331410DDF944440"
1375595890620000494	495	0.0472906728095983	"0102000020E610000022000000E08442041C3A21C0001B1021AE9244402D5DC136E23921C05A66118AAD924440AEF204C24E3921C0ED478AC8B092444048DDCEBEF23821C06682E15CC3924440C95A43A9BD3821C0EDF5EE8FF7924440166D8E739B3821C0E04DB7EC10934440C90391459A3821C0D95C35CF119344407C43E1B3753821C0062E8F35239344404AB6BA9C123821C0D927806264934440630B410E4A3821C038D89B189293444016687748313821C0381268B0A9934440E388B5F8143821C0840CE4D9E59344407EC51A2E723721C01D01DC2C5E944440FF08C380253721C0B66455849B9444404DA25EF0693621C010B056ED9A944440B5DD04DF343521C00A850838849444408463963D093421C0F086342A70944440056D72F8A43321C0D7A546E867944440BAD7497D593221C08A1F63EE5A9444400989B48D3F3121C0904AB1A3719444402578431A153021C04A0C022B87944440266E15C4402F21C083BF5FCC969444408D4468041B2F21C0C34659BF99944440F4F8BD4D7F2E21C0DC7EF964C5944440DCBB067DE92D21C0E3E313B2F3944440292504ABEA2D21C089981249F49444407689EAAD812D21C0363E93FDF3944440F8DF4A766C2C21C01C40BFEFDF944440F949B54FC72B21C016F88A6EBD944440ADDBA0F65B2B21C0501A6A1492944440C826F911BF2A21C05DC2A1B7789444404757E9EE3A2B21C0DD96C80567944440AD8905BEA22B21C0D7DF12807F944440FAF202ECA32B21C077A38FF980944440"
1397306076620000186	540	0.04194570303360663	"0102000020E61000002500000046EC1340313A21C0001B1021AE924440C669882AFC3921C05A66118AAD924440C7478B33863921C09AED0A7DB09244402E7079AC193921C0D3838252B4924440950C0055DC3821C0DACBB6D3D6924440965E9B8D953821C0CC7A319413934440637FD93D793821C072A3C85A439344404A0D6D00363821C08CA19C68579344403049658A393821C0329067976F934440E31934F44F3821C07F50172994934440494739984D3821C02B137EA99F934440971AA19FA93721C058C7F143A59344406649809A5A3621C0B212F3ACA4934440CEC3094CA73521C0EBC5504EB4934440815A0C1EA63521C05184D4EDEC9344409B3BFA5FAE3521C01171732A19944440B5E21B0A9F3521C0771211FE45944440CEA623809B3521C08A592F8672944440E86A2BF6973521C03D0D18247D9444409C31CC09DA3421C043FE99417C9444400438BD8BF73321C0BDE13E726B94444038C0CC77F03321C0103CBEBD6B944440EB56CF49EF3321C0103CBEBD6B944440D2E4620CAC3321C08A3C49BA66944440D3838252B43221C0B7B6F0BC54944440D449B6BA9C3221C0645C71715494444087E0B88C9B3221C01002F22554944440D53F8864C83121C03DD34B8C6594444024B726DD963021C09067976F7D9444400C01C0B1672F21C03656629E959444405A828C800A2F21C0AA8251499D9444400E661360582E21C016325706D5944440292504ABEA2D21C0295C8FC2F5944440758E01D9EB2D21C0D6011077F5944440758E01D9EB2D21C0D6011077F594444044DFDDCA122D21C0166C239EEC944440C61858C7F12B21C0C3D7D7BAD4944440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=17891733.70..17891733.76 rows=1 width=52) (actual time=362.863..363.938 rows=3 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 21"
"  Buffers: shared hit=4670 read=265520"
"  CTE filtered_trips"
"    ->  Gather  (cost=1000.00..17891733.70 rows=1 width=838) (actual time=76.704..363.910 rows=7 loops=1)"
"          Workers Planned: 2"
"          Workers Launched: 2"
"          Buffers: shared hit=4670 read=265520"
"          ->  Parallel Seq Scan on taxi_trajectory  (cost=0.00..17890733.60 rows=1 width=838) (actual time=155.639..336.996 rows=2 loops=3)"
"                Filter: (st_contains('0103000020E6100000010000000600000060DF993E2C3B21C0BC3BD2189092444030C6589D093A21C084FC4881A3924440C09BDDCE0B3A21C088F198C8B2924440501E0D62783A21C0E46D4816B692444020BB7204463B21C02CF9B829A292444060DF993E2C3B21C0BC3BD21890924440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000007000000A0F434C8F42921C0BCB6A1184894444030F92BB0442921C0E0077B71D7944440A0913AD7622A21C0C0CDFE7400954440F039D0AA0B2C21C08CAB6587E594444090D454EA652C21C0C40E3CBEB1944440F0E6C528412B21C07CD4DB395D944440A0F434C8F42921C0BCB6A11848944440'::geometry, st_endpoint(polyline)))"
"                Rows Removed by Filter: 558051"
"                Buffers: shared hit=4670 read=265520"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=76.713..76.714 rows=7 loops=1)"
"        Buffers: shared hit=157 read=12288"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..40.878 rows=4 loops=7)"
"        Buffers: shared hit=4513 read=253232"
"Planning Time: 0.293 ms"
"Execution Time: 363.995 ms"
 */

/* Test Case 2.3: Clérigos Tower (Tourist Area) -> Estádio do Dragão (Football Stadium) */
/* Test Case 2.3 with GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline) */
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist(ST_StartPoint(polyline));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist(ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.615571934016486 41.145022490170476,-8.61335460385007 41.14561477721966,-8.613371338416869 41.14608104198402,-8.614199699498528 41.14618185555062,-8.615768565182918 41.14557382137204,-8.615571934016486 41.145022490170476))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.581945663894942 41.15845020195181,-8.580602174156041 41.16282480723726,-8.582785344981687 41.16407644692981,-8.586026513975384 41.163254665988546,-8.586715052466644 41.161674289059675,-8.584481500776263 41.15909503206146,-8.581945663894942 41.15845020195181))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);

DROP INDEX idx_startpoint_gist;
DROP INDEX idx_endpoint_gist;
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1375595890620000494	495	0.0472906728095983	"0102000020E610000022000000E08442041C3A21C0001B1021AE9244402D5DC136E23921C05A66118AAD924440AEF204C24E3921C0ED478AC8B092444048DDCEBEF23821C06682E15CC3924440C95A43A9BD3821C0EDF5EE8FF7924440166D8E739B3821C0E04DB7EC10934440C90391459A3821C0D95C35CF119344407C43E1B3753821C0062E8F35239344404AB6BA9C123821C0D927806264934440630B410E4A3821C038D89B189293444016687748313821C0381268B0A9934440E388B5F8143821C0840CE4D9E59344407EC51A2E723721C01D01DC2C5E944440FF08C380253721C0B66455849B9444404DA25EF0693621C010B056ED9A944440B5DD04DF343521C00A850838849444408463963D093421C0F086342A70944440056D72F8A43321C0D7A546E867944440BAD7497D593221C08A1F63EE5A9444400989B48D3F3121C0904AB1A3719444402578431A153021C04A0C022B87944440266E15C4402F21C083BF5FCC969444408D4468041B2F21C0C34659BF99944440F4F8BD4D7F2E21C0DC7EF964C5944440DCBB067DE92D21C0E3E313B2F3944440292504ABEA2D21C089981249F49444407689EAAD812D21C0363E93FDF3944440F8DF4A766C2C21C01C40BFEFDF944440F949B54FC72B21C016F88A6EBD944440ADDBA0F65B2B21C0501A6A1492944440C826F911BF2A21C05DC2A1B7789444404757E9EE3A2B21C0DD96C80567944440AD8905BEA22B21C0D7DF12807F944440FAF202ECA32B21C077A38FF980944440"
1395621183620000239	510	0.042479299298944964	"0102000020E610000023000000C68B8521723A21C020ED7F80B592444012F5824F733A21C07A3881E9B4924440C634D3BD4E3A21C0C6DB4AAFCD92444079573D601E3A21C046072461DF924440E04A766C043A21C0FA4674CFBA924440AD1402B9C43921C0DA740470B392444062A1D634EF3821C0DA91EA3BBF9244407C48F8DEDF3821C0CD069964E4924440AFEDED96E43821C06DCA15DEE5924440AF22A303923821C0D95C35CF11934440170CAEB9A33721C093E4B9BE0F934440E59B6D6E4C3721C0B98AC56F0A934440195932C7F23621C02C9ACE4E069344403465A71FD43521C0CD237F30F0924440505436ACA93421C0739EB12FD992444050A6D1E4623421C0A0353FFED29244406B60AB048B3321C0A643A7E7DD924440A087DA368C3221C093AAED26F8924440BA4BE2AC883221C00611A9691793444054FCDF11153221C08693347F4C934440D63A71395E3121C0A51309A69A9344400989B48D3F3121C01E4E603AAD93444089230F44163121C072C5C551B9934440249A40118B3021C09128B4ACFB9344407250C24CDB2F21C0CA6C904946944440404F0306492F21C0F7B182DF86944440F415A4198B2E21C0D68D7747C69444405CAD1397E32D21C01C7A8B87F79444402AA73D25E72C21C0234E27D9EA94444060B1868BDC2B21C0639B5434D6944440793BC269C12B21C0E3A9471ADC944440931CB0ABC92B21C0DCB8C5FCDC944440E085ADD9CA2B21C0D6C743DFDD9444402CEFAA07CC2B21C02331410DDF9444407958A835CD2B21C02331410DDF944440"
1397306076620000186	540	0.04194570303360663	"0102000020E61000002500000046EC1340313A21C0001B1021AE924440C669882AFC3921C05A66118AAD924440C7478B33863921C09AED0A7DB09244402E7079AC193921C0D3838252B4924440950C0055DC3821C0DACBB6D3D6924440965E9B8D953821C0CC7A319413934440637FD93D793821C072A3C85A439344404A0D6D00363821C08CA19C68579344403049658A393821C0329067976F934440E31934F44F3821C07F50172994934440494739984D3821C02B137EA99F934440971AA19FA93721C058C7F143A59344406649809A5A3621C0B212F3ACA4934440CEC3094CA73521C0EBC5504EB4934440815A0C1EA63521C05184D4EDEC9344409B3BFA5FAE3521C01171732A19944440B5E21B0A9F3521C0771211FE45944440CEA623809B3521C08A592F8672944440E86A2BF6973521C03D0D18247D9444409C31CC09DA3421C043FE99417C9444400438BD8BF73321C0BDE13E726B94444038C0CC77F03321C0103CBEBD6B944440EB56CF49EF3321C0103CBEBD6B944440D2E4620CAC3321C08A3C49BA66944440D3838252B43221C0B7B6F0BC54944440D449B6BA9C3221C0645C71715494444087E0B88C9B3221C01002F22554944440D53F8864C83121C03DD34B8C6594444024B726DD963021C09067976F7D9444400C01C0B1672F21C03656629E959444405A828C800A2F21C0AA8251499D9444400E661360582E21C016325706D5944440292504ABEA2D21C0295C8FC2F5944440758E01D9EB2D21C0D6011077F5944440758E01D9EB2D21C0D6011077F594444044DFDDCA122D21C0166C239EEC944440C61858C7F12B21C0C3D7D7BAD4944440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=40.72..40.78 rows=1 width=52) (actual time=4.548..4.569 rows=3 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 21"
"  Buffers: shared hit=128"
"  CTE filtered_trips"
"    ->  Bitmap Heap Scan on taxi_trajectory  (cost=11.33..40.72 rows=1 width=838) (actual time=4.450..4.519 rows=7 loops=1)"
"          Filter: (st_contains('0103000020E6100000010000000600000060DF993E2C3B21C0BC3BD2189092444030C6589D093A21C084FC4881A3924440C09BDDCE0B3A21C088F198C8B2924440501E0D62783A21C0E46D4816B692444020BB7204463B21C02CF9B829A292444060DF993E2C3B21C0BC3BD21890924440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000007000000A0F434C8F42921C0BCB6A1184894444030F92BB0442921C0E0077B71D7944440A0913AD7622A21C0C0CDFE7400954440F039D0AA0B2C21C08CAB6587E594444090D454EA652C21C0C40E3CBEB1944440F0E6C528412B21C07CD4DB395D944440A0F434C8F42921C0BCB6A11848944440'::geometry, st_endpoint(polyline)))"
"          Rows Removed by Filter: 7"
"          Heap Blocks: exact=14"
"          Buffers: shared hit=128"
"          ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=4.313..4.315 rows=0 loops=1)"
"                Buffers: shared hit=114"
"                ->  Bitmap Index Scan on idx_endpoint_gist  (cost=0.00..5.54 rows=167 width=0) (actual time=1.951..1.952 rows=9811 loops=1)"
"                      Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000007000000A0F434C8F42921C0BCB6A1184894444030F92BB0442921C0E0077B71D7944440A0913AD7622A21C0C0CDFE7400954440F039D0AA0B2C21C08CAB6587E594444090D454EA652C21C0C40E3CBEB1944440F0E6C528412B21C07CD4DB395D944440A0F434C8F42921C0BCB6A11848944440'::geometry)"
"                      Buffers: shared hit=69"
"                ->  Bitmap Index Scan on idx_startpoint_gist  (cost=0.00..5.54 rows=167 width=0) (actual time=1.243..1.243 rows=4789 loops=1)"
"                      Index Cond: (st_startpoint(polyline) @ '0103000020E6100000010000000600000060DF993E2C3B21C0BC3BD2189092444030C6589D093A21C084FC4881A3924440C09BDDCE0B3A21C088F198C8B2924440501E0D62783A21C0E46D4816B692444020BB7204463B21C02CF9B829A292444060DF993E2C3B21C0BC3BD21890924440'::geometry)"
"                      Buffers: shared hit=45"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=4.459..4.461 rows=7 loops=1)"
"        Buffers: shared hit=115"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.012 rows=4 loops=7)"
"        Buffers: shared hit=13"
"Planning Time: 0.428 ms"
"Execution Time: 4.659 ms"
 */

/* Test Case 2.3: Clérigos Tower (Tourist Area) -> Estádio do Dragão (Football Stadium) */
/* Test Case 2.3 with SP-GiST on ST_StartPoint(polyline) and ST_EndPoint(polyline) */
CREATE INDEX idx_startpoint_spgist ON taxi_trajectory USING spgist(ST_StartPoint(polyline));
CREATE INDEX idx_endpoint_spgist ON taxi_trajectory USING spgist(ST_EndPoint(polyline));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
WITH filtered_trips AS (
  SELECT trip_id, total_travel_time, ST_Length(polyline) AS route_length, polyline
  FROM taxi_trajectory
  WHERE 
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.615571934016486 41.145022490170476,-8.61335460385007 41.14561477721966,-8.613371338416869 41.14608104198402,-8.614199699498528 41.14618185555062,-8.615768565182918 41.14557382137204,-8.615571934016486 41.145022490170476))', 4326),
      ST_StartPoint(polyline)
    ) AND
    ST_Contains(
      ST_GeomFromText('POLYGON((-8.581945663894942 41.15845020195181,-8.580602174156041 41.16282480723726,-8.582785344981687 41.16407644692981,-8.586026513975384 41.163254665988546,-8.586715052466644 41.161674289059675,-8.584481500776263 41.15909503206146,-8.581945663894942 41.15845020195181))', 4326),
      ST_EndPoint(polyline)
    )
)
SELECT *
FROM filtered_trips t1
WHERE NOT EXISTS (
  SELECT 1 FROM filtered_trips t2
  WHERE 
    (t2.total_travel_time <= t1.total_travel_time AND
     t2.route_length <= t1.route_length) AND
    (t2.total_travel_time < t1.total_travel_time OR
     t2.route_length < t1.route_length)
);

DROP INDEX idx_startpoint_spgist;
DROP INDEX idx_endpoint_spgist;
/* Outputs:
"trip_id"	"total_travel_time"	"route_length"	"polyline"
1375595890620000494	495	0.0472906728095983	"0102000020E610000022000000E08442041C3A21C0001B1021AE9244402D5DC136E23921C05A66118AAD924440AEF204C24E3921C0ED478AC8B092444048DDCEBEF23821C06682E15CC3924440C95A43A9BD3821C0EDF5EE8FF7924440166D8E739B3821C0E04DB7EC10934440C90391459A3821C0D95C35CF119344407C43E1B3753821C0062E8F35239344404AB6BA9C123821C0D927806264934440630B410E4A3821C038D89B189293444016687748313821C0381268B0A9934440E388B5F8143821C0840CE4D9E59344407EC51A2E723721C01D01DC2C5E944440FF08C380253721C0B66455849B9444404DA25EF0693621C010B056ED9A944440B5DD04DF343521C00A850838849444408463963D093421C0F086342A70944440056D72F8A43321C0D7A546E867944440BAD7497D593221C08A1F63EE5A9444400989B48D3F3121C0904AB1A3719444402578431A153021C04A0C022B87944440266E15C4402F21C083BF5FCC969444408D4468041B2F21C0C34659BF99944440F4F8BD4D7F2E21C0DC7EF964C5944440DCBB067DE92D21C0E3E313B2F3944440292504ABEA2D21C089981249F49444407689EAAD812D21C0363E93FDF3944440F8DF4A766C2C21C01C40BFEFDF944440F949B54FC72B21C016F88A6EBD944440ADDBA0F65B2B21C0501A6A1492944440C826F911BF2A21C05DC2A1B7789444404757E9EE3A2B21C0DD96C80567944440AD8905BEA22B21C0D7DF12807F944440FAF202ECA32B21C077A38FF980944440"
1395621183620000239	510	0.042479299298944964	"0102000020E610000023000000C68B8521723A21C020ED7F80B592444012F5824F733A21C07A3881E9B4924440C634D3BD4E3A21C0C6DB4AAFCD92444079573D601E3A21C046072461DF924440E04A766C043A21C0FA4674CFBA924440AD1402B9C43921C0DA740470B392444062A1D634EF3821C0DA91EA3BBF9244407C48F8DEDF3821C0CD069964E4924440AFEDED96E43821C06DCA15DEE5924440AF22A303923821C0D95C35CF11934440170CAEB9A33721C093E4B9BE0F934440E59B6D6E4C3721C0B98AC56F0A934440195932C7F23621C02C9ACE4E069344403465A71FD43521C0CD237F30F0924440505436ACA93421C0739EB12FD992444050A6D1E4623421C0A0353FFED29244406B60AB048B3321C0A643A7E7DD924440A087DA368C3221C093AAED26F8924440BA4BE2AC883221C00611A9691793444054FCDF11153221C08693347F4C934440D63A71395E3121C0A51309A69A9344400989B48D3F3121C01E4E603AAD93444089230F44163121C072C5C551B9934440249A40118B3021C09128B4ACFB9344407250C24CDB2F21C0CA6C904946944440404F0306492F21C0F7B182DF86944440F415A4198B2E21C0D68D7747C69444405CAD1397E32D21C01C7A8B87F79444402AA73D25E72C21C0234E27D9EA94444060B1868BDC2B21C0639B5434D6944440793BC269C12B21C0E3A9471ADC944440931CB0ABC92B21C0DCB8C5FCDC944440E085ADD9CA2B21C0D6C743DFDD9444402CEFAA07CC2B21C02331410DDF9444407958A835CD2B21C02331410DDF944440"
1397306076620000186	540	0.04194570303360663	"0102000020E61000002500000046EC1340313A21C0001B1021AE924440C669882AFC3921C05A66118AAD924440C7478B33863921C09AED0A7DB09244402E7079AC193921C0D3838252B4924440950C0055DC3821C0DACBB6D3D6924440965E9B8D953821C0CC7A319413934440637FD93D793821C072A3C85A439344404A0D6D00363821C08CA19C68579344403049658A393821C0329067976F934440E31934F44F3821C07F50172994934440494739984D3821C02B137EA99F934440971AA19FA93721C058C7F143A59344406649809A5A3621C0B212F3ACA4934440CEC3094CA73521C0EBC5504EB4934440815A0C1EA63521C05184D4EDEC9344409B3BFA5FAE3521C01171732A19944440B5E21B0A9F3521C0771211FE45944440CEA623809B3521C08A592F8672944440E86A2BF6973521C03D0D18247D9444409C31CC09DA3421C043FE99417C9444400438BD8BF73321C0BDE13E726B94444038C0CC77F03321C0103CBEBD6B944440EB56CF49EF3321C0103CBEBD6B944440D2E4620CAC3321C08A3C49BA66944440D3838252B43221C0B7B6F0BC54944440D449B6BA9C3221C0645C71715494444087E0B88C9B3221C01002F22554944440D53F8864C83121C03DD34B8C6594444024B726DD963021C09067976F7D9444400C01C0B1672F21C03656629E959444405A828C800A2F21C0AA8251499D9444400E661360582E21C016325706D5944440292504ABEA2D21C0295C8FC2F5944440758E01D9EB2D21C0D6011077F5944440758E01D9EB2D21C0D6011077F594444044DFDDCA122D21C0166C239EEC944440C61858C7F12B21C0C3D7D7BAD4944440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Nested Loop Anti Join  (cost=40.72..40.78 rows=1 width=52) (actual time=6.800..6.821 rows=3 loops=1)"
"  Join Filter: ((t2.total_travel_time <= t1.total_travel_time) AND (t2.route_length <= t1.route_length) AND ((t2.total_travel_time < t1.total_travel_time) OR (t2.route_length < t1.route_length)))"
"  Rows Removed by Join Filter: 21"
"  Buffers: shared hit=605"
"  CTE filtered_trips"
"    ->  Bitmap Heap Scan on taxi_trajectory  (cost=11.33..40.72 rows=1 width=838) (actual time=6.703..6.772 rows=7 loops=1)"
"          Filter: (st_contains('0103000020E6100000010000000600000060DF993E2C3B21C0BC3BD2189092444030C6589D093A21C084FC4881A3924440C09BDDCE0B3A21C088F198C8B2924440501E0D62783A21C0E46D4816B692444020BB7204463B21C02CF9B829A292444060DF993E2C3B21C0BC3BD21890924440'::geometry, st_startpoint(polyline)) AND st_contains('0103000020E61000000100000007000000A0F434C8F42921C0BCB6A1184894444030F92BB0442921C0E0077B71D7944440A0913AD7622A21C0C0CDFE7400954440F039D0AA0B2C21C08CAB6587E594444090D454EA652C21C0C40E3CBEB1944440F0E6C528412B21C07CD4DB395D944440A0F434C8F42921C0BCB6A11848944440'::geometry, st_endpoint(polyline)))"
"          Rows Removed by Filter: 7"
"          Heap Blocks: exact=14"
"          Buffers: shared hit=605"
"          ->  BitmapAnd  (cost=11.33..11.33 rows=1 width=0) (actual time=6.572..6.574 rows=0 loops=1)"
"                Buffers: shared hit=591"
"                ->  Bitmap Index Scan on idx_endpoint_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=3.632..3.632 rows=9811 loops=1)"
"                      Index Cond: (st_endpoint(polyline) @ '0103000020E61000000100000007000000A0F434C8F42921C0BCB6A1184894444030F92BB0442921C0E0077B71D7944440A0913AD7622A21C0C0CDFE7400954440F039D0AA0B2C21C08CAB6587E594444090D454EA652C21C0C40E3CBEB1944440F0E6C528412B21C07CD4DB395D944440A0F434C8F42921C0BCB6A11848944440'::geometry)"
"                      Buffers: shared hit=299"
"                ->  Bitmap Index Scan on idx_startpoint_spgist  (cost=0.00..5.54 rows=167 width=0) (actual time=1.843..1.843 rows=4789 loops=1)"
"                      Index Cond: (st_startpoint(polyline) @ '0103000020E6100000010000000600000060DF993E2C3B21C0BC3BD2189092444030C6589D093A21C084FC4881A3924440C09BDDCE0B3A21C088F198C8B2924440501E0D62783A21C0E46D4816B692444020BB7204463B21C02CF9B829A292444060DF993E2C3B21C0BC3BD21890924440'::geometry)"
"                      Buffers: shared hit=292"
"  ->  CTE Scan on filtered_trips t1  (cost=0.00..0.02 rows=1 width=52) (actual time=6.710..6.713 rows=7 loops=1)"
"        Buffers: shared hit=592"
"  ->  CTE Scan on filtered_trips t2  (cost=0.00..0.02 rows=1 width=12) (actual time=0.000..0.012 rows=4 loops=7)"
"        Buffers: shared hit=13"
"Planning Time: 0.361 ms"
"Execution Time: 6.894 ms"
 */



/* 
Query Task 3: Trajectory Similarity Analysis
Use fast DTW to find the top 5 similar trips to a given trip.
The candidate trips should meet the following conditions:
- The trip should not be the same as the base trip.
- The trip should be longer than 1000 meters.
- The start point of the trip should be within 500 meters of the start point of the base trip.
- The end point of the trip should be within 500 meters of the end point of the base trip.
- The hour of the day should be the same as the base trip.
- The number of points in the trip should be within a certain range of the base trip.
*/

-- The following UDF finds the top 5 similar trips to a given trip using DTW.
CREATE OR REPLACE FUNCTION find_top5_similar_trips(
    base_trip_id BIGINT,
    diff_min INTEGER,
    diff_max INTEGER
)
RETURNS TABLE(
    similar_trip_id BIGINT,
    dtw_distance DOUBLE PRECISION,
    base_point_count INTEGER,
    similar_point_count INTEGER,
    similar_hour_of_day INTEGER,
    similar_total_travel_time INTEGER,
    similar_start_local_time TIMESTAMP WITHOUT TIME ZONE,
    similar_end_local_time TIMESTAMP WITHOUT TIME ZONE,
    similar_polyline GEOMETRY(LINESTRING,4326)
)
AS $$
import time
import numpy as np
from scipy.spatial.distance import euclidean
from fastdtw import fastdtw

def parse_linestring(wkt_text):
    """Parses a WKT LINESTRING into a NumPy array of coordinates."""
    pts = wkt_text.strip()[len("LINESTRING("):-1].split(',')
    return np.array([list(map(float, p.strip().split())) for p in pts])

total_start = time.time()

ref_q = plpy.execute(f"""
    SELECT
      ST_AsText(polyline) AS base_wkt,
      ST_AsText(ST_StartPoint(polyline)) AS start_wkt,
      ST_AsText(ST_EndPoint(polyline)) AS end_wkt,
      hour_of_day AS ref_hour,
      point_count AS ref_count
    FROM taxi_trajectory
    WHERE trip_id = {base_trip_id}
""")
if not ref_q:
    return []

ref = ref_q[0]
base_wkt = ref['base_wkt']
reference_start = ref['start_wkt']
reference_end = ref['end_wkt']
reference_hour = ref['ref_hour']
reference_count = ref['ref_count']
base_coords = parse_linestring(base_wkt)

query_start = time.time()

cand_q = plpy.execute(f"""
    SELECT
      trip_id,
      ST_AsText(polyline) AS poly_wkt,
      point_count AS cand_count,
      hour_of_day AS cand_hour,
      total_travel_time,
      start_local_time,
      end_local_time
    FROM taxi_trajectory
    WHERE trip_id <> {base_trip_id}
      AND ST_Length(ST_Transform(polyline,3857)) > 1000
      AND ST_DWithin(
            ST_Transform(ST_StartPoint(polyline),3857),
            ST_Transform(ST_GeomFromText('{reference_start}',4326),3857),
            500
          )
      AND ST_DWithin(
            ST_Transform(ST_EndPoint(polyline),3857),
            ST_Transform(ST_GeomFromText('{reference_end}',4326),3857),
            500
          )
      AND hour_of_day = {reference_hour}
      AND point_count BETWEEN {reference_count} + {diff_min}
                         AND {reference_count} + {diff_max}
""")

plpy.notice(f"Time for candidate SQL query: {time.time() - query_start:.3f}s")

if not cand_q:
    plpy.notice("No candidates found.")
    return []
else:
    # Space complexity analysis
    all_lengths = [len(parse_linestring(r['poly_wkt'])) for r in cand_q]
    avg_len = np.mean(all_lengths)
    max_len = np.max(all_lengths)
    min_len = np.min(all_lengths)
    total_points = sum(all_lengths)
    approx_mem_MB = total_points * len(base_coords) * 16 / (1024**2)
    plpy.notice(f"[Memory Estimation] Candidates: {len(all_lengths)}, Avg length: {avg_len:.1f}, Max: {max_len}, Min: {min_len}, Total points: {total_points}")
    plpy.notice(f"[Memory Estimation] Approx DTW memory usage: {approx_mem_MB:.2f} MB")

dtw_start = time.time()

scored = []
for row in cand_q:
    coords = parse_linestring(row['poly_wkt'])
    dist, _ = fastdtw(base_coords, coords, dist=euclidean)
    scored.append({
        'trip_id': row['trip_id'],
        'dtw_distance': dist,
        'point_count': row['cand_count'],
        'hour_of_day': row['cand_hour'],
        'total_travel_time': row['total_travel_time'],
        'start_local_time': row['start_local_time'],
        'end_local_time': row['end_local_time'],
        'poly_wkt': row['poly_wkt']
    })

plpy.notice(f"DTW computation time for {len(cand_q)} candidates: {time.time() - dtw_start:.3f}s")

scored.sort(key=lambda x: x['dtw_distance'])
top5 = scored[:5]

plpy.notice(f"Total UDF execution time: {time.time() - total_start:.3f}s")

return [
    (
      rec['trip_id'], 
      rec['dtw_distance'], 
      reference_count, 
      rec['point_count'], 
      rec['hour_of_day'], 
      rec['total_travel_time'], 
      rec['start_local_time'], 
      rec['end_local_time'], 
      'SRID=4326;' + rec['poly_wkt']
    )
    for rec in top5
]
$$ LANGUAGE plpython3u;

/* All the following queries are to be run using the UDF above. */

/* Test Case 3.1: Find top 5 trips most similar to trip ID 1400915574620000496 (Airport -> CBD at 8am) with 0-30 point count difference. */
/* Test Case 3.1 with Only apply B-tree on trip_id, hour_of_day and point_count */
CREATE INDEX idx_trip_id ON taxi_trajectory (trip_id);
CREATE INDEX idx_hour_of_day ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_point_count ON taxi_trajectory (point_count);

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1400915574620000496, 0, 30);

DROP INDEX IF EXISTS idx_trip_id;
DROP INDEX IF EXISTS idx_hour_of_day;
DROP INDEX IF EXISTS idx_point_count;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1377587421620000351	0.040592206440243535	41	47	8	690	"2013-08-27 08:10:21"	"2013-08-27 08:21:51"	"0102000020E61000002F000000137F1475E65621C065506D70229E44402D5BEB8B845621C04C8C65FA259E444047B071FDBB5621C0CB2BD7DB669E44407BDCB75A275621C08BC1C3B46F9E44407CBABA63B15521C0EC1516DC0F9E4440FCABC77DAB5521C080F277EFA89D4440E17D552E545621C06EE00ED4299D4440C710001C7B5621C0A2630795B89C4440319413ED2A5421C048DE3994A19C444002F390291F5221C04913EF004F9C444052F17F47545021C0B01EF7ADD69B44403B3602F1BA4E21C0717500C45D9B4440F0A5F0A0D94D21C0BE9F1A2FDD9A4440577C43E1B34D21C03370404B579A4440F24410E7E14C21C0FAD4B14AE9994440A4E029E44A4D21C0B35C363AE79944404165FCFB8C4B21C0535A7F4B009A4440C503CAA65C4921C0200C3CF71E9A4440639B5434D64621C0ECDADE6E499A4440B4386398134421C07F30F0DC7B9A4440A051BAF42F4121C06C4084B8729A44402594BE10723E21C08D47A984279A44402A029CDEC53B21C04721C9ACDE994440AFEDED96E43821C0D49D279EB39944401AF8510DFB3521C027A1F48590994440ECC039234A3321C08786C5A86B9944403DB5FAEAAA3021C021C8410933994440F44F70B1A22E21C022718FA50F9944400D535BEA202F21C022A64412BD984440A5C00298323021C05055A181589844402426A8E15B3021C0A4703D0AD797444026732CEFAA2F21C0FE5F75E4489744407233DC80CF2F21C0CC5EB69DB69644408BAA5FE97C3021C094895B053196444070B6B9313D3121C0C763062AE3954440BC934F8F6D3121C034BC5983F7954440A58636001B3021C0E144F46BEB954440280D350A492E21C0AEF199EC9F954440925B936E4B2C21C0B534B7425895444049D92269372A21C015FDA1992795444017D86322A52921C07D08AA46AF94444095B6B8C6672A21C0F1129CFA40944440151C5E10912A21C025B37A87DB934440FC523F6F2A2A21C01215AA9B8B9344402F3201BF462A21C09206B7B58593444063804413282A21C0A5828AAA5F9344407BF7C77BD52A21C086764EB340934440"
1377761035620000351	0.05672501482344053	41	55	8	810	"2013-08-29 08:23:55"	"2013-08-29 08:37:25"	"0102000020E61000003700000094A5D6FB8D5621C0663387A4169E444047938B31B05621C0255AF2785A9E4440613596B0365621C005DF347D769E4440486C770FD05521C0DF50F86C1D9E4440E27327D87F5521C0ADC3D155BA9D4440613596B0365621C0E146CA16499D444014D1AFAD9F5621C0A19DD32CD09C4440B1E1E995B25421C0EF92382BA29C4440B471C45A7C5221C089D4B48B699C444004013274EC5021C090C01F7EFE9B44403AAFB14B544F21C0A48E8EAB919B4440EF8D2100384E21C0E4D6A4DB129B4440F0315871AA4D21C0D2A755F4879A44400A2B1554544D21C0C6A354C2139A44408B51D7DAFB4C21C07A8CF2CCCB994440F2B391EBA64C21C0BA6A9E23F2994440C24CDBBFB24A21C05A68E7340B9A4440ADDEE176684821C006651A4D2E9A44407E1B62BCE64521C013BBB6B75B9A4440B6F468AA274321C0A5F3E159829A444055DE8E705A4021C006D9B27C5D9A444040C23060C93D21C06667D13B159A44402B4F20EC143B21C0AD31E884D099444096766A2E373821C0A7E9B303AE99444082C98D226B3521C07ADE8D05859944406DFFCA4A933221C09B3C65355D994440242BBF0CC63021C06840BD193599444026FF93BF7B2F21C01BBAD91F28994440417FA1478C2E21C02F19C748F6984440C05DF6EB4E2F21C0F6B704E09F98444071E65773803021C0E3DF675C389844408BFCFA21363021C017467A51BB97444059FB3BDBA32F21C0588E90813C9744403F8EE6C8CA2F21C0467C2766BD964440A417B5FB553021C04D4BAC8C469644403D9D2B4A093121C06744696FF095444022FB20CB823121C05471E316F39544408B709351653021C0478FDFDBF49544403F8EE6C8CA2F21C03B730F09DF9544408D9B1A683E2F21C087A2409FC89544400E492D944C2E21C0A10F96B1A19544407862D68BA12C21C05B069CA5649544407C2C7DE8822A21C08255F5F23B954440640795B88E2921C0A305685BCD94444049BC3C9D2B2A21C0F75AD07B63944440E2B034F0A32A21C0B1FA230C03944440E371512D222A21C08B6CE7FBA9934440E2C80391452A21C0E5603601869344407C613255302A21C05853591476934440C9CA2F83312A21C05262D7F6769344407C613255302A21C0A5BC5642779344402FF834272F2A21C0F816D68D779344407C613255302A21C05262D7F676934440E371512D222A21C04563EDEF6C934440FCA9F1D24D2A21C0C537143E5B934440"
1380438911620000351	0.0582629806321721	41	54	8	795	"2013-09-29 08:15:11"	"2013-09-29 08:28:26"	"0102000020E610000036000000E1F1ED5D835621C0ACAB02B5189E4440FA298E03AF5621C0B22D03CE529E44407A8A1C226E5621C0B2A19BFD819E444048A643A7E75521C0F25D4A5D329E4440E31C75745C5521C0B9DFA128D09D4440FBCDC474215621C02DEA93DC619D444014B4C9E1935621C04E7D2079E79C444095B88E71C55521C0E2B034F0A39C4440802DAF5C6F5321C0EF75525F969C4440698F17D2E15121C069AB92C83E9C4440382D78D1575021C05DC47762D69B444088F6B182DF4E21C05DBF60376C9B4440F0FCA204FD4D21C032E9EFA5F09A444070404B57B04D21C0469A7807789A4440F14927124C4D21C0D38558FD119A444072361D01DC4C21C04DF564FED1994440573D601E324D21C093A7ACA6EB994440282D5C56614B21C04D69FD2D019A444045813E91274921C0B3EDB435229A4440FDF9B660A94621C0D316D7F84C9A4440B5FE9600FC4321C026E5EE737C9A44406DC9AA08374121C06C4084B8729A4440D8BB3FDEAB3E21C0B30A9B012E9A444010CF1264043C21C01A8A3BDEE49944402E7079AC193921C0210725CCB49944409A232BBF0C3621C027A1F48590994440EC6987BF263321C09B594B0169994440573F36C98F3021C088F546AD309944400E4E44BFB62E21C0E2067C7E18994440DA73999A042F21C0B5A4A31CCC984440253E7782FD2F21C0D0807A336A98444071033E3F8C3021C0B79A75C6F7974440F25EB532E12F21C0B85B9203769744408CDAFD2AC02F21C0AC1DC539EA964440711B0DE02D3021C0E066F1626196444023658BA4DD3021C03ACAC16C029644403CDC0E0D8B3121C04772F90FE9954440A46E675F793021C03AADDBA0F69544408E791D71C82E21C06EA46C91B495444078B988EFC42C21C0EFE714E4679544404835ECF7C42A21C08F54DFF94595444097033DD4B62921C076A8A624EB944440630CACE3F82921C057EE05668594444062A2410A9E2A21C037177FDB1394444096422097382A21C05ED5592DB09344407C9BFEEC472A21C0DF6FB4E38693444063804413282A21C04563EDEF6C9344402FDB4E5B232A21C05F27F56569934440C9AD49B7252A21C0B28174B1699344402FDB4E5B232A21C005DCF3FC699344402FDB4E5B232A21C005DCF3FC69934440158BDF14562A21C079CE16105A9344406133C005D92A21C0263ACB2C42934440FB7953910A2B21C04C89247A19934440"
1387614147620000351	1.063005936793671	41	54	8	795	"2013-12-21 08:22:27"	"2013-12-21 08:35:42"	"0102000020E61000003600000046072461DF5621C0F25D4A5D329E44402D431CEBE25621C00531D0B52F9E4440471FF301815621C05260014C199E44402DCF83BBB35621C02B4B7496599E4440AE9E93DE375621C005DF347D769E444062307F85CC5521C0DF50F86C1D9E4440AF08FEB7925521C093E2E313B29D4440616F62484E5621C0EEEE01BA2F9D444014B4C9E1935621C0E8F86871C69C44407C0C569C6A5521C05534D6FECE9C4440CD3FFA264D5321C09BE61DA7E89C44409E42AED4B35021C0410FB56D189D4440D5CE30B5A54E21C0462234828D9D4440A24621C9AC4E21C025E659492B9E444025B03907CF4C21C0A5164A26A79E4440C408E1D1C64921C02B6D718DCF9E4440B0FF3A376D4621C0B8E9CF7EA49E44401C5C3AE63C4321C0247CEF6FD09E4440098D60E3FA3F21C08AE3C0ABE59E4440F549EEB0893C21C01E34BBEEAD9E444062BEBC00FB3821C0F17F4754A89E44404F24986A663521C0AB4198DBBD9E444088BEBB95253221C0B2BE81C98D9E4440C18D942D922E21C0EBFD463B6E9E4440AE105663092B21C0D847A7AE7C9E44406762BA10AB2721C0D1ADD7F4A09E444006BB61DBA22421C098512CB7B49E44408B1A4CC3F02121C08BA9F413CE9E4440F59D5F94A01F21C0919A7631CD9E4440DBC1887D022021C0DE3829CC7B9E4440BF805EB8732121C07FC2D9AD659E44403FAC376A852121C0C58CF0F6209E4440A391CF2B9E2221C020D3DA34B69D4440ED65DB696B2421C014B2F336369D4440D15966118A2521C0950D6B2A8B9C444082A8FB00A42621C0A33CF372D89B44400057B263232821C08BC56F0A2B9B4440FC8C0B07422A21C01F115322899A4440E063B0E2542B21C0CD0358E4D799444090D959F44E2D21C0FB3E1C2444994440A708707A172F21C062105839B4984440BE6C3B6D8D3021C03D0E83F92B9844403FE5982CEE2F21C098C3EE3B86974440D943FB58C12F21C0921FF12BD69644408BAA5FE97C3021C047205ED72F96444022DE3AFF763121C0740987DEE295444057E883656C3021C04E8061F9F3954440742497FF902E21C0A81DFE9AAC9544402C11A8FE412C21C0A852B3075A954440C9737D1F0E2A21C089EFC4AC17954440302DEA93DC2921C0560BEC319194444048DE3994A12A21C0B1170AD80E94444030A182C30B2A21C0787C7BD7A093444096253ACB2C2A21C07217618A72934440"
1380700170620000351	1.0797209046736225	41	66	8	975	"2013-10-02 08:49:30"	"2013-10-02 09:05:45"	"0102000020E610000042000000E02BBAF59A5621C025034015379E44407A5567B5C05621C01F865627679E444094BDA59C2F5621C018B2BAD5739E4440C85D8429CA5521C0A6BA8097199E44402F17F19D985521C0A6B5696CAF9D444061527C7C425621C0E129E44A3D9D44407AFEB4519D5621C09BAC510FD19C44407C293C68765521C0BB61DBA2CC9C444099F1B6D26B5321C0F4311F10E89C44409E42AED4B35021C09B5AB6D6179D444022382EE3A64E21C0EDD632198E9D4440889FFF1EBC4E21C08C135FED289E4440BE9F1A2FDD4C21C0B1F84D61A59E44401155F833BC4921C0E4F4F57CCD9E444017105A0F5F4621C0B8E9CF7EA49E444036E675C4214321C004C765DCD49E4440D690B8C7D23F21C097C5C4E6E39E4440295E656D533C21C0DEACC1FBAA9E44402F6B6281AF3821C0DEACC1FBAA9E4440B6F5D37FD63421C0986E1283C09E444056F2B1BB403121C038842A357B9E4440C3F2E7DB822D21C08BC1C3B46F9E4440B03BDD79E22921C08527F4FA939E4440CFF41263992621C07862D68BA19E444021E9D32AFA2321C05ED89AADBC9E4440723447567E2121C0CB30EE06D19E4440F58079C8941F21C0B14F00C5C89E444041EF8D21002021C0D25625917D9E4440A648BE12482121C02B685A62659E4440723447567E2121C0C5A9D6C22C9E44403D2AFEEF882221C040A54A94BD9D444053CDACA5802421C0FAD005F52D9D444004392861A62521C0488787307E9C4440E9D500A5A12621C050E27327D89B444067B96C74CE2721C091F0BDBF419B44407D3F355EBA2921C0F8DEDFA0BD9A44402E71E481C82A21C006483481229A444045662E70792C21C03483F8C08E9944400FF27A30292E21C0F59F353FFE98444073F4F8BD4D2F21C0897C975297984440BF620D17B92F21C01C075E2D77984440A5DDE8633E3021C06919A9F754984440249A40118B3021C043FF04172B984440A48B4D2B853021C0B0A9F3A8F89744400BEE073C303021C0D1CDFE40B99744408CDAFD2AC02F21C0986C3CD8629744400CCC0A45BA2F21C0253B3602F19644408B8862F2063021C0992842EA769644403D0CAD4ECE3021C081423D7D04964440EF8FF7AA953121C0E7357689EA9544400989B48D3F3121C06E52D158FB9544408CF7E3F6CB2F21C0E1270EA0DF954440DBA337DC472E21C055A69883A0954440450F7C0C562C21C0F5BBB0355B9544407C613255302A21C0D575A8A62495444017D86322A52921C0E335AFEAAC944440FC1D8A027D2A21C06AF6402B309444404930D5CC5A2A21C0FEB5BC72BD93444096422097382A21C072512D228A934440AF230ED9402A21C0C5ABAC6D8A9344402F151BF33A2A21C08507CDAE7B93444096422097382A21C08CF84ECC7A934440FC6F253B362A21C0389ECF807A934440C99063EB192A21C0CC457C2766934440AFD172A0872A21C0FFB0A547539344406133C005D92A21C0CCEEC9C342934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=227.413..227.414 rows=5 loops=1)"
"  Buffers: shared hit=721 read=32431"
"Planning Time: 0.045 ms"
"Execution Time: 227.441 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.229s
NOTICE:  [Memory Estimation] Candidates: 8, Avg length: 58.4, Max: 68, Min: 47, Total points: 467
NOTICE:  [Memory Estimation] Approx DTW memory usage: 0.29 MB
NOTICE:  DTW computation time for 8 candidates: 0.025s
NOTICE:  Total UDF execution time: 0.257s

Successfully run. Total query runtime: 278 msec.
5 rows affected.
 */

/* Test Case 3.1: Find top 5 trips most similar to trip ID 1400915574620000496 (Airport -> CBD at 8am) with 0-30 point count difference. */
/* Test Case 3.1 with Only apply GiST on polyline, ST_Transform(ST_StartPoint(polyline), 3857) and ST_Transform(ST_EndPoint(polyline), 3857) */
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_StartPoint(polyline), 3857));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_EndPoint(polyline), 3857));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1400915574620000496, 0, 30);

DROP INDEX IF EXISTS idx_polyline_gist;
DROP INDEX IF EXISTS idx_startpoint_gist;
DROP INDEX IF EXISTS idx_endpoint_gist;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1377587421620000351	0.040592206440243535	41	47	8	690	"2013-08-27 08:10:21"	"2013-08-27 08:21:51"	"0102000020E61000002F000000137F1475E65621C065506D70229E44402D5BEB8B845621C04C8C65FA259E444047B071FDBB5621C0CB2BD7DB669E44407BDCB75A275621C08BC1C3B46F9E44407CBABA63B15521C0EC1516DC0F9E4440FCABC77DAB5521C080F277EFA89D4440E17D552E545621C06EE00ED4299D4440C710001C7B5621C0A2630795B89C4440319413ED2A5421C048DE3994A19C444002F390291F5221C04913EF004F9C444052F17F47545021C0B01EF7ADD69B44403B3602F1BA4E21C0717500C45D9B4440F0A5F0A0D94D21C0BE9F1A2FDD9A4440577C43E1B34D21C03370404B579A4440F24410E7E14C21C0FAD4B14AE9994440A4E029E44A4D21C0B35C363AE79944404165FCFB8C4B21C0535A7F4B009A4440C503CAA65C4921C0200C3CF71E9A4440639B5434D64621C0ECDADE6E499A4440B4386398134421C07F30F0DC7B9A4440A051BAF42F4121C06C4084B8729A44402594BE10723E21C08D47A984279A44402A029CDEC53B21C04721C9ACDE994440AFEDED96E43821C0D49D279EB39944401AF8510DFB3521C027A1F48590994440ECC039234A3321C08786C5A86B9944403DB5FAEAAA3021C021C8410933994440F44F70B1A22E21C022718FA50F9944400D535BEA202F21C022A64412BD984440A5C00298323021C05055A181589844402426A8E15B3021C0A4703D0AD797444026732CEFAA2F21C0FE5F75E4489744407233DC80CF2F21C0CC5EB69DB69644408BAA5FE97C3021C094895B053196444070B6B9313D3121C0C763062AE3954440BC934F8F6D3121C034BC5983F7954440A58636001B3021C0E144F46BEB954440280D350A492E21C0AEF199EC9F954440925B936E4B2C21C0B534B7425895444049D92269372A21C015FDA1992795444017D86322A52921C07D08AA46AF94444095B6B8C6672A21C0F1129CFA40944440151C5E10912A21C025B37A87DB934440FC523F6F2A2A21C01215AA9B8B9344402F3201BF462A21C09206B7B58593444063804413282A21C0A5828AAA5F9344407BF7C77BD52A21C086764EB340934440"
1377761035620000351	0.05672501482344053	41	55	8	810	"2013-08-29 08:23:55"	"2013-08-29 08:37:25"	"0102000020E61000003700000094A5D6FB8D5621C0663387A4169E444047938B31B05621C0255AF2785A9E4440613596B0365621C005DF347D769E4440486C770FD05521C0DF50F86C1D9E4440E27327D87F5521C0ADC3D155BA9D4440613596B0365621C0E146CA16499D444014D1AFAD9F5621C0A19DD32CD09C4440B1E1E995B25421C0EF92382BA29C4440B471C45A7C5221C089D4B48B699C444004013274EC5021C090C01F7EFE9B44403AAFB14B544F21C0A48E8EAB919B4440EF8D2100384E21C0E4D6A4DB129B4440F0315871AA4D21C0D2A755F4879A44400A2B1554544D21C0C6A354C2139A44408B51D7DAFB4C21C07A8CF2CCCB994440F2B391EBA64C21C0BA6A9E23F2994440C24CDBBFB24A21C05A68E7340B9A4440ADDEE176684821C006651A4D2E9A44407E1B62BCE64521C013BBB6B75B9A4440B6F468AA274321C0A5F3E159829A444055DE8E705A4021C006D9B27C5D9A444040C23060C93D21C06667D13B159A44402B4F20EC143B21C0AD31E884D099444096766A2E373821C0A7E9B303AE99444082C98D226B3521C07ADE8D05859944406DFFCA4A933221C09B3C65355D994440242BBF0CC63021C06840BD193599444026FF93BF7B2F21C01BBAD91F28994440417FA1478C2E21C02F19C748F6984440C05DF6EB4E2F21C0F6B704E09F98444071E65773803021C0E3DF675C389844408BFCFA21363021C017467A51BB97444059FB3BDBA32F21C0588E90813C9744403F8EE6C8CA2F21C0467C2766BD964440A417B5FB553021C04D4BAC8C469644403D9D2B4A093121C06744696FF095444022FB20CB823121C05471E316F39544408B709351653021C0478FDFDBF49544403F8EE6C8CA2F21C03B730F09DF9544408D9B1A683E2F21C087A2409FC89544400E492D944C2E21C0A10F96B1A19544407862D68BA12C21C05B069CA5649544407C2C7DE8822A21C08255F5F23B954440640795B88E2921C0A305685BCD94444049BC3C9D2B2A21C0F75AD07B63944440E2B034F0A32A21C0B1FA230C03944440E371512D222A21C08B6CE7FBA9934440E2C80391452A21C0E5603601869344407C613255302A21C05853591476934440C9CA2F83312A21C05262D7F6769344407C613255302A21C0A5BC5642779344402FF834272F2A21C0F816D68D779344407C613255302A21C05262D7F676934440E371512D222A21C04563EDEF6C934440FCA9F1D24D2A21C0C537143E5B934440"
1380438911620000351	0.0582629806321721	41	54	8	795	"2013-09-29 08:15:11"	"2013-09-29 08:28:26"	"0102000020E610000036000000E1F1ED5D835621C0ACAB02B5189E4440FA298E03AF5621C0B22D03CE529E44407A8A1C226E5621C0B2A19BFD819E444048A643A7E75521C0F25D4A5D329E4440E31C75745C5521C0B9DFA128D09D4440FBCDC474215621C02DEA93DC619D444014B4C9E1935621C04E7D2079E79C444095B88E71C55521C0E2B034F0A39C4440802DAF5C6F5321C0EF75525F969C4440698F17D2E15121C069AB92C83E9C4440382D78D1575021C05DC47762D69B444088F6B182DF4E21C05DBF60376C9B4440F0FCA204FD4D21C032E9EFA5F09A444070404B57B04D21C0469A7807789A4440F14927124C4D21C0D38558FD119A444072361D01DC4C21C04DF564FED1994440573D601E324D21C093A7ACA6EB994440282D5C56614B21C04D69FD2D019A444045813E91274921C0B3EDB435229A4440FDF9B660A94621C0D316D7F84C9A4440B5FE9600FC4321C026E5EE737C9A44406DC9AA08374121C06C4084B8729A4440D8BB3FDEAB3E21C0B30A9B012E9A444010CF1264043C21C01A8A3BDEE49944402E7079AC193921C0210725CCB49944409A232BBF0C3621C027A1F48590994440EC6987BF263321C09B594B0169994440573F36C98F3021C088F546AD309944400E4E44BFB62E21C0E2067C7E18994440DA73999A042F21C0B5A4A31CCC984440253E7782FD2F21C0D0807A336A98444071033E3F8C3021C0B79A75C6F7974440F25EB532E12F21C0B85B9203769744408CDAFD2AC02F21C0AC1DC539EA964440711B0DE02D3021C0E066F1626196444023658BA4DD3021C03ACAC16C029644403CDC0E0D8B3121C04772F90FE9954440A46E675F793021C03AADDBA0F69544408E791D71C82E21C06EA46C91B495444078B988EFC42C21C0EFE714E4679544404835ECF7C42A21C08F54DFF94595444097033DD4B62921C076A8A624EB944440630CACE3F82921C057EE05668594444062A2410A9E2A21C037177FDB1394444096422097382A21C05ED5592DB09344407C9BFEEC472A21C0DF6FB4E38693444063804413282A21C04563EDEF6C9344402FDB4E5B232A21C05F27F56569934440C9AD49B7252A21C0B28174B1699344402FDB4E5B232A21C005DCF3FC699344402FDB4E5B232A21C005DCF3FC69934440158BDF14562A21C079CE16105A9344406133C005D92A21C0263ACB2C42934440FB7953910A2B21C04C89247A19934440"
1387614147620000351	1.063005936793671	41	54	8	795	"2013-12-21 08:22:27"	"2013-12-21 08:35:42"	"0102000020E61000003600000046072461DF5621C0F25D4A5D329E44402D431CEBE25621C00531D0B52F9E4440471FF301815621C05260014C199E44402DCF83BBB35621C02B4B7496599E4440AE9E93DE375621C005DF347D769E444062307F85CC5521C0DF50F86C1D9E4440AF08FEB7925521C093E2E313B29D4440616F62484E5621C0EEEE01BA2F9D444014B4C9E1935621C0E8F86871C69C44407C0C569C6A5521C05534D6FECE9C4440CD3FFA264D5321C09BE61DA7E89C44409E42AED4B35021C0410FB56D189D4440D5CE30B5A54E21C0462234828D9D4440A24621C9AC4E21C025E659492B9E444025B03907CF4C21C0A5164A26A79E4440C408E1D1C64921C02B6D718DCF9E4440B0FF3A376D4621C0B8E9CF7EA49E44401C5C3AE63C4321C0247CEF6FD09E4440098D60E3FA3F21C08AE3C0ABE59E4440F549EEB0893C21C01E34BBEEAD9E444062BEBC00FB3821C0F17F4754A89E44404F24986A663521C0AB4198DBBD9E444088BEBB95253221C0B2BE81C98D9E4440C18D942D922E21C0EBFD463B6E9E4440AE105663092B21C0D847A7AE7C9E44406762BA10AB2721C0D1ADD7F4A09E444006BB61DBA22421C098512CB7B49E44408B1A4CC3F02121C08BA9F413CE9E4440F59D5F94A01F21C0919A7631CD9E4440DBC1887D022021C0DE3829CC7B9E4440BF805EB8732121C07FC2D9AD659E44403FAC376A852121C0C58CF0F6209E4440A391CF2B9E2221C020D3DA34B69D4440ED65DB696B2421C014B2F336369D4440D15966118A2521C0950D6B2A8B9C444082A8FB00A42621C0A33CF372D89B44400057B263232821C08BC56F0A2B9B4440FC8C0B07422A21C01F115322899A4440E063B0E2542B21C0CD0358E4D799444090D959F44E2D21C0FB3E1C2444994440A708707A172F21C062105839B4984440BE6C3B6D8D3021C03D0E83F92B9844403FE5982CEE2F21C098C3EE3B86974440D943FB58C12F21C0921FF12BD69644408BAA5FE97C3021C047205ED72F96444022DE3AFF763121C0740987DEE295444057E883656C3021C04E8061F9F3954440742497FF902E21C0A81DFE9AAC9544402C11A8FE412C21C0A852B3075A954440C9737D1F0E2A21C089EFC4AC17954440302DEA93DC2921C0560BEC319194444048DE3994A12A21C0B1170AD80E94444030A182C30B2A21C0787C7BD7A093444096253ACB2C2A21C07217618A72934440"
1380700170620000351	1.0797209046736225	41	66	8	975	"2013-10-02 08:49:30"	"2013-10-02 09:05:45"	"0102000020E610000042000000E02BBAF59A5621C025034015379E44407A5567B5C05621C01F865627679E444094BDA59C2F5621C018B2BAD5739E4440C85D8429CA5521C0A6BA8097199E44402F17F19D985521C0A6B5696CAF9D444061527C7C425621C0E129E44A3D9D44407AFEB4519D5621C09BAC510FD19C44407C293C68765521C0BB61DBA2CC9C444099F1B6D26B5321C0F4311F10E89C44409E42AED4B35021C09B5AB6D6179D444022382EE3A64E21C0EDD632198E9D4440889FFF1EBC4E21C08C135FED289E4440BE9F1A2FDD4C21C0B1F84D61A59E44401155F833BC4921C0E4F4F57CCD9E444017105A0F5F4621C0B8E9CF7EA49E444036E675C4214321C004C765DCD49E4440D690B8C7D23F21C097C5C4E6E39E4440295E656D533C21C0DEACC1FBAA9E44402F6B6281AF3821C0DEACC1FBAA9E4440B6F5D37FD63421C0986E1283C09E444056F2B1BB403121C038842A357B9E4440C3F2E7DB822D21C08BC1C3B46F9E4440B03BDD79E22921C08527F4FA939E4440CFF41263992621C07862D68BA19E444021E9D32AFA2321C05ED89AADBC9E4440723447567E2121C0CB30EE06D19E4440F58079C8941F21C0B14F00C5C89E444041EF8D21002021C0D25625917D9E4440A648BE12482121C02B685A62659E4440723447567E2121C0C5A9D6C22C9E44403D2AFEEF882221C040A54A94BD9D444053CDACA5802421C0FAD005F52D9D444004392861A62521C0488787307E9C4440E9D500A5A12621C050E27327D89B444067B96C74CE2721C091F0BDBF419B44407D3F355EBA2921C0F8DEDFA0BD9A44402E71E481C82A21C006483481229A444045662E70792C21C03483F8C08E9944400FF27A30292E21C0F59F353FFE98444073F4F8BD4D2F21C0897C975297984440BF620D17B92F21C01C075E2D77984440A5DDE8633E3021C06919A9F754984440249A40118B3021C043FF04172B984440A48B4D2B853021C0B0A9F3A8F89744400BEE073C303021C0D1CDFE40B99744408CDAFD2AC02F21C0986C3CD8629744400CCC0A45BA2F21C0253B3602F19644408B8862F2063021C0992842EA769644403D0CAD4ECE3021C081423D7D04964440EF8FF7AA953121C0E7357689EA9544400989B48D3F3121C06E52D158FB9544408CF7E3F6CB2F21C0E1270EA0DF954440DBA337DC472E21C055A69883A0954440450F7C0C562C21C0F5BBB0355B9544407C613255302A21C0D575A8A62495444017D86322A52921C0E335AFEAAC944440FC1D8A027D2A21C06AF6402B309444404930D5CC5A2A21C0FEB5BC72BD93444096422097382A21C072512D228A934440AF230ED9402A21C0C5ABAC6D8A9344402F151BF33A2A21C08507CDAE7B93444096422097382A21C08CF84ECC7A934440FC6F253B362A21C0389ECF807A934440C99063EB192A21C0CC457C2766934440AFD172A0872A21C0FFB0A547539344406133C005D92A21C0CCEEC9C342934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=291.554..291.555 rows=5 loops=1)"
"  Buffers: shared hit=13776 read=252612"
"Planning Time: 0.054 ms"
"Execution Time: 291.587 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.009s
NOTICE:  [Memory Estimation] Candidates: 8, Avg length: 58.4, Max: 68, Min: 47, Total points: 467
NOTICE:  [Memory Estimation] Approx DTW memory usage: 0.29 MB
NOTICE:  DTW computation time for 8 candidates: 0.036s
NOTICE:  Total UDF execution time: 0.294s

Successfully run. Total query runtime: 312 msec.
5 rows affected.
 */

/* Test Case 3.1: Find top 5 trips most similar to trip ID 1400915574620000496 (Airport -> CBD at 8am) with 0-30 point count difference. */
/* Test Case 3.1 with Both B-tree and GiST will be applied on attributes mentioned in index method 1 & 2 */
CREATE INDEX idx_trip_id ON taxi_trajectory (trip_id);
CREATE INDEX idx_hour_of_day ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_point_count ON taxi_trajectory (point_count);
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_StartPoint(polyline), 3857));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_EndPoint(polyline), 3857));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1400915574620000496, 0, 30);

DROP INDEX IF EXISTS idx_trip_id;
DROP INDEX IF EXISTS idx_hour_of_day;
DROP INDEX IF EXISTS idx_point_count;
DROP INDEX IF EXISTS idx_polyline_gist;
DROP INDEX IF EXISTS idx_startpoint_gist;
DROP INDEX IF EXISTS idx_endpoint_gist;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1377587421620000351	0.040592206440243535	41	47	8	690	"2013-08-27 08:10:21"	"2013-08-27 08:21:51"	"0102000020E61000002F000000137F1475E65621C065506D70229E44402D5BEB8B845621C04C8C65FA259E444047B071FDBB5621C0CB2BD7DB669E44407BDCB75A275621C08BC1C3B46F9E44407CBABA63B15521C0EC1516DC0F9E4440FCABC77DAB5521C080F277EFA89D4440E17D552E545621C06EE00ED4299D4440C710001C7B5621C0A2630795B89C4440319413ED2A5421C048DE3994A19C444002F390291F5221C04913EF004F9C444052F17F47545021C0B01EF7ADD69B44403B3602F1BA4E21C0717500C45D9B4440F0A5F0A0D94D21C0BE9F1A2FDD9A4440577C43E1B34D21C03370404B579A4440F24410E7E14C21C0FAD4B14AE9994440A4E029E44A4D21C0B35C363AE79944404165FCFB8C4B21C0535A7F4B009A4440C503CAA65C4921C0200C3CF71E9A4440639B5434D64621C0ECDADE6E499A4440B4386398134421C07F30F0DC7B9A4440A051BAF42F4121C06C4084B8729A44402594BE10723E21C08D47A984279A44402A029CDEC53B21C04721C9ACDE994440AFEDED96E43821C0D49D279EB39944401AF8510DFB3521C027A1F48590994440ECC039234A3321C08786C5A86B9944403DB5FAEAAA3021C021C8410933994440F44F70B1A22E21C022718FA50F9944400D535BEA202F21C022A64412BD984440A5C00298323021C05055A181589844402426A8E15B3021C0A4703D0AD797444026732CEFAA2F21C0FE5F75E4489744407233DC80CF2F21C0CC5EB69DB69644408BAA5FE97C3021C094895B053196444070B6B9313D3121C0C763062AE3954440BC934F8F6D3121C034BC5983F7954440A58636001B3021C0E144F46BEB954440280D350A492E21C0AEF199EC9F954440925B936E4B2C21C0B534B7425895444049D92269372A21C015FDA1992795444017D86322A52921C07D08AA46AF94444095B6B8C6672A21C0F1129CFA40944440151C5E10912A21C025B37A87DB934440FC523F6F2A2A21C01215AA9B8B9344402F3201BF462A21C09206B7B58593444063804413282A21C0A5828AAA5F9344407BF7C77BD52A21C086764EB340934440"
1377761035620000351	0.05672501482344053	41	55	8	810	"2013-08-29 08:23:55"	"2013-08-29 08:37:25"	"0102000020E61000003700000094A5D6FB8D5621C0663387A4169E444047938B31B05621C0255AF2785A9E4440613596B0365621C005DF347D769E4440486C770FD05521C0DF50F86C1D9E4440E27327D87F5521C0ADC3D155BA9D4440613596B0365621C0E146CA16499D444014D1AFAD9F5621C0A19DD32CD09C4440B1E1E995B25421C0EF92382BA29C4440B471C45A7C5221C089D4B48B699C444004013274EC5021C090C01F7EFE9B44403AAFB14B544F21C0A48E8EAB919B4440EF8D2100384E21C0E4D6A4DB129B4440F0315871AA4D21C0D2A755F4879A44400A2B1554544D21C0C6A354C2139A44408B51D7DAFB4C21C07A8CF2CCCB994440F2B391EBA64C21C0BA6A9E23F2994440C24CDBBFB24A21C05A68E7340B9A4440ADDEE176684821C006651A4D2E9A44407E1B62BCE64521C013BBB6B75B9A4440B6F468AA274321C0A5F3E159829A444055DE8E705A4021C006D9B27C5D9A444040C23060C93D21C06667D13B159A44402B4F20EC143B21C0AD31E884D099444096766A2E373821C0A7E9B303AE99444082C98D226B3521C07ADE8D05859944406DFFCA4A933221C09B3C65355D994440242BBF0CC63021C06840BD193599444026FF93BF7B2F21C01BBAD91F28994440417FA1478C2E21C02F19C748F6984440C05DF6EB4E2F21C0F6B704E09F98444071E65773803021C0E3DF675C389844408BFCFA21363021C017467A51BB97444059FB3BDBA32F21C0588E90813C9744403F8EE6C8CA2F21C0467C2766BD964440A417B5FB553021C04D4BAC8C469644403D9D2B4A093121C06744696FF095444022FB20CB823121C05471E316F39544408B709351653021C0478FDFDBF49544403F8EE6C8CA2F21C03B730F09DF9544408D9B1A683E2F21C087A2409FC89544400E492D944C2E21C0A10F96B1A19544407862D68BA12C21C05B069CA5649544407C2C7DE8822A21C08255F5F23B954440640795B88E2921C0A305685BCD94444049BC3C9D2B2A21C0F75AD07B63944440E2B034F0A32A21C0B1FA230C03944440E371512D222A21C08B6CE7FBA9934440E2C80391452A21C0E5603601869344407C613255302A21C05853591476934440C9CA2F83312A21C05262D7F6769344407C613255302A21C0A5BC5642779344402FF834272F2A21C0F816D68D779344407C613255302A21C05262D7F676934440E371512D222A21C04563EDEF6C934440FCA9F1D24D2A21C0C537143E5B934440"
1380438911620000351	0.0582629806321721	41	54	8	795	"2013-09-29 08:15:11"	"2013-09-29 08:28:26"	"0102000020E610000036000000E1F1ED5D835621C0ACAB02B5189E4440FA298E03AF5621C0B22D03CE529E44407A8A1C226E5621C0B2A19BFD819E444048A643A7E75521C0F25D4A5D329E4440E31C75745C5521C0B9DFA128D09D4440FBCDC474215621C02DEA93DC619D444014B4C9E1935621C04E7D2079E79C444095B88E71C55521C0E2B034F0A39C4440802DAF5C6F5321C0EF75525F969C4440698F17D2E15121C069AB92C83E9C4440382D78D1575021C05DC47762D69B444088F6B182DF4E21C05DBF60376C9B4440F0FCA204FD4D21C032E9EFA5F09A444070404B57B04D21C0469A7807789A4440F14927124C4D21C0D38558FD119A444072361D01DC4C21C04DF564FED1994440573D601E324D21C093A7ACA6EB994440282D5C56614B21C04D69FD2D019A444045813E91274921C0B3EDB435229A4440FDF9B660A94621C0D316D7F84C9A4440B5FE9600FC4321C026E5EE737C9A44406DC9AA08374121C06C4084B8729A4440D8BB3FDEAB3E21C0B30A9B012E9A444010CF1264043C21C01A8A3BDEE49944402E7079AC193921C0210725CCB49944409A232BBF0C3621C027A1F48590994440EC6987BF263321C09B594B0169994440573F36C98F3021C088F546AD309944400E4E44BFB62E21C0E2067C7E18994440DA73999A042F21C0B5A4A31CCC984440253E7782FD2F21C0D0807A336A98444071033E3F8C3021C0B79A75C6F7974440F25EB532E12F21C0B85B9203769744408CDAFD2AC02F21C0AC1DC539EA964440711B0DE02D3021C0E066F1626196444023658BA4DD3021C03ACAC16C029644403CDC0E0D8B3121C04772F90FE9954440A46E675F793021C03AADDBA0F69544408E791D71C82E21C06EA46C91B495444078B988EFC42C21C0EFE714E4679544404835ECF7C42A21C08F54DFF94595444097033DD4B62921C076A8A624EB944440630CACE3F82921C057EE05668594444062A2410A9E2A21C037177FDB1394444096422097382A21C05ED5592DB09344407C9BFEEC472A21C0DF6FB4E38693444063804413282A21C04563EDEF6C9344402FDB4E5B232A21C05F27F56569934440C9AD49B7252A21C0B28174B1699344402FDB4E5B232A21C005DCF3FC699344402FDB4E5B232A21C005DCF3FC69934440158BDF14562A21C079CE16105A9344406133C005D92A21C0263ACB2C42934440FB7953910A2B21C04C89247A19934440"
1387614147620000351	1.063005936793671	41	54	8	795	"2013-12-21 08:22:27"	"2013-12-21 08:35:42"	"0102000020E61000003600000046072461DF5621C0F25D4A5D329E44402D431CEBE25621C00531D0B52F9E4440471FF301815621C05260014C199E44402DCF83BBB35621C02B4B7496599E4440AE9E93DE375621C005DF347D769E444062307F85CC5521C0DF50F86C1D9E4440AF08FEB7925521C093E2E313B29D4440616F62484E5621C0EEEE01BA2F9D444014B4C9E1935621C0E8F86871C69C44407C0C569C6A5521C05534D6FECE9C4440CD3FFA264D5321C09BE61DA7E89C44409E42AED4B35021C0410FB56D189D4440D5CE30B5A54E21C0462234828D9D4440A24621C9AC4E21C025E659492B9E444025B03907CF4C21C0A5164A26A79E4440C408E1D1C64921C02B6D718DCF9E4440B0FF3A376D4621C0B8E9CF7EA49E44401C5C3AE63C4321C0247CEF6FD09E4440098D60E3FA3F21C08AE3C0ABE59E4440F549EEB0893C21C01E34BBEEAD9E444062BEBC00FB3821C0F17F4754A89E44404F24986A663521C0AB4198DBBD9E444088BEBB95253221C0B2BE81C98D9E4440C18D942D922E21C0EBFD463B6E9E4440AE105663092B21C0D847A7AE7C9E44406762BA10AB2721C0D1ADD7F4A09E444006BB61DBA22421C098512CB7B49E44408B1A4CC3F02121C08BA9F413CE9E4440F59D5F94A01F21C0919A7631CD9E4440DBC1887D022021C0DE3829CC7B9E4440BF805EB8732121C07FC2D9AD659E44403FAC376A852121C0C58CF0F6209E4440A391CF2B9E2221C020D3DA34B69D4440ED65DB696B2421C014B2F336369D4440D15966118A2521C0950D6B2A8B9C444082A8FB00A42621C0A33CF372D89B44400057B263232821C08BC56F0A2B9B4440FC8C0B07422A21C01F115322899A4440E063B0E2542B21C0CD0358E4D799444090D959F44E2D21C0FB3E1C2444994440A708707A172F21C062105839B4984440BE6C3B6D8D3021C03D0E83F92B9844403FE5982CEE2F21C098C3EE3B86974440D943FB58C12F21C0921FF12BD69644408BAA5FE97C3021C047205ED72F96444022DE3AFF763121C0740987DEE295444057E883656C3021C04E8061F9F3954440742497FF902E21C0A81DFE9AAC9544402C11A8FE412C21C0A852B3075A954440C9737D1F0E2A21C089EFC4AC17954440302DEA93DC2921C0560BEC319194444048DE3994A12A21C0B1170AD80E94444030A182C30B2A21C0787C7BD7A093444096253ACB2C2A21C07217618A72934440"
1380700170620000351	1.0797209046736225	41	66	8	975	"2013-10-02 08:49:30"	"2013-10-02 09:05:45"	"0102000020E610000042000000E02BBAF59A5621C025034015379E44407A5567B5C05621C01F865627679E444094BDA59C2F5621C018B2BAD5739E4440C85D8429CA5521C0A6BA8097199E44402F17F19D985521C0A6B5696CAF9D444061527C7C425621C0E129E44A3D9D44407AFEB4519D5621C09BAC510FD19C44407C293C68765521C0BB61DBA2CC9C444099F1B6D26B5321C0F4311F10E89C44409E42AED4B35021C09B5AB6D6179D444022382EE3A64E21C0EDD632198E9D4440889FFF1EBC4E21C08C135FED289E4440BE9F1A2FDD4C21C0B1F84D61A59E44401155F833BC4921C0E4F4F57CCD9E444017105A0F5F4621C0B8E9CF7EA49E444036E675C4214321C004C765DCD49E4440D690B8C7D23F21C097C5C4E6E39E4440295E656D533C21C0DEACC1FBAA9E44402F6B6281AF3821C0DEACC1FBAA9E4440B6F5D37FD63421C0986E1283C09E444056F2B1BB403121C038842A357B9E4440C3F2E7DB822D21C08BC1C3B46F9E4440B03BDD79E22921C08527F4FA939E4440CFF41263992621C07862D68BA19E444021E9D32AFA2321C05ED89AADBC9E4440723447567E2121C0CB30EE06D19E4440F58079C8941F21C0B14F00C5C89E444041EF8D21002021C0D25625917D9E4440A648BE12482121C02B685A62659E4440723447567E2121C0C5A9D6C22C9E44403D2AFEEF882221C040A54A94BD9D444053CDACA5802421C0FAD005F52D9D444004392861A62521C0488787307E9C4440E9D500A5A12621C050E27327D89B444067B96C74CE2721C091F0BDBF419B44407D3F355EBA2921C0F8DEDFA0BD9A44402E71E481C82A21C006483481229A444045662E70792C21C03483F8C08E9944400FF27A30292E21C0F59F353FFE98444073F4F8BD4D2F21C0897C975297984440BF620D17B92F21C01C075E2D77984440A5DDE8633E3021C06919A9F754984440249A40118B3021C043FF04172B984440A48B4D2B853021C0B0A9F3A8F89744400BEE073C303021C0D1CDFE40B99744408CDAFD2AC02F21C0986C3CD8629744400CCC0A45BA2F21C0253B3602F19644408B8862F2063021C0992842EA769644403D0CAD4ECE3021C081423D7D04964440EF8FF7AA953121C0E7357689EA9544400989B48D3F3121C06E52D158FB9544408CF7E3F6CB2F21C0E1270EA0DF954440DBA337DC472E21C055A69883A0954440450F7C0C562C21C0F5BBB0355B9544407C613255302A21C0D575A8A62495444017D86322A52921C0E335AFEAAC944440FC1D8A027D2A21C06AF6402B309444404930D5CC5A2A21C0FEB5BC72BD93444096422097382A21C072512D228A934440AF230ED9402A21C0C5ABAC6D8A9344402F151BF33A2A21C08507CDAE7B93444096422097382A21C08CF84ECC7A934440FC6F253B362A21C0389ECF807A934440C99063EB192A21C0CC457C2766934440AFD172A0872A21C0FFB0A547539344406133C005D92A21C0CCEEC9C342934440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=70.509..70.509 rows=5 loops=1)"
"  Buffers: shared hit=392"
"Planning Time: 0.079 ms"
"Execution Time: 70.544 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.022s
NOTICE:  [Memory Estimation] Candidates: 8, Avg length: 58.4, Max: 68, Min: 47, Total points: 467
NOTICE:  [Memory Estimation] Approx DTW memory usage: 0.29 MB
NOTICE:  DTW computation time for 8 candidates: 0.032s
NOTICE:  Total UDF execution time: 0.057s

Successfully run. Total query runtime: 91 msec.
5 rows affected.
 */


/* Test Case 3.2: Find top 5 trips most similar to trip ID 1398517670620000151 (Train Station -> Tourist Area at 2pm) with 0-10 point count difference. */
/* Test Case 3.2 with Only apply B-tree on trip_id, hour_of_day and point_count */
CREATE INDEX idx_trip_id ON taxi_trajectory (trip_id);
CREATE INDEX idx_hour_of_day ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_point_count ON taxi_trajectory (point_count);

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1398517670620000151, 0, 10);

DROP INDEX IF EXISTS idx_trip_id;
DROP INDEX IF EXISTS idx_hour_of_day;
DROP INDEX IF EXISTS idx_point_count;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1375969345620000594	0.01824138488505521	40	50	14	735	"2013-08-08 14:42:25"	"2013-08-08 14:54:40"	"0102000020E61000003200000093399677D52B21C0D95C35CF1193444079AF5A99F02B21C02CB7B41A12934440923EADA23F2C21C026C632FD12934440446B459BE32C21C0E65B1FD61B9344405DE2C803912D21C033E202D0289344400E83F92B642E21C02C0E677E35934440C05DF6EB4E2F21C0126745D444934440BFEE74E7892F21C09F573CF5489344400CCC0A45BA2F21C08693347F4C934440F20C1AFA273021C06CCF2C095093444025CFF57D383021C02C4833164D9344400AF83592043121C0F277EFA831934440EE5A423EE83121C0000341800C934440EEEBC039233221C0F303577902934440EEEBC039233221C0F303577902934440873254C5543221C00CC85EEFFE924440ED815660C83221C000E65AB4009344409E5C5320B33321C0000341800C9344409DD5027B4C3421C0B9A7AB3B169344409CFC169D2C3521C0A6F10BAF2493444001C0B167CF3521C0B9E177D32D934440E78C28ED0D3621C0132D793C2D934440B4041901153621C07369FCC22B93444033DE567A6D3621C0A60EF27A30934440B309302C7F3621C0A60EF27A3093444000732D5A803621C053B4722F3093444019ABCDFFAB3621C0992CEE3F32934440CC41D0D1AA3621C0923B6C2233934440CC41D0D1AA3621C0E695EB6D33934440CC41D0D1AA3621C08C4AEA043493444019ABCDFFAB3621C0DFA4695034934440325706D5063721C0DF87838428934440B2135E82533721C0C05E61C1FD92444017EFC7ED973721C0CD069964E4924440170CAEB9A33721C0D3F71A82E392444031ED9BFBAB3721C079AC1919E492444017D7F84CF63721C060E811A3E7924440309B00C3F23721C0B933130CE7924440499EEBFB703821C0335184D4ED9244407C65DEAAEB3821C0139CFA40F292444014200A664C3921C006BAF605F4924440946DE00ED43921C019AA622AFD924440C6FA0626373A21C0B96DDFA3FE924440C68B8521723A21C079E6E5B0FB9244402CF3565D873A21C0198D7C5EF192444013471E882C3A21C0C6151747E592444060B01BB62D3A21C0DA740470B392444060B01BB62D3A21C0A0DE8C9AAF92444046EC1340313A21C06D3997E2AA92444046EC1340313A21C06D3997E2AA924440"
1378216365620000041	0.020787531981045753	40	45	14	660	"2013-09-03 14:52:45"	"2013-09-03 15:03:45"	"0102000020E61000002D000000AC1A84B9DD2B21C086E5CFB705934440DFBF7971E22B21C0E04DB7EC10934440DF3312A1112C21C0D95C35CF11934440DE3829CC7B2C21C0CC7A3194139344407715527E522D21C059880E812393444075CDE49B6D2E21C02C0E677E35934440406CE9D1542F21C0B91B446B4593444025CADE52CE2F21C08C84B69C4B93444025CADE52CE2F21C08C84B69C4B9344400B45BA9F533021C0392A37514B934440F08AE07F2B3121C0191EFB592C9344406EA301BC053221C026A94C3107934440D40AD3F71A3221C0EC12D55B03934440EEEBC039233221C0397CD28904934440A0C6BDF90D3321C0397CD28904934440B95510035D3321C026A94C3107934440B95510035D3321C02C9ACE4E06934440D192C7D3F23321C0000341800C934440B64C86E3F93421C0A6D425E318934440CE893DB48F3521C059880E81239344401AE0826C593621C00C3CF71E2E9344407FF5B86FB53621C08C4AEA0434934440FFCEF6E80D3721C013109370219344401898158A743721C00DAB7823F3924440B1C1C2499A3721C0B34291EEE792444097546D37C13721C0E6CAA0DAE0924440C9C9C4AD823821C04D158C4AEA9244409641B5C1893821C0A6608DB3E99244407C7DAD4B8D3821C053060E68E99244409529E620E83821C086AB0320EE924440FA43334FAE3921C0E013EB54F9924440124C35B3963A21C0E013EB54F99244402C62D8614C3A21C00D8E9257E7924440ADDF4C4C173A21C06DAD2F12DA92444046CF2D74253A21C05AA0DD21C5924440C6FA0626373A21C0BADC60A8C3924440C6DD205A2B3A21C006465ED6C492444060B01BB62D3A21C00D37E0F3C3924440799109F8353A21C07364E597C1924440AC36FFAF3A3A21C0C6BE64E3C1924440799109F8353A21C01A19E42EC292444013640454383A21C0BADC60A8C3924440F99FFCDD3B3A21C0ADFA5C6DC5924440C6FA0626373A21C09A27D714C892444060B01BB62D3A21C05AA0DD21C5924440"
1376919686620000678	0.02126056711503235	40	42	14	615	"2013-08-19 14:41:26"	"2013-08-19 14:51:41"	"0102000020E61000002A000000C6FB71FBE52B21C05340DAFF009344409373620FED2B21C0C66CC9AA089344405FEB5223F42B21C033A836381193444078B471C45A2C21C02CB7B41A12934440F775E09C112D21C0793D98141F9344405CE7DF2EFB2D21C0FF59F3E32F934440A7EB89AE0B2F21C02C2B4D4A41934440A59E05A1BC2F21C072C0AE264F93444059350873BB2F21C0CC0BB08F4E9344408BC22E8A1E3021C00C93A982519344400AD6389B8E3021C02C2B4D4A41934440897AC1A7393121C0D3A57F492A934440228C9FC6BD3121C0C689AF7614934440211D1EC2F83121C0A6B73F170D934440EE940ED6FF3121C0B98AC56F0A934440213A048E043221C02C9ACE4E06934440EDD3F198813221C0C64FE3DEFC924440D236FE44653321C07903CC7C07934440B972F6CE683321C020B8CA1308934440D253E410713321C073124A5F089344406ABC7493183421C0E04DB7EC1093444050FD8348863421C06C3EAE0D15934440D0D6C1C1DE3421C0EC4CA1F31A93444082035ABA823521C0FF3C0D18249344409A40118B183621C0795A7EE02A934440B4041901153621C07369FCC22B93444099620E828E3621C046D26EF43193444019C8B3CBB73621C07F68E6C935934440CC5EB69DB63621C0CCD1E3F736934440E5D022DBF93621C06C787AA52C934440984F560C573721C04641F0F8F69244407E39B35DA13721C033349E08E292444031D0B52FA03721C0D9E89C9FE292444030B8E68EFE3721C02D431CEBE292444063D17476323821C0206118B0E492444062F3716DA83821C066D993C0E692444095B54DF1B83821C019709692E5924440E10B93A9823921C000C974E8F4924440132A38BC203A21C0B96DDFA3FE924440450E1137A73A21C0198D7C5EF1924440E0BE0E9C333A21C066D993C0E6924440F9484A7A183A21C02D431CEBE2924440"
1387118746620000273	0.021690078708113663	40	41	14	600	"2013-12-15 14:45:46"	"2013-12-15 14:55:46"	"0102000020E6100000290000002C29779FE32B21C026A94C3107934440C6FB71FBE52B21C0B98AC56F0A934440C6353E93FD2B21C02CB7B41A12934440AB933314772C21C0CC7A3194139344405DC5E237852D21C0D3A57F492A93444074982F2FC02E21C046EF54C03D934440BF620D17B92F21C02657B1F84D93444072A774B0FE2F21C04C1AA375549344408BDF14562A3021C0B9382A375193444058CB9D99603021C09966BAD7499344400989B48D3F3121C0DF878384289344406EC0E787113221C0E030D120059344406E8B321B643221C019AA622AFD92444005A22765523321C0397CD28904934440B8B1D991EA3321C04C6C3EAE0D93444004C93B87323421C07920B24813934440020D36751E3521C0F94B8BFA249344403430F2B2263621C0865968E73493444080812040863621C0CCD1E3F736934440FFB1101D023721C0865968E734934440185E49F25C3721C020B8CA1308934440E466B8019F3721C0938D075BEC9244404B94BDA59C3721C0F9BA0CFFE992444097FDBAD39D3721C053060E68E99244407E9065C1C43721C0069D103AE892444063B9A5D5903821C06DE7FBA9F19244407CD45FAFB03821C0198D7C5EF1924440FCE25295B63821C00DAB7823F39244404969368FC33821C05323F433F59244407BA4C16D6D3921C04641F0F8F69244405F07CE19513A21C04C4F58E201934440C5C551B9893A21C0AC8BDB6800934440F96A47718E3A21C0AC8BDB6800934440AC014A438D3A21C05340DAFF00934440C5C551B9893A21C0A69A594B01934440DFC325C79D3A21C066F6798CF2924440ADFC3218233A21C09370218FE092444093382BA2263A21C093FC885FB192444046B247A8193A21C020D099B4A99244401477BCC96F3921C04D840D4FAF9244401494A2957B3921C0C6DB4AAFCD924440"
1375278524620000542	0.022414689793695063	40	42	14	615	"2013-07-31 14:48:44"	"2013-07-31 14:58:59"	"0102000020E61000002A0000002C0C91D3D72B21C0A0A9D72D02934440C6DE8B2FDA2B21C086E5CFB705934440DFDC5F3DEE2B21C0E04DB7EC109344409204E10A282C21C08011346612934440DE8FDB2F9F2C21C0B3B6291E179344405D86FF74032D21C0DF6A9DB81C934440904DF2237E2D21C03FC4060B27934440DAC534D3BD2E21C09F3A56293D9344403FABCC94D62F21C072C0AE264F934440BEBED6A5463021C03239B5334C934440F0F96184F03021C0ACFF73982F9344406FD8B628B33121C0E04DB7EC1093444021AE9CBD333221C013B9E00CFE92444053AF5B04C63221C00CC85EEFFE9244406C09F9A0673321C02C9ACE4E06934440EBC5504EB43321C013D6C6D80993444051A1BAB9F83321C0E63E390A10934440693524EEB13421C09FE3A3C5199344400281CEA44D3521C0B9C49107229344401BBE8575E33521C0191EFB592C934440CDC82077113621C06C787AA52C934440CD1FD3DA343621C06687F8872D93444066BD18CA893621C08C4AEA0434934440809E060C923621C0D9B3E7323593444066DAFE95953621C0865968E73493444080D8D2A3A93621C07F68E6C935934440E544BB0A293721C0A69A594B01934440CB4BFE277F3721C0F9BA0CFFE9924440643BDF4F8D3721C0F9BA0CFFE9924440B1C1C2499A3721C053060E68E99244404B94BDA59C3721C0069D103AE892444097AB1F9BE43721C04033880FEC924440C972124A5F3821C00DAB7823F39244407BC1A739793921C093AAED26F8924440C74CA25EF03921C06C04E275FD92444012D89C83673A21C066136058FE924440C6A86BED7D3A21C08CB96B09F9924440ACAA97DF693A21C0AD510FD1E8924440F99FFCDD3B3A21C0C6151747E59244402DD15966113A21C0206118B0E4924440E04A766C043A21C0B34291EEE792444093E1783E033A21C0069D103AE8924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=575.442..575.443 rows=5 loops=1)"
"  Buffers: shared hit=798 read=25145"
"Planning Time: 0.060 ms"
"Execution Time: 575.480 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.159s
NOTICE:  [Memory Estimation] Candidates: 157, Avg length: 45.3, Max: 50, Min: 40, Total points: 7115
NOTICE:  [Memory Estimation] Approx DTW memory usage: 4.34 MB
NOTICE:  DTW computation time for 157 candidates: 0.421s
NOTICE:  Total UDF execution time: 0.585s

Successfully run. Total query runtime: 601 msec.
5 rows affected.
 */

/* Test Case 3.2: Find top 5 trips most similar to trip ID 1398517670620000151 (Train Station -> Tourist Area at 2pm) with 0-10 point count difference. */
/* Test Case 3.2 with Only apply GiST on polyline, ST_Transform(ST_StartPoint(polyline), 3857) and ST_Transform(ST_EndPoint(polyline), 3857) */
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_StartPoint(polyline), 3857));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_EndPoint(polyline), 3857));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1398517670620000151, 0, 10);

DROP INDEX IF EXISTS idx_polyline_gist;
DROP INDEX IF EXISTS idx_startpoint_gist;
DROP INDEX IF EXISTS idx_endpoint_gist;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1375969345620000594	0.01824138488505521	40	50	14	735	"2013-08-08 14:42:25"	"2013-08-08 14:54:40"	"0102000020E61000003200000093399677D52B21C0D95C35CF1193444079AF5A99F02B21C02CB7B41A12934440923EADA23F2C21C026C632FD12934440446B459BE32C21C0E65B1FD61B9344405DE2C803912D21C033E202D0289344400E83F92B642E21C02C0E677E35934440C05DF6EB4E2F21C0126745D444934440BFEE74E7892F21C09F573CF5489344400CCC0A45BA2F21C08693347F4C934440F20C1AFA273021C06CCF2C095093444025CFF57D383021C02C4833164D9344400AF83592043121C0F277EFA831934440EE5A423EE83121C0000341800C934440EEEBC039233221C0F303577902934440EEEBC039233221C0F303577902934440873254C5543221C00CC85EEFFE924440ED815660C83221C000E65AB4009344409E5C5320B33321C0000341800C9344409DD5027B4C3421C0B9A7AB3B169344409CFC169D2C3521C0A6F10BAF2493444001C0B167CF3521C0B9E177D32D934440E78C28ED0D3621C0132D793C2D934440B4041901153621C07369FCC22B93444033DE567A6D3621C0A60EF27A30934440B309302C7F3621C0A60EF27A3093444000732D5A803621C053B4722F3093444019ABCDFFAB3621C0992CEE3F32934440CC41D0D1AA3621C0923B6C2233934440CC41D0D1AA3621C0E695EB6D33934440CC41D0D1AA3621C08C4AEA043493444019ABCDFFAB3621C0DFA4695034934440325706D5063721C0DF87838428934440B2135E82533721C0C05E61C1FD92444017EFC7ED973721C0CD069964E4924440170CAEB9A33721C0D3F71A82E392444031ED9BFBAB3721C079AC1919E492444017D7F84CF63721C060E811A3E7924440309B00C3F23721C0B933130CE7924440499EEBFB703821C0335184D4ED9244407C65DEAAEB3821C0139CFA40F292444014200A664C3921C006BAF605F4924440946DE00ED43921C019AA622AFD924440C6FA0626373A21C0B96DDFA3FE924440C68B8521723A21C079E6E5B0FB9244402CF3565D873A21C0198D7C5EF192444013471E882C3A21C0C6151747E592444060B01BB62D3A21C0DA740470B392444060B01BB62D3A21C0A0DE8C9AAF92444046EC1340313A21C06D3997E2AA92444046EC1340313A21C06D3997E2AA924440"
1378216365620000041	0.020787531981045753	40	45	14	660	"2013-09-03 14:52:45"	"2013-09-03 15:03:45"	"0102000020E61000002D000000AC1A84B9DD2B21C086E5CFB705934440DFBF7971E22B21C0E04DB7EC10934440DF3312A1112C21C0D95C35CF11934440DE3829CC7B2C21C0CC7A3194139344407715527E522D21C059880E812393444075CDE49B6D2E21C02C0E677E35934440406CE9D1542F21C0B91B446B4593444025CADE52CE2F21C08C84B69C4B93444025CADE52CE2F21C08C84B69C4B9344400B45BA9F533021C0392A37514B934440F08AE07F2B3121C0191EFB592C9344406EA301BC053221C026A94C3107934440D40AD3F71A3221C0EC12D55B03934440EEEBC039233221C0397CD28904934440A0C6BDF90D3321C0397CD28904934440B95510035D3321C026A94C3107934440B95510035D3321C02C9ACE4E06934440D192C7D3F23321C0000341800C934440B64C86E3F93421C0A6D425E318934440CE893DB48F3521C059880E81239344401AE0826C593621C00C3CF71E2E9344407FF5B86FB53621C08C4AEA0434934440FFCEF6E80D3721C013109370219344401898158A743721C00DAB7823F3924440B1C1C2499A3721C0B34291EEE792444097546D37C13721C0E6CAA0DAE0924440C9C9C4AD823821C04D158C4AEA9244409641B5C1893821C0A6608DB3E99244407C7DAD4B8D3821C053060E68E99244409529E620E83821C086AB0320EE924440FA43334FAE3921C0E013EB54F9924440124C35B3963A21C0E013EB54F99244402C62D8614C3A21C00D8E9257E7924440ADDF4C4C173A21C06DAD2F12DA92444046CF2D74253A21C05AA0DD21C5924440C6FA0626373A21C0BADC60A8C3924440C6DD205A2B3A21C006465ED6C492444060B01BB62D3A21C00D37E0F3C3924440799109F8353A21C07364E597C1924440AC36FFAF3A3A21C0C6BE64E3C1924440799109F8353A21C01A19E42EC292444013640454383A21C0BADC60A8C3924440F99FFCDD3B3A21C0ADFA5C6DC5924440C6FA0626373A21C09A27D714C892444060B01BB62D3A21C05AA0DD21C5924440"
1376919686620000678	0.02126056711503235	40	42	14	615	"2013-08-19 14:41:26"	"2013-08-19 14:51:41"	"0102000020E61000002A000000C6FB71FBE52B21C05340DAFF009344409373620FED2B21C0C66CC9AA089344405FEB5223F42B21C033A836381193444078B471C45A2C21C02CB7B41A12934440F775E09C112D21C0793D98141F9344405CE7DF2EFB2D21C0FF59F3E32F934440A7EB89AE0B2F21C02C2B4D4A41934440A59E05A1BC2F21C072C0AE264F93444059350873BB2F21C0CC0BB08F4E9344408BC22E8A1E3021C00C93A982519344400AD6389B8E3021C02C2B4D4A41934440897AC1A7393121C0D3A57F492A934440228C9FC6BD3121C0C689AF7614934440211D1EC2F83121C0A6B73F170D934440EE940ED6FF3121C0B98AC56F0A934440213A048E043221C02C9ACE4E06934440EDD3F198813221C0C64FE3DEFC924440D236FE44653321C07903CC7C07934440B972F6CE683321C020B8CA1308934440D253E410713321C073124A5F089344406ABC7493183421C0E04DB7EC1093444050FD8348863421C06C3EAE0D15934440D0D6C1C1DE3421C0EC4CA1F31A93444082035ABA823521C0FF3C0D18249344409A40118B183621C0795A7EE02A934440B4041901153621C07369FCC22B93444099620E828E3621C046D26EF43193444019C8B3CBB73621C07F68E6C935934440CC5EB69DB63621C0CCD1E3F736934440E5D022DBF93621C06C787AA52C934440984F560C573721C04641F0F8F69244407E39B35DA13721C033349E08E292444031D0B52FA03721C0D9E89C9FE292444030B8E68EFE3721C02D431CEBE292444063D17476323821C0206118B0E492444062F3716DA83821C066D993C0E692444095B54DF1B83821C019709692E5924440E10B93A9823921C000C974E8F4924440132A38BC203A21C0B96DDFA3FE924440450E1137A73A21C0198D7C5EF1924440E0BE0E9C333A21C066D993C0E6924440F9484A7A183A21C02D431CEBE2924440"
1387118746620000273	0.021690078708113663	40	41	14	600	"2013-12-15 14:45:46"	"2013-12-15 14:55:46"	"0102000020E6100000290000002C29779FE32B21C026A94C3107934440C6FB71FBE52B21C0B98AC56F0A934440C6353E93FD2B21C02CB7B41A12934440AB933314772C21C0CC7A3194139344405DC5E237852D21C0D3A57F492A93444074982F2FC02E21C046EF54C03D934440BF620D17B92F21C02657B1F84D93444072A774B0FE2F21C04C1AA375549344408BDF14562A3021C0B9382A375193444058CB9D99603021C09966BAD7499344400989B48D3F3121C0DF878384289344406EC0E787113221C0E030D120059344406E8B321B643221C019AA622AFD92444005A22765523321C0397CD28904934440B8B1D991EA3321C04C6C3EAE0D93444004C93B87323421C07920B24813934440020D36751E3521C0F94B8BFA249344403430F2B2263621C0865968E73493444080812040863621C0CCD1E3F736934440FFB1101D023721C0865968E734934440185E49F25C3721C020B8CA1308934440E466B8019F3721C0938D075BEC9244404B94BDA59C3721C0F9BA0CFFE992444097FDBAD39D3721C053060E68E99244407E9065C1C43721C0069D103AE892444063B9A5D5903821C06DE7FBA9F19244407CD45FAFB03821C0198D7C5EF1924440FCE25295B63821C00DAB7823F39244404969368FC33821C05323F433F59244407BA4C16D6D3921C04641F0F8F69244405F07CE19513A21C04C4F58E201934440C5C551B9893A21C0AC8BDB6800934440F96A47718E3A21C0AC8BDB6800934440AC014A438D3A21C05340DAFF00934440C5C551B9893A21C0A69A594B01934440DFC325C79D3A21C066F6798CF2924440ADFC3218233A21C09370218FE092444093382BA2263A21C093FC885FB192444046B247A8193A21C020D099B4A99244401477BCC96F3921C04D840D4FAF9244401494A2957B3921C0C6DB4AAFCD924440"
1375278524620000542	0.022414689793695063	40	42	14	615	"2013-07-31 14:48:44"	"2013-07-31 14:58:59"	"0102000020E61000002A0000002C0C91D3D72B21C0A0A9D72D02934440C6DE8B2FDA2B21C086E5CFB705934440DFDC5F3DEE2B21C0E04DB7EC109344409204E10A282C21C08011346612934440DE8FDB2F9F2C21C0B3B6291E179344405D86FF74032D21C0DF6A9DB81C934440904DF2237E2D21C03FC4060B27934440DAC534D3BD2E21C09F3A56293D9344403FABCC94D62F21C072C0AE264F934440BEBED6A5463021C03239B5334C934440F0F96184F03021C0ACFF73982F9344406FD8B628B33121C0E04DB7EC1093444021AE9CBD333221C013B9E00CFE92444053AF5B04C63221C00CC85EEFFE9244406C09F9A0673321C02C9ACE4E06934440EBC5504EB43321C013D6C6D80993444051A1BAB9F83321C0E63E390A10934440693524EEB13421C09FE3A3C5199344400281CEA44D3521C0B9C49107229344401BBE8575E33521C0191EFB592C934440CDC82077113621C06C787AA52C934440CD1FD3DA343621C06687F8872D93444066BD18CA893621C08C4AEA0434934440809E060C923621C0D9B3E7323593444066DAFE95953621C0865968E73493444080D8D2A3A93621C07F68E6C935934440E544BB0A293721C0A69A594B01934440CB4BFE277F3721C0F9BA0CFFE9924440643BDF4F8D3721C0F9BA0CFFE9924440B1C1C2499A3721C053060E68E99244404B94BDA59C3721C0069D103AE892444097AB1F9BE43721C04033880FEC924440C972124A5F3821C00DAB7823F39244407BC1A739793921C093AAED26F8924440C74CA25EF03921C06C04E275FD92444012D89C83673A21C066136058FE924440C6A86BED7D3A21C08CB96B09F9924440ACAA97DF693A21C0AD510FD1E8924440F99FFCDD3B3A21C0C6151747E59244402DD15966113A21C0206118B0E4924440E04A766C043A21C0B34291EEE792444093E1783E033A21C0069D103AE8924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=761.837..761.838 rows=5 loops=1)"
"  Buffers: shared hit=23134 read=260431"
"Planning Time: 0.074 ms"
"Execution Time: 761.882 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.136s
NOTICE:  [Memory Estimation] Candidates: 157, Avg length: 45.3, Max: 50, Min: 40, Total points: 7115
NOTICE:  [Memory Estimation] Approx DTW memory usage: 4.34 MB
NOTICE:  DTW computation time for 157 candidates: 0.431s
NOTICE:  Total UDF execution time: 0.866s

Successfully run. Total query runtime: 887 msec.
5 rows affected.
 */

/* Test Case 3.2: Find top 5 trips most similar to trip ID 1398517670620000151 (Train Station -> Tourist Area at 2pm) with 0-10 point count difference. */
/* Test Case 3.2 with Both B-tree and GiST will be applied on attributes mentioned in index method 1 & 2 */
CREATE INDEX idx_trip_id ON taxi_trajectory (trip_id);
CREATE INDEX idx_hour_of_day ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_point_count ON taxi_trajectory (point_count);
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_StartPoint(polyline), 3857));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_EndPoint(polyline), 3857));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1398517670620000151, 0, 10);

DROP INDEX IF EXISTS idx_trip_id;
DROP INDEX IF EXISTS idx_hour_of_day;
DROP INDEX IF EXISTS idx_point_count;
DROP INDEX IF EXISTS idx_polyline_gist;
DROP INDEX IF EXISTS idx_startpoint_gist;
DROP INDEX IF EXISTS idx_endpoint_gist;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1375969345620000594	0.01824138488505521	40	50	14	735	"2013-08-08 14:42:25"	"2013-08-08 14:54:40"	"0102000020E61000003200000093399677D52B21C0D95C35CF1193444079AF5A99F02B21C02CB7B41A12934440923EADA23F2C21C026C632FD12934440446B459BE32C21C0E65B1FD61B9344405DE2C803912D21C033E202D0289344400E83F92B642E21C02C0E677E35934440C05DF6EB4E2F21C0126745D444934440BFEE74E7892F21C09F573CF5489344400CCC0A45BA2F21C08693347F4C934440F20C1AFA273021C06CCF2C095093444025CFF57D383021C02C4833164D9344400AF83592043121C0F277EFA831934440EE5A423EE83121C0000341800C934440EEEBC039233221C0F303577902934440EEEBC039233221C0F303577902934440873254C5543221C00CC85EEFFE924440ED815660C83221C000E65AB4009344409E5C5320B33321C0000341800C9344409DD5027B4C3421C0B9A7AB3B169344409CFC169D2C3521C0A6F10BAF2493444001C0B167CF3521C0B9E177D32D934440E78C28ED0D3621C0132D793C2D934440B4041901153621C07369FCC22B93444033DE567A6D3621C0A60EF27A30934440B309302C7F3621C0A60EF27A3093444000732D5A803621C053B4722F3093444019ABCDFFAB3621C0992CEE3F32934440CC41D0D1AA3621C0923B6C2233934440CC41D0D1AA3621C0E695EB6D33934440CC41D0D1AA3621C08C4AEA043493444019ABCDFFAB3621C0DFA4695034934440325706D5063721C0DF87838428934440B2135E82533721C0C05E61C1FD92444017EFC7ED973721C0CD069964E4924440170CAEB9A33721C0D3F71A82E392444031ED9BFBAB3721C079AC1919E492444017D7F84CF63721C060E811A3E7924440309B00C3F23721C0B933130CE7924440499EEBFB703821C0335184D4ED9244407C65DEAAEB3821C0139CFA40F292444014200A664C3921C006BAF605F4924440946DE00ED43921C019AA622AFD924440C6FA0626373A21C0B96DDFA3FE924440C68B8521723A21C079E6E5B0FB9244402CF3565D873A21C0198D7C5EF192444013471E882C3A21C0C6151747E592444060B01BB62D3A21C0DA740470B392444060B01BB62D3A21C0A0DE8C9AAF92444046EC1340313A21C06D3997E2AA92444046EC1340313A21C06D3997E2AA924440"
1378216365620000041	0.020787531981045753	40	45	14	660	"2013-09-03 14:52:45"	"2013-09-03 15:03:45"	"0102000020E61000002D000000AC1A84B9DD2B21C086E5CFB705934440DFBF7971E22B21C0E04DB7EC10934440DF3312A1112C21C0D95C35CF11934440DE3829CC7B2C21C0CC7A3194139344407715527E522D21C059880E812393444075CDE49B6D2E21C02C0E677E35934440406CE9D1542F21C0B91B446B4593444025CADE52CE2F21C08C84B69C4B93444025CADE52CE2F21C08C84B69C4B9344400B45BA9F533021C0392A37514B934440F08AE07F2B3121C0191EFB592C9344406EA301BC053221C026A94C3107934440D40AD3F71A3221C0EC12D55B03934440EEEBC039233221C0397CD28904934440A0C6BDF90D3321C0397CD28904934440B95510035D3321C026A94C3107934440B95510035D3321C02C9ACE4E06934440D192C7D3F23321C0000341800C934440B64C86E3F93421C0A6D425E318934440CE893DB48F3521C059880E81239344401AE0826C593621C00C3CF71E2E9344407FF5B86FB53621C08C4AEA0434934440FFCEF6E80D3721C013109370219344401898158A743721C00DAB7823F3924440B1C1C2499A3721C0B34291EEE792444097546D37C13721C0E6CAA0DAE0924440C9C9C4AD823821C04D158C4AEA9244409641B5C1893821C0A6608DB3E99244407C7DAD4B8D3821C053060E68E99244409529E620E83821C086AB0320EE924440FA43334FAE3921C0E013EB54F9924440124C35B3963A21C0E013EB54F99244402C62D8614C3A21C00D8E9257E7924440ADDF4C4C173A21C06DAD2F12DA92444046CF2D74253A21C05AA0DD21C5924440C6FA0626373A21C0BADC60A8C3924440C6DD205A2B3A21C006465ED6C492444060B01BB62D3A21C00D37E0F3C3924440799109F8353A21C07364E597C1924440AC36FFAF3A3A21C0C6BE64E3C1924440799109F8353A21C01A19E42EC292444013640454383A21C0BADC60A8C3924440F99FFCDD3B3A21C0ADFA5C6DC5924440C6FA0626373A21C09A27D714C892444060B01BB62D3A21C05AA0DD21C5924440"
1376919686620000678	0.02126056711503235	40	42	14	615	"2013-08-19 14:41:26"	"2013-08-19 14:51:41"	"0102000020E61000002A000000C6FB71FBE52B21C05340DAFF009344409373620FED2B21C0C66CC9AA089344405FEB5223F42B21C033A836381193444078B471C45A2C21C02CB7B41A12934440F775E09C112D21C0793D98141F9344405CE7DF2EFB2D21C0FF59F3E32F934440A7EB89AE0B2F21C02C2B4D4A41934440A59E05A1BC2F21C072C0AE264F93444059350873BB2F21C0CC0BB08F4E9344408BC22E8A1E3021C00C93A982519344400AD6389B8E3021C02C2B4D4A41934440897AC1A7393121C0D3A57F492A934440228C9FC6BD3121C0C689AF7614934440211D1EC2F83121C0A6B73F170D934440EE940ED6FF3121C0B98AC56F0A934440213A048E043221C02C9ACE4E06934440EDD3F198813221C0C64FE3DEFC924440D236FE44653321C07903CC7C07934440B972F6CE683321C020B8CA1308934440D253E410713321C073124A5F089344406ABC7493183421C0E04DB7EC1093444050FD8348863421C06C3EAE0D15934440D0D6C1C1DE3421C0EC4CA1F31A93444082035ABA823521C0FF3C0D18249344409A40118B183621C0795A7EE02A934440B4041901153621C07369FCC22B93444099620E828E3621C046D26EF43193444019C8B3CBB73621C07F68E6C935934440CC5EB69DB63621C0CCD1E3F736934440E5D022DBF93621C06C787AA52C934440984F560C573721C04641F0F8F69244407E39B35DA13721C033349E08E292444031D0B52FA03721C0D9E89C9FE292444030B8E68EFE3721C02D431CEBE292444063D17476323821C0206118B0E492444062F3716DA83821C066D993C0E692444095B54DF1B83821C019709692E5924440E10B93A9823921C000C974E8F4924440132A38BC203A21C0B96DDFA3FE924440450E1137A73A21C0198D7C5EF1924440E0BE0E9C333A21C066D993C0E6924440F9484A7A183A21C02D431CEBE2924440"
1387118746620000273	0.021690078708113663	40	41	14	600	"2013-12-15 14:45:46"	"2013-12-15 14:55:46"	"0102000020E6100000290000002C29779FE32B21C026A94C3107934440C6FB71FBE52B21C0B98AC56F0A934440C6353E93FD2B21C02CB7B41A12934440AB933314772C21C0CC7A3194139344405DC5E237852D21C0D3A57F492A93444074982F2FC02E21C046EF54C03D934440BF620D17B92F21C02657B1F84D93444072A774B0FE2F21C04C1AA375549344408BDF14562A3021C0B9382A375193444058CB9D99603021C09966BAD7499344400989B48D3F3121C0DF878384289344406EC0E787113221C0E030D120059344406E8B321B643221C019AA622AFD92444005A22765523321C0397CD28904934440B8B1D991EA3321C04C6C3EAE0D93444004C93B87323421C07920B24813934440020D36751E3521C0F94B8BFA249344403430F2B2263621C0865968E73493444080812040863621C0CCD1E3F736934440FFB1101D023721C0865968E734934440185E49F25C3721C020B8CA1308934440E466B8019F3721C0938D075BEC9244404B94BDA59C3721C0F9BA0CFFE992444097FDBAD39D3721C053060E68E99244407E9065C1C43721C0069D103AE892444063B9A5D5903821C06DE7FBA9F19244407CD45FAFB03821C0198D7C5EF1924440FCE25295B63821C00DAB7823F39244404969368FC33821C05323F433F59244407BA4C16D6D3921C04641F0F8F69244405F07CE19513A21C04C4F58E201934440C5C551B9893A21C0AC8BDB6800934440F96A47718E3A21C0AC8BDB6800934440AC014A438D3A21C05340DAFF00934440C5C551B9893A21C0A69A594B01934440DFC325C79D3A21C066F6798CF2924440ADFC3218233A21C09370218FE092444093382BA2263A21C093FC885FB192444046B247A8193A21C020D099B4A99244401477BCC96F3921C04D840D4FAF9244401494A2957B3921C0C6DB4AAFCD924440"
1375278524620000542	0.022414689793695063	40	42	14	615	"2013-07-31 14:48:44"	"2013-07-31 14:58:59"	"0102000020E61000002A0000002C0C91D3D72B21C0A0A9D72D02934440C6DE8B2FDA2B21C086E5CFB705934440DFDC5F3DEE2B21C0E04DB7EC109344409204E10A282C21C08011346612934440DE8FDB2F9F2C21C0B3B6291E179344405D86FF74032D21C0DF6A9DB81C934440904DF2237E2D21C03FC4060B27934440DAC534D3BD2E21C09F3A56293D9344403FABCC94D62F21C072C0AE264F934440BEBED6A5463021C03239B5334C934440F0F96184F03021C0ACFF73982F9344406FD8B628B33121C0E04DB7EC1093444021AE9CBD333221C013B9E00CFE92444053AF5B04C63221C00CC85EEFFE9244406C09F9A0673321C02C9ACE4E06934440EBC5504EB43321C013D6C6D80993444051A1BAB9F83321C0E63E390A10934440693524EEB13421C09FE3A3C5199344400281CEA44D3521C0B9C49107229344401BBE8575E33521C0191EFB592C934440CDC82077113621C06C787AA52C934440CD1FD3DA343621C06687F8872D93444066BD18CA893621C08C4AEA0434934440809E060C923621C0D9B3E7323593444066DAFE95953621C0865968E73493444080D8D2A3A93621C07F68E6C935934440E544BB0A293721C0A69A594B01934440CB4BFE277F3721C0F9BA0CFFE9924440643BDF4F8D3721C0F9BA0CFFE9924440B1C1C2499A3721C053060E68E99244404B94BDA59C3721C0069D103AE892444097AB1F9BE43721C04033880FEC924440C972124A5F3821C00DAB7823F39244407BC1A739793921C093AAED26F8924440C74CA25EF03921C06C04E275FD92444012D89C83673A21C066136058FE924440C6A86BED7D3A21C08CB96B09F9924440ACAA97DF693A21C0AD510FD1E8924440F99FFCDD3B3A21C0C6151747E59244402DD15966113A21C0206118B0E4924440E04A766C043A21C0B34291EEE792444093E1783E033A21C0069D103AE8924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=557.304..557.305 rows=5 loops=1)"
"  Buffers: shared hit=1212 read=16357"
"Planning Time: 0.106 ms"
"Execution Time: 557.356 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.150s
NOTICE:  [Memory Estimation] Candidates: 157, Avg length: 45.3, Max: 50, Min: 40, Total points: 7115
NOTICE:  [Memory Estimation] Approx DTW memory usage: 4.34 MB
NOTICE:  DTW computation time for 157 candidates: 0.439s
NOTICE:  Total UDF execution time: 0.593s

Successfully run. Total query runtime: 611 msec.
5 rows affected.
 */


/* Test Case 3.3: Find top 5 trips most similar to trip ID 1385464940620000152 (Football field -> Hospital at 11am) with no limit (set 99999 as max) point count difference. */
/* Test Case 3.3 with Only apply B-tree on trip_id, hour_of_day and point_count */
CREATE INDEX idx_trip_id ON taxi_trajectory (trip_id);
CREATE INDEX idx_hour_of_day ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_point_count ON taxi_trajectory (point_count);

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1385464940620000152, 0, 99999);

DROP INDEX IF EXISTS idx_trip_id;
DROP INDEX IF EXISTS idx_hour_of_day;
DROP INDEX IF EXISTS idx_point_count;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1386327623620000077	0.04873699560840406	65	103	11	1530	"2013-12-06 11:00:23"	"2013-12-06 11:25:53"	"0102000020E61000006700000061FE0A992B2B21C0096D3997E29444407A19C5724B2B21C07C7C4276DE944440DF6DDE38292C21C04303B16CE69444409065C1C41F2D21C063F20698F9944440AA9D616A4B2D21C0F6D37FD6FC94444010CB660E492D21C0A379008BFC944440C36169E0472D21C04F1F813FFC944440C36169E0472D21C04F1F813FFC944440F7065F984C2D21C0F6D37FD6FC9444402A0307B4742D21C0DC0F7860009544402A0307B4742D21C089B5F814009544402A0307B4742D21C089B5F81400954440766C04E2752D21C0DC0F78600095444042AF3F89CF2D21C0BC5AEECC04954440DC813AE5D12D21C0BC5AEECC049544400FB8AE98112E21C043209738F2944440F415A4198B2E21C096236420CF94444027FA7C94112F21C05645B8C9A894444072DC291DAC2F21C003B16CE690944440573F36C98F3021C0AA656B7D91944440D5CBEF34993121C010B056ED9A944440EEEBC039233221C0F0FACC599F94444053AF5B04C63221C023A0C211A494444085CD0017643321C0DD274701A294444038F581E49D3321C0EAB298D87C9444401E6B4606B93321C04AD235936F94444005E10A28D43321C0842EE1D05B944440D1CC936B0A3421C06A1327F73B9444401E8D43FD2E3421C02461DF4E22944440B7B6F0BC543421C017450F7C0C94444083A279008B3421C05E66D828EB934440E9D495CFF23421C0F8E12021CA934440E89FE062453521C085D21742CE9344409B70AFCC5B3521C07EE19524CF934440014C1938A03521C0FEB5BC72BD934440CE548847E23521C09E3F6D54A793444099F38C7DC93621C0EBA86A82A8934440E4DA5031CE3721C0381268B0A9934440965984622B3821C0857B65DEAA934440B01D8CD8273821C0D8D5E429AB934440164B917C253821C07E8AE3C0AB93444030833122513821C0EBA86A82A8934440FDFA2136583821C06552431B80934440AF05BD37863821C0D9278062649344402FA52E19C73821C01F49490F439344409529E620E83821C0FF59F3E32F9344401555BFD2F93821C01FF296AB1F93444015C95702293921C00611A969179344407BD976DA1A3921C0664D2CF01593444095D74AE82E3921C0BF982D591593444095F430B43A3921C0C689AF7614934440FB3E1C24443921C026C632FD12934440FB3E1C24443921C02CB7B41A129344402EE411DC483921C08602B68311934440FB5B02F04F3921C08CF337A1109344402E01F8A7543921C0467BBC900E93444048E2E5E95C3921C0408A3A730F934440AE0FEB8D5A3921C093E4B9BE0F934440E197FA79533921C0EC2FBB270F934440E1B4E0455F3921C0F3203D450E934440145AD6FD633921C04C6C3EAE0D934440C7F0D8CF623921C0F911BF620D9344402E1EDE73603921C0F911BF620D9344402E1EDE73603921C0F911BF620D9344407B87DBA1613921C0F911BF620D934440FB95CE87673921C080F44D9A069344402E3BC43F6C3921C0EC12D55B039344407BA4C16D6D3921C0465ED6C402934440C70DBF9B6E3921C0465ED6C402934440FBB2B453733921C079E6E5B0FB924440C7478B33863921C0F9D7F2CAF5924440FAEC80EB8A3921C0F3E670ADF6924440AE8383BD893921C0999B6F44F7924440618E1EBFB73921C0D9226937FA924440946DE00ED43921C080D767CEFA9244407AA9D898D73921C02C7DE882FA92444060E5D022DB3921C080D767CEFA924440F9484A7A183A21C0209BE447FC924440ACC77DAB753A21C079E6E5B0FB924440F9307BD9763A21C0C64FE3DEFC924440F9307BD9763A21C073F56393FC924440469A7807783A21C0209BE447FC92444079793A57943A21C0D9226937FA9244402C4A09C1AA3A21C0938D075BEC924440C51C041DAD3A21C0EDD808C4EB924440C51C041DAD3A21C04033880FEC9244404582A966D63A21C0008FA850DD9244402BBEA1F0D93A21C060CB2BD7DB9244402BBEA1F0D93A21C006802A6EDC924440DE54A4C2D83A21C059DAA9B9DC924440C5909C4CDC3A21C0B9162D40DB92444011A8FE41243B21C0739EB12FD992444044DE72F5633B21C06DAD2F12DA9244405D6DC5FEB23B21C0D3DA34B6D7924440C3482F6AF73B21C0C6F8307BD9924440DC291DACFF3B21C0204432E4D8924440C382FB010F3C21C07A8F334DD89244408F6E8445453C21C0DACBB6D3D69244408FC536A9683C21C0739EB12FD9924440A9893E1F653C21C06DAD2F12DA924440A9893E1F653C21C0C007AF5DDA924440F5F23B4D663C21C01A53B0C6D9924440F5F23B4D663C21C0C6F8307BD9924440"
1396261081620000458	0.04910619807741667	65	65	11	960	"2014-03-31 11:18:01"	"2014-03-31 11:34:01"	"0102000020E610000041000000E129E44A3D2B21C0768BC058DF944440DF3312A1112C21C0A930B610E49444402B685A62652C21C0234E27D9EA944440DFFE5C34642C21C07C992842EA944440C43F6CE9D12C21C0967A1684F2944440C30FCEA78E2D21C0C93CF20703954440293DD34B8C2D21C0C24B70EA0395444076A6D0798D2D21C016A6EF3504954440906AD8EF892D21C06FF1F09E039544405C7347FFCB2D21C0620FED630595444076711B0DE02D21C02F6AF7AB00954440295FD042022E21C0C91F0C3CF7944440DB34B6D7822E21C030F65E7CD19444400DFCA886FD2E21C083F92B64AE944440F2B56796043021C02366F6798C94444022FB20CB823121C0D0285DFA97944440A1BC8FA3393221C0AA8251499D944440A1BC8FA3393221C0FDDCD0949D944440EE258DD13A3221C0FDDCD0949D944440215C01857A3221C03D64CA87A094444039B69E211C3321C016BEBED6A59444401FA0FB72663321C0C3633F8BA5944440384C3448C13321C0172D40DB6A9444401E537765173421C0B75F3E5931944440842EE1D05B3421C037FA980F08944440B72A89EC833421C0F838D384ED9344409DBD33DAAA3421C098C28366D7934440B6813B50A73421C04568041BD7934440E94317D4B73421C0E50E9BC8CC9344400281CEA44D3521C0317898F6CD93444068791EDC9D3521C08BC3995FCD9344401B2D077AA83521C0925D6919A9934440E622BE13B33621C0EBA86A82A893444017BA1281EA3721C0E5B7E864A99344407D789620233821C0D2E4620CAC934440E3A59BC4203821C0D2E4620CAC934440C9552C7E533821C005508C2C99934440C972124A5F3821C01FBDE13E7293444095D233BDC43821C0ECC039234A9344402FC214E5D23821C079944A784293444094111780463921C052D158FB3B934440471CB281743921C0AC1C5A643B934440605969520A3A21C03FE1ECD63293444093ACC3D1553A21C0992CEE3F32934440DF6C73637A3A21C020D5B0DF139344401212691B7F3A21C08602B683119344401212691B7F3A21C080113466129344401212691B7F3A21C026C632FD129344405F7B6649803A21C026C632FD129344401212691B7F3A21C08011346612934440793F6EBF7C3A21C0D36BB3B112934440C6A86BED7D3A21C02CB7B41A12934440C6A86BED7D3A21C08602B6831193444045B75ED3833A21C04C6C3EAE0D934440795C548B883A21C093C7D3F20393444078EDD286C33A21C0E6CAA0DAE0924440C5909C4CDC3A21C01A53B0C6D9924440789B374E0A3B21C02635B401D89244402AE09EE74F3B21C06DAD2F12DA924440111C9771533B21C06DAD2F12DA9244405E85949F543B21C01A53B0C6D9924440DE9387855A3B21C01A53B0C6D9924440F705F4C29D3B21C03A083A5AD5924440C39FE1CD1A3C21C02635B401D89244400F09DFFB1B3C21C07A8F334DD8924440"
1374746530620000233	0.06692773162239422	65	71	11	1050	"2013-07-25 11:02:10"	"2013-07-25 11:19:40"	"0102000020E61000004700000094A30051302B21C0C3F4BD86E0944440C6302768932B21C0904FC8CEDB94444092EC116A862C21C00F7BA180ED9444405D8B16A06D2D21C0DC0F786000954440F697DD93872D21C01C97715303954440F697DD93872D21C0C93CF20703954440906AD8EF892D21C02288F37002954440DC813AE5D12D21C0C93CF20703954440F6622827DA2D21C02F6AF7AB0095444029081EDFDE2D21C0E200FA7DFF9444404145D5AF742E21C023145B41D394444026512FF8342F21C05628D2FD9C944440D8F15F20083021C0D00B772E8C944440560F98874C3121C0D619DF1797944440BC24CE8AA83121C0C34659BF99944440A06F0B96EA3221C0C3633F8BA59444406C43C5387F3321C076DD5B91989444406B0E10CCD13321C017105A0F5F944440B7990AF1483421C0E4D9E55B1F9444409DA04D0E9F3421C011FDDAFAE993444050C8CEDBD83421C03E5A9C31CC9344404E5E64027E3521C0259694BBCF9344409B1E1494A23521C071E2AB1DC5934440E7525C55F63521C0984EEB36A8934440666B7D91D03621C0FE7BF0DAA593444018EAB0C22D3721C0984EEB36A8934440FEF0F3DF833721C0925D6919A99344409702D2FE073821C0F299EC9FA79344404AB6BA9C123821C0E5B7E864A99344407D5BB054173821C08B6CE7FBA99344404AD3A0681E3821C0D2E4620CAC9344404AD3A0681E3821C05ED5592DB09344407DEC2E50523821C0AB21718FA5934440FDFA2136583821C0ACADD85F7693444096CD1C925A3821C00CEA5BE674934440FC170802643821C04563EDEF6C934440FBE769C0203921C0E6CFB7054B934440E162450DA63921C052D158FB3B93444013BBB6B75B3A21C03FE1ECD63293444079793A57943A21C0A0C6BDF90D934440925A28999C3A21C013B9E00CFE924440DFC325C79D3A21C06C04E275FD924440124C35B3963A21C0C05E61C1FD9244402C103D29933A21C079E6E5B0FB9244405F46B1DCD23A21C06DCA15DEE5924440DE54A4C2D83A21C0C6151747E5924440DE718A8EE43A21C0D3F71A82E3924440446ADAC5343B21C059DAA9B9DC924440AA622AFD843B21C0739EB12FD9924440DD5ED218AD3B21C08080B56AD792444076887FD8D23B21C0204432E4D892444076DF313CF63B21C0C6F8307BD99244405C1B2AC6F93B21C01A53B0C6D99244408F17D2E1213C21C01A53B0C6D99244408FC536A9683C21C0008FA850DD924440A8A624EB703C21C06DCA15DEE5924440DC4B1AA3753C21C0938D075BEC9244400F2BDCF2913C21C02C7DE882FA924440C1A90F24EF3C21C0E621533E04934440F4DF83D72E3D21C0A69A594B01934440C15774EB353D21C013B9E00CFE92444041834D9D473D21C0395FECBDF8924440A7B05241453D21C093AAED26F8924440F3AACE6A813D21C0F9BA0CFFE99244408DB7955E9B3D21C09961A3ACDF924440A67B9DD4973D21C0A05225CADE9244405A12A0A6963D21C0A643A7E7DD924440F3E49A02993D21C08D62B9A5D5924440DAACFA5C6D3D21C0DAAED007CB92444040DAFF006B3D21C0865451BCCA924440DAACFA5C6D3D21C033FAD170CA924440"
1390305251620000053	0.12509431872110693	65	116	11	1725	"2014-01-21 11:54:11"	"2014-01-21 12:22:56"	"0102000020E61000007400000014950D6B2A2B21C0C3F4BD86E0944440C72B103D292B21C0BC033C69E19444402D93E1783E2B21C02331410DDF94444013656F29E72B21C0709A3E3BE094444011001C7BF62C21C0295C8FC2F5944440C3B81B446B2D21C0365B79C9FF94444076FD82DDB02D21C00FB56D1805954440F6622827DA2D21C07CD3F4D901954440C24EB16A102E21C0E9D495CFF29444408EE89E758D2E21C0E38C614ED09444408D4468041B2F21C0C3633F8BA59444400CCC0A45BA2F21C01684F23E8E944440713D0AD7A33021C0AA656B7D919444400932022A1C3121C03656629E95944440889CBE9EAF3121C016A1D80A9A944440EE258DD13A3221C0503750E09D944440863C821B293321C0CA54C1A8A49444401F49490F433321C0C3633F8BA5944440D2FC31AD4D3321C076FA415DA4944440B972F6CE683321C023A0C211A494444052F355F2B13321C0371C96067E944440058A58C4B03321C070952710769444401EC2F869DC3321C0A4E36A64579444409E44847F113421C0D731AEB8389444400420EEEA553421C0047289230F9444401DAF40F4A43421C018D1764CDD93444003081F4AB43421C071FF91E9D09344403621AD31E83421C04B3CA06CCA93444002F566D47C3521C07EE19524CF9344401B1021AE9C3521C09E961FB8CA9344404EEFE2FDB83521C0984EEB36A89344401A89D008363621C0A530EF71A6934440992842EA763621C058C7F143A593444066BD18CA893621C04C8E3BA583934440198EE733A03621C06552431B809344407FF5B86FB53621C07825C9737D934440FF774485EA3621C0396403E962934440338CBB41B43621C0B9382A3751934440B2D47ABFD13621C03FFED2A23E93444099840B79043721C033E202D028934440E544BB0A293721C033A83638119344404BAC8C463E3721C00CE544BB0A934440B2F677B6473721C099B8551003934440CB113290673721C0F9D7F2CAF59244404ACE893DB43721C09370218FE0924440309B00C3F23721C0D9E89C9FE2924440B05758703F3821C0B933130CE7924440967B8159A13821C086AB0320EE9244402FA52E19C73821C0AD6EF59CF4924440FCFF3861C23821C05323F433F5924440AF963B33C13821C05323F433F5924440FCFF3861C23821C05323F433F592444095D233BDC43821C05323F433F59244402FA52E19C73821C000C974E8F4924440624A24D1CB3821C000C974E8F4924440AFB321FFCC3821C0AD6EF59CF4924440AFB321FFCC3821C0AD6EF59CF492444049861C5BCF3821C0AD6EF59CF49244402FC214E5D23821C006BAF605F4924440E25817B7D13821C00DAB7823F392444095EF1989D03821C06005F86EF392444095EF1989D03821C06005F86EF3924440C8940F41D53821C06005F86EF392444062670A9DD73821C06005F86EF392444062670A9DD73821C06005F86EF392444062670A9DD73821C0B35F77BAF3924440950C0055DC3821C06005F86EF3924440E275FD82DD3821C00DAB7823F392444048A30227DB3821C00DAB7823F3924440FC3905F9D93821C00DAB7823F3924440AFD007CBD83821C06005F86EF3924440950C0055DC3821C06005F86EF39244407C48F8DEDF3821C06005F86EF39244407C48F8DEDF3821C00DAB7823F39244407C48F8DEDF3821C00DAB7823F39244407C48F8DEDF3821C00DAB7823F39244402FDFFAB0DE3821C06005F86EF39244402FDFFAB0DE3821C00DAB7823F3924440E275FD82DD3821C00DAB7823F3924440E275FD82DD3821C06005F86EF3924440E275FD82DD3821C006BAF605F4924440C8B1F50CE13821C0AD6EF59CF49244409529E620E83821C05323F433F592444048C0E8F2E63821C05323F433F5924440AFEDED96E43821C05323F433F59244407C48F8DEDF3821C000C974E8F4924440950C0055DC3821C0AD6EF59CF4924440C8B1F50CE13821C059147651F4924440C8B1F50CE13821C059147651F4924440950C0055DC3821C0AD6EF59CF492444048A30227DB3821C0AD6EF59CF4924440950C0055DC3821C000C974E8F492444062670A9DD73821C000C974E8F4924440AFD007CBD83821C0F9D7F2CAF5924440AF963B33C13821C0406D54A703934440E38DCC237F3821C0B9A7AB3B1693444016F9F5436C3821C06C3EAE0D159344407DB262B83A3821C0CC5D4BC807934440CA332F87DD3721C06005F86EF39244404B94BDA59C3721C066D993C0E6924440CAA7C7B60C3821C0C0249529E69244401650A8A78F3821C0F3C98AE1EA924440C8CEDBD8EC3821C0394206F2EC924440FA0967B7963921C05323F433F59244402716F88A6E3D21C0EDD808C4EB9244400DC68844A13D21C03317B83CD6924440C022BF7E883D21C086376BF0BE92444073B9C150873D21C040BFEFDFBC924440F4DF83D72E3D21C0D3838252B49244404227840EBA3C21C00D1AFA27B8924440751E15FF773C21C04DA1F31ABB924440C2D9AD65323C21C0ADC090D5AD924440A98427F4FA3B21C0A7785C548B9244402AE09EE74F3B21C087E0B88C9B924440DFC325C79D3A21C0605793A7AC9244407905A227653A21C06765FB90B7924440"
1377857809620000458	0.1811634659993304	65	80	11	1185	"2013-08-30 11:16:49"	"2013-08-30 11:36:34"	"0102000020E6100000500000002FE065868D2A21C0E92B4833169544407C2C7DE8822A21C09CC24A051595444015FF7744852A21C002F04FA91295444015A8C5E0612A21C03C69E1B20A954440151C5E10912A21C08FFD2C9622954440FDA4DAA7E32921C07C478D093195444062BF27D6A92A21C0E257ACE122954440FAB836548C2B21C01CD13DEB1A954440DEACC1FBAA2C21C075560BEC3195444090D959F44E2D21C0E29178793A954440F7065F984C2D21C0280AF4893C954440F7065F984C2D21C01C28F04E3E9544405D34643C4A2D21C0BCEB6CC83F954440AA9D616A4B2D21C062A06B5F40954440C3D50110772D21C01C28F04E3E954440DC476E4DBA2D21C0B686527B11954440761A69A9BC2D21C07CF0DAA50D9544400F61FC34EE2D21C0A379008BFC9444404128EFE3682E21C056B950F9D794444040F850A2252F21C083DC4598A2944440F2D24D62103021C0C32973F38D94444009E066F1623121C01D925A28999444406DCA15DEE53221C0C3633F8BA59444409DF2E846583421C089EAAD81AD94444082C476F7003521C0A9BC1DE1B4944440B64C86E3F93421C056629E95B49444409CFC169D2C3521C09DDA19A6B6944440CD02ED0E293621C010070951BE944440FE99417C603721C01615713AC994444017F4DE18023821C0B6BB07E8BE9444406397A8DE1A3821C029AE2AFBAE9444407D5BB054173821C07D08AA46AF944440B05758703F3821C09D836742939444407DCF4884463821C06ADE718A8E94444096B036C64E3821C00A4B3CA06C94444049641F64593821C0919C4CDC2A94444016DC0F78603821C09E44847F1194444030A017EE5C3821C01EA5129ED0934440C9552C7E533821C05F61C1FD80934440C9ACDEE1763821C0593673486A934440AF5C6F9BA93821C039471D1D57934440622D3E05C03821C0FFB0A547539344407ADE8D05853921C02C2B4D4A41934440132A38BC203A21C01F2C634337934440C634D3BD4E3A21C00C3CF71E2E934440DF4F8D976E3A21C0B3B6291E1793444092037635793A21C0594E42E90B934440C5C551B9893A21C06C21C84109934440F96A47718E3A21C0338B506C059344402C103D29933A21C08CD651D504934440DFA63FFB913A21C0406D54A703934440923D42CD903A21C0F9F4D89601934440F8DEDFA0BD3A21C02D431CEBE2924440AB92C83EC83A21C0F3ACA415DF9244404565C39ACA3A21C053E9279CDD924440F8359204E13A21C0D3DA34B6D7924440DE76A1B94E3B21C0CDE9B298D8924440C32B499EEB3B21C01A53B0C6D99244407670B037313C21C0DACBB6D3D69244407670B037313C21C03317B83CD69244405CACA8C1343C21C0E0BC38F1D5924440DC114E0B5E3C21C0FA804067D2924440A94F72874D3C21C00055DCB8C59244405CE674594C3C21C053AF5B04C6924440A94F72874D3C21C053AF5B04C69244405CE674594C3C21C0A609DB4FC6924440F69B89E9423C21C093196F2BBD92444029CDE671183C21C007D2C5A6959244401021AE9CBD3B21C0FAD2DB9F8B924440DEE522BE133B21C0BA85AE44A0924440118B1876183B21C0B4942C27A1924440C4211B48173B21C05A492BBEA1924440C4211B48173B21C05A492BBEA192444078B81D1A163B21C0603AADDBA09244402B4F20EC143B21C00DE02D90A0924440DEE522BE133B21C00DE02D90A0924440DEE522BE133B21C00DE02D90A09244402B4F20EC143B21C00DE02D90A0924440118B1876183B21C007EFAB72A1924440118B1876183B21C0B4942C27A1924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=267.570..267.570 rows=5 loops=1)"
"  Buffers: shared hit=1431 read=31161"
"Planning Time: 0.077 ms"
"Execution Time: 267.614 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.211s
NOTICE:  [Memory Estimation] Candidates: 10, Avg length: 84.9, Max: 116, Min: 65, Total points: 849
NOTICE:  [Memory Estimation] Approx DTW memory usage: 0.84 MB
NOTICE:  DTW computation time for 10 candidates: 0.048s
NOTICE:  Total UDF execution time: 0.260s

Successfully run. Total query runtime: 278 msec.
5 rows affected.
 */

/* Test Case 3.3: Find top 5 trips most similar to trip ID 1385464940620000152 (Football field -> Hospital at 11am) with no limit (set 99999 as max) point count difference. */
/* Test Case 3.3 with Only apply GiST on polyline, ST_Transform(ST_StartPoint(polyline), 3857) and ST_Transform(ST_EndPoint(polyline), 3857) */
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_StartPoint(polyline), 3857));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_EndPoint(polyline), 3857));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1385464940620000152, 0, 99999);

DROP INDEX IF EXISTS idx_polyline_gist;
DROP INDEX IF EXISTS idx_startpoint_gist;
DROP INDEX IF EXISTS idx_endpoint_gist;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1386327623620000077	0.04873699560840406	65	103	11	1530	"2013-12-06 11:00:23"	"2013-12-06 11:25:53"	"0102000020E61000006700000061FE0A992B2B21C0096D3997E29444407A19C5724B2B21C07C7C4276DE944440DF6DDE38292C21C04303B16CE69444409065C1C41F2D21C063F20698F9944440AA9D616A4B2D21C0F6D37FD6FC94444010CB660E492D21C0A379008BFC944440C36169E0472D21C04F1F813FFC944440C36169E0472D21C04F1F813FFC944440F7065F984C2D21C0F6D37FD6FC9444402A0307B4742D21C0DC0F7860009544402A0307B4742D21C089B5F814009544402A0307B4742D21C089B5F81400954440766C04E2752D21C0DC0F78600095444042AF3F89CF2D21C0BC5AEECC04954440DC813AE5D12D21C0BC5AEECC049544400FB8AE98112E21C043209738F2944440F415A4198B2E21C096236420CF94444027FA7C94112F21C05645B8C9A894444072DC291DAC2F21C003B16CE690944440573F36C98F3021C0AA656B7D91944440D5CBEF34993121C010B056ED9A944440EEEBC039233221C0F0FACC599F94444053AF5B04C63221C023A0C211A494444085CD0017643321C0DD274701A294444038F581E49D3321C0EAB298D87C9444401E6B4606B93321C04AD235936F94444005E10A28D43321C0842EE1D05B944440D1CC936B0A3421C06A1327F73B9444401E8D43FD2E3421C02461DF4E22944440B7B6F0BC543421C017450F7C0C94444083A279008B3421C05E66D828EB934440E9D495CFF23421C0F8E12021CA934440E89FE062453521C085D21742CE9344409B70AFCC5B3521C07EE19524CF934440014C1938A03521C0FEB5BC72BD934440CE548847E23521C09E3F6D54A793444099F38C7DC93621C0EBA86A82A8934440E4DA5031CE3721C0381268B0A9934440965984622B3821C0857B65DEAA934440B01D8CD8273821C0D8D5E429AB934440164B917C253821C07E8AE3C0AB93444030833122513821C0EBA86A82A8934440FDFA2136583821C06552431B80934440AF05BD37863821C0D9278062649344402FA52E19C73821C01F49490F439344409529E620E83821C0FF59F3E32F9344401555BFD2F93821C01FF296AB1F93444015C95702293921C00611A969179344407BD976DA1A3921C0664D2CF01593444095D74AE82E3921C0BF982D591593444095F430B43A3921C0C689AF7614934440FB3E1C24443921C026C632FD12934440FB3E1C24443921C02CB7B41A129344402EE411DC483921C08602B68311934440FB5B02F04F3921C08CF337A1109344402E01F8A7543921C0467BBC900E93444048E2E5E95C3921C0408A3A730F934440AE0FEB8D5A3921C093E4B9BE0F934440E197FA79533921C0EC2FBB270F934440E1B4E0455F3921C0F3203D450E934440145AD6FD633921C04C6C3EAE0D934440C7F0D8CF623921C0F911BF620D9344402E1EDE73603921C0F911BF620D9344402E1EDE73603921C0F911BF620D9344407B87DBA1613921C0F911BF620D934440FB95CE87673921C080F44D9A069344402E3BC43F6C3921C0EC12D55B039344407BA4C16D6D3921C0465ED6C402934440C70DBF9B6E3921C0465ED6C402934440FBB2B453733921C079E6E5B0FB924440C7478B33863921C0F9D7F2CAF5924440FAEC80EB8A3921C0F3E670ADF6924440AE8383BD893921C0999B6F44F7924440618E1EBFB73921C0D9226937FA924440946DE00ED43921C080D767CEFA9244407AA9D898D73921C02C7DE882FA92444060E5D022DB3921C080D767CEFA924440F9484A7A183A21C0209BE447FC924440ACC77DAB753A21C079E6E5B0FB924440F9307BD9763A21C0C64FE3DEFC924440F9307BD9763A21C073F56393FC924440469A7807783A21C0209BE447FC92444079793A57943A21C0D9226937FA9244402C4A09C1AA3A21C0938D075BEC924440C51C041DAD3A21C0EDD808C4EB924440C51C041DAD3A21C04033880FEC9244404582A966D63A21C0008FA850DD9244402BBEA1F0D93A21C060CB2BD7DB9244402BBEA1F0D93A21C006802A6EDC924440DE54A4C2D83A21C059DAA9B9DC924440C5909C4CDC3A21C0B9162D40DB92444011A8FE41243B21C0739EB12FD992444044DE72F5633B21C06DAD2F12DA9244405D6DC5FEB23B21C0D3DA34B6D7924440C3482F6AF73B21C0C6F8307BD9924440DC291DACFF3B21C0204432E4D8924440C382FB010F3C21C07A8F334DD89244408F6E8445453C21C0DACBB6D3D69244408FC536A9683C21C0739EB12FD9924440A9893E1F653C21C06DAD2F12DA924440A9893E1F653C21C0C007AF5DDA924440F5F23B4D663C21C01A53B0C6D9924440F5F23B4D663C21C0C6F8307BD9924440"
1396261081620000458	0.04910619807741667	65	65	11	960	"2014-03-31 11:18:01"	"2014-03-31 11:34:01"	"0102000020E610000041000000E129E44A3D2B21C0768BC058DF944440DF3312A1112C21C0A930B610E49444402B685A62652C21C0234E27D9EA944440DFFE5C34642C21C07C992842EA944440C43F6CE9D12C21C0967A1684F2944440C30FCEA78E2D21C0C93CF20703954440293DD34B8C2D21C0C24B70EA0395444076A6D0798D2D21C016A6EF3504954440906AD8EF892D21C06FF1F09E039544405C7347FFCB2D21C0620FED630595444076711B0DE02D21C02F6AF7AB00954440295FD042022E21C0C91F0C3CF7944440DB34B6D7822E21C030F65E7CD19444400DFCA886FD2E21C083F92B64AE944440F2B56796043021C02366F6798C94444022FB20CB823121C0D0285DFA97944440A1BC8FA3393221C0AA8251499D944440A1BC8FA3393221C0FDDCD0949D944440EE258DD13A3221C0FDDCD0949D944440215C01857A3221C03D64CA87A094444039B69E211C3321C016BEBED6A59444401FA0FB72663321C0C3633F8BA5944440384C3448C13321C0172D40DB6A9444401E537765173421C0B75F3E5931944440842EE1D05B3421C037FA980F08944440B72A89EC833421C0F838D384ED9344409DBD33DAAA3421C098C28366D7934440B6813B50A73421C04568041BD7934440E94317D4B73421C0E50E9BC8CC9344400281CEA44D3521C0317898F6CD93444068791EDC9D3521C08BC3995FCD9344401B2D077AA83521C0925D6919A9934440E622BE13B33621C0EBA86A82A893444017BA1281EA3721C0E5B7E864A99344407D789620233821C0D2E4620CAC934440E3A59BC4203821C0D2E4620CAC934440C9552C7E533821C005508C2C99934440C972124A5F3821C01FBDE13E7293444095D233BDC43821C0ECC039234A9344402FC214E5D23821C079944A784293444094111780463921C052D158FB3B934440471CB281743921C0AC1C5A643B934440605969520A3A21C03FE1ECD63293444093ACC3D1553A21C0992CEE3F32934440DF6C73637A3A21C020D5B0DF139344401212691B7F3A21C08602B683119344401212691B7F3A21C080113466129344401212691B7F3A21C026C632FD129344405F7B6649803A21C026C632FD129344401212691B7F3A21C08011346612934440793F6EBF7C3A21C0D36BB3B112934440C6A86BED7D3A21C02CB7B41A12934440C6A86BED7D3A21C08602B6831193444045B75ED3833A21C04C6C3EAE0D934440795C548B883A21C093C7D3F20393444078EDD286C33A21C0E6CAA0DAE0924440C5909C4CDC3A21C01A53B0C6D9924440789B374E0A3B21C02635B401D89244402AE09EE74F3B21C06DAD2F12DA924440111C9771533B21C06DAD2F12DA9244405E85949F543B21C01A53B0C6D9924440DE9387855A3B21C01A53B0C6D9924440F705F4C29D3B21C03A083A5AD5924440C39FE1CD1A3C21C02635B401D89244400F09DFFB1B3C21C07A8F334DD8924440"
1374746530620000233	0.06692773162239422	65	71	11	1050	"2013-07-25 11:02:10"	"2013-07-25 11:19:40"	"0102000020E61000004700000094A30051302B21C0C3F4BD86E0944440C6302768932B21C0904FC8CEDB94444092EC116A862C21C00F7BA180ED9444405D8B16A06D2D21C0DC0F786000954440F697DD93872D21C01C97715303954440F697DD93872D21C0C93CF20703954440906AD8EF892D21C02288F37002954440DC813AE5D12D21C0C93CF20703954440F6622827DA2D21C02F6AF7AB0095444029081EDFDE2D21C0E200FA7DFF9444404145D5AF742E21C023145B41D394444026512FF8342F21C05628D2FD9C944440D8F15F20083021C0D00B772E8C944440560F98874C3121C0D619DF1797944440BC24CE8AA83121C0C34659BF99944440A06F0B96EA3221C0C3633F8BA59444406C43C5387F3321C076DD5B91989444406B0E10CCD13321C017105A0F5F944440B7990AF1483421C0E4D9E55B1F9444409DA04D0E9F3421C011FDDAFAE993444050C8CEDBD83421C03E5A9C31CC9344404E5E64027E3521C0259694BBCF9344409B1E1494A23521C071E2AB1DC5934440E7525C55F63521C0984EEB36A8934440666B7D91D03621C0FE7BF0DAA593444018EAB0C22D3721C0984EEB36A8934440FEF0F3DF833721C0925D6919A99344409702D2FE073821C0F299EC9FA79344404AB6BA9C123821C0E5B7E864A99344407D5BB054173821C08B6CE7FBA99344404AD3A0681E3821C0D2E4620CAC9344404AD3A0681E3821C05ED5592DB09344407DEC2E50523821C0AB21718FA5934440FDFA2136583821C0ACADD85F7693444096CD1C925A3821C00CEA5BE674934440FC170802643821C04563EDEF6C934440FBE769C0203921C0E6CFB7054B934440E162450DA63921C052D158FB3B93444013BBB6B75B3A21C03FE1ECD63293444079793A57943A21C0A0C6BDF90D934440925A28999C3A21C013B9E00CFE924440DFC325C79D3A21C06C04E275FD924440124C35B3963A21C0C05E61C1FD9244402C103D29933A21C079E6E5B0FB9244405F46B1DCD23A21C06DCA15DEE5924440DE54A4C2D83A21C0C6151747E5924440DE718A8EE43A21C0D3F71A82E3924440446ADAC5343B21C059DAA9B9DC924440AA622AFD843B21C0739EB12FD9924440DD5ED218AD3B21C08080B56AD792444076887FD8D23B21C0204432E4D892444076DF313CF63B21C0C6F8307BD99244405C1B2AC6F93B21C01A53B0C6D99244408F17D2E1213C21C01A53B0C6D99244408FC536A9683C21C0008FA850DD924440A8A624EB703C21C06DCA15DEE5924440DC4B1AA3753C21C0938D075BEC9244400F2BDCF2913C21C02C7DE882FA924440C1A90F24EF3C21C0E621533E04934440F4DF83D72E3D21C0A69A594B01934440C15774EB353D21C013B9E00CFE92444041834D9D473D21C0395FECBDF8924440A7B05241453D21C093AAED26F8924440F3AACE6A813D21C0F9BA0CFFE99244408DB7955E9B3D21C09961A3ACDF924440A67B9DD4973D21C0A05225CADE9244405A12A0A6963D21C0A643A7E7DD924440F3E49A02993D21C08D62B9A5D5924440DAACFA5C6D3D21C0DAAED007CB92444040DAFF006B3D21C0865451BCCA924440DAACFA5C6D3D21C033FAD170CA924440"
1390305251620000053	0.12509431872110693	65	116	11	1725	"2014-01-21 11:54:11"	"2014-01-21 12:22:56"	"0102000020E61000007400000014950D6B2A2B21C0C3F4BD86E0944440C72B103D292B21C0BC033C69E19444402D93E1783E2B21C02331410DDF94444013656F29E72B21C0709A3E3BE094444011001C7BF62C21C0295C8FC2F5944440C3B81B446B2D21C0365B79C9FF94444076FD82DDB02D21C00FB56D1805954440F6622827DA2D21C07CD3F4D901954440C24EB16A102E21C0E9D495CFF29444408EE89E758D2E21C0E38C614ED09444408D4468041B2F21C0C3633F8BA59444400CCC0A45BA2F21C01684F23E8E944440713D0AD7A33021C0AA656B7D919444400932022A1C3121C03656629E95944440889CBE9EAF3121C016A1D80A9A944440EE258DD13A3221C0503750E09D944440863C821B293321C0CA54C1A8A49444401F49490F433321C0C3633F8BA5944440D2FC31AD4D3321C076FA415DA4944440B972F6CE683321C023A0C211A494444052F355F2B13321C0371C96067E944440058A58C4B03321C070952710769444401EC2F869DC3321C0A4E36A64579444409E44847F113421C0D731AEB8389444400420EEEA553421C0047289230F9444401DAF40F4A43421C018D1764CDD93444003081F4AB43421C071FF91E9D09344403621AD31E83421C04B3CA06CCA93444002F566D47C3521C07EE19524CF9344401B1021AE9C3521C09E961FB8CA9344404EEFE2FDB83521C0984EEB36A89344401A89D008363621C0A530EF71A6934440992842EA763621C058C7F143A593444066BD18CA893621C04C8E3BA583934440198EE733A03621C06552431B809344407FF5B86FB53621C07825C9737D934440FF774485EA3621C0396403E962934440338CBB41B43621C0B9382A3751934440B2D47ABFD13621C03FFED2A23E93444099840B79043721C033E202D028934440E544BB0A293721C033A83638119344404BAC8C463E3721C00CE544BB0A934440B2F677B6473721C099B8551003934440CB113290673721C0F9D7F2CAF59244404ACE893DB43721C09370218FE0924440309B00C3F23721C0D9E89C9FE2924440B05758703F3821C0B933130CE7924440967B8159A13821C086AB0320EE9244402FA52E19C73821C0AD6EF59CF4924440FCFF3861C23821C05323F433F5924440AF963B33C13821C05323F433F5924440FCFF3861C23821C05323F433F592444095D233BDC43821C05323F433F59244402FA52E19C73821C000C974E8F4924440624A24D1CB3821C000C974E8F4924440AFB321FFCC3821C0AD6EF59CF4924440AFB321FFCC3821C0AD6EF59CF492444049861C5BCF3821C0AD6EF59CF49244402FC214E5D23821C006BAF605F4924440E25817B7D13821C00DAB7823F392444095EF1989D03821C06005F86EF392444095EF1989D03821C06005F86EF3924440C8940F41D53821C06005F86EF392444062670A9DD73821C06005F86EF392444062670A9DD73821C06005F86EF392444062670A9DD73821C0B35F77BAF3924440950C0055DC3821C06005F86EF3924440E275FD82DD3821C00DAB7823F392444048A30227DB3821C00DAB7823F3924440FC3905F9D93821C00DAB7823F3924440AFD007CBD83821C06005F86EF3924440950C0055DC3821C06005F86EF39244407C48F8DEDF3821C06005F86EF39244407C48F8DEDF3821C00DAB7823F39244407C48F8DEDF3821C00DAB7823F39244407C48F8DEDF3821C00DAB7823F39244402FDFFAB0DE3821C06005F86EF39244402FDFFAB0DE3821C00DAB7823F3924440E275FD82DD3821C00DAB7823F3924440E275FD82DD3821C06005F86EF3924440E275FD82DD3821C006BAF605F4924440C8B1F50CE13821C0AD6EF59CF49244409529E620E83821C05323F433F592444048C0E8F2E63821C05323F433F5924440AFEDED96E43821C05323F433F59244407C48F8DEDF3821C000C974E8F4924440950C0055DC3821C0AD6EF59CF4924440C8B1F50CE13821C059147651F4924440C8B1F50CE13821C059147651F4924440950C0055DC3821C0AD6EF59CF492444048A30227DB3821C0AD6EF59CF4924440950C0055DC3821C000C974E8F492444062670A9DD73821C000C974E8F4924440AFD007CBD83821C0F9D7F2CAF5924440AF963B33C13821C0406D54A703934440E38DCC237F3821C0B9A7AB3B1693444016F9F5436C3821C06C3EAE0D159344407DB262B83A3821C0CC5D4BC807934440CA332F87DD3721C06005F86EF39244404B94BDA59C3721C066D993C0E6924440CAA7C7B60C3821C0C0249529E69244401650A8A78F3821C0F3C98AE1EA924440C8CEDBD8EC3821C0394206F2EC924440FA0967B7963921C05323F433F59244402716F88A6E3D21C0EDD808C4EB9244400DC68844A13D21C03317B83CD6924440C022BF7E883D21C086376BF0BE92444073B9C150873D21C040BFEFDFBC924440F4DF83D72E3D21C0D3838252B49244404227840EBA3C21C00D1AFA27B8924440751E15FF773C21C04DA1F31ABB924440C2D9AD65323C21C0ADC090D5AD924440A98427F4FA3B21C0A7785C548B9244402AE09EE74F3B21C087E0B88C9B924440DFC325C79D3A21C0605793A7AC9244407905A227653A21C06765FB90B7924440"
1377857809620000458	0.1811634659993304	65	80	11	1185	"2013-08-30 11:16:49"	"2013-08-30 11:36:34"	"0102000020E6100000500000002FE065868D2A21C0E92B4833169544407C2C7DE8822A21C09CC24A051595444015FF7744852A21C002F04FA91295444015A8C5E0612A21C03C69E1B20A954440151C5E10912A21C08FFD2C9622954440FDA4DAA7E32921C07C478D093195444062BF27D6A92A21C0E257ACE122954440FAB836548C2B21C01CD13DEB1A954440DEACC1FBAA2C21C075560BEC3195444090D959F44E2D21C0E29178793A954440F7065F984C2D21C0280AF4893C954440F7065F984C2D21C01C28F04E3E9544405D34643C4A2D21C0BCEB6CC83F954440AA9D616A4B2D21C062A06B5F40954440C3D50110772D21C01C28F04E3E954440DC476E4DBA2D21C0B686527B11954440761A69A9BC2D21C07CF0DAA50D9544400F61FC34EE2D21C0A379008BFC9444404128EFE3682E21C056B950F9D794444040F850A2252F21C083DC4598A2944440F2D24D62103021C0C32973F38D94444009E066F1623121C01D925A28999444406DCA15DEE53221C0C3633F8BA59444409DF2E846583421C089EAAD81AD94444082C476F7003521C0A9BC1DE1B4944440B64C86E3F93421C056629E95B49444409CFC169D2C3521C09DDA19A6B6944440CD02ED0E293621C010070951BE944440FE99417C603721C01615713AC994444017F4DE18023821C0B6BB07E8BE9444406397A8DE1A3821C029AE2AFBAE9444407D5BB054173821C07D08AA46AF944440B05758703F3821C09D836742939444407DCF4884463821C06ADE718A8E94444096B036C64E3821C00A4B3CA06C94444049641F64593821C0919C4CDC2A94444016DC0F78603821C09E44847F1194444030A017EE5C3821C01EA5129ED0934440C9552C7E533821C05F61C1FD80934440C9ACDEE1763821C0593673486A934440AF5C6F9BA93821C039471D1D57934440622D3E05C03821C0FFB0A547539344407ADE8D05853921C02C2B4D4A41934440132A38BC203A21C01F2C634337934440C634D3BD4E3A21C00C3CF71E2E934440DF4F8D976E3A21C0B3B6291E1793444092037635793A21C0594E42E90B934440C5C551B9893A21C06C21C84109934440F96A47718E3A21C0338B506C059344402C103D29933A21C08CD651D504934440DFA63FFB913A21C0406D54A703934440923D42CD903A21C0F9F4D89601934440F8DEDFA0BD3A21C02D431CEBE2924440AB92C83EC83A21C0F3ACA415DF9244404565C39ACA3A21C053E9279CDD924440F8359204E13A21C0D3DA34B6D7924440DE76A1B94E3B21C0CDE9B298D8924440C32B499EEB3B21C01A53B0C6D99244407670B037313C21C0DACBB6D3D69244407670B037313C21C03317B83CD69244405CACA8C1343C21C0E0BC38F1D5924440DC114E0B5E3C21C0FA804067D2924440A94F72874D3C21C00055DCB8C59244405CE674594C3C21C053AF5B04C6924440A94F72874D3C21C053AF5B04C69244405CE674594C3C21C0A609DB4FC6924440F69B89E9423C21C093196F2BBD92444029CDE671183C21C007D2C5A6959244401021AE9CBD3B21C0FAD2DB9F8B924440DEE522BE133B21C0BA85AE44A0924440118B1876183B21C0B4942C27A1924440C4211B48173B21C05A492BBEA1924440C4211B48173B21C05A492BBEA192444078B81D1A163B21C0603AADDBA09244402B4F20EC143B21C00DE02D90A0924440DEE522BE133B21C00DE02D90A0924440DEE522BE133B21C00DE02D90A09244402B4F20EC143B21C00DE02D90A0924440118B1876183B21C007EFAB72A1924440118B1876183B21C0B4942C27A1924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=347.811..347.812 rows=5 loops=1)"
"  Buffers: shared hit=19058 read=250562"
"Planning Time: 0.061 ms"
"Execution Time: 347.850 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.051s
NOTICE:  [Memory Estimation] Candidates: 10, Avg length: 84.9, Max: 116, Min: 65, Total points: 849
NOTICE:  [Memory Estimation] Approx DTW memory usage: 0.84 MB
NOTICE:  DTW computation time for 10 candidates: 0.048s
NOTICE:  Total UDF execution time: 0.355s

Successfully run. Total query runtime: 376 msec.
5 rows affected.
 */

/* Test Case 3.3: Find top 5 trips most similar to trip ID 1385464940620000152 (Football field -> Hospital at 11am) with no limit (set 99999 as max) point count difference. */
/* Test Case 3.3 with Both B-tree and GiST will be applied on attributes mentioned in index method 1 & 2 */
CREATE INDEX idx_trip_id ON taxi_trajectory (trip_id);
CREATE INDEX idx_hour_of_day ON taxi_trajectory (hour_of_day);
CREATE INDEX idx_point_count ON taxi_trajectory (point_count);
CREATE INDEX idx_polyline_gist ON taxi_trajectory USING gist (polyline);
CREATE INDEX idx_startpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_StartPoint(polyline), 3857));
CREATE INDEX idx_endpoint_gist ON taxi_trajectory USING gist (ST_Transform(ST_EndPoint(polyline), 3857));

-- EXPLAIN (ANALYZE ON, BUFFERS ON)
SELECT * FROM find_top5_similar_trips(1385464940620000152, 0, 99999);

DROP INDEX IF EXISTS idx_trip_id;
DROP INDEX IF EXISTS idx_hour_of_day;
DROP INDEX IF EXISTS idx_point_count;
DROP INDEX IF EXISTS idx_polyline_gist;
DROP INDEX IF EXISTS idx_startpoint_gist;
DROP INDEX IF EXISTS idx_endpoint_gist;
/* Outputs:
"similar_trip_id"	"dtw_distance"	"base_point_count"	"similar_point_count"	"similar_hour_of_day"	"similar_total_travel_time"	"similar_start_local_time"	"similar_end_local_time"	"similar_polyline"
1386327623620000077	0.04873699560840406	65	103	11	1530	"2013-12-06 11:00:23"	"2013-12-06 11:25:53"	"0102000020E61000006700000061FE0A992B2B21C0096D3997E29444407A19C5724B2B21C07C7C4276DE944440DF6DDE38292C21C04303B16CE69444409065C1C41F2D21C063F20698F9944440AA9D616A4B2D21C0F6D37FD6FC94444010CB660E492D21C0A379008BFC944440C36169E0472D21C04F1F813FFC944440C36169E0472D21C04F1F813FFC944440F7065F984C2D21C0F6D37FD6FC9444402A0307B4742D21C0DC0F7860009544402A0307B4742D21C089B5F814009544402A0307B4742D21C089B5F81400954440766C04E2752D21C0DC0F78600095444042AF3F89CF2D21C0BC5AEECC04954440DC813AE5D12D21C0BC5AEECC049544400FB8AE98112E21C043209738F2944440F415A4198B2E21C096236420CF94444027FA7C94112F21C05645B8C9A894444072DC291DAC2F21C003B16CE690944440573F36C98F3021C0AA656B7D91944440D5CBEF34993121C010B056ED9A944440EEEBC039233221C0F0FACC599F94444053AF5B04C63221C023A0C211A494444085CD0017643321C0DD274701A294444038F581E49D3321C0EAB298D87C9444401E6B4606B93321C04AD235936F94444005E10A28D43321C0842EE1D05B944440D1CC936B0A3421C06A1327F73B9444401E8D43FD2E3421C02461DF4E22944440B7B6F0BC543421C017450F7C0C94444083A279008B3421C05E66D828EB934440E9D495CFF23421C0F8E12021CA934440E89FE062453521C085D21742CE9344409B70AFCC5B3521C07EE19524CF934440014C1938A03521C0FEB5BC72BD934440CE548847E23521C09E3F6D54A793444099F38C7DC93621C0EBA86A82A8934440E4DA5031CE3721C0381268B0A9934440965984622B3821C0857B65DEAA934440B01D8CD8273821C0D8D5E429AB934440164B917C253821C07E8AE3C0AB93444030833122513821C0EBA86A82A8934440FDFA2136583821C06552431B80934440AF05BD37863821C0D9278062649344402FA52E19C73821C01F49490F439344409529E620E83821C0FF59F3E32F9344401555BFD2F93821C01FF296AB1F93444015C95702293921C00611A969179344407BD976DA1A3921C0664D2CF01593444095D74AE82E3921C0BF982D591593444095F430B43A3921C0C689AF7614934440FB3E1C24443921C026C632FD12934440FB3E1C24443921C02CB7B41A129344402EE411DC483921C08602B68311934440FB5B02F04F3921C08CF337A1109344402E01F8A7543921C0467BBC900E93444048E2E5E95C3921C0408A3A730F934440AE0FEB8D5A3921C093E4B9BE0F934440E197FA79533921C0EC2FBB270F934440E1B4E0455F3921C0F3203D450E934440145AD6FD633921C04C6C3EAE0D934440C7F0D8CF623921C0F911BF620D9344402E1EDE73603921C0F911BF620D9344402E1EDE73603921C0F911BF620D9344407B87DBA1613921C0F911BF620D934440FB95CE87673921C080F44D9A069344402E3BC43F6C3921C0EC12D55B039344407BA4C16D6D3921C0465ED6C402934440C70DBF9B6E3921C0465ED6C402934440FBB2B453733921C079E6E5B0FB924440C7478B33863921C0F9D7F2CAF5924440FAEC80EB8A3921C0F3E670ADF6924440AE8383BD893921C0999B6F44F7924440618E1EBFB73921C0D9226937FA924440946DE00ED43921C080D767CEFA9244407AA9D898D73921C02C7DE882FA92444060E5D022DB3921C080D767CEFA924440F9484A7A183A21C0209BE447FC924440ACC77DAB753A21C079E6E5B0FB924440F9307BD9763A21C0C64FE3DEFC924440F9307BD9763A21C073F56393FC924440469A7807783A21C0209BE447FC92444079793A57943A21C0D9226937FA9244402C4A09C1AA3A21C0938D075BEC924440C51C041DAD3A21C0EDD808C4EB924440C51C041DAD3A21C04033880FEC9244404582A966D63A21C0008FA850DD9244402BBEA1F0D93A21C060CB2BD7DB9244402BBEA1F0D93A21C006802A6EDC924440DE54A4C2D83A21C059DAA9B9DC924440C5909C4CDC3A21C0B9162D40DB92444011A8FE41243B21C0739EB12FD992444044DE72F5633B21C06DAD2F12DA9244405D6DC5FEB23B21C0D3DA34B6D7924440C3482F6AF73B21C0C6F8307BD9924440DC291DACFF3B21C0204432E4D8924440C382FB010F3C21C07A8F334DD89244408F6E8445453C21C0DACBB6D3D69244408FC536A9683C21C0739EB12FD9924440A9893E1F653C21C06DAD2F12DA924440A9893E1F653C21C0C007AF5DDA924440F5F23B4D663C21C01A53B0C6D9924440F5F23B4D663C21C0C6F8307BD9924440"
1396261081620000458	0.04910619807741667	65	65	11	960	"2014-03-31 11:18:01"	"2014-03-31 11:34:01"	"0102000020E610000041000000E129E44A3D2B21C0768BC058DF944440DF3312A1112C21C0A930B610E49444402B685A62652C21C0234E27D9EA944440DFFE5C34642C21C07C992842EA944440C43F6CE9D12C21C0967A1684F2944440C30FCEA78E2D21C0C93CF20703954440293DD34B8C2D21C0C24B70EA0395444076A6D0798D2D21C016A6EF3504954440906AD8EF892D21C06FF1F09E039544405C7347FFCB2D21C0620FED630595444076711B0DE02D21C02F6AF7AB00954440295FD042022E21C0C91F0C3CF7944440DB34B6D7822E21C030F65E7CD19444400DFCA886FD2E21C083F92B64AE944440F2B56796043021C02366F6798C94444022FB20CB823121C0D0285DFA97944440A1BC8FA3393221C0AA8251499D944440A1BC8FA3393221C0FDDCD0949D944440EE258DD13A3221C0FDDCD0949D944440215C01857A3221C03D64CA87A094444039B69E211C3321C016BEBED6A59444401FA0FB72663321C0C3633F8BA5944440384C3448C13321C0172D40DB6A9444401E537765173421C0B75F3E5931944440842EE1D05B3421C037FA980F08944440B72A89EC833421C0F838D384ED9344409DBD33DAAA3421C098C28366D7934440B6813B50A73421C04568041BD7934440E94317D4B73421C0E50E9BC8CC9344400281CEA44D3521C0317898F6CD93444068791EDC9D3521C08BC3995FCD9344401B2D077AA83521C0925D6919A9934440E622BE13B33621C0EBA86A82A893444017BA1281EA3721C0E5B7E864A99344407D789620233821C0D2E4620CAC934440E3A59BC4203821C0D2E4620CAC934440C9552C7E533821C005508C2C99934440C972124A5F3821C01FBDE13E7293444095D233BDC43821C0ECC039234A9344402FC214E5D23821C079944A784293444094111780463921C052D158FB3B934440471CB281743921C0AC1C5A643B934440605969520A3A21C03FE1ECD63293444093ACC3D1553A21C0992CEE3F32934440DF6C73637A3A21C020D5B0DF139344401212691B7F3A21C08602B683119344401212691B7F3A21C080113466129344401212691B7F3A21C026C632FD129344405F7B6649803A21C026C632FD129344401212691B7F3A21C08011346612934440793F6EBF7C3A21C0D36BB3B112934440C6A86BED7D3A21C02CB7B41A12934440C6A86BED7D3A21C08602B6831193444045B75ED3833A21C04C6C3EAE0D934440795C548B883A21C093C7D3F20393444078EDD286C33A21C0E6CAA0DAE0924440C5909C4CDC3A21C01A53B0C6D9924440789B374E0A3B21C02635B401D89244402AE09EE74F3B21C06DAD2F12DA924440111C9771533B21C06DAD2F12DA9244405E85949F543B21C01A53B0C6D9924440DE9387855A3B21C01A53B0C6D9924440F705F4C29D3B21C03A083A5AD5924440C39FE1CD1A3C21C02635B401D89244400F09DFFB1B3C21C07A8F334DD8924440"
1374746530620000233	0.06692773162239422	65	71	11	1050	"2013-07-25 11:02:10"	"2013-07-25 11:19:40"	"0102000020E61000004700000094A30051302B21C0C3F4BD86E0944440C6302768932B21C0904FC8CEDB94444092EC116A862C21C00F7BA180ED9444405D8B16A06D2D21C0DC0F786000954440F697DD93872D21C01C97715303954440F697DD93872D21C0C93CF20703954440906AD8EF892D21C02288F37002954440DC813AE5D12D21C0C93CF20703954440F6622827DA2D21C02F6AF7AB0095444029081EDFDE2D21C0E200FA7DFF9444404145D5AF742E21C023145B41D394444026512FF8342F21C05628D2FD9C944440D8F15F20083021C0D00B772E8C944440560F98874C3121C0D619DF1797944440BC24CE8AA83121C0C34659BF99944440A06F0B96EA3221C0C3633F8BA59444406C43C5387F3321C076DD5B91989444406B0E10CCD13321C017105A0F5F944440B7990AF1483421C0E4D9E55B1F9444409DA04D0E9F3421C011FDDAFAE993444050C8CEDBD83421C03E5A9C31CC9344404E5E64027E3521C0259694BBCF9344409B1E1494A23521C071E2AB1DC5934440E7525C55F63521C0984EEB36A8934440666B7D91D03621C0FE7BF0DAA593444018EAB0C22D3721C0984EEB36A8934440FEF0F3DF833721C0925D6919A99344409702D2FE073821C0F299EC9FA79344404AB6BA9C123821C0E5B7E864A99344407D5BB054173821C08B6CE7FBA99344404AD3A0681E3821C0D2E4620CAC9344404AD3A0681E3821C05ED5592DB09344407DEC2E50523821C0AB21718FA5934440FDFA2136583821C0ACADD85F7693444096CD1C925A3821C00CEA5BE674934440FC170802643821C04563EDEF6C934440FBE769C0203921C0E6CFB7054B934440E162450DA63921C052D158FB3B93444013BBB6B75B3A21C03FE1ECD63293444079793A57943A21C0A0C6BDF90D934440925A28999C3A21C013B9E00CFE924440DFC325C79D3A21C06C04E275FD924440124C35B3963A21C0C05E61C1FD9244402C103D29933A21C079E6E5B0FB9244405F46B1DCD23A21C06DCA15DEE5924440DE54A4C2D83A21C0C6151747E5924440DE718A8EE43A21C0D3F71A82E3924440446ADAC5343B21C059DAA9B9DC924440AA622AFD843B21C0739EB12FD9924440DD5ED218AD3B21C08080B56AD792444076887FD8D23B21C0204432E4D892444076DF313CF63B21C0C6F8307BD99244405C1B2AC6F93B21C01A53B0C6D99244408F17D2E1213C21C01A53B0C6D99244408FC536A9683C21C0008FA850DD924440A8A624EB703C21C06DCA15DEE5924440DC4B1AA3753C21C0938D075BEC9244400F2BDCF2913C21C02C7DE882FA924440C1A90F24EF3C21C0E621533E04934440F4DF83D72E3D21C0A69A594B01934440C15774EB353D21C013B9E00CFE92444041834D9D473D21C0395FECBDF8924440A7B05241453D21C093AAED26F8924440F3AACE6A813D21C0F9BA0CFFE99244408DB7955E9B3D21C09961A3ACDF924440A67B9DD4973D21C0A05225CADE9244405A12A0A6963D21C0A643A7E7DD924440F3E49A02993D21C08D62B9A5D5924440DAACFA5C6D3D21C0DAAED007CB92444040DAFF006B3D21C0865451BCCA924440DAACFA5C6D3D21C033FAD170CA924440"
1390305251620000053	0.12509431872110693	65	116	11	1725	"2014-01-21 11:54:11"	"2014-01-21 12:22:56"	"0102000020E61000007400000014950D6B2A2B21C0C3F4BD86E0944440C72B103D292B21C0BC033C69E19444402D93E1783E2B21C02331410DDF94444013656F29E72B21C0709A3E3BE094444011001C7BF62C21C0295C8FC2F5944440C3B81B446B2D21C0365B79C9FF94444076FD82DDB02D21C00FB56D1805954440F6622827DA2D21C07CD3F4D901954440C24EB16A102E21C0E9D495CFF29444408EE89E758D2E21C0E38C614ED09444408D4468041B2F21C0C3633F8BA59444400CCC0A45BA2F21C01684F23E8E944440713D0AD7A33021C0AA656B7D919444400932022A1C3121C03656629E95944440889CBE9EAF3121C016A1D80A9A944440EE258DD13A3221C0503750E09D944440863C821B293321C0CA54C1A8A49444401F49490F433321C0C3633F8BA5944440D2FC31AD4D3321C076FA415DA4944440B972F6CE683321C023A0C211A494444052F355F2B13321C0371C96067E944440058A58C4B03321C070952710769444401EC2F869DC3321C0A4E36A64579444409E44847F113421C0D731AEB8389444400420EEEA553421C0047289230F9444401DAF40F4A43421C018D1764CDD93444003081F4AB43421C071FF91E9D09344403621AD31E83421C04B3CA06CCA93444002F566D47C3521C07EE19524CF9344401B1021AE9C3521C09E961FB8CA9344404EEFE2FDB83521C0984EEB36A89344401A89D008363621C0A530EF71A6934440992842EA763621C058C7F143A593444066BD18CA893621C04C8E3BA583934440198EE733A03621C06552431B809344407FF5B86FB53621C07825C9737D934440FF774485EA3621C0396403E962934440338CBB41B43621C0B9382A3751934440B2D47ABFD13621C03FFED2A23E93444099840B79043721C033E202D028934440E544BB0A293721C033A83638119344404BAC8C463E3721C00CE544BB0A934440B2F677B6473721C099B8551003934440CB113290673721C0F9D7F2CAF59244404ACE893DB43721C09370218FE0924440309B00C3F23721C0D9E89C9FE2924440B05758703F3821C0B933130CE7924440967B8159A13821C086AB0320EE9244402FA52E19C73821C0AD6EF59CF4924440FCFF3861C23821C05323F433F5924440AF963B33C13821C05323F433F5924440FCFF3861C23821C05323F433F592444095D233BDC43821C05323F433F59244402FA52E19C73821C000C974E8F4924440624A24D1CB3821C000C974E8F4924440AFB321FFCC3821C0AD6EF59CF4924440AFB321FFCC3821C0AD6EF59CF492444049861C5BCF3821C0AD6EF59CF49244402FC214E5D23821C006BAF605F4924440E25817B7D13821C00DAB7823F392444095EF1989D03821C06005F86EF392444095EF1989D03821C06005F86EF3924440C8940F41D53821C06005F86EF392444062670A9DD73821C06005F86EF392444062670A9DD73821C06005F86EF392444062670A9DD73821C0B35F77BAF3924440950C0055DC3821C06005F86EF3924440E275FD82DD3821C00DAB7823F392444048A30227DB3821C00DAB7823F3924440FC3905F9D93821C00DAB7823F3924440AFD007CBD83821C06005F86EF3924440950C0055DC3821C06005F86EF39244407C48F8DEDF3821C06005F86EF39244407C48F8DEDF3821C00DAB7823F39244407C48F8DEDF3821C00DAB7823F39244407C48F8DEDF3821C00DAB7823F39244402FDFFAB0DE3821C06005F86EF39244402FDFFAB0DE3821C00DAB7823F3924440E275FD82DD3821C00DAB7823F3924440E275FD82DD3821C06005F86EF3924440E275FD82DD3821C006BAF605F4924440C8B1F50CE13821C0AD6EF59CF49244409529E620E83821C05323F433F592444048C0E8F2E63821C05323F433F5924440AFEDED96E43821C05323F433F59244407C48F8DEDF3821C000C974E8F4924440950C0055DC3821C0AD6EF59CF4924440C8B1F50CE13821C059147651F4924440C8B1F50CE13821C059147651F4924440950C0055DC3821C0AD6EF59CF492444048A30227DB3821C0AD6EF59CF4924440950C0055DC3821C000C974E8F492444062670A9DD73821C000C974E8F4924440AFD007CBD83821C0F9D7F2CAF5924440AF963B33C13821C0406D54A703934440E38DCC237F3821C0B9A7AB3B1693444016F9F5436C3821C06C3EAE0D159344407DB262B83A3821C0CC5D4BC807934440CA332F87DD3721C06005F86EF39244404B94BDA59C3721C066D993C0E6924440CAA7C7B60C3821C0C0249529E69244401650A8A78F3821C0F3C98AE1EA924440C8CEDBD8EC3821C0394206F2EC924440FA0967B7963921C05323F433F59244402716F88A6E3D21C0EDD808C4EB9244400DC68844A13D21C03317B83CD6924440C022BF7E883D21C086376BF0BE92444073B9C150873D21C040BFEFDFBC924440F4DF83D72E3D21C0D3838252B49244404227840EBA3C21C00D1AFA27B8924440751E15FF773C21C04DA1F31ABB924440C2D9AD65323C21C0ADC090D5AD924440A98427F4FA3B21C0A7785C548B9244402AE09EE74F3B21C087E0B88C9B924440DFC325C79D3A21C0605793A7AC9244407905A227653A21C06765FB90B7924440"
1377857809620000458	0.1811634659993304	65	80	11	1185	"2013-08-30 11:16:49"	"2013-08-30 11:36:34"	"0102000020E6100000500000002FE065868D2A21C0E92B4833169544407C2C7DE8822A21C09CC24A051595444015FF7744852A21C002F04FA91295444015A8C5E0612A21C03C69E1B20A954440151C5E10912A21C08FFD2C9622954440FDA4DAA7E32921C07C478D093195444062BF27D6A92A21C0E257ACE122954440FAB836548C2B21C01CD13DEB1A954440DEACC1FBAA2C21C075560BEC3195444090D959F44E2D21C0E29178793A954440F7065F984C2D21C0280AF4893C954440F7065F984C2D21C01C28F04E3E9544405D34643C4A2D21C0BCEB6CC83F954440AA9D616A4B2D21C062A06B5F40954440C3D50110772D21C01C28F04E3E954440DC476E4DBA2D21C0B686527B11954440761A69A9BC2D21C07CF0DAA50D9544400F61FC34EE2D21C0A379008BFC9444404128EFE3682E21C056B950F9D794444040F850A2252F21C083DC4598A2944440F2D24D62103021C0C32973F38D94444009E066F1623121C01D925A28999444406DCA15DEE53221C0C3633F8BA59444409DF2E846583421C089EAAD81AD94444082C476F7003521C0A9BC1DE1B4944440B64C86E3F93421C056629E95B49444409CFC169D2C3521C09DDA19A6B6944440CD02ED0E293621C010070951BE944440FE99417C603721C01615713AC994444017F4DE18023821C0B6BB07E8BE9444406397A8DE1A3821C029AE2AFBAE9444407D5BB054173821C07D08AA46AF944440B05758703F3821C09D836742939444407DCF4884463821C06ADE718A8E94444096B036C64E3821C00A4B3CA06C94444049641F64593821C0919C4CDC2A94444016DC0F78603821C09E44847F1194444030A017EE5C3821C01EA5129ED0934440C9552C7E533821C05F61C1FD80934440C9ACDEE1763821C0593673486A934440AF5C6F9BA93821C039471D1D57934440622D3E05C03821C0FFB0A547539344407ADE8D05853921C02C2B4D4A41934440132A38BC203A21C01F2C634337934440C634D3BD4E3A21C00C3CF71E2E934440DF4F8D976E3A21C0B3B6291E1793444092037635793A21C0594E42E90B934440C5C551B9893A21C06C21C84109934440F96A47718E3A21C0338B506C059344402C103D29933A21C08CD651D504934440DFA63FFB913A21C0406D54A703934440923D42CD903A21C0F9F4D89601934440F8DEDFA0BD3A21C02D431CEBE2924440AB92C83EC83A21C0F3ACA415DF9244404565C39ACA3A21C053E9279CDD924440F8359204E13A21C0D3DA34B6D7924440DE76A1B94E3B21C0CDE9B298D8924440C32B499EEB3B21C01A53B0C6D99244407670B037313C21C0DACBB6D3D69244407670B037313C21C03317B83CD69244405CACA8C1343C21C0E0BC38F1D5924440DC114E0B5E3C21C0FA804067D2924440A94F72874D3C21C00055DCB8C59244405CE674594C3C21C053AF5B04C6924440A94F72874D3C21C053AF5B04C69244405CE674594C3C21C0A609DB4FC6924440F69B89E9423C21C093196F2BBD92444029CDE671183C21C007D2C5A6959244401021AE9CBD3B21C0FAD2DB9F8B924440DEE522BE133B21C0BA85AE44A0924440118B1876183B21C0B4942C27A1924440C4211B48173B21C05A492BBEA1924440C4211B48173B21C05A492BBEA192444078B81D1A163B21C0603AADDBA09244402B4F20EC143B21C00DE02D90A0924440DEE522BE133B21C00DE02D90A0924440DEE522BE133B21C00DE02D90A09244402B4F20EC143B21C00DE02D90A0924440118B1876183B21C007EFAB72A1924440118B1876183B21C0B4942C27A1924440"
 */
/* QUERY PLAN:
"QUERY PLAN"
"Function Scan on find_top5_similar_trips  (cost=0.25..10.25 rows=1000 width=80) (actual time=105.970..105.971 rows=5 loops=1)"
"  Buffers: shared hit=3628"
"Planning Time: 0.044 ms"
"Execution Time: 106.000 ms"
 */
/* Messages:
NOTICE:  Time for candidate SQL query: 0.060s
NOTICE:  [Memory Estimation] Candidates: 10, Avg length: 84.9, Max: 116, Min: 65, Total points: 849
NOTICE:  [Memory Estimation] Approx DTW memory usage: 0.84 MB
NOTICE:  DTW computation time for 10 candidates: 0.063s
NOTICE:  Total UDF execution time: 0.126s
Successfully run. Total query runtime: 155 msec.
5 rows affected.
 */

-- Drop the UDF
DROP FUNCTION find_top5_similar_trips;
